




/*
     FILE ARCHIVED ON 0:10:53 Jun 13, 2013 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 21:15:22 Mar 8, 2015.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
*/
function RGBColor(e){this.ok=!1,"#"==e.charAt(0)&&(e=e.substr(1,6)),e=e.replace(/ /g,""),e=e.toLowerCase();var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var n in t)e==n&&(e=t[n]);for(var i=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],o=0;i.length>o;o++){var r=i[o].re,a=i[o].process,s=r.exec(e);s&&(channels=a(s),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=0>this.r||isNaN(this.r)?0:this.r>255?255:this.r,this.g=0>this.g||isNaN(this.g)?0:this.g>255?255:this.g,this.b=0>this.b||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),n=this.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),"#"+e+t+n},this.getHelpXML=function(){for(var e=[],n=0;i.length>n;n++)for(var o=i[n].example,r=0;o.length>r;r++)e[e.length]=o[r];for(var a in t)e[e.length]=a;var s=document.createElement("ul");s.setAttribute("id","rgbcolor-examples");for(var n=0;e.length>n;n++)try{var l=document.createElement("li"),c=new RGBColor(e[n]),u=document.createElement("div");u.style.cssText="margin: 3px; border: 1px solid black; background:"+c.toHex()+"; "+"color:"+c.toHex(),u.appendChild(document.createTextNode("test"));var d=document.createTextNode(" "+e[n]+" -> "+c.toRGB()+" -> "+c.toHex());l.appendChild(u),l.appendChild(d),s.appendChild(l)}catch(h){}return s}}(function(e){var t,n=/^\s*|\s*$/g,i="$1"==="B".replace(/A(.)|B/,"$1"),o={majorVersion:"@@tinymce_major_version@@",minorVersion:"@@tinymce_minor_version@@",releaseDate:"@@tinymce_release_date@@",_init:function(){function t(e){return e.src&&/tiny_mce(|_gzip|_jquery|_prototype|_full)(_dev|_src)?.js/.test(e.src)?(/_(src|dev)\.js/g.test(e.src)&&(l.suffix="_src"),-1!=(a=e.src.indexOf("?"))&&(l.query=e.src.substring(a+1)),l.baseURL=e.src.substring(0,e.src.lastIndexOf("/")),r&&-1==l.baseURL.indexOf("://")&&0!==l.baseURL.indexOf("/")&&(l.baseURL=r+l.baseURL),l.baseURL):null}var n,i,o,r,a,s,l=this,c=document,u=navigator,d=u.userAgent;if(l.isOpera=e.opera&&opera.buildNumber,l.isWebKit=/WebKit/.test(d),l.isIE=!l.isWebKit&&!l.isOpera&&/MSIE/gi.test(d)&&/Explorer/gi.test(u.appName),l.isIE6=l.isIE&&/MSIE [56]/.test(d),l.isIE7=l.isIE&&/MSIE [7]/.test(d),l.isIE8=l.isIE&&/MSIE [8]/.test(d),l.isIE9=l.isIE&&/MSIE [9]/.test(d),l.isGecko=!l.isWebKit&&/Gecko/.test(d),l.isMac=-1!=d.indexOf("Mac"),l.isAir=/adobeair/i.test(d),l.isIDevice=/(iPad|iPhone)/.test(d),l.isIOS5=l.isIDevice&&d.match(/AppleWebKit\/(\d*)/)[1]>=534,e.tinyMCEPreInit)return l.suffix=tinyMCEPreInit.suffix,l.baseURL=tinyMCEPreInit.base,l.query=tinyMCEPreInit.query,void 0;for(l.suffix="",i=c.getElementsByTagName("base"),n=0;i.length>n;n++)s=i[n].href,s&&(/^https?:\/\/[^\/]+$/.test(s)&&(s+="/"),r=s?s.match(/.*\//)[0]:"");for(i=c.getElementsByTagName("script"),n=0;i.length>n;n++)if(t(i[n]))return;if(o=c.getElementsByTagName("head")[0])for(i=o.getElementsByTagName("script"),n=0;i.length>n;n++)if(t(i[n]))return},is:function(e,n){return n?"array"==n&&e.hasOwnProperty&&e instanceof Array?!0:typeof e==n:e!==t},makeMap:function(e,t,n){var i;for(e=e||[],t=t||",","string"==typeof e&&(e=e.split(t)),n=n||{},i=e.length;i--;)n[e[i]]={};return n},each:function(e,n,i){var o,r;if(!e)return 0;if(i=i||e,e.length!==t){for(o=0,r=e.length;r>o;o++)if(n.call(i,e[o],o,e)===!1)return 0}else for(o in e)if(e.hasOwnProperty(o)&&n.call(i,e[o],o,e)===!1)return 0;return 1},trim:function(e){return(e?""+e:"").replace(n,"")},create:function(e,t,n){var i,o,r,a,s,l=this,c=0;if(e=/^((static) )?([\w.]+)(:([\w.]+))?/.exec(e),r=e[3].match(/(^|\.)(\w+)$/i)[2],o=l.createNS(e[3].replace(/\.\w+$/,""),n),!o[r]){if("static"==e[2])return o[r]=t,this.onCreate&&this.onCreate(e[2],e[3],o[r]),void 0;t[r]||(t[r]=function(){},c=1),o[r]=t[r],l.extend(o[r].prototype,t),e[5]&&(i=l.resolve(e[5]).prototype,a=e[5].match(/\.(\w+)$/i)[1],s=o[r],o[r]=c?function(){return i[a].apply(this,arguments)}:function(){return this.parent=i[a],s.apply(this,arguments)},o[r].prototype[r]=o[r],l.each(i,function(e,t){o[r].prototype[t]=i[t]}),l.each(t,function(e,t){i[t]?o[r].prototype[t]=function(){return this.parent=i[t],e.apply(this,arguments)}:t!=r&&(o[r].prototype[t]=e)})),l.each(t["static"],function(e,t){o[r][t]=e}),this.onCreate&&this.onCreate(e[2],e[3],o[r].prototype)}},walk:function(e,t,n,i){i=i||this,e&&(n&&(e=e[n]),o.each(e,function(e,r){return t.call(i,e,r,n)===!1?!1:(o.walk(e,t,n,i),void 0)}))},createNS:function(t,n){var i,o;for(n=n||e,t=t.split("."),i=0;t.length>i;i++)o=t[i],n[o]||(n[o]={}),n=n[o];return n},resolve:function(t,n){var i,o;for(n=n||e,t=t.split("."),i=0,o=t.length;o>i&&(n=n[t[i]],n);i++);return n},addUnload:function(t,n){function i(){function t(){n.detachEvent("onstop",t),o&&o(),n=0}var n=document;"interactive"==n.readyState&&(n&&n.attachEvent("onstop",t),e.setTimeout(function(){n&&n.detachEvent("onstop",t)},0))}var o,r=this;return o=function(){var t,n,a=r.unloads;if(a){for(n in a)t=a[n],t&&t.func&&t.func.call(t.scope,1);e.detachEvent?(e.detachEvent("onbeforeunload",i),e.detachEvent("onunload",o)):e.removeEventListener&&e.removeEventListener("unload",o,!1),r.unloads=t=a=w=o=0,e.CollectGarbage&&CollectGarbage()}},t={func:t,scope:n||this},r.unloads?r.unloads.push(t):(e.attachEvent?(e.attachEvent("onunload",o),e.attachEvent("onbeforeunload",i)):e.addEventListener&&e.addEventListener("unload",o,!1),r.unloads=[t]),t},removeUnload:function(e){var t=this.unloads,n=null;return o.each(t,function(i,o){return i&&i.func==e?(t.splice(o,1),n=e,!1):void 0}),n},explode:function(e,t){return!e||o.is(e,"array")?e:o.map(e.split(t||","),o.trim)},_addVer:function(e){var t;return this.query?(t=(-1==e.indexOf("?")?"?":"&")+this.query,-1==e.indexOf("#")?e+t:e.replace("#",t+"#")):e},_replace:function(e,n,o){return i?o.replace(e,function(){var e,i=n,o=arguments;for(e=0;o.length-2>e;e++)i=o[e]===t?i.replace(RegExp("\\$"+e,"g"),""):i.replace(RegExp("\\$"+e,"g"),o[e]);return i}):o.replace(e,n)}};o._init(),e.tinymce=e.tinyMCE=o})(window),function(e,t){var n,i=(t.is,/^(href|src|style)$/i);if(!e)return alert("Some of the Javascript files required for Wikispaces did not load. Please reload this page and try again. If this problem continues, make sure an anti-virus program, firewall, or web filter is not blocking Wikispaces Javascript files.");t.$=e,t.adapter={patchEditor:function(t){function o(e,t){var n=this;return t&&n.removeAttr("data-mce-style"),s.css.apply(n,arguments)}function r(e,o){var r=this;return i.test(e)?o!==n?(r.each(function(n,i){t.dom.setAttrib(i,e,o)}),r):r.attr("data-mce-"+e):s.attr.apply(r,arguments)}function a(e){return e.css!==o&&(e.css=o,e.attr=r,e.tinymce=t,e.pushStack=function(){return a(s.pushStack.apply(this,arguments))}),e}var s=e.fn;t.$=function(n,i){var o=t.getDoc();return a(e(n||o,o||i))}}},t.extend=e.extend,t.extend(t,{map:e.map,grep:function(t,n){return e.grep(t,n||function(){return 1})},inArray:function(t,n){return e.inArray(n,t||[])}});var o={"tinymce.dom.DOMUtils":{select:function(t,n){var i=this;return e.find(t,i.get(n)||i.get(i.settings.root_element)||i.doc,[])},is:function(t,n){return 1!==t.nodeType&&"*"===n?!1:e(this.get(t)).is(n)}}};t.onCreate=function(e,n,i){t.extend(i,o[n])}}(window.jQuery,tinymce),tinymce.create("tinymce.util.Dispatcher",{scope:null,listeners:null,inDispatch:!1,Dispatcher:function(e){this.scope=e||this,this.listeners=[]},add:function(e,t){return this.listeners.push({cb:e,scope:t||this.scope}),e},addToTop:function(e,t){var n=this,i={cb:e,scope:t||n.scope};return n.inDispatch?n.listeners=[i].concat(n.listeners):n.listeners.unshift(i),e},remove:function(e){var t=this.listeners,n=null;return tinymce.each(t,function(i,o){return e==i.cb?(n=i,t.splice(o,1),!1):void 0}),n},dispatch:function(){var e,t,n,i=this,o=arguments,r=i.listeners;for(i.inDispatch=!0,t=0;r.length>t&&(n=r[t],e=n.cb.apply(n.scope,o.length>0?o:[n.scope]),e!==!1);t++);return i.inDispatch=!1,e}}),function(){var e=tinymce.each;tinymce.create("tinymce.util.URI",{URI:function(t,n){var i,o,r=this;return t=tinymce.trim(t),n=r.settings=n||{},/^([\w\-]+):([^\/]{2})/i.test(t)||/^\s*#/.test(t)?(r.source=t,void 0):(0===t.indexOf("/")&&0!==t.indexOf("//")&&(t=(n.base_uri?n.base_uri.protocol||"http":"http")+"://mce_host"+t),/^[\w\-]*:?\/\//.test(t)||(o=n.base_uri?n.base_uri.path:new tinymce.util.URI(location.href).directory,t=(n.base_uri&&n.base_uri.protocol||"http")+"://mce_host"+r.toAbsPath(o,t)),t=t.replace(/@@/g,"(mce_at)"),t=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(t),e(["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],function(e,n){var i=t[n];i&&(i=i.replace(/\(mce_at\)/g,"@@")),r[e]=i}),i=n.base_uri,i&&(r.protocol||(r.protocol=i.protocol),r.userInfo||(r.userInfo=i.userInfo),r.port||"mce_host"!==r.host||(r.port=i.port),r.host&&"mce_host"!==r.host||(r.host=i.host),r.source=""),void 0)},setPath:function(e){var t=this;e=/^(.*?)\/?(\w+)?$/.exec(e),t.path=e[0],t.directory=e[1],t.file=e[2],t.source="",t.getURI()},toRelative:function(e){var t,n=this;if("./"===e)return e;if(e=new tinymce.util.URI(e,{base_uri:n}),"mce_host"!=e.host&&n.host!=e.host&&e.host||n.port!=e.port||n.protocol!=e.protocol)return e.getURI();var i=n.getURI(),o=e.getURI();return i==o||"/"==i.charAt(i.length-1)&&i.substr(0,i.length-1)==o?i:(t=n.toRelPath(n.path,e.path),e.query&&(t+="?"+e.query),e.anchor&&(t+="#"+e.anchor),t)},toAbsolute:function(e,t){return e=new tinymce.util.URI(e,{base_uri:this}),e.getURI(this.host==e.host&&this.protocol==e.protocol?t:0)},toRelPath:function(e,t){var n,i,o,r=0,a="";if(e=e.substring(0,e.lastIndexOf("/")),e=e.split("/"),n=t.split("/"),e.length>=n.length)for(i=0,o=e.length;o>i;i++)if(i>=n.length||e[i]!=n[i]){r=i+1;break}if(e.length<n.length)for(i=0,o=n.length;o>i;i++)if(i>=e.length||e[i]!=n[i]){r=i+1;break}if(1===r)return t;for(i=0,o=e.length-(r-1);o>i;i++)a+="../";for(i=r-1,o=n.length;o>i;i++)a+=i!=r-1?"/"+n[i]:n[i];return a},toAbsPath:function(t,n){var i,o,r,a=0,s=[];for(o=/\/$/.test(n)?"/":"",t=t.split("/"),n=n.split("/"),e(t,function(e){e&&s.push(e)}),t=s,i=n.length-1,s=[];i>=0;i--)0!==n[i].length&&"."!==n[i]&&(".."!==n[i]?a>0?a--:s.push(n[i]):a++);return i=t.length-a,r=0>=i?s.reverse().join("/"):t.slice(0,i).join("/")+"/"+s.reverse().join("/"),0!==r.indexOf("/")&&(r="/"+r),o&&r.lastIndexOf("/")!==r.length-1&&(r+=o),r},getURI:function(e){var t,n=this;return(!n.source||e)&&(t="",e||(n.protocol&&(t+=n.protocol+"://"),n.userInfo&&(t+=n.userInfo+"@"),n.host&&(t+=n.host),n.port&&(t+=":"+n.port)),n.path&&(t+=n.path),n.query&&(t+="?"+n.query),n.anchor&&(t+="#"+n.anchor),n.source=t),n.source}})}(),function(){var e=tinymce.each;tinymce.create("static tinymce.util.Cookie",{getHash:function(t){var n,i=this.get(t);return i&&e(i.split("&"),function(e){e=e.split("="),n=n||{},n[unescape(e[0])]=unescape(e[1])}),n},setHash:function(t,n,i,o,r,a){var s="";e(n,function(e,t){s+=(s?"&":"")+escape(t)+"="+escape(e)}),this.set(t,s,i,o,r,a)},get:function(e){var t,n,i=document.cookie,o=e+"=";if(i){if(n=i.indexOf("; "+o),-1==n){if(n=i.indexOf(o),0!==n)return null}else n+=2;return t=i.indexOf(";",n),-1==t&&(t=i.length),unescape(i.substring(n+o.length,t))}},set:function(e,t,n,i,o,r){document.cookie=e+"="+escape(t)+(n?"; expires="+n.toGMTString():"")+(i?"; path="+escape(i):"")+(o?"; domain="+o:"")+(r?"; secure":"")},remove:function(e,t,n){var i=new Date;i.setTime(i.getTime()-1e3),this.set(e,"",i,t,n)}})}(),function(){function serialize(e,t){var n,i,o,r;if(t=t||'"',null==e)return"null";if(o=typeof e,"string"==o)return i="\bb	t\nn\ff\rr\"\"''\\\\",t+e.replace(/([\u0080-\uFFFF\x00-\x1f\"\'\\])/g,function(e,o){return'"'===t&&"'"===e?e:(n=i.indexOf(o),n+1?"\\"+i.charAt(n+1):(e=o.charCodeAt().toString(16),"\\u"+"0000".substring(e.length)+e))})+t;if("object"==o){if(e.hasOwnProperty&&"[object Array]"===Object.prototype.toString.call(e)){for(n=0,i="[";e.length>n;n++)i+=(n>0?",":"")+serialize(e[n],t);return i+"]"}i="{";for(r in e)e.hasOwnProperty(r)&&(i+="function"!=typeof e[r]?(i.length>1?","+t:t)+r+t+":"+serialize(e[r],t):"");return i+"}"}return""+e}tinymce.util.JSON={serialize:serialize,parse:function(s){try{return eval("("+s+")")}catch(ex){}}}}(),tinymce.create("static tinymce.util.XHR",{send:function(e){function t(){!e.async||4==i.readyState||a++>1e4?(e.success&&1e4>a&&200==i.status?e.success.call(e.success_scope,""+i.responseText,i,e):e.error&&e.error.call(e.error_scope,a>1e4?"TIMED_OUT":"GENERAL",i,e),i=null):r.setTimeout(t,10)}function n(e){i=0;try{i=new ActiveXObject(e)}catch(t){}return i}var i,o,r=window,a=0;if(e.scope=e.scope||this,e.success_scope=e.success_scope||e.scope,e.error_scope=e.error_scope||e.scope,e.async=e.async===!1?!1:!0,e.data=e.data||"",i=r.XMLHttpRequest?new XMLHttpRequest:n("Microsoft.XMLHTTP")||n("Msxml2.XMLHTTP")){if(i.overrideMimeType&&i.overrideMimeType(e.content_type),i.open(e.type||(e.data?"POST":"GET"),e.url,e.async),e.content_type&&i.setRequestHeader("Content-Type",e.content_type),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.send(e.data),!e.async)return t();o=r.setTimeout(t,10)}}}),function(){var e=tinymce.extend,t=tinymce.util.JSON,n=tinymce.util.XHR;tinymce.create("tinymce.util.JSONRequest",{JSONRequest:function(t){this.settings=e({},t),this.count=0},send:function(i){var o=i.error,r=i.success;i=e(this.settings,i),i.success=function(e,n){e=t.parse(e),e===void 0&&(e={error:"JSON Parse error."}),e.error?o.call(i.error_scope||i.scope,e.error,n):r.call(i.success_scope||i.scope,e.result)},i.error=function(e,t){o&&o.call(i.error_scope||i.scope,e,t)},i.data=t.serialize({id:i.id||"c"+this.count++,method:i.method,params:i.params}),i.content_type="application/json",n.send(i)},"static":{sendRPC:function(e){return(new tinymce.util.JSONRequest).send(e)}}})}(),function(e){e.VK={BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,modifierPressed:function(e){return e.shiftKey||e.ctrlKey||e.altKey},metaKeyPressed:function(t){return e.isMac?t.metaKey:t.ctrlKey&&!t.altKey}}}(tinymce),tinymce.util.Quirks=function(e){function t(t,n){try{e.getDoc().execCommand(t,!1,n)}catch(i){}}function n(){var t=e.getDoc().documentMode;return t?t:6}function i(){function t(t){var n,i,o,r;if(n=N.getRng(),i=M.getParent(n.startContainer,M.isBlock),t&&(i=M.getNext(i,M.isBlock)),i){for(o=i.firstChild;o&&3==o.nodeType&&0===o.nodeValue.length;)o=o.nextSibling;o&&"SPAN"===o.nodeName&&(r=o.cloneNode(!1))}e.getDoc().execCommand(t?"ForwardDelete":"Delete",!1,null),i=M.getParent(n.startContainer,M.isBlock),tinymce.each(M.select("span.Apple-style-span,font.Apple-style-span",i),function(e){var t=N.getBookmark();r?M.replace(r.cloneNode(!1),e,!0):M.remove(e,!0),N.moveToBookmark(t)})}e.onKeyDown.add(function(e,n){var i;i=n.keyCode==D,n.isDefaultPrevented()||!i&&n.keyCode!=E||S.modifierPressed(n)||(n.preventDefault(),t(i))}),e.addCommand("Delete",function(){t()})}function o(){function t(e){var t=M.create("body"),n=e.cloneContents();return t.appendChild(n),N.serializer.serialize(t,{format:"html"})}function n(n){var i=t(n),o=M.createRng();o.selectNode(e.getBody());var r=t(o);return i===r}e.onKeyDown.add(function(e,t){var i,o=t.keyCode;if(!t.isDefaultPrevented()&&(o==D||o==E)){if(i=e.selection.isCollapsed(),i&&!M.isEmpty(e.getBody()))return;if(tinymce.isIE&&!i)return;if(!i&&!n(e.selection.getRng()))return;e.setContent(""),e.selection.setCursorLocation(e.getBody(),0),e.nodeChanged()}})}function r(){e.onKeyDown.add(function(e,t){65==t.keyCode&&S.metaKeyPressed(t)&&(t.preventDefault(),e.execCommand("SelectAll"))})}function a(){e.settings.content_editable||(M.bind(e.getDoc(),"focusin",function(){N.setRng(N.getRng())}),M.bind(e.getDoc(),"mousedown",function(t){t.target==e.getDoc().documentElement&&(e.getWin().focus(),N.setRng(N.getRng()))}))}function s(){e.onKeyDown.add(function(e,t){if(!t.isDefaultPrevented()&&t.keyCode===E&&N.isCollapsed()&&0===N.getRng(!0).startOffset){var n=N.getNode(),i=n.previousSibling;i&&i.nodeName&&"hr"===i.nodeName.toLowerCase()&&(M.remove(i),tinymce.dom.Event.cancel(t))}})}function l(){Range.prototype.getClientRects||e.onMouseDown.add(function(e,t){if("HTML"===t.target.nodeName){var n=e.getBody();n.blur(),setTimeout(function(){n.focus()},0)}})}function c(){e.onClick.add(function(e,t){t=t.target,/^(IMG|HR)$/.test(t.nodeName)&&N.getSel().setBaseAndExtent(t,0,t,1),"A"==t.nodeName&&M.hasClass(t,"mceItemAnchor")&&N.select(t),e.nodeChanged()})}function u(){function t(){var t=M.getAttribs(N.getStart().cloneNode(!1));return function(){var n=N.getStart();n!==e.getBody()&&(M.setAttrib(n,"style",null),tinymce.each(t,function(e){n.setAttributeNode(e.cloneNode(!0))}))}}function n(){return!N.isCollapsed()&&M.getParent(N.getStart(),M.isBlock)!=M.getParent(N.getEnd(),M.isBlock)}function i(e,t){return t.preventDefault(),!1}e.onKeyPress.add(function(e,i){var o;return 8!=i.keyCode&&46!=i.keyCode||!n()?void 0:(o=t(),e.getDoc().execCommand("delete",!1,null),o(),i.preventDefault(),!1)}),M.bind(e.getDoc(),"cut",function(){var o;n()&&(o=t(),e.onKeyUp.addToTop(i),setTimeout(function(){o(),e.onKeyUp.remove(i)},0))})}function d(){var t,n;M.bind(e.getDoc(),"selectionchange",function(){n&&(clearTimeout(n),n=0),n=window.setTimeout(function(){var n=N.getRng();t&&tinymce.dom.RangeUtils.compareRanges(n,t)||(e.nodeChanged(),t=n)},50)})}function h(){document.body.setAttribute("role","application")}function p(){e.onKeyDown.add(function(e,t){if(!t.isDefaultPrevented()&&t.keyCode===E&&N.isCollapsed()&&0===N.getRng(!0).startOffset){var n=N.getNode().previousSibling;if(n&&n.nodeName&&"table"===n.nodeName.toLowerCase())return tinymce.dom.Event.cancel(t)}})}function f(){n()>7||(t("RespectVisibilityInDesign",!0),e.contentStyles.push(".mceHideBrInPre pre br {display: none}"),M.addClass(e.getBody(),"mceHideBrInPre"),P.addNodeFilter("pre",function(e){for(var t,n,i,o,r=e.length;r--;)for(t=e[r].getAll("br"),n=t.length;n--;)i=t[n],o=i.prev,o&&3===o.type&&"\n"!=o.value.charAt(o.value-1)?o.value+="\n":i.parent.insert(new tinymce.html.Node("#text",3),i,!0).value="\n"}),I.addNodeFilter("pre",function(e){for(var t,n,i,o,r=e.length;r--;)for(t=e[r].getAll("br"),n=t.length;n--;)i=t[n],o=i.prev,o&&3==o.type&&(o.value=o.value.replace(/\r?\n$/,""))}))}function m(){M.bind(e.getBody(),"mouseup",function(){var e,t=N.getNode();"IMG"==t.nodeName&&((e=M.getStyle(t,"width"))&&(M.setAttrib(t,"width",e.replace(/[^0-9%]+/g,"")),M.setStyle(t,"width","")),(e=M.getStyle(t,"height"))&&(M.setAttrib(t,"height",e.replace(/[^0-9%]+/g,"")),M.setStyle(t,"height","")))})}function g(){e.onKeyDown.add(function(e,t){var n,i,o,r,a,s,l;n=t.keyCode==D,t.isDefaultPrevented()||!n&&t.keyCode!=E||S.modifierPressed(t)||(i=N.getRng(),o=i.startContainer,r=i.startOffset,l=i.collapsed,3==o.nodeType&&o.nodeValue.length>0&&(0===r&&!l||l&&r===(n?0:1))&&(nonEmptyElements=e.schema.getNonEmptyElements(),t.preventDefault(),a=M.create("br",{id:"__tmp"}),o.parentNode.insertBefore(a,o),e.getDoc().execCommand(n?"ForwardDelete":"Delete",!1,null),o=N.getRng().startContainer,s=o.previousSibling,s&&1==s.nodeType&&!M.isBlock(s)&&M.isEmpty(s)&&!nonEmptyElements[s.nodeName.toLowerCase()]&&M.remove(s),M.remove("__tmp")))})}function v(){e.onKeyDown.add(function(e,t){var n,i,o,r,a;if(!t.isDefaultPrevented()&&t.keyCode==S.BACKSPACE&&(n=N.getRng(),i=n.startContainer,o=n.startOffset,r=M.getRoot(),a=i,n.collapsed&&0===o)){for(;a&&a.parentNode&&a.parentNode.firstChild==a&&a.parentNode!=r;)a=a.parentNode;"BLOCKQUOTE"===a.tagName&&(e.formatter.toggle("blockquote",null,a),n=M.createRng(),n.setStart(i,0),n.setEnd(i,0),N.setRng(n))}})}function b(){function n(){e._refreshContentEditable(),t("StyleWithCSS",!1),t("enableInlineTableEditing",!1),A.object_resizing||t("enableObjectResizing",!1)}A.readonly||(e.onBeforeExecCommand.add(n),e.onMouseDown.add(n))}function y(){function t(){tinymce.each(M.select("a"),function(e){var t=e.parentNode,n=M.getRoot();if(t.lastChild===e){for(;t&&!M.isBlock(t);){if(t.parentNode.lastChild!==t||t===n)return;t=t.parentNode}M.add(t,"br",{"data-mce-bogus":1})}})}e.onExecCommand.add(function(e,n){"CreateLink"===n&&t(e)}),e.onSetContent.add(N.onSetContent.add(t))}function w(){A.forced_root_block&&e.onInit.add(function(){t("DefaultParagraphSeparator",A.forced_root_block)})}function x(){function t(t,n){t&&n.initial||e.execCommand("mceRepaint")}e.onUndo.add(t),e.onRedo.add(t),e.onSetContent.add(t)}function k(){e.onKeyDown.add(function(e,t){var n;t.isDefaultPrevented()||t.keyCode!=E||(n=e.getDoc().selection.createRange(),n&&n.item&&(t.preventDefault(),e.undoManager.beforeChange(),M.remove(n.item(0)),e.undoManager.add()))})}function _(){var t;n()>=10&&(t="",tinymce.each("p div h1 h2 h3 h4 h5 h6".split(" "),function(e,n){t+=(n>0?",":"")+e+":empty"}),e.contentStyles.push(t+"{padding-right: 1px !important}"))}function C(){function n(e){var t,n;t=e.screenX-h,n=e.screenY-p,b=t*d[2]+f,y=n*d[3]+m,b=5>b?5:b,y=5>y?5:y,(S.modifierPressed(e)||"IMG"==c.nodeName&&0!==d[2]*d[3])&&(b=Math.round(y/g),y=Math.round(b*g)),M.setStyles(u,{width:b,height:y}),0>d[2]&&b>=u.clientWidth&&M.setStyle(u,"left",s+(f-b)),0>d[3]&&y>=u.clientHeight&&M.setStyle(u,"top",l+(m-y))}function i(){function t(t,n){n&&(c.style[t]||!e.schema.isValid(c.nodeName.toLowerCase(),t)?M.setStyle(c,t,n):M.setAttrib(c,t,n))}t("width",b),t("height",y),M.unbind(x,"mousemove",n),M.unbind(x,"mouseup",i),w!=x&&(M.unbind(w,"mousemove",n),M.unbind(w,"mouseup",i)),M.remove(u),o(c)}function o(e){var t,o,a;r(),t=M.getPos(e),s=t.x,l=t.y,o=e.offsetWidth,a=e.offsetHeight,c!=e&&(c=e,b=y=0),tinymce.each(v,function(e,t){var r;r=M.get("mceResizeHandle"+t),r?M.show(r):(r=M.add(x.documentElement,"div",{id:"mceResizeHandle"+t,"class":"mceResizeHandle",style:"cursor:"+t+"-resize; margin:0; padding:0"}),M.bind(r,"mousedown",function(t){t.preventDefault(),i(),h=t.screenX,p=t.screenY,f=c.clientWidth,m=c.clientHeight,g=m/f,d=e,u=c.cloneNode(!0),M.addClass(u,"mceClonedResizable"),M.setStyles(u,{left:s,top:l,margin:0}),x.documentElement.appendChild(u),M.bind(x,"mousemove",n),M.bind(x,"mouseup",i),w!=x&&(M.bind(w,"mousemove",n),M.bind(w,"mouseup",i))})),M.setStyles(r,{left:o*e[0]+s-r.offsetWidth/2,top:a*e[1]+l-r.offsetHeight/2})}),tinymce.isOpera||"IMG"!=c.nodeName||c.setAttribute("data-mce-selected","1")}function r(){c&&c.removeAttribute("data-mce-selected");for(var e in v)M.hide("mceResizeHandle"+e)}function a(){var e=M.getParent(N.getNode(),"table,img");tinymce.each(M.select("img[data-mce-selected]"),function(e){e.removeAttribute("data-mce-selected")}),e?o(e):r()}var s,l,c,u,d,h,p,f,m,g,v,b,y,w=document,x=e.getDoc();A.object_resizing&&A.webkit_fake_resize!==!1&&(t("enableObjectResizing",!1),v={n:[.5,0,0,-1],e:[1,.5,1,0],s:[.5,1,0,1],w:[0,.5,-1,0],nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]},e.contentStyles.push(".mceResizeHandle {position: absolute;border: 1px solid black;background: #FFF;width: 5px;height: 5px;z-index: 10000}.mceResizeHandle:hover {background: #000}img[data-mce-selected] {outline: 1px solid black}img.mceClonedResizable, table.mceClonedResizable {position: absolute;outline: 1px dashed black;opacity: .5;z-index: 10000}"),e.onNodeChange.add(a),M.bind(x,"selectionchange",a),e.serializer.addAttributeFilter("data-mce-selected",function(e,t){for(var n=e.length;n--;)e[n].attr(t,null)}))}function T(){9>n()&&(P.addNodeFilter("noscript",function(e){for(var t,n,i=e.length;i--;)t=e[i],n=t.firstChild,n&&t.attr("data-mce-innertext",n.value)}),I.addNodeFilter("noscript",function(e){for(var t,n,i,o=e.length;o--;)t=e[o],n=e[o].firstChild,n?n.value=tinymce.html.Entities.decode(n.value):(i=t.attributes.map["data-mce-innertext"],i&&(t.attr("data-mce-innertext",null),n=new tinymce.html.Node("#text",3),n.value=i,n.raw=!0,t.append(n)))}))}var S=tinymce.VK,E=S.BACKSPACE,D=S.DELETE,M=e.dom,N=e.selection,A=e.settings,P=e.parser,I=e.serializer;p(),v(),o(),tinymce.isWebKit&&(g(),i(),a(),c(),w(),tinymce.isIDevice?d():(C(),r())),tinymce.isIE&&(s(),h(),f(),m(),k(),_(),T()),tinymce.isGecko&&(s(),l(),u(),b(),y(),x()),tinymce.isOpera&&C()},function(e){function t(e){var t;return t=document.createElement("div"),t.innerHTML=e,t.textContent||t.innerText||e}function n(e,t){var n,i,r,a={};if(e){for(e=e.split(","),t=t||10,n=0;e.length>n;n+=2)i=String.fromCharCode(parseInt(e[n],t)),o[i]||(r="&"+e[n+1]+";",a[i]=r,a[r]=i);return a}}var i,o,r,a=/[&<>\"\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,s=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,l=/[<>&\"\']/g,c=/&(#x|#)?([\w]+);/g,u={128:"€",130:"‚",131:"ƒ",132:"„",133:"…",134:"†",135:"‡",136:"ˆ",137:"‰",138:"Š",139:"‹",140:"Œ",142:"Ž",145:"‘",146:"’",147:"“",148:"”",149:"•",150:"–",151:"—",152:"˜",153:"™",154:"š",155:"›",156:"œ",158:"ž",159:"Ÿ"};o={'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","&":"&amp;"},r={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"},i=n("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),e.html=e.html||{},e.html.Entities={encodeRaw:function(e,t){return e.replace(t?a:s,function(e){return o[e]||e})},encodeAllRaw:function(e){return(""+e).replace(l,function(e){return o[e]||e})},encodeNumeric:function(e,t){return e.replace(t?a:s,function(e){return e.length>1?"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";":o[e]||"&#"+e.charCodeAt(0)+";"})},encodeNamed:function(e,t,n){return n=n||i,e.replace(t?a:s,function(e){return o[e]||n[e]||e})},getEncodeFunc:function(t,r){function l(e,t){return e.replace(t?a:s,function(e){return o[e]||r[e]||"&#"+e.charCodeAt(0)+";"||e})}function c(e,t){return u.encodeNamed(e,t,r)}var u=e.html.Entities;return r=n(r)||i,t=e.makeMap(t.replace(/\+/g,",")),t.named&&t.numeric?l:t.named?r?c:u.encodeNamed:t.numeric?u.encodeNumeric:u.encodeRaw},decode:function(e){return e.replace(c,function(e,n,o){return n?(o=parseInt(o,2===n.length?16:10),o>65535?(o-=65536,String.fromCharCode(55296+(o>>10),56320+(1023&o))):u[o]||String.fromCharCode(o)):r[e]||i[e]||t(e)})}}}(tinymce),tinymce.html.Styles=function(e,t){function n(e,t,n,i){function o(e){return e=parseInt(e).toString(16),e.length>1?e:"0"+e}return"#"+o(t)+o(n)+o(i)}var i,o,r,a=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,s=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,l=/\s*([^:]+):\s*([^;]+);?/g,c=/\s+$/,u={};for(e=e||{},r="\\\" \\' \\; \\: ; : ﻿".split(" "),o=0;r.length>o;o++)u[r[o]]="﻿"+o,u["﻿"+o]=r[o];return{toHex:function(e){return e.replace(a,n)},parse:function(t){function i(e,t){var n,i,o,r;n=b[e+"-top"+t],n&&(i=b[e+"-right"+t],n==i&&(o=b[e+"-bottom"+t],i==o&&(r=b[e+"-left"+t],o==r&&(b[e+t]=r,delete b[e+"-top"+t],delete b[e+"-right"+t],delete b[e+"-bottom"+t],delete b[e+"-left"+t]))))
}function o(e){var t,n=b[e];if(n&&!(0>n.indexOf(" "))){for(n=n.split(" "),t=n.length;t--;)if(n[t]!==n[0])return!1;return b[e]=n[0],!0}}function r(e,t,n,i){o(t)&&o(n)&&o(i)&&(b[e]=b[t]+" "+b[n]+" "+b[i],delete b[t],delete b[n],delete b[i])}function d(e){return v=!0,u[e]}function h(e,t){return v&&(e=e.replace(/\uFEFF[0-9]/g,function(e){return u[e]})),t||(e=e.replace(/\\([\'\";:])/g,"$1")),e}function p(e,t,n,i,o,r){return(o=o||r)?(o=h(o),"'"+o.replace(/\'/g,"\\'")+"'"):(t=h(t||n||i),y&&(t=y.call(w,t,"style")),"url('"+t.replace(/\'/g,"\\'")+"')")}var f,m,g,v,b={},y=e.url_converter,w=e.url_converter_scope||this;if(t){for(t=t.replace(/\\[\"\';:\uFEFF]/g,d).replace(/\"[^\"]+\"|\'[^\']+\'/g,function(e){return e.replace(/[;:]/g,d)});f=l.exec(t);)m=f[1].replace(c,"").toLowerCase(),g=f[2].replace(c,""),m&&g.length>0&&("font-weight"===m&&"700"===g?g="bold":("color"===m||"background-color"===m)&&(g=g.toLowerCase()),g=g.replace(a,n),g=g.replace(s,p),b[m]=v?h(g,!0):g),l.lastIndex=f.index+f[0].length;i("border",""),i("border","-width"),i("border","-color"),i("border","-style"),i("padding",""),i("margin",""),r("border","border-width","border-style","border-color"),"medium none"===b.border&&delete b.border}return b},serialize:function(e,n){function o(n){var o,r,a,l;if(o=t.styles[n])for(r=0,a=o.length;a>r;r++)n=o[r],l=e[n],l!==i&&l.length>0&&(s+=(s.length>0?" ":"")+n+": "+l+";")}var r,a,s="";if(n&&t&&t.styles)o("*"),o(n);else for(r in e)a=e[r],a!==i&&a.length>0&&(s+=(s.length>0?" ":"")+r+": "+a+";");return s}}},function(e){function t(e,t){return e.split(t||",")}function n(e,n){function i(t){return t.replace(/[A-Z]+/g,function(t){return i(e[t])})}var o,r={};for(o in e)e.hasOwnProperty(o)&&(e[o]=i(e[o]));return i(n).replace(/#/g,"#text").replace(/(\w+)\[([^\]]+)\]\[([^\]]*)\]/g,function(e,n,i,o){i=t(i,"|"),r[n]={attributes:a(i),attributesOrder:i,children:a(o,"|",{"#comment":{}})}}),r}function i(){var e=r.html5;return e||(e=r.html5=n({A:"id|accesskey|class|dir|draggable|item|hidden|itemprop|role|spellcheck|style|subject|title|onclick|ondblclick|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup",B:"#|a|abbr|area|audio|b|bdo|br|button|canvas|cite|code|command|datalist|del|dfn|em|embed|i|iframe|img|input|ins|kbd|keygen|label|link|map|mark|meta|meter|noscript|object|output|progress|q|ruby|samp|script|select|small|span|strong|sub|sup|svg|textarea|time|var|video|wbr",C:"#|a|abbr|area|address|article|aside|audio|b|bdo|blockquote|br|button|canvas|cite|code|command|datalist|del|details|dfn|dialog|div|dl|em|embed|fieldset|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|i|iframe|img|input|ins|kbd|keygen|label|link|map|mark|menu|meta|meter|nav|noscript|ol|object|output|p|pre|progress|q|ruby|samp|script|section|select|small|span|strong|style|sub|sup|svg|table|textarea|time|ul|var|video"},"html[A|manifest][body|head]head[A][base|command|link|meta|noscript|script|style|title]title[A][#]base[A|href|target][]link[A|href|rel|media|type|sizes][]meta[A|http-equiv|name|content|charset][]style[A|type|media|scoped][#]script[A|charset|type|src|defer|async][#]noscript[A][C]body[A][C]section[A][C]nav[A][C]article[A][C]aside[A][C]h1[A][B]h2[A][B]h3[A][B]h4[A][B]h5[A][B]h6[A][B]hgroup[A][h1|h2|h3|h4|h5|h6]header[A][C]footer[A][C]address[A][C]p[A][B]br[A][]pre[A][B]dialog[A][dd|dt]blockquote[A|cite][C]ol[A|start|reversed][li]ul[A][li]li[A|value][C]dl[A][dd|dt]dt[A][B]dd[A][C]a[A|href|target|ping|rel|media|type][B]em[A][B]strong[A][B]small[A][B]cite[A][B]q[A|cite][B]dfn[A][B]abbr[A][B]code[A][B]var[A][B]samp[A][B]kbd[A][B]sub[A][B]sup[A][B]i[A][B]b[A][B]mark[A][B]progress[A|value|max][B]meter[A|value|min|max|low|high|optimum][B]time[A|datetime][B]ruby[A][B|rt|rp]rt[A][B]rp[A][B]bdo[A][B]span[A][B]ins[A|cite|datetime][B]del[A|cite|datetime][B]figure[A][C|legend|figcaption]figcaption[A][C]img[A|alt|src|height|width|usemap|ismap][]iframe[A|name|src|height|width|sandbox|seamless][]embed[A|src|height|width|type][]object[A|data|type|height|width|usemap|name|form|classid][param]param[A|name|value][]details[A|open][C|legend]command[A|type|label|icon|disabled|checked|radiogroup][]menu[A|type|label][C|li]legend[A][C|B]div[A][C]source[A|src|type|media][]audio[A|src|autobuffer|autoplay|loop|controls][source]video[A|src|autobuffer|autoplay|loop|controls|width|height|poster][source]hr[A][]form[A|accept-charset|action|autocomplete|enctype|method|name|novalidate|target][C]fieldset[A|disabled|form|name][C|legend]label[A|form|for][B]input[A|type|accept|alt|autocomplete|checked|disabled|form|formaction|formenctype|formmethod|formnovalidate|formtarget|height|list|max|maxlength|min|multiple|pattern|placeholder|readonly|required|size|src|step|width|files|value|name][]button[A|autofocus|disabled|form|formaction|formenctype|formmethod|formnovalidate|formtarget|name|value|type][B]select[A|autofocus|disabled|form|multiple|name|size][option|optgroup]datalist[A][B|option]optgroup[A|disabled|label][option]option[A|disabled|selected|label|value][]textarea[A|autofocus|disabled|form|maxlength|name|placeholder|readonly|required|rows|cols|wrap][]keygen[A|autofocus|challenge|disabled|form|keytype|name][]output[A|for|form|name][B]canvas[A|width|height][]map[A|name][B|C]area[A|shape|coords|href|alt|target|media|rel|ping|type][]mathml[A][]svg[A][]table[A|border][caption|colgroup|thead|tfoot|tbody|tr]caption[A][C]colgroup[A|span][col]col[A|span][]thead[A][tr]tfoot[A][tr]tbody[A][tr]tr[A][th|td]th[A|headers|rowspan|colspan|scope][B]td[A|headers|rowspan|colspan][C]wbr[A][]")),e}function o(){var e=r.html4;return e||(e=r.html4=n({Z:"H|K|N|O|P",Y:"X|form|R|Q",ZG:"E|span|width|align|char|charoff|valign",X:"p|T|div|U|W|isindex|fieldset|table",ZF:"E|align|char|charoff|valign",W:"pre|hr|blockquote|address|center|noframes",ZE:"abbr|axis|headers|scope|rowspan|colspan|align|char|charoff|valign|nowrap|bgcolor|width|height",ZD:"[E][S]",U:"ul|ol|dl|menu|dir",ZC:"p|Y|div|U|W|table|br|span|bdo|object|applet|img|map|K|N|Q",T:"h1|h2|h3|h4|h5|h6",ZB:"X|S|Q",S:"R|P",ZA:"a|G|J|M|O|P",R:"a|H|K|N|O",Q:"noscript|P",P:"ins|del|script",O:"input|select|textarea|label|button",N:"M|L",M:"em|strong|dfn|code|q|samp|kbd|var|cite|abbr|acronym",L:"sub|sup",K:"J|I",J:"tt|i|b|u|s|strike",I:"big|small|font|basefont",H:"G|F",G:"br|span|bdo",F:"object|applet|img|map|iframe",E:"A|B|C",D:"accesskey|tabindex|onfocus|onblur",C:"onclick|ondblclick|onmousedown|onmouseup|onmouseover|onmousemove|onmouseout|onkeypress|onkeydown|onkeyup",B:"lang|xml:lang|dir",A:"id|class|style|title"},"script[id|charset|type|language|src|defer|xml:space][]style[B|id|type|media|title|xml:space][]object[E|declare|classid|codebase|data|type|codetype|archive|standby|width|height|usemap|name|tabindex|align|border|hspace|vspace][#|param|Y]param[id|name|value|valuetype|type][]p[E|align][#|S]a[E|D|charset|type|name|href|hreflang|rel|rev|shape|coords|target][#|Z]br[A|clear][]span[E][#|S]bdo[A|C|B][#|S]applet[A|codebase|archive|code|object|alt|name|width|height|align|hspace|vspace][#|param|Y]h1[E|align][#|S]img[E|src|alt|name|longdesc|width|height|usemap|ismap|align|border|hspace|vspace][]map[B|C|A|name][X|form|Q|area]h2[E|align][#|S]iframe[A|longdesc|name|src|frameborder|marginwidth|marginheight|scrolling|align|width|height][#|Y]h3[E|align][#|S]tt[E][#|S]i[E][#|S]b[E][#|S]u[E][#|S]s[E][#|S]strike[E][#|S]big[E][#|S]small[E][#|S]font[A|B|size|color|face][#|S]basefont[id|size|color|face][]em[E][#|S]strong[E][#|S]dfn[E][#|S]code[E][#|S]q[E|cite][#|S]samp[E][#|S]kbd[E][#|S]var[E][#|S]cite[E][#|S]abbr[E][#|S]acronym[E][#|S]sub[E][#|S]sup[E][#|S]input[E|D|type|name|value|checked|disabled|readonly|size|maxlength|src|alt|usemap|onselect|onchange|accept|align][]select[E|name|size|multiple|disabled|tabindex|onfocus|onblur|onchange][optgroup|option]optgroup[E|disabled|label][option]option[E|selected|disabled|label|value][]textarea[E|D|name|rows|cols|disabled|readonly|onselect|onchange][]label[E|for|accesskey|onfocus|onblur][#|S]button[E|D|name|value|type|disabled][#|p|T|div|U|W|table|G|object|applet|img|map|K|N|Q]h4[E|align][#|S]ins[E|cite|datetime][#|Y]h5[E|align][#|S]del[E|cite|datetime][#|Y]h6[E|align][#|S]div[E|align][#|Y]ul[E|type|compact][li]li[E|type|value][#|Y]ol[E|type|compact|start][li]dl[E|compact][dt|dd]dt[E][#|S]dd[E][#|Y]menu[E|compact][li]dir[E|compact][li]pre[E|width|xml:space][#|ZA]hr[E|align|noshade|size|width][]blockquote[E|cite][#|Y]address[E][#|S|p]center[E][#|Y]noframes[E][#|Y]isindex[A|B|prompt][]fieldset[E][#|legend|Y]legend[E|accesskey|align][#|S]table[E|summary|width|border|frame|rules|cellspacing|cellpadding|align|bgcolor][caption|col|colgroup|thead|tfoot|tbody|tr]caption[E|align][#|S]col[ZG][]colgroup[ZG][col]thead[ZF][tr]tr[ZF|bgcolor][th|td]th[E|ZE][#|Y]form[E|action|method|name|enctype|onsubmit|onreset|accept|accept-charset|target][#|X|R|Q]noscript[E][#|Y]td[E|ZE][#|Y]tfoot[ZF][tr]tbody[ZF][tr]area[E|D|shape|coords|href|nohref|alt|target][]base[id|href|target][]body[E|onload|onunload|background|bgcolor|text|link|vlink|alink][#|Y]")),e}var r={},a=e.makeMap,s=e.each;e.html.Schema=function(n){function l(t,i,o){var s=n[t];return s?s=a(s,",",a(s.toUpperCase()," ")):(s=r[t],s||(s=a(i," ",a(i.toUpperCase()," ")),s=e.extend(s,o),r[t]=s)),s}function c(e){return RegExp("^"+e.replace(/([?+*])/g,".$1")+"$")}function u(n){var i,o,r,s,l,u,d,h,p,f,m,g,v,b,y,w,x,k,_,T=/^([#+\-])?([^\[\/]+)(?:\/([^\[]+))?(?:\[([^\]]+)\])?$/,E=/^([!\-])?(\w+::\w+|[^=:<]+)?(?:([=:<])(.*))?$/,D=/[*?+]/;if(n)for(n=t(n),C["@"]&&(w=C["@"].attributes,x=C["@"].attributesOrder),i=0,o=n.length;o>i;i++)if(l=T.exec(n[i])){if(b=l[1],p=l[2],y=l[3],h=l[4],g={},v=[],u={attributes:g,attributesOrder:v},"#"===b&&(u.paddEmpty=!0),"-"===b&&(u.removeEmpty=!0),w){for(k in w)g[k]=w[k];v.push.apply(v,x)}if(h)for(h=t(h,"|"),r=0,s=h.length;s>r;r++)if(l=E.exec(h[r])){if(d={},m=l[1],f=l[2].replace(/::/g,":"),b=l[3],_=l[4],"!"===m&&(u.attributesRequired=u.attributesRequired||[],u.attributesRequired.push(f),d.required=!0),"-"===m){delete g[f],v.splice(e.inArray(v,f),1);continue}b&&("="===b&&(u.attributesDefault=u.attributesDefault||[],u.attributesDefault.push({name:f,value:_}),d.defaultValue=_),":"===b&&(u.attributesForced=u.attributesForced||[],u.attributesForced.push({name:f,value:_}),d.forcedValue=_),"<"===b&&(d.validValues=a(_,"?"))),D.test(f)?(u.attributePatterns=u.attributePatterns||[],d.pattern=c(f),u.attributePatterns.push(d)):(g[f]||v.push(f),g[f]=d)}w||"@"!=p||(w=g,x=v),y&&(u.outputName=p,C[y]=u),D.test(p)?(u.pattern=c(p),S.push(u)):C[p]=u}}function d(e){C={},S=[],u(e),s(g,function(e,t){T[t]=e.children})}function h(e){var n=/^(~)?(.+)$/;e&&s(t(e),function(e){var t=n.exec(e),i="~"===t[1],o=i?"span":"div",r=t[2];T[r]=T[o],E[r]=o,i||(x[r]={}),s(T,function(e){e[o]&&(e[r]=e[o])})})}function p(e){var n=/^([+\-]?)(\w+)\[([^\]]+)\]$/;e&&s(t(e),function(e){var i,o,r=n.exec(e);r&&(o=r[1],i=o?T[r[2]]:T[r[2]]={"#comment":{}},i=T[r[2]],s(t(r[3],"|"),function(e){"-"===o?delete i[e]:i[e]={}}))})}function f(e){var t,n=C[e];if(n)return n;for(t=S.length;t--;)if(n=S[t],n.pattern.test(e))return n}var m,g,v,b,y,w,x,k,_=this,C={},T={},S=[],E={};n=n||{},g="html5"==n.schema?i():o(),n.verify_html===!1&&(n.valid_elements="*[*]"),n.valid_styles&&(m={},s(n.valid_styles,function(t,n){m[n]=e.explode(t)})),v=l("whitespace_elements","pre script noscript style textarea"),b=l("self_closing_elements","colgroup dd dt li option p td tfoot th thead tr"),y=l("short_ended_elements","area base basefont br col frame hr img input isindex link meta param embed source wbr"),w=l("boolean_attributes","checked compact declare defer disabled ismap multiple nohref noresize noshade nowrap readonly selected autoplay loop controls"),k=l("non_empty_elements","td th iframe video audio object",y),textBlockElementsMap=l("text_block_elements","h1 h2 h3 h4 h5 h6 p div address pre form blockquote center dir fieldset header footer article section hgroup aside nav figure"),x=l("block_elements","hr table tbody thead tfoot th tr td li ol ul caption dl dt dd noscript menu isindex samp option datalist select optgroup",textBlockElementsMap),n.valid_elements?d(n.valid_elements):(s(g,function(e,t){C[t]={attributes:e.attributes,attributesOrder:e.attributesOrder},T[t]=e.children}),"html5"!=n.schema&&s(t("strong/b,em/i"),function(e){e=t(e,"/"),C[e[1]].outputName=e[0]}),C.img.attributesDefault=[{name:"alt",value:""}],s(t("ol,ul,sub,sup,blockquote,span,font,a,table,tbody,tr,strong,em,b,i"),function(e){C[e]&&(C[e].removeEmpty=!0)}),s(t("p,h1,h2,h3,h4,h5,h6,th,td,pre,div,address,caption"),function(e){C[e].paddEmpty=!0})),h(n.custom_elements),p(n.valid_children),u(n.extended_valid_elements),p("+ol[ul|ol],+ul[ul|ol]"),n.invalid_elements&&e.each(e.explode(n.invalid_elements),function(e){C[e]&&delete C[e]}),f("span")||u("span[!data-mce-type|*]"),_.children=T,_.styles=m,_.getBoolAttrs=function(){return w},_.getBlockElements=function(){return x},_.getTextBlockElements=function(){return textBlockElementsMap},_.getShortEndedElements=function(){return y},_.getSelfClosingElements=function(){return b},_.getNonEmptyElements=function(){return k},_.getWhiteSpaceElements=function(){return v},_.isValidChild=function(e,t){var n=T[e];return!(!n||!n[t])},_.isValid=function(e,t){var n,i,o=f(e);if(o){if(!t)return!0;if(o.attributes[t])return!0;if(n=o.attributePatterns)for(i=n.length;i--;)if(n[i].pattern.test(e))return!0}return!1},_.getElementRule=f,_.getCustomElements=function(){return E},_.addValidElements=u,_.setValidElements=d,_.addCustomElements=h,_.addValidChildren=p}}(tinymce),function(e){e.html.SaxParser=function(t,n){var i=this,o=function(){};t=t||{},i.schema=n=n||new e.html.Schema,t.fix_self_closing!==!1&&(t.fix_self_closing=!0),e.each("comment cdata text start end pi doctype".split(" "),function(e){e&&(i[e]=t[e]||o)}),i.parse=function(i){function o(e){var t,n;for(t=O.length;t--&&O[t].name!==e;);if(t>=0){for(n=O.length-1;n>=t;n--)e=O[n],e.valid&&j.end(e.name);O.length=t}}function r(e,t,n,i,o){var r,a;if(t=t.toLowerCase(),n=t in g?t:H(n||i||o||""),b&&!p&&0!==t.indexOf("data-")){if(r=C[t],!r&&T){for(a=T.length;a--&&(r=T[a],!r.pattern.test(t)););-1===a&&(r=null)}if(!r)return;if(r.validValues&&!(n in r.validValues))return}c.map[t]=n,c.push({name:t,value:n})}var a,s,l,c,u,d,h,p,f,m,g,v,b,y,w,x,k,_,C,T,S,E,D,M,N,A,P,I,L,R,j=this,F=0,O=[],B=0,H=e.html.Entities.decode;for(N=RegExp("<(?:(?:!--([\\w\\W]*?)-->)|(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|(?:!DOCTYPE([\\w\\W]*?)>)|(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|(?:\\/([^>]+)>)|(?:([A-Za-z0-9\\-\\:]+)((?:\\s+[^\"'>]+(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>]*))*|\\/|\\s+)>))","g"),A=/([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g,P={script:/<\/script[^>]*>/gi,style:/<\/style[^>]*>/gi,noscript:/<\/noscript[^>]*>/gi},m=n.getShortEndedElements(),M=t.self_closing_elements||n.getSelfClosingElements(),g=n.getBoolAttrs(),b=t.validate,f=t.remove_internals,L=t.fix_self_closing,R=e.isIE,_=/^:/;a=N.exec(i);){if(a.index>F&&j.text(H(i.substr(F,a.index-F))),s=a[6])s=s.toLowerCase(),R&&_.test(s)&&(s=s.substr(1)),o(s);else if(s=a[7]){if(s=s.toLowerCase(),R&&_.test(s)&&(s=s.substr(1)),v=s in m,L&&M[s]&&O.length>0&&O[O.length-1].name===s&&o(s),!b||(y=n.getElementRule(s))){if(w=!0,b&&(C=y.attributes,T=y.attributePatterns),(k=a[8])?(p=-1!==k.indexOf("data-mce-type"),p&&f&&(w=!1),c=[],c.map={},k.replace(A,r)):(c=[],c.map={}),b&&!p){if(S=y.attributesRequired,E=y.attributesDefault,D=y.attributesForced)for(u=D.length;u--;)x=D[u],h=x.name,I=x.value,"{$uid}"===I&&(I="mce_"+B++),c.map[h]=I,c.push({name:h,value:I});if(E)for(u=E.length;u--;)x=E[u],h=x.name,h in c.map||(I=x.value,"{$uid}"===I&&(I="mce_"+B++),c.map[h]=I,c.push({name:h,value:I}));if(S){for(u=S.length;u--&&!(S[u]in c.map););-1===u&&(w=!1)}c.map["data-mce-bogus"]&&(w=!1)}w&&j.start(s,c,v)}else w=!1;if(l=P[s]){l.lastIndex=F=a.index+a[0].length,(a=l.exec(i))?(w&&(d=i.substr(F,a.index-F)),F=a.index+a[0].length):(d=i.substr(F),F=i.length),w&&d.length>0&&j.text(d,!0),w&&j.end(s),N.lastIndex=F;continue}v||(k&&k.indexOf("/")==k.length-1?w&&j.end(s):O.push({name:s,valid:w}))}else(s=a[1])?j.comment(s):(s=a[2])?j.cdata(s):(s=a[3])?j.doctype(s):(s=a[4])&&j.pi(s,a[5]);F=a.index+a[0].length}for(i.length>F&&j.text(H(i.substr(F))),u=O.length-1;u>=0;u--)s=O[u],s.valid&&j.end(s.name)}}}(tinymce),function(e){function t(e,t,n){var i,o,r=n?"lastChild":"firstChild",a=n?"prev":"next";if(e[r])return e[r];if(e!==t){if(i=e[a])return i;for(o=e.parent;o&&o!==t;o=o.parent)if(i=o[a])return i}}function n(e,t){this.name=e,this.type=t,1===t&&(this.attributes=[],this.attributes.map={})}var i=/^[ \t\r\n]*$/,o={"#text":3,"#comment":8,"#cdata":4,"#pi":7,"#doctype":10,"#document-fragment":11};e.extend(n.prototype,{replace:function(e){var t=this;return e.parent&&e.remove(),t.insert(e,t),t.remove(),t},attr:function(e,t){var n,i,o,r=this;if("string"!=typeof e){for(i in e)r.attr(i,e[i]);return r}if(n=r.attributes){if(t!==o){if(null===t){if(e in n.map)for(delete n.map[e],i=n.length;i--;)if(n[i].name===e)return n=n.splice(i,1),r;return r}if(e in n.map){for(i=n.length;i--;)if(n[i].name===e){n[i].value=t;break}}else n.push({name:e,value:t});return n.map[e]=t,r}return n.map[e]}},clone:function(){var e,t,i,o,r,a=this,s=new n(a.name,a.type);if(i=a.attributes){for(r=[],r.map={},e=0,t=i.length;t>e;e++)o=i[e],"id"!==o.name&&(r[r.length]={name:o.name,value:o.value},r.map[o.name]=o.value);s.attributes=r}return s.value=a.value,s.shortEnded=a.shortEnded,s},wrap:function(e){var t=this;return t.parent.insert(e,t),e.append(t),t},unwrap:function(){var e,t,n=this;for(e=n.firstChild;e;)t=e.next,n.insert(e,n,!0),e=t;n.remove()},remove:function(){var e=this,t=e.parent,n=e.next,i=e.prev;return t&&(t.firstChild===e?(t.firstChild=n,n&&(n.prev=null)):i.next=n,t.lastChild===e?(t.lastChild=i,i&&(i.next=null)):n.prev=i,e.parent=e.next=e.prev=null),e},append:function(e){var t,n=this;return e.parent&&e.remove(),t=n.lastChild,t?(t.next=e,e.prev=t,n.lastChild=e):n.lastChild=n.firstChild=e,e.parent=n,e},insert:function(e,t,n){var i;return e.parent&&e.remove(),i=t.parent||this,n?(t===i.firstChild?i.firstChild=e:t.prev.next=e,e.prev=t.prev,e.next=t,t.prev=e):(t===i.lastChild?i.lastChild=e:t.next.prev=e,e.next=t.next,e.prev=t,t.next=e),e.parent=i,e},getAll:function(e){var n,i=this,o=[];for(n=i.firstChild;n;n=t(n,i))n.name===e&&o.push(n);return o},empty:function(){var e,n,i,o=this;if(o.firstChild){for(e=[],i=o.firstChild;i;i=t(i,o))e.push(i);for(n=e.length;n--;)i=e[n],i.parent=i.firstChild=i.lastChild=i.next=i.prev=null}return o.firstChild=o.lastChild=null,o},isEmpty:function(e){var n,o,r=this,a=r.firstChild;if(a)do{if(1===a.type){if(a.attributes.map["data-mce-bogus"])continue;if(e[a.name])return!1;for(n=a.attributes.length;n--;)if(o=a.attributes[n].name,"name"===o||0===o.indexOf("data-"))return!1}if(8===a.type)return!1;if(3===a.type&&!i.test(a.value))return!1}while(a=t(a,r));return!0},walk:function(e){return t(this,null,e)}}),e.extend(n,{create:function(e,t){var i,r;if(i=new n(e,o[e]||1),t)for(r in t)i.attr(r,t[r]);return i}}),e.html.Node=n}(tinymce),function(e){var t=e.html.Node;e.html.DomParser=function(n,i){function o(n){var o,a,s,l,c,u,d,h,p,f,m,g,v,b;for(m=e.makeMap("tr,td,th,tbody,thead,tfoot,table"),f=i.getNonEmptyElements(),g=i.getTextBlockElements(),o=0;n.length>o;o++)if(a=n[o],a.parent&&!a.fixed)if(g[a.name]&&"li"==a.parent.name){for(v=a.next;v&&g[v.name];)v.name="li",v.fixed=!0,a.parent.insert(v,a.parent),v=v.next;a.unwrap(a)}else{for(l=[a],s=a.parent;s&&!i.isValidChild(s.name,a.name)&&!m[s.name];s=s.parent)l.push(s);if(s&&l.length>1){for(l.reverse(),c=u=r.filterNode(l[0].clone()),p=0;l.length-1>p;p++){for(i.isValidChild(u.name,l[p].name)?(d=r.filterNode(l[p].clone()),u.append(d)):d=u,h=l[p].firstChild;h&&h!=l[p+1];)b=h.next,d.append(h),h=b;u=d}c.isEmpty(f)?s.insert(a,l[0],!0):(s.insert(c,l[0],!0),s.insert(a,c)),s=l[0],(s.isEmpty(f)||s.firstChild===s.lastChild&&"br"===s.firstChild.name)&&s.empty().remove()}else if(a.parent){if("li"===a.name){if(v=a.prev,v&&("ul"===v.name||"ul"===v.name)){v.append(a);continue}if(v=a.next,v&&("ul"===v.name||"ul"===v.name)){v.insert(a,v.firstChild,!0);continue}a.wrap(r.filterNode(new t("ul",1)));continue}i.isValidChild(a.parent.name,"div")&&i.isValidChild("div",a.name)?a.wrap(r.filterNode(new t("div",1))):"style"===a.name||"script"===a.name?a.empty().remove():a.unwrap()}}}var r=this,a={},s=[],l={},c={};n=n||{},n.validate="validate"in n?n.validate:!0,n.root_name=n.root_name||"body",r.schema=i=i||new e.html.Schema,r.filterNode=function(e){var t,n,i;n in a&&(i=l[n],i?i.push(e):l[n]=[e]),t=s.length;for(;t--;)n=s[t].name,n in e.attributes.map&&(i=c[n],i?i.push(e):c[n]=[e]);return e},r.addNodeFilter=function(t,n){e.each(e.explode(t),function(e){var t=a[e];t||(a[e]=t=[]),t.push(n)})},r.addAttributeFilter=function(t,n){e.each(e.explode(t),function(e){var t;for(t=0;s.length>t;t++)if(s[t].name===e)return s[t].callbacks.push(n),void 0;s.push({name:e,callbacks:[n]})})},r.parse=function(r,u){function d(){for(var e,t,n=g.firstChild;n;)e=n.next,3==n.type||1==n.type&&"p"!==n.name&&!S[n.name]&&!n.attr("data-mce-type")?t?t.append(n):(t=h(R,1),g.insert(t,n),t.append(n)):t=null,n=e}function h(e,n){var i,o=new t(e,n);return e in a&&(i=l[e],i?i.push(o):l[e]=[o]),o}function p(e){var t,n,i;for(t=e.prev;t&&3===t.type;)n=t.value.replace(M,""),n.length>0?(t.value=n,t=t.prev):(i=t.prev,t.remove(),t=i)}function f(e){var t,n={};for(t in e)"li"!==t&&"p"!=t&&(n[t]=e[t]);return n}var m,g,v,b,y,w,x,k,_,C,T,S,E,D,M,N,A,P,I,L,R,j=[];if(u=u||{},l={},c={},S=e.extend(e.makeMap("script,style,head,html,body,title,meta,param"),i.getBlockElements()),L=i.getNonEmptyElements(),I=i.children,T=n.validate,R="forced_root_block"in u?u.forced_root_block:n.forced_root_block,P=i.getWhiteSpaceElements(),E=/^[ \t\r\n]+/,M=/[ \t\r\n]+$/,N=/[ \t\r\n]+/g,A=/^[ \t\r\n]+$/,m=new e.html.SaxParser({validate:T,self_closing_elements:f(i.getSelfClosingElements()),cdata:function(e){v.append(h("#cdata",4)).value=e},text:function(e,t){var n;D||(e=e.replace(N," "),v.lastChild&&S[v.lastChild.name]&&(e=e.replace(E,""))),0!==e.length&&(n=h("#text",3),n.raw=!!t,v.append(n).value=e)},comment:function(e){v.append(h("#comment",8)).value=e},pi:function(e,t){v.append(h(e,7)).value=t,p(v)},doctype:function(e){var t;t=v.append(h("#doctype",10)),t.value=e,p(v)},start:function(e,t,n){var o,r,a,l,u;if(a=T?i.getElementRule(e):{}){for(o=h(a.outputName||e,1),o.attributes=t,o.shortEnded=n,v.append(o),u=I[v.name],u&&I[o.name]&&!u[o.name]&&j.push(o),r=s.length;r--;)l=s[r].name,l in t.map&&(_=c[l],_?_.push(o):c[l]=[o]);S[e]&&p(o),n||(v=o),!D&&P[e]&&(D=!0)}},end:function(e){var n,o,r,a,s;if(o=T?i.getElementRule(e):{}){if(S[e]&&!D){if(n=v.firstChild,n&&3===n.type)for(r=n.value.replace(E,""),r.length>0?(n.value=r,n=n.next):(a=n.next,n.remove(),n=a);n&&3===n.type;)r=n.value,a=n.next,(0===r.length||A.test(r))&&(n.remove(),n=a),n=a;if(n=v.lastChild,n&&3===n.type)for(r=n.value.replace(M,""),r.length>0?(n.value=r,n=n.prev):(a=n.prev,n.remove(),n=a);n&&3===n.type;)r=n.value,a=n.prev,(0===r.length||A.test(r))&&(n.remove(),n=a),n=a}if(D&&P[e]&&(D=!1),(o.removeEmpty||o.paddEmpty)&&v.isEmpty(L))if(o.paddEmpty)v.empty().append(new t("#text","3")).value=" ";else if(!v.attributes.map.name&&!v.attributes.map.id)return s=v.parent,v.empty().remove(),v=s,void 0;v=v.parent}}},i),g=v=new t(u.context||n.root_name,11),m.parse(r),T&&j.length&&(u.context?u.invalid=!0:o(j)),R&&"body"==g.name&&d(),!u.invalid){for(C in l){for(_=a[C],b=l[C],x=b.length;x--;)b[x].parent||b.splice(x,1);for(y=0,w=_.length;w>y;y++)_[y](b,C,u)}for(y=0,w=s.length;w>y;y++)if(_=s[y],_.name in c){for(b=c[_.name],x=b.length;x--;)b[x].parent||b.splice(x,1);for(x=0,k=_.callbacks.length;k>x;x++)_.callbacks[x](b,_.name,u)}}return g},n.remove_trailing_brs&&r.addNodeFilter("br",function(t){var n,o,r,a,s,l,c=t.length,u=e.extend({},i.getBlockElements()),d=i.getNonEmptyElements();for(u.body=1,n=0;c>n;n++)if(o=t[n],r=o.parent,u[o.parent.name]&&o===r.lastChild){for(s=o.prev;s;){if(l=s.name,"span"!==l||"bookmark"!==s.attr("data-mce-type")){if("br"!==l)break;if("br"===l){o=null;break}}s=s.prev}o&&(o.remove(),r.isEmpty(d)&&(elementRule=i.getElementRule(r.name),elementRule&&(elementRule.removeEmpty?r.remove():elementRule.paddEmpty&&(r.empty().append(new e.html.Node("#text",3)).value=" "))))}else{for(a=o;r.firstChild===a&&r.lastChild===a&&(a=r,!u[r.name]);)r=r.parent;a===r&&(textNode=new e.html.Node("#text",3),textNode.value=" ",o.replace(textNode))}}),n.allow_html_in_named_anchor||r.addAttributeFilter("id,name",function(e){for(var t,n,i,o,r=e.length;r--;)if(o=e[r],"a"===o.name&&o.firstChild&&!o.attr("href")){i=o.parent,t=o.lastChild;do n=t.prev,i.insert(t,o),t=n;while(t)}})}}(tinymce),tinymce.html.Writer=function(e){var t,n,i,o,r,a=[];return e=e||{},t=e.indent,n=tinymce.makeMap(e.indent_before||""),i=tinymce.makeMap(e.indent_after||""),o=tinymce.html.Entities.getEncodeFunc(e.entity_encoding||"raw",e.entities),r="html"==e.element_format,{start:function(e,s,l){var c,u,d,h;if(t&&n[e]&&a.length>0&&(h=a[a.length-1],h.length>0&&"\n"!==h&&a.push("\n")),a.push("<",e),s)for(c=0,u=s.length;u>c;c++)d=s[c],a.push(" ",d.name,'="',o(d.value,!0),'"');a[a.length]=!l||r?">":" />",l&&t&&i[e]&&a.length>0&&(h=a[a.length-1],h.length>0&&"\n"!==h&&a.push("\n"))},end:function(e){var n;a.push("</",e,">"),t&&i[e]&&a.length>0&&(n=a[a.length-1],n.length>0&&"\n"!==n&&a.push("\n"))},text:function(e,t){e.length>0&&(a[a.length]=t?e:o(e))},cdata:function(e){a.push("<![CDATA[",e,"]]>")},comment:function(e){a.push("<!--",e,"-->")},pi:function(e,n){n?a.push("<?",e," ",n,"?>"):a.push("<?",e,"?>"),t&&a.push("\n")},doctype:function(e){a.push("<!DOCTYPE",e,">",t?"\n":"")},reset:function(){a.length=0},getContent:function(){return a.join("").replace(/\n$/,"")}}},function(e){e.html.Serializer=function(t,n){var i=this,o=new e.html.Writer(t);t=t||{},t.validate="validate"in t?t.validate:!0,i.schema=n=n||new e.html.Schema,i.writer=o,i.serialize=function(e){function i(e){var t,s,l,c,u,d,h,p,f,m=r[e.type];if(m)m(e);else{if(t=e.name,s=e.shortEnded,l=e.attributes,a&&l&&l.length>1){for(d=[],d.map={},f=n.getElementRule(e.name),h=0,p=f.attributesOrder.length;p>h;h++)c=f.attributesOrder[h],c in l.map&&(u=l.map[c],d.map[c]=u,d.push({name:c,value:u}));for(h=0,p=l.length;p>h;h++)c=l[h].name,c in d.map||(u=l.map[c],d.map[c]=u,d.push({name:c,value:u}));l=d}if(o.start(e.name,l,s),!s){if(e=e.firstChild)do i(e);while(e=e.next);o.end(t)}}}var r,a;return a=t.validate,r={3:function(e){o.text(e.value,e.raw)},8:function(e){o.comment(e.value)},7:function(e){o.pi(e.name,e.value)},10:function(e){o.doctype(e.value)},4:function(e){o.cdata(e.value)},11:function(e){if(e=e.firstChild)do i(e);while(e=e.next)}},o.reset(),1!=e.type||t.inner?r[11](e):i(e),o.getContent()}}}(tinymce),tinymce.dom={},function(e,t){function n(e,t,n,i){e.addEventListener?e.addEventListener(t,n,i||!1):e.attachEvent&&e.attachEvent("on"+t,n)}function i(e,t,n,i){e.removeEventListener?e.removeEventListener(t,n,i||!1):e.detachEvent&&e.detachEvent("on"+t,n)}function o(e,t){function n(){return!1}function i(){return!0}var o,r=t||{};for(o in e)"layerX"!==o&&"layerY"!==o&&(r[o]=e[o]);return r.target||(r.target=r.srcElement||document),r.preventDefault=function(){r.isDefaultPrevented=i,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},r.stopPropagation=function(){r.isPropagationStopped=i,e&&(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0)},r.stopImmediatePropagation=function(){r.isImmediatePropagationStopped=i,r.stopPropagation()},r.isDefaultPrevented||(r.isDefaultPrevented=n,r.isPropagationStopped=n,r.isImmediatePropagationStopped=n),r}function r(e,t,o){function r(){o.domLoaded||(o.domLoaded=!0,t(l))}var a=e.document,l={type:"ready"};s?n(e,"DOMContentLoaded",r):(n(a,"readystatechange",function(){"complete"===a.readyState&&(i(a,"readystatechange",arguments.callee),r())}),a.documentElement.doScroll&&e===e.top&&function(){try{a.documentElement.doScroll("left")}catch(e){return setTimeout(arguments.callee,0),void 0}r()}()),n(e,"load",r)}function a(e){function a(e,t){var n,i,o,r;if(n=p[t][e.type])for(i=0,o=n.length;o>i;i++)if(r=n[i],r&&r.func.call(r.scope,e)===!1&&e.preventDefault(),e.isImmediatePropagationStopped())return}var l,c,u,d,h=this,p={};u="onmouseenter"in document.documentElement,c="onfocusin"in document.documentElement,d={mouseenter:"mouseover",mouseleave:"mouseout"},l=1,h.domLoaded=!1,h.events=p,h.bind=function(i,f,m,g){function v(e){a(o(e||T.event),b)}var b,y,w,x,k,_,C,T=window;if(i&&3!==i.nodeType&&8!==i.nodeType){for(i[t]?(b=i[t],p[b]||(p[b]={})):(b=l++,i[t]=b,p[b]={}),g=g||i,f=f.split(" "),w=f.length;w--;)x=f[w],_=v,k=C=!1,"DOMContentLoaded"===x&&(x="ready"),!h.domLoaded&&"complete"!=i.readyState||"ready"!==x?(u||(k=d[x],k&&(_=function(e){var t,n;if(t=e.currentTarget,n=e.relatedTarget,n&&t.contains)n=t.contains(n);else for(;n&&n!==t;)n=n.parentNode;n||(e=o(e||T.event),e.type="mouseout"===e.type?"mouseleave":"mouseenter",e.target=t,a(e,b))})),c||"focusin"!==x&&"focusout"!==x||(C=!0,k="focusin"===x?"focus":"blur",_=function(e){e=o(e||T.event),e.type="focus"===e.type?"focusin":"focusout",a(e,b)}),y=p[b][x],y?y.push({func:m,scope:g}):(p[b][x]=y=[{func:m,scope:g}],y.fakeName=k,y.capture=C,y.nativeHandler=_,s||(y.proxyHandler=e(b)),"ready"===x?r(i,_,h):n(i,k||x,s?_:y.proxyHandler,C))):(h.domLoaded=!0,m.call(g,o({type:x})));return i=y=0,m}},h.unbind=function(e,n,o){var r,a,l,c,u,d;if(!e||3===e.nodeType||8===e.nodeType)return h;if(r=e[t]){if(d=p[r],n){for(n=n.split(" "),l=n.length;l--;)if(u=n[l],a=d[u]){if(o)for(c=a.length;c--;)a[c].func===o&&a.splice(c,1);o&&0!==a.length||(delete d[u],i(e,a.fakeName||u,s?a.nativeHandler:a.proxyHandler,a.capture))}}else{for(u in d)a=d[u],i(e,a.fakeName||u,s?a.nativeHandler:a.proxyHandler,a.capture);d={}}for(u in d)return h;delete p[r];try{delete e[t]}catch(f){e[t]=null}}return h},h.fire=function(e,n,i){var r,s;if(!e||3===e.nodeType||8===e.nodeType)return h;s=o(null,i),s.type=n;do r=e[t],r&&a(s,r),e=e.parentNode||e.ownerDocument||e.defaultView||e.parentWindow;while(e&&!s.isPropagationStopped());return h},h.clean=function(e){var n,i,o=h.unbind;if(!e||3===e.nodeType||8===e.nodeType)return h;if(e[t]&&o(e),e.getElementsByTagName||(e=e.document),e&&e.getElementsByTagName)for(o(e),i=e.getElementsByTagName("*"),n=i.length;n--;)e=i[n],e[t]&&o(e);return h},h.callNativeHandler=function(e,t){p&&p[e][t.type].nativeHandler(t)},h.destory=function(){p={}},h.add=function(e,t,n,i){"string"==typeof e&&(e=document.getElementById(e));{if(!(e&&e instanceof Array))return"init"===t&&(t="ready"),h.bind(e,t instanceof Array?t.join(" "):t,n,i);for(var o=e.length;o--;)h.add(e[o],t,n,i)}},h.remove=function(e,t,n,i){if(!e)return h;if("string"==typeof e&&(e=document.getElementById(e)),e instanceof Array){for(var o=e.length;o--;)h.remove(e[o],t,n,i);return h}return h.unbind(e,t instanceof Array?t.join(" "):t,n)},h.clear=function(e){return"string"==typeof e&&(e=document.getElementById(e)),h.clean(e)},h.cancel=function(e){return e&&(h.prevent(e),h.stop(e)),!1},h.prevent=function(e){return e.preventDefault||(e=o(e)),e.preventDefault(),!1},h.stop=function(e){return e.stopPropagation||(e=o(e)),e.stopPropagation(),!1}}var s=!!document.addEventListener;e.EventUtils=a,e.Event=new a(function(e){return function(t){tinymce.dom.Event.callNativeHandler(e,t)}}),e.Event.bind(window,"ready",function(){}),e=0}(tinymce.dom,"data-mce-expando"),tinymce.dom.TreeWalker=function(e,t){function n(e,n,i,o){var r,a;if(e){if(!o&&e[n])return e[n];if(e!=t){if(r=e[i])return r;for(a=e.parentNode;a&&a!=t;a=a.parentNode)if(r=a[i])return r}}}var i=e;this.current=function(){return i},this.next=function(e){return i=n(i,"firstChild","nextSibling",e)},this.prev=function(e){return i=n(i,"lastChild","previousSibling",e)}},function(e){var t=e.each,n=e.is,i=e.isWebKit,o=e.isIE,r=e.html.Entities,a=/^[ \t\r\n]*$/;e.create("tinymce.dom.DOMUtils",{doc:null,root:null,files:null,pixelStyles:/^(top|left|bottom|right|width|height|borderWidth)$/,props:{"for":"htmlFor","class":"className",className:"className",checked:"checked",disabled:"disabled",maxlength:"maxLength",readonly:"readOnly",selected:"selected",value:"value",id:"id",name:"name",type:"type"},DOMUtils:function(t,n){var i,o=this;
if(o.doc=t,o.win=window,o.files={},o.cssFlicker=!1,o.counter=0,o.stdMode=!e.isIE||t.documentMode>=8,o.boxModel=!e.isIE||"CSS1Compat"==t.compatMode||o.stdMode,o.hasOuterHTML="outerHTML"in t.createElement("a"),o.settings=n=e.extend({keep_values:!1,hex_colors:1},n),o.schema=n.schema,o.styles=new e.html.Styles({url_converter:n.url_converter,url_converter_scope:n.url_converter_scope},n.schema),e.isIE6)try{t.execCommand("BackgroundImageCache",!1,!0)}catch(r){o.cssFlicker=!0}o.fixDoc(t),o.events=n.ownEvents?new e.dom.EventUtils(n.proxy):e.dom.Event,e.addUnload(o.destroy,o),i=n.schema?n.schema.getBlockElements():{},o.isBlock=function(e){var t=e.nodeType;return t?!(1!==t||!i[e.nodeName]):!!i[e]}},fixDoc:function(e){var t,n=this.settings;if(o&&n.schema){"abbr article aside audio canvas details figcaption figure footer header hgroup mark menu meter nav output progress section summary time video".replace(/\w+/g,function(t){e.createElement(t)});for(t in n.schema.getCustomElements())e.createElement(t)}},clone:function(e,n){var i,r,a=this;return!o||1!==e.nodeType||n?e.cloneNode(n):(r=a.doc,n?i.firstChild:(i=r.createElement(e.nodeName),t(a.getAttribs(e),function(t){a.setAttrib(i,t.nodeName,a.getAttrib(e,t.nodeName))}),i))},getRoot:function(){var e=this,t=e.settings;return t&&e.get(t.root_element)||e.doc.body},getViewPort:function(e){var t,n;return e=e?e:this.win,t=e.document,n=this.boxModel?t.documentElement:t.body,{x:e.pageXOffset||n.scrollLeft,y:e.pageYOffset||n.scrollTop,w:e.innerWidth||n.clientWidth,h:e.innerHeight||n.clientHeight}},getRect:function(e){var t,n,i=this;return e=i.get(e),t=i.getPos(e),n=i.getSize(e),{x:t.x,y:t.y,w:n.w,h:n.h}},getSize:function(e){var t,n,i=this;return e=i.get(e),t=i.getStyle(e,"width"),n=i.getStyle(e,"height"),-1===t.indexOf("px")&&(t=0),-1===n.indexOf("px")&&(n=0),{w:parseInt(t,10)||e.offsetWidth||e.clientWidth,h:parseInt(n,10)||e.offsetHeight||e.clientHeight}},getParent:function(e,t,n){return this.getParents(e,t,n,!1)},getParents:function(e,t,i,o){var r,a=this,s=a.settings,l=[];for(e=a.get(e),o=void 0===o,s.strict_root&&(i=i||a.getRoot()),n(t,"string")&&(r=t,t="*"===t?function(e){return 1==e.nodeType}:function(e){return a.is(e,r)});e&&e!=i&&e.nodeType&&9!==e.nodeType;){if(!t||t(e)){if(!o)return e;l.push(e)}e=e.parentNode}return o?l:null},get:function(e){var t;return e&&this.doc&&"string"==typeof e&&(t=e,e=this.doc.getElementById(e),e&&e.id!==t)?this.doc.getElementsByName(t)[1]:e},getNext:function(e,t){return this._findSib(e,t,"nextSibling")},getPrev:function(e,t){return this._findSib(e,t,"previousSibling")},add:function(e,t,i,o,r){var a=this;return this.run(e,function(e){var s;return s=n(t,"string")?a.doc.createElement(t):t,a.setAttribs(s,i),o&&(o.nodeType?s.appendChild(o):a.setHTML(s,o)),r?s:e.appendChild(s)})},create:function(e,t,n){return this.add(this.doc.createElement(e),e,t,n,1)},createHTML:function(e,t,n){var i,o="",r=this;o+="<"+e;for(i in t)t.hasOwnProperty(i)&&(o+=" "+i+'="'+r.encode(t[i])+'"');return n!==void 0?o+">"+n+"</"+e+">":o+" />"},remove:function(t,n){return this.run(t,function(t){var i,o=t.parentNode;if(!o)return null;if(n)for(;i=t.firstChild;)!e.isIE||3!==i.nodeType||i.nodeValue?o.insertBefore(i,t):t.removeChild(i);return o.removeChild(t)})},setStyle:function(t,n,i){var r=this;return r.run(t,function(a){var s;switch(s=a.style,n=n.replace(/-(\D)/g,function(e,t){return t.toUpperCase()}),r.pixelStyles.test(n)&&(e.is(i,"number")||/^[\-0-9\.]+$/.test(i))&&(i+="px"),n){case"opacity":o&&(s.filter=""===i?"":"alpha(opacity="+100*i+")",t.currentStyle&&t.currentStyle.hasLayout||(s.display="inline-block")),s[n]=s["-moz-opacity"]=s["-khtml-opacity"]=i||"";break;case"float":o?s.styleFloat=i:s.cssFloat=i;break;default:s[n]=i||""}r.settings.update_styles&&r.setAttrib(a,"data-mce-style")})},getStyle:function(e,t,n){if(e=this.get(e)){if(this.doc.defaultView&&n){t=t.replace(/[A-Z]/g,function(e){return"-"+e});try{return this.doc.defaultView.getComputedStyle(e,null).getPropertyValue(t)}catch(i){return null}}return t=t.replace(/-(\D)/g,function(e,t){return t.toUpperCase()}),"float"==t&&(t=o?"styleFloat":"cssFloat"),e.currentStyle&&n?e.currentStyle[t]:e.style?e.style[t]:void 0}},setStyles:function(e,n){var i,o=this,r=o.settings;i=r.update_styles,r.update_styles=0,t(n,function(t,n){o.setStyle(e,n,t)}),r.update_styles=i,r.update_styles&&o.setAttrib(e,r.cssText)},removeAllAttribs:function(e){return this.run(e,function(e){var t,n=e.attributes;for(t=n.length-1;t>=0;t--)e.removeAttributeNode(n.item(t))})},setAttrib:function(e,i,o){var r=this;if(e&&i)return r.settings.strict&&(i=i.toLowerCase()),this.run(e,function(e){var a=r.settings,s=e.getAttribute(i);if(null!==o)switch(i){case"style":if(!n(o,"string"))return t(o,function(t,n){r.setStyle(e,n,t)}),void 0;a.keep_values&&(o&&!r._isRes(o)?e.setAttribute("data-mce-style",o,2):e.removeAttribute("data-mce-style",2)),e.style.cssText=o;break;case"class":e.className=o||"";break;case"src":case"href":a.keep_values&&(a.url_converter&&(o=a.url_converter.call(a.url_converter_scope||r,o,i,e)),r.setAttrib(e,"data-mce-"+i,o,2));break;case"shape":e.setAttribute("data-mce-style",o)}if(n(o)&&null!==o&&0!==o.length?e.setAttribute(i,""+o,2):e.removeAttribute(i,2),tinyMCE.activeEditor&&s!=o){var l=tinyMCE.activeEditor;l.onSetAttrib.dispatch(l,e,i,o)}})},setAttribs:function(e,n){var i=this;return this.run(e,function(e){t(n,function(t,n){i.setAttrib(e,n,t)})})},getAttrib:function(t,r,a){var s,l,c=this;if(t=c.get(t),!t||1!==t.nodeType)return a===l?!1:a;if(n(a)||(a=""),/^(src|href|style|coords|shape)$/.test(r)&&(s=t.getAttribute("data-mce-"+r)))return s;if(o&&c.props[r]&&(s=t[c.props[r]],s=s&&s.nodeValue?s.nodeValue:s),s||(s=t.getAttribute(r,2)),/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noshade|nowrap|readonly|selected)$/.test(r))return t[c.props[r]]===!0&&""===s?r:s?r:"";if("FORM"===t.nodeName&&t.getAttributeNode(r))return t.getAttributeNode(r).nodeValue;if("style"===r&&(s=s||t.style.cssText,s&&(s=c.serializeStyle(c.parseStyle(s),t.nodeName),c.settings.keep_values&&!c._isRes(s)&&t.setAttribute("data-mce-style",s))),i&&"class"===r&&s&&(s=s.replace(/(apple|webkit)\-[a-z\-]+/gi,"")),o)switch(r){case"rowspan":case"colspan":1===s&&(s="");break;case"size":("+0"===s||20===s||0===s)&&(s="");break;case"width":case"height":case"vspace":case"checked":case"disabled":case"readonly":0===s&&(s="");break;case"hspace":-1===s&&(s="");break;case"maxlength":case"tabindex":(32768===s||2147483647===s||"32768"===s)&&(s="");break;case"multiple":case"compact":case"noshade":case"nowrap":return 65535===s?r:a;case"shape":s=s.toLowerCase();break;default:0===r.indexOf("on")&&s&&(s=e._replace(/^function\s+\w+\(\)\s+\{\s+(.*)\s+\}$/,"$1",""+s))}return s!==l&&null!==s&&""!==s?""+s:a},getPos:function(e,t){var n,i,o=this,r=0,a=0,s=o.doc;if(e=o.get(e),t=t||s.body,e){if(e.getBoundingClientRect)return e=e.getBoundingClientRect(),n=o.boxModel?s.documentElement:s.body,r=e.left+(s.documentElement.scrollLeft||s.body.scrollLeft)-n.clientTop,a=e.top+(s.documentElement.scrollTop||s.body.scrollTop)-n.clientLeft,{x:r,y:a};for(i=e;i&&i!=t&&i.nodeType;)r+=i.offsetLeft||0,a+=i.offsetTop||0,i=i.offsetParent;for(i=e.parentNode;i&&i!=t&&i.nodeType;)r-=i.scrollLeft||0,a-=i.scrollTop||0,i=i.parentNode}return{x:r,y:a}},parseStyle:function(e){return this.styles.parse(e)},serializeStyle:function(e,t){return this.styles.serialize(e,t)},addStyle:function(e){var t,n=this.doc;styleElm=n.getElementById("mceDefaultStyles"),styleElm||(styleElm=n.createElement("style"),styleElm.id="mceDefaultStyles",styleElm.type="text/css",t=n.getElementsByTagName("head")[0],t.firstChild?t.insertBefore(styleElm,t.firstChild):t.appendChild(styleElm)),styleElm.styleSheet?styleElm.styleSheet.cssText+=e:styleElm.appendChild(n.createTextNode(e))},loadCSS:function(n){var i,r=this,a=r.doc;n||(n=""),i=a.getElementsByTagName("head")[0],t(n.split(","),function(t){var n;r.files[t]||(r.files[t]=!0,n=r.create("link",{rel:"stylesheet",href:e._addVer(t)}),o&&a.documentMode&&a.recalc&&(n.onload=function(){a.recalc&&a.recalc(),n.onload=null}),i.appendChild(n))})},addClass:function(e,t){return this.run(e,function(e){var n;return t?this.hasClass(e,t)?e.className:(n=this.removeClass(e,t),e.className=(""!=n?n+" ":"")+t):0})},removeClass:function(t,n){var i,o=this;return o.run(t,function(t){var r;return o.hasClass(t,n)?(i||(i=RegExp("(^|\\s+)"+n+"(\\s+|$)","g")),r=t.className.replace(i," "),r=e.trim(" "!=r?r:""),t.className=r,r||(t.removeAttribute("class"),t.removeAttribute("className")),r):t.className})},hasClass:function(e,t){return e=this.get(e),e&&t?-1!==(" "+e.className+" ").indexOf(" "+t+" "):!1},show:function(e){return this.setStyle(e,"display","block")},hide:function(e){return this.setStyle(e,"display","none")},isHidden:function(e){return e=this.get(e),!e||"none"==e.style.display||"none"==this.getStyle(e,"display")},uniqueId:function(e){return(e?e:"mce_")+this.counter++},setHTML:function(n,i){var r=this;return r.run(n,function(n){if(o){for(;n.firstChild;)n.removeChild(n.firstChild);try{n.innerHTML="<br />"+i,n.removeChild(n.firstChild)}catch(a){var s=r.create("div");s.innerHTML="<br />"+i,t(e.grep(s.childNodes),function(e,t){t&&n.canHaveHTML&&n.appendChild(e)})}}else n.innerHTML=i;return i})},getOuterHTML:function(e){var t,n=this;return(e=n.get(e))?1===e.nodeType&&n.hasOuterHTML?e.outerHTML:(t=(e.ownerDocument||n.doc).createElement("body"),t.appendChild(e.cloneNode(!0)),t.innerHTML):null},setOuterHTML:function(e,t,n){function i(e,t,n){var i,o;for(o=n.createElement("body"),o.innerHTML=t,i=o.lastChild;i;)r.insertAfter(i.cloneNode(!0),e),i=i.previousSibling;r.remove(e)}var r=this;return this.run(e,function(e){if(e=r.get(e),1==e.nodeType)if(n=n||e.ownerDocument||r.doc,o)try{o&&1==e.nodeType?e.outerHTML=t:i(e,t,n)}catch(a){i(e,t,n)}else i(e,t,n)})},decode:r.decode,encode:r.encodeAllRaw,insertAfter:function(e,t){return t=this.get(t),this.run(e,function(e){var n,i;return n=t.parentNode,i=t.nextSibling,i?n.insertBefore(e,i):n.appendChild(e),e})},replace:function(i,o,r){var a=this;return n(o,"array")&&(i=i.cloneNode(!0)),a.run(o,function(n){return r&&t(e.grep(n.childNodes),function(e){i.appendChild(e)}),n.parentNode.replaceChild(i,n)})},rename:function(e,n){var i,o=this;return e.nodeName!=n.toUpperCase()&&(i=o.create(n),t(o.getAttribs(e),function(t){o.setAttrib(i,t.nodeName,o.getAttrib(e,t.nodeName))}),o.replace(i,e,1)),i||e},findCommonAncestor:function(e,t){for(var n,i=e;i;){for(n=t;n&&i!=n;)n=n.parentNode;if(i==n)break;i=i.parentNode}return!i&&e.ownerDocument?e.ownerDocument.documentElement:i},toHex:function(e){function t(e){return e=parseInt(e,10).toString(16),e.length>1?e:"0"+e}var n=/^\s*rgb\s*?\(\s*?([0-9]+)\s*?,\s*?([0-9]+)\s*?,\s*?([0-9]+)\s*?\)\s*$/i.exec(e);return n?e="#"+t(n[1])+t(n[2])+t(n[3]):e},getClasses:function(){function n(o){t(o.imports,function(e){n(e)}),t(o.cssRules||o.rules,function(o){switch(o.type||1){case 1:o.selectorText&&t(o.selectorText.split(","),function(t){t=t.replace(/^\s*|\s*$|^\s\./g,""),!/\.mce/.test(t)&&/\.[\w\-]+$/.test(t)&&(i=t,t=e._replace(/.*\.([a-z0-9_\-]+).*/i,"$1",t),(!s||(t=s(t,i)))&&(a[t]||(r.push({"class":t}),a[t]=1)))});break;case 3:n(o.styleSheet)}})}var i,o=this,r=[],a={},s=o.settings.class_filter;if(o.classes)return o.classes;try{t(o.doc.styleSheets,n)}catch(l){}return r.length>0&&(o.classes=r),r},run:function(e,n,i){var o,r=this;return r.doc&&"string"==typeof e&&(e=r.get(e)),e?(i=i||this,e.nodeType||!e.length&&0!==e.length?n.call(i,e):(o=[],t(e,function(e,t){e&&("string"==typeof e&&(e=r.doc.getElementById(e)),o.push(n.call(i,e,t)))}),o)):!1},getAttribs:function(e){var t;return e=this.get(e),e?o?(t=[],"OBJECT"==e.nodeName?e.attributes:("OPTION"===e.nodeName&&this.getAttrib(e,"selected")&&t.push({specified:1,nodeName:"selected"}),e.cloneNode(!1).outerHTML.replace(/<\/?[\w:\-]+ ?|=[\"][^\"]+\"|=\'[^\']+\'|=[\w\-]+|>/gi,"").replace(/[\w:\-]+/gi,function(e){t.push({specified:1,nodeName:e})}),t)):e.attributes:[]},isEmpty:function(t,n){var i,o,r,s,l,c=this,u=0;if(t=t.firstChild){s=new e.dom.TreeWalker(t,t.parentNode),n=n||c.schema?c.schema.getNonEmptyElements():null;do{if(r=t.nodeType,1===r){if(t.getAttribute("data-mce-bogus"))continue;if(l=t.nodeName.toLowerCase(),n&&n[l]){if("br"===l){u++;continue}return!1}for(o=c.getAttribs(t),i=t.attributes.length;i--;)if(l=t.attributes[i].nodeName,"name"===l||"data-mce-bookmark"===l)return!1}if(8==r)return!1;if(3===r&&!a.test(t.nodeValue))return!1}while(t=s.next())}return 1>=u},destroy:function(t){var n=this;n.win=n.doc=n.root=n.events=n.frag=null,t||e.removeUnload(n.destroy)},createRng:function(){var t=this.doc;return t.createRange?t.createRange():new e.dom.Range(this)},nodeIndex:function(e,t){var n,i,o,r=0;if(e)for(n=e.nodeType,e=e.previousSibling,i=e;e;e=e.previousSibling)o=e.nodeType,(!t||3!=o||o!=n&&e.nodeValue.length)&&(r++,n=o);return r},split:function(t,n,i){function o(t){function n(e){var t=e.previousSibling&&"SPAN"==e.previousSibling.nodeName,n=e.nextSibling&&"SPAN"==e.nextSibling.nodeName;return t&&n}var i,r=t.childNodes,a=t.nodeType;if(1!=a||"bookmark"!=t.getAttribute("data-mce-type")){for(i=r.length-1;i>=0;i--)o(r[i]);if(9!=a){if(3==a&&t.nodeValue.length>0){var s=e.trim(t.nodeValue).length;if(!l.isBlock(t.parentNode)||s>0||0===s&&n(t))return}else if(1==a&&(r=t.childNodes,1==r.length&&r[0]&&1==r[0].nodeType&&"bookmark"==r[0].getAttribute("data-mce-type")&&t.parentNode.insertBefore(r[0],t),r.length||/^(br|hr|input|img)$/i.test(t.nodeName)))return;l.remove(t)}return t}}var r,a,s,l=this,c=l.createRng();return t&&n?(c.setStart(t.parentNode,l.nodeIndex(t)),c.setEnd(n.parentNode,l.nodeIndex(n)),r=c.extractContents(),c=l.createRng(),c.setStart(n.parentNode,l.nodeIndex(n)+1),c.setEnd(t.parentNode,l.nodeIndex(t)+1),a=c.extractContents(),s=t.parentNode,s.insertBefore(o(r),t),i?s.replaceChild(i,n):s.insertBefore(n,t),s.insertBefore(o(a),t),l.remove(t),i||n):void 0},bind:function(e,t,n,i){return this.events.add(e,t,n,i||this)},unbind:function(e,t,n){return this.events.remove(e,t,n)},fire:function(e,t,n){return this.events.fire(e,t,n)},getContentEditable:function(e){var t;return 1!=e.nodeType?null:(t=e.getAttribute("data-mce-contenteditable"),t&&"inherit"!==t?t:"inherit"!==e.contentEditable?e.contentEditable:null)},_findSib:function(e,t,i){var o=this,r=t;if(e)for(n(r,"string")&&(r=function(e){return o.is(e,t)}),e=e[i];e;e=e[i])if(r(e))return e;return null},_isRes:function(e){return/^(top|left|bottom|right|width|height)/i.test(e)||/;\s*(top|left|bottom|right|width|height)/i.test(e)}}),e.DOM=new e.dom.DOMUtils(document,{process_html:0})}(tinymce),function(e){function t(e){function n(){return L.createDocumentFragment()}function i(e,t){k(O,e,t)}function o(e,t){k(B,e,t)}function r(e){i(e.parentNode,q(e))}function a(e){i(e.parentNode,q(e)+1)}function s(e){o(e.parentNode,q(e))}function l(e){o(e.parentNode,q(e)+1)}function c(e){e?(I[W]=I[z],I[U]=I[H]):(I[z]=I[W],I[H]=I[U]),I.collapsed=O}function u(e){r(e),l(e)}function d(e){i(e,0),o(e,1===e.nodeType?e.childNodes.length:e.nodeValue.length)}function h(e,t){var n=I[z],i=I[H],o=I[W],r=I[U],a=t.startContainer,s=t.startOffset,l=t.endContainer,c=t.endOffset;return 0===e?x(n,i,a,s):1===e?x(o,r,a,s):2===e?x(o,r,l,c):3===e?x(n,i,l,c):void 0}function p(){_(F)}function f(){return _(R)}function m(){return _(j)}function g(t){var n,i,o=this[z],r=this[H];3!==o.nodeType&&4!==o.nodeType||!o.nodeValue?(o.childNodes.length>0&&(i=o.childNodes[r]),i?o.insertBefore(t,i):o.appendChild(t)):r?r>=o.nodeValue.length?e.insertAfter(t,o):(n=o.splitText(r),o.parentNode.insertBefore(t,n)):o.parentNode.insertBefore(t,o)}function v(e){var t=I.extractContents();I.insertNode(e),e.appendChild(t),I.selectNode(e)}function b(){return $(new t(e),{startContainer:I[z],startOffset:I[H],endContainer:I[W],endOffset:I[U],collapsed:I.collapsed,commonAncestorContainer:I.commonAncestorContainer})}function y(e,t){var n;if(3==e.nodeType)return e;if(0>t)return e;for(n=e.firstChild;n&&t>0;)--t,n=n.nextSibling;return n?n:e}function w(){return I[z]==I[W]&&I[H]==I[U]}function x(t,n,i,o){var r,a,s,l,c,u;if(t==i)return n==o?0:o>n?-1:1;for(r=i;r&&r.parentNode!=t;)r=r.parentNode;if(r){for(a=0,s=t.firstChild;s!=r&&n>a;)a++,s=s.nextSibling;return a>=n?-1:1}for(r=t;r&&r.parentNode!=i;)r=r.parentNode;if(r){for(a=0,s=i.firstChild;s!=r&&o>a;)a++,s=s.nextSibling;return o>a?-1:1}for(l=e.findCommonAncestor(t,i),c=t;c&&c.parentNode!=l;)c=c.parentNode;for(c||(c=l),u=i;u&&u.parentNode!=l;)u=u.parentNode;if(u||(u=l),c==u)return 0;for(s=l.firstChild;s;){if(s==c)return-1;if(s==u)return 1;s=s.nextSibling}}function k(t,n,i){var o,r;for(t?(I[z]=n,I[H]=i):(I[W]=n,I[U]=i),o=I[W];o.parentNode;)o=o.parentNode;for(r=I[z];r.parentNode;)r=r.parentNode;r==o?x(I[z],I[H],I[W],I[U])>0&&I.collapse(t):I.collapse(t),I.collapsed=w(),I.commonAncestorContainer=e.findCommonAncestor(I[z],I[W])}function _(e){var t,n,i,o,r,a,s,l=0,c=0;if(I[z]==I[W])return C(e);for(t=I[W],n=t.parentNode;n;t=n,n=n.parentNode){if(n==I[z])return T(t,e);++l}for(t=I[z],n=t.parentNode;n;t=n,n=n.parentNode){if(n==I[W])return S(t,e);++c}for(i=c-l,o=I[z];i>0;)o=o.parentNode,i--;for(r=I[W];0>i;)r=r.parentNode,i++;for(a=o.parentNode,s=r.parentNode;a!=s;a=a.parentNode,s=s.parentNode)o=a,r=s;return E(o,r,e)}function C(e){var t,i,o,r,a,s,l,c,u;if(e!=F&&(t=n()),I[H]==I[U])return t;if(3==I[z].nodeType){if(i=I[z].nodeValue,o=i.substring(I[H],I[U]),e!=j&&(r=I[z],c=I[H],u=I[U]-I[H],0===c&&u>=r.nodeValue.length-1?r.parentNode.removeChild(r):r.deleteData(c,u),I.collapse(O)),e==F)return;return o.length>0&&t.appendChild(L.createTextNode(o)),t}for(r=y(I[z],I[H]),a=I[U]-I[H];r&&a>0;)s=r.nextSibling,l=A(r,e),t&&t.appendChild(l),--a,r=s;return e!=j&&I.collapse(O),t}function T(e,t){var i,o,r,a,s,l;if(t!=F&&(i=n()),o=D(e,t),i&&i.appendChild(o),r=q(e),a=r-I[H],0>=a)return t!=j&&(I.setEndBefore(e),I.collapse(B)),i;for(o=e.previousSibling;a>0;)s=o.previousSibling,l=A(o,t),i&&i.insertBefore(l,i.firstChild),--a,o=s;return t!=j&&(I.setEndBefore(e),I.collapse(B)),i}function S(e,t){var i,o,r,a,s,l;for(t!=F&&(i=n()),r=M(e,t),i&&i.appendChild(r),o=q(e),++o,a=I[U]-o,r=e.nextSibling;r&&a>0;)s=r.nextSibling,l=A(r,t),i&&i.appendChild(l),--a,r=s;return t!=j&&(I.setStartAfter(e),I.collapse(O)),i}function E(e,t,i){var o,r,a,s,l,c,u,d;for(i!=F&&(r=n()),o=M(e,i),r&&r.appendChild(o),a=e.parentNode,s=q(e),l=q(t),++s,c=l-s,u=e.nextSibling;c>0;)d=u.nextSibling,o=A(u,i),r&&r.appendChild(o),u=d,--c;return o=D(t,i),r&&r.appendChild(o),i!=j&&(I.setStartAfter(e),I.collapse(O)),r}function D(e,t){var n,i,o,r,a,s=y(I[W],I[U]-1),l=s!=I[W];if(s==e)return N(s,l,B,t);for(n=s.parentNode,i=N(n,B,B,t);n;){for(;s;)o=s.previousSibling,r=N(s,l,B,t),t!=F&&i.insertBefore(r,i.firstChild),l=O,s=o;if(n==e)return i;s=n.previousSibling,n=n.parentNode,a=N(n,B,B,t),t!=F&&a.appendChild(i),i=a}}function M(e,t){var n,i,o,r,a,s=y(I[z],I[H]),l=s!=I[z];if(s==e)return N(s,l,O,t);for(n=s.parentNode,i=N(n,B,O,t);n;){for(;s;)o=s.nextSibling,r=N(s,l,O,t),t!=F&&i.appendChild(r),l=O,s=o;if(n==e)return i;s=n.nextSibling,n=n.parentNode,a=N(n,B,O,t),t!=F&&a.appendChild(i),i=a}}function N(t,n,i,o){var r,a,s,l,c;if(n)return A(t,o);if(3==t.nodeType){if(r=t.nodeValue,i?(l=I[H],a=r.substring(l),s=r.substring(0,l)):(l=I[U],a=r.substring(0,l),s=r.substring(l)),o!=j&&(t.nodeValue=s),o==F)return;return c=e.clone(t,B),c.nodeValue=a,c}if(o!=F)return e.clone(t,B)}function A(t,n){return n!=F?n==j?e.clone(t,O):t:(t.parentNode.removeChild(t),void 0)}function P(){return e.create("body",null,m()).outerText}var I=this,L=e.doc,R=0,j=1,F=2,O=!0,B=!1,H="startOffset",z="startContainer",W="endContainer",U="endOffset",$=tinymce.extend,q=e.nodeIndex;return $(I,{startContainer:L,startOffset:0,endContainer:L,endOffset:0,collapsed:O,commonAncestorContainer:L,START_TO_START:0,START_TO_END:1,END_TO_END:2,END_TO_START:3,setStart:i,setEnd:o,setStartBefore:r,setStartAfter:a,setEndBefore:s,setEndAfter:l,collapse:c,selectNode:u,selectNodeContents:d,compareBoundaryPoints:h,deleteContents:p,extractContents:f,cloneContents:m,insertNode:g,surroundContents:v,cloneRange:b,toStringIE:P}),I}e.Range=t,t.prototype.toString=function(){return this.toStringIE()}}(tinymce.dom),function(){function e(e){function t(t,n){var i,o,r,a,s,l,c,u,d=0,h=-1;if(i=t.duplicate(),i.collapse(n),u=i.parentElement(),u.ownerDocument===e.dom.doc){for(;"false"===u.contentEditable;)u=u.parentNode;if(!u.hasChildNodes())return{node:u,inside:1};for(a=u.children,o=a.length-1;o>=d;)if(c=Math.floor((d+o)/2),s=a[c],i.moveToElementText(s),h=i.compareEndPoints(n?"StartToStart":"EndToEnd",t),h>0)o=c-1;else{if(!(0>h))return{node:s};d=c+1}if(0>h)for(s?i.collapse(!1):(i.moveToElementText(u),i.collapse(!0),s=u,r=!0),l=0;0!==i.compareEndPoints(n?"StartToStart":"StartToEnd",t)&&0!==i.move("character",1)&&u==i.parentElement();)l++;else for(i.collapse(!0),l=0;0!==i.compareEndPoints(n?"StartToStart":"StartToEnd",t)&&0!==i.move("character",-1)&&u==i.parentElement();)l++;return{node:s,position:h,offset:l,inside:r}}}function n(){function n(e){var n,i,o,r,a,s=t(u,e),l=0;if(n=s.node,i=s.offset,s.inside&&!n.hasChildNodes())return d[e?"setStart":"setEnd"](n,0),void 0;if(i===r)return d[e?"setStartBefore":"setEndAfter"](n),void 0;if(0>s.position){if(o=s.inside?n.firstChild:n.nextSibling,!o)return d[e?"setStartAfter":"setEndAfter"](n),void 0;if(!i)return 3==o.nodeType?d[e?"setStart":"setEnd"](o,0):d[e?"setStartBefore":"setEndBefore"](o),void 0;for(;o;){if(a=o.nodeValue,l+=a.length,l>=i){n=o,l-=i,l=a.length-l;break}o=o.nextSibling}}else{if(o=n.previousSibling,!o)return d[e?"setStartBefore":"setEndBefore"](n);if(!i)return 3==n.nodeType?d[e?"setStart":"setEnd"](o,n.nodeValue.length):d[e?"setStartAfter":"setEndAfter"](o),void 0;for(;o;){if(l+=o.nodeValue.length,l>=i){n=o,l-=i;break}o=o.previousSibling}}d[e?"setStart":"setEnd"](n,l)}var r,a,s,l,c,u=e.getRng(),d=o.createRng();if(r=u.item?u.item(0):u.parentElement(),r.ownerDocument!=o.doc)return d;if(a=e.isCollapsed(),u.item)return d.setStart(r.parentNode,o.nodeIndex(r)),d.setEnd(d.startContainer,d.startOffset+1),d;try{n(!0),a||n()}catch(h){if(-2147024809!=h.number)throw h;c=i.getBookmark(2),s=u.duplicate(),s.collapse(!0),r=s.parentElement(),a||(s=u.duplicate(),s.collapse(!1),l=s.parentElement(),l.innerHTML=l.innerHTML),r.innerHTML=r.innerHTML,i.moveToBookmark(c),u=e.getRng(),n(!0),a||n()}return d}var i=this,o=e.dom,r=!1;this.getBookmark=function(n){function i(e){var t,n,i,r,a=[];for(t=e.parentNode,n=o.getRoot().parentNode;t!=n&&9!==t.nodeType;){for(i=t.children,r=i.length;r--;)if(e===i[r]){a.push(r);break}e=t,t=t.parentNode}return a}function r(e){var n;return n=t(a,e),n?{position:n.position,offset:n.offset,indexes:i(n.node),inside:n.inside}:void 0}var a=e.getRng(),s={};return 2===n&&(a.item?s.start={ctrl:!0,indexes:i(a.item(0))}:(s.start=r(!0),e.isCollapsed()||(s.end=r()))),s},this.moveToBookmark=function(e){function t(e){var t,n,i,r;for(t=o.getRoot(),n=e.length-1;n>=0;n--)r=t.children,i=e[n],r.length-1>=i&&(t=r[i]);return t}function n(n){var o,a,s,l=e[n?"start":"end"];l&&(o=l.position>0,a=r.createTextRange(),a.moveToElementText(t(l.indexes)),offset=l.offset,offset!==s?(a.collapse(l.inside||o),a.moveStart("character",o?-offset:offset)):a.collapse(n),i.setEndPoint(n?"StartToStart":"EndToStart",a),n&&i.collapse(!0))}var i,r=o.doc.body;e.start&&(e.start.ctrl?(i=r.createControlRange(),i.addElement(t(e.start.indexes)),i.select()):(i=r.createTextRange(),n(!0),n(),i.select()))},this.addRange=function(t){function n(e){var t,n,a,d,h;a=o.create("a"),t=e?s:c,n=e?l:u,d=i.duplicate(),(t==f||t==f.documentElement)&&(t=m,n=0),3==t.nodeType?(t.parentNode.insertBefore(a,t),d.moveToElementText(a),d.moveStart("character",n),o.remove(a),i.setEndPoint(e?"StartToStart":"EndToEnd",d)):(h=t.childNodes,h.length?(n>=h.length?o.insertAfter(a,h[h.length-1]):t.insertBefore(a,h[n]),d.moveToElementText(a)):t.canHaveHTML&&(t.innerHTML="<span>﻿</span>",a=t.firstChild,d.moveToElementText(a),d.collapse(r)),i.setEndPoint(e?"StartToStart":"EndToEnd",d),o.remove(a))}var i,a,s,l,c,u,d,h,p,f=e.dom.doc,m=f.body;if(s=t.startContainer,l=t.startOffset,c=t.endContainer,u=t.endOffset,i=m.createTextRange(),s==c&&1==s.nodeType){if(l==u&&!s.hasChildNodes()){if(s.canHaveHTML)return d=s.previousSibling,d&&!d.hasChildNodes()&&o.isBlock(d)?d.innerHTML="﻿":d=null,s.innerHTML="<span>﻿</span><span>﻿</span>",i.moveToElementText(s.lastChild),i.select(),o.doc.selection.clear(),s.innerHTML="",d&&(d.innerHTML=""),void 0;l=o.nodeIndex(s),s=s.parentNode}if(l==u-1)try{if(p=s.childNodes[l],a=m.createControlRange(),a.addElement(p),a.select(),h=e.getRng(),h.item&&p===h.item(0))return}catch(g){}}n(!0),n(),i.select()},this.getRangeAt=n}tinymce.dom.TridentSelection=e}(),function(e){e.dom.Element=function(t,n){var i,o,r=this;r.settings=n=n||{},r.id=t,r.dom=i=n.dom||e.DOM,e.isIE||(o=i.get(r.id)),e.each("getPos,getRect,getParent,add,setStyle,getStyle,setStyles,setAttrib,setAttribs,getAttrib,addClass,removeClass,hasClass,getOuterHTML,setOuterHTML,remove,show,hide,isHidden,setHTML,get".split(/,/),function(e){r[e]=function(){var n,o=[t];for(n=0;arguments.length>n;n++)o.push(arguments[n]);return o=i[e].apply(i,o),r.update(e),o}}),e.extend(r,{on:function(t,n,i){return e.dom.Event.add(r.id,t,n,i)},getXY:function(){return{x:parseInt(r.getStyle("left")),y:parseInt(r.getStyle("top"))}},getSize:function(){var e=i.get(r.id);return{w:parseInt(r.getStyle("width")||e.clientWidth),h:parseInt(r.getStyle("height")||e.clientHeight)}},moveTo:function(e,t){r.setStyles({left:e,top:t})},moveBy:function(e,t){var n=r.getXY();r.moveTo(n.x+e,n.y+t)},resizeTo:function(e,t){r.setStyles({width:e,height:t})},resizeBy:function(e,t){var n=r.getSize();r.resizeTo(n.w+e,n.h+t)},update:function(t){var o;if(e.isIE6&&n.blocker){if(t=t||"",0===t.indexOf("get")||0===t.indexOf("has")||0===t.indexOf("is"))return;if("remove"==t)return i.remove(r.blocker),void 0;r.blocker?o=i.get(r.blocker):(r.blocker=i.uniqueId(),o=i.add(n.container||i.getRoot(),"iframe",{id:r.blocker,style:"position:absolute;",frameBorder:0,src:'javascript:""'}),i.setStyle(o,"opacity",0)),i.setStyles(o,{left:r.getStyle("left",1),top:r.getStyle("top",1),width:r.getStyle("width",1),height:r.getStyle("height",1),display:r.getStyle("display",1),zIndex:parseInt(r.getStyle("zIndex",1)||0)-1})}}})}}(tinymce),function(e){var t=e.is,n=e.isIE,i=e.each,o=e.dom.TreeWalker;e.create("tinymce.dom.Selection",{Selection:function(t,n,o,r){var a=this;a.dom=t,a.win=n,a.serializer=o,a.editor=r,i(["onBeforeSetContent","onBeforeGetContent","onSetContent","onGetContent"],function(t){a[t]=new e.util.Dispatcher(a)}),a.win.getSelection||(a.tridentSel=new e.dom.TridentSelection(a)),e.isIE&&t.boxModel&&this._fixIESelection(),e.addUnload(a.destroy,a)},setCursorLocation:function(e,t){var n=this,i=n.dom.createRng();i.setStart(e,t),i.setEnd(e,t),n.setRng(i),n.collapse(!1)},getContent:function(e){var n,i,o,r=this,a=r.getRng(),s=r.dom.create("body"),l=r.getSel();return e=e||{},n=i="",e.get=!0,e.format=e.format||"html",e.forced_root_block="",r.onBeforeGetContent.dispatch(r,e),"text"==e.format?r.isCollapsed()?"":a.text||(l.toString?""+l:""):(a.cloneContents?(o=a.cloneContents(),o&&s.appendChild(o)):t(a.item)||t(a.htmlText)?(s.innerHTML="<br>"+(a.item?a.item(0).outerHTML:a.htmlText),s.removeChild(s.firstChild)):s.innerHTML=""+a,/^\s/.test(s.innerHTML)&&(n=" "),/\s+$/.test(s.innerHTML)&&(i=" "),e.getInner=!0,e.content=r.isCollapsed()?"":n+r.serializer.serialize(s,e)+i,r.onGetContent.dispatch(r,e),e.content)},setContent:function(e,t){var n,i,o,r=this,a=r.getRng(),s=r.win.document;if(t=t||{format:"html"},t.set=!0,e=t.content=e,t.no_events||r.onBeforeSetContent.dispatch(r,t),e=t.content,a.insertNode){e+='<span id="__caret">_</span>',a.startContainer==s&&a.endContainer==s?s.body.innerHTML=e:(a.deleteContents(),0===s.body.childNodes.length?s.body.innerHTML=e:a.createContextualFragment?a.insertNode(a.createContextualFragment(e)):(i=s.createDocumentFragment(),o=s.createElement("div"),i.appendChild(o),o.outerHTML=e,a.insertNode(i))),n=r.dom.get("__caret"),a=s.createRange(),a.setStartBefore(n),a.setEndBefore(n),r.setRng(a),r.dom.remove("__caret");try{r.setRng(a)}catch(l){}}else a.item&&(s.execCommand("Delete",!1,null),a=r.getRng()),/^\s+/.test(e)?(a.pasteHTML('<span id="__mce_tmp">_</span>'+e),r.dom.remove("__mce_tmp")):a.pasteHTML(e);t.no_events||r.onSetContent.dispatch(r,t)},getStart:function(){var e,t,n,i,o=this,r=o.getRng();if(r.duplicate||r.item){if(r.item)return r.item(0);for(n=r.duplicate(),n.collapse(1),e=n.parentElement(),e.ownerDocument!==o.dom.doc&&(e=o.dom.getRoot()),t=i=r.parentElement();i=i.parentNode;)if(i==e){e=t;break}return e}return e=r.startContainer,1==e.nodeType&&e.hasChildNodes()&&(e=e.childNodes[Math.min(e.childNodes.length-1,r.startOffset)]),e&&3==e.nodeType?e.parentNode:e},getEnd:function(){var e,t,n=this,i=n.getRng();return i.duplicate||i.item?i.item?i.item(0):(i=i.duplicate(),i.collapse(0),e=i.parentElement(),e.ownerDocument!==n.dom.doc&&(e=n.dom.getRoot()),e&&"BODY"==e.nodeName?e.lastChild||e:e):(e=i.endContainer,t=i.endOffset,1==e.nodeType&&e.hasChildNodes()&&(e=e.childNodes[t>0?t-1:t]),e&&3==e.nodeType?e.parentNode:e)},getBookmark:function(e,t){function n(e,t){var n=0;return i(f.select(e),function(e,i){e==t&&(n=i)}),n}function o(e){function t(t){var n,i,o,r=t?"start":"end";n=e[r+"Container"],i=e[r+"Offset"],1==n.nodeType&&"TR"==n.nodeName&&(o=n.childNodes,n=o[Math.min(t?i:i-1,o.length-1)],n&&(i=t?0:n.childNodes.length,e["set"+(t?"Start":"End")](n,i)))}return t(!0),t(),e}function r(){function e(e,n){var o,r,a=e[n?"startContainer":"endContainer"],s=e[n?"startOffset":"endOffset"],l=[],c=0;if(3==a.nodeType){if(t)for(o=a.previousSibling;o&&3==o.nodeType;o=o.previousSibling)s+=o.nodeValue.length;l.push(s)}else r=a.childNodes,s>=r.length&&r.length&&(c=1,s=Math.max(0,r.length-1)),l.push(p.dom.nodeIndex(r[s],t)+c);for(;a&&a!=i;a=a.parentNode)l.push(p.dom.nodeIndex(a,t));return l}var n=p.getRng(!0),i=f.getRoot(),o={};return o.start=e(n,!0),p.isCollapsed()||(o.end=e(n)),o}var a,s,l,c,u,d,h,p=this,f=p.dom,m="﻿";if(2==e)return p.tridentSel?p.tridentSel.getBookmark(e):r();if(e)return{rng:p.getRng()};if(a=p.getRng(),l=f.uniqueId(),c=tinyMCE.activeEditor.selection.isCollapsed(),h="overflow:hidden;line-height:0px",a.duplicate||a.item){if(a.item)return d=a.item(0),u=d.nodeName,{name:u,index:n(u,d)};s=a.duplicate();try{a.collapse(),a.pasteHTML('<span data-mce-type="bookmark" id="'+l+'_start" style="'+h+'">'+m+"</span>"),c||(s.collapse(!1),a.moveToElementText(s.parentElement()),0===a.compareEndPoints("StartToEnd",s)&&s.move("character",-1),s.pasteHTML('<span data-mce-type="bookmark" id="'+l+'_end" style="'+h+'">'+m+"</span>"))}catch(g){return null}}else{if(d=p.getNode(),u=d.nodeName,"IMG"==u)return{name:u,index:n(u,d)};s=o(a.cloneRange()),c||(s.collapse(!1),s.insertNode(f.create("span",{"data-mce-type":"bookmark",id:l+"_end",style:h},m))),a=o(a),a.collapse(!0),a.insertNode(f.create("span",{"data-mce-type":"bookmark",id:l+"_start",style:h},m))}return p.moveToBookmark({id:l,keep:1}),{id:l}},moveToBookmark:function(t){function o(e){var n,i,o,r,a=t[e?"start":"end"];if(a){for(o=a[0],i=l,n=a.length-1;n>=1;n--){if(r=i.childNodes,a[n]>r.length-1)return;i=r[a[n]]}3===i.nodeType&&(o=Math.min(a[0],i.nodeValue.length)),1===i.nodeType&&(o=Math.min(a[0],i.childNodes.length)),e?s.setStart(i,o):s.setEnd(i,o)}return!0}function r(n){var o,r,a,s,l=f.get(t.id+"_"+n),p=t.keep;if(l&&(o=l.parentNode,"start"==n?(p?(o=l.firstChild,r=1):r=f.nodeIndex(l),c=u=o,d=h=r):(p?(o=l.firstChild,r=1):r=f.nodeIndex(l),u=o,h=r),!p)){for(s=l.previousSibling,a=l.nextSibling,i(e.grep(l.childNodes),function(e){3==e.nodeType&&(e.nodeValue=e.nodeValue.replace(/\uFEFF/g,""))});l=f.get(t.id+"_"+n);)f.remove(l,1);s&&a&&s.nodeType==a.nodeType&&3==s.nodeType&&!e.isOpera&&(r=s.nodeValue.length,s.appendData(a.nodeValue),f.remove(a),"start"==n?(c=u=s,d=h=r):(u=s,h=r))}}function a(e){return!f.isBlock(e)||e.innerHTML||n||(e.innerHTML='<br data-mce-bogus="1" />'),e}var s,l,c,u,d,h,p=this,f=p.dom;if(t)if(t.start){if(s=f.createRng(),l=f.getRoot(),p.tridentSel)return p.tridentSel.moveToBookmark(t);o(!0)&&o()&&p.setRng(s)
}else t.id?(r("start"),r("end"),c&&(s=f.createRng(),s.setStart(a(c),d),s.setEnd(a(u),h),p.setRng(s))):t.name?p.select(f.select(t.name)[t.index]):t.rng&&p.setRng(t.rng)},select:function(t,n){function i(t,n){var i=new o(t,t);do{if(3==t.nodeType&&0!==e.trim(t.nodeValue).length)return n?l.setStart(t,0):l.setEnd(t,t.nodeValue.length),void 0;if("BR"==t.nodeName)return n?l.setStartBefore(t):l.setEndBefore(t),void 0}while(t=n?i.next():i.prev())}var r,a=this,s=a.dom,l=s.createRng();return t&&(r=s.nodeIndex(t),l.setStart(t.parentNode,r),l.setEnd(t.parentNode,r+1),n&&(i(t,1),i(t)),a.setRng(l)),t},isCollapsed:function(){var e=this,t=e.getRng(),n=e.getSel();return!t||t.item?!1:t.compareEndPoints?0===t.compareEndPoints("StartToEnd",t):!n||t.collapsed},collapse:function(e){var t,n=this,i=n.getRng();i.item&&(t=i.item(0),i=n.win.document.body.createTextRange(),i.moveToElementText(t)),i.collapse(!!e),n.setRng(i)},getSel:function(){var e=this.win;return e.getSelection?e.getSelection():e.document.selection},getRng:function(t){var n,i,o,r=this,a=r.win.document;if(t&&r.tridentSel)return r.tridentSel.getRangeAt(0);try{(n=r.getSel())&&(i=n.rangeCount>0?n.getRangeAt(0):n.createRange?n.createRange():a.createRange())}catch(s){}return e.isIE&&i&&i.setStart&&a.selection.createRange().item&&(o=a.selection.createRange().item(0),i=a.createRange(),i.setStartBefore(o),i.setEndAfter(o)),i||(i=a.createRange?a.createRange():a.body.createTextRange()),!e.isIE&&i.setStart&&9===i.startContainer.nodeType&&i.collapsed&&(o=r.dom.getRoot(),i.setStart(o,0),i.setEnd(o,0)),r.selectedRange&&r.explicitRange&&(0===i.compareBoundaryPoints(i.START_TO_START,r.selectedRange)&&0===i.compareBoundaryPoints(i.END_TO_END,r.selectedRange)?i=r.explicitRange:(r.selectedRange=null,r.explicitRange=null)),i},setRng:function(e,t){var n,i=this;if(i.tridentSel){if(e.cloneRange)try{return i.tridentSel.addRange(e),void 0}catch(o){}try{e.select()}catch(o){}}else if(n=i.getSel()){i.explicitRange=e;try{n.removeAllRanges()}catch(o){}n.addRange(e),t===!1&&n.extend&&(n.collapse(e.endContainer,e.endOffset),n.extend(e.startContainer,e.startOffset)),i.selectedRange=n.rangeCount>0?n.getRangeAt(0):null}},setNode:function(e){var t=this;return t.setContent(t.dom.getOuterHTML(e)),e},getNode:function(){function e(e,t){for(var n=e;e&&3===e.nodeType&&0===e.length;)e=t?e.nextSibling:e.previousSibling;return e||n}var t,n=this,i=n.getRng(),o=(n.getSel(),i.startContainer),r=i.endContainer;return i?i.setStart?(t=i.commonAncestorContainer,!i.collapsed&&(i.startContainer==i.endContainer&&2>i.endOffset-i.startOffset&&i.startContainer.hasChildNodes()&&(t=i.startContainer.childNodes[i.startOffset]),3===o.nodeType&&3===r.nodeType&&(o=o.length===i.startOffset?e(o.nextSibling,!0):o.parentNode,r=0===i.endOffset?e(r.previousSibling,!1):r.parentNode,o&&o===r))?o:t&&3==t.nodeType?t.parentNode:t):i.item?i.item(0):i.parentElement():n.dom.getRoot()},getSelectedBlocks:function(e,t){var n,i,r,a=this,s=a.dom,l=[];if(n=s.getParent(e||a.getStart(),s.isBlock),i=s.getParent(t||a.getEnd(),s.isBlock),n&&l.push(n),n&&i&&n!=i){r=n;for(var c=new o(n,s.getRoot());(r=c.next())&&r!=i;)s.isBlock(r)&&l.push(r)}return i&&n!=i&&l.push(i),l},isForward:function(){var e,t,n=this.dom,i=this.getSel();return i&&null!=i.anchorNode&&null!=i.focusNode?(e=n.createRng(),e.setStart(i.anchorNode,i.anchorOffset),e.collapse(!0),t=n.createRng(),t.setStart(i.focusNode,i.focusOffset),t.collapse(!0),0>=e.compareBoundaryPoints(e.START_TO_START,t)):!0},normalize:function(){function t(e){function t(e,t){for(var n=new o(e,f.getParent(e.parentNode,f.isBlock)||m);e=n[t?"prev":"next"]();)if("BR"===e.nodeName)return!0}function s(e,t){var n,a;for(t=t||l,n=new o(t,f.getParent(t.parentNode,f.isBlock)||m);d=n[e?"prev":"next"]();){if(3===d.nodeType&&d.nodeValue.length>0)return l=d,c=e?d.nodeValue.length:0,i=!0,void 0;if(f.isBlock(d)||h[d.nodeName.toLowerCase()])return;a=d}r&&a&&(l=a,i=!0,c=0)}var l,c,u,d,h,p,f=a.dom,m=f.getRoot();if(l=n[(e?"start":"end")+"Container"],c=n[(e?"start":"end")+"Offset"],h=f.schema.getNonEmptyElements(),9===l.nodeType&&(l=f.getRoot(),c=0),l===m){if(e&&(d=l.childNodes[c>0?c-1:0],d&&(p=d.nodeName.toLowerCase(),h[d.nodeName]||"TABLE"==d.nodeName)))return;if(l.hasChildNodes()&&(l=l.childNodes[Math.min(!e&&c>0?c-1:c,l.childNodes.length-1)],c=0,l.hasChildNodes()&&!/TABLE/.test(l.nodeName))){d=l,u=new o(l,m);do{if(3===d.nodeType&&d.nodeValue.length>0){c=e?0:d.nodeValue.length,l=d,i=!0;break}if(h[d.nodeName.toLowerCase()]){c=f.nodeIndex(d),l=d.parentNode,"IMG"!=d.nodeName||e||c++,i=!0;break}}while(d=e?u.next():u.prev())}}r&&(3===l.nodeType&&0===c&&s(!0),1===l.nodeType&&(d=l.childNodes[c],!d||"BR"!==d.nodeName||t(d)||t(d,!0)||s(!0,l.childNodes[c]))),e&&!r&&3===l.nodeType&&c===l.nodeValue.length&&s(!1),i&&n["set"+(e?"Start":"End")](l,c)}var n,i,r,a=this;e.isIE||(n=a.getRng(),r=n.collapsed,t(!0),r||t(),i&&(r&&n.collapse(!0),a.setRng(n,a.isForward())))},selectorChanged:function(e,t){var n,o=this;return o.selectorChangedData||(o.selectorChangedData={},n={},o.editor.onNodeChange.addToTop(function(e,t,r){var a=o.dom,s=a.getParents(r,null,a.getRoot()),l={};i(o.selectorChangedData,function(e,t){i(s,function(o){return a.is(o,t)?(n[t]||(i(e,function(e){e(!0,{node:o,selector:t,parents:s})}),n[t]=e),l[t]=e,!1):void 0})}),i(n,function(e,t){l[t]||(delete n[t],i(e,function(e){e(!1,{node:r,selector:t,parents:s})}))})})),o.selectorChangedData[e]||(o.selectorChangedData[e]=[]),o.selectorChangedData[e].push(t),o},destroy:function(t){var n=this;n.win=null,t||e.removeUnload(n.destroy)},_fixIESelection:function(){function e(e,t){var n=l.createTextRange();try{n.moveToPoint(e,t)}catch(i){n=null}return n}function t(t){var i;t.button?(i=e(t.x,t.y),i&&(i.compareEndPoints("StartToStart",o)>0?i.setEndPoint("StartToStart",o):i.setEndPoint("EndToEnd",o),i.select())):n()}function n(){var e=s.selection.createRange();o&&!e.item&&0===e.compareEndPoints("StartToEnd",e)&&o.select(),a.unbind(s,"mouseup",n),a.unbind(s,"mousemove",t),o=i=0}var i,o,r,a=this.dom,s=a.doc,l=s.body;s.documentElement.unselectable=!0,a.bind(s,["mousedown","contextmenu"],function(l){if("HTML"===l.target.nodeName){if(i&&n(),r=s.documentElement,r.scrollHeight>r.clientHeight)return;i=1,o=e(l.x,l.y),o&&(a.bind(s,"mouseup",n),a.bind(s,"mousemove",t),a.win.focus(),o.select())}})}})}(tinymce),function(e){e.dom.Serializer=function(t,n,i){var o,r,a,s=e.isIE,l=e.each;return t.apply_source_formatting||(t.indent=!1),n=n||e.DOM,i=i||new e.html.Schema(t),t.entity_encoding=t.entity_encoding||"named",t.remove_trailing_brs="remove_trailing_brs"in t?t.remove_trailing_brs:!0,o=new e.util.Dispatcher(self),r=new e.util.Dispatcher(self),a=new e.html.DomParser(t,i),a.addAttributeFilter("src,href,style",function(e,i){for(var o,r,a,s=e.length,l="data-mce-"+i,c=t.url_converter,u=t.url_converter_scope;s--;)o=e[s],r=o.attributes.map[l],r!==a?(o.attr(i,r.length>0?r:null),o.attr(l,null)):(r=o.attributes.map[i],"style"===i?r=n.serializeStyle(n.parseStyle(r),o.name):c&&(r=c.call(u,r,i,o.name)),o.attr(i,r.length>0?r:null))}),a.addAttributeFilter("class",function(e){for(var t,n,i=e.length;i--;)t=e[i],n=t.attr("class").replace(/(?:^|\s)mce(Item\w+|Selected)(?!\S)/g,""),t.attr("class",n.length>0?n:null)}),a.addAttributeFilter("data-mce-type",function(e,t,n){for(var i,o=e.length;o--;)i=e[o],"bookmark"!==i.attributes.map["data-mce-type"]||n.cleanup||i.remove()}),a.addAttributeFilter("data-mce-expando",function(e,t){for(var n=e.length;n--;)e[n].attr(t,null)}),a.addNodeFilter("noscript",function(t){for(var n,i=t.length;i--;)n=t[i].firstChild,n&&(n.value=e.html.Entities.decode(n.value))}),a.addNodeFilter("script,style",function(e,t){function n(e){return e.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")}for(var i,o,r=e.length;r--;)i=e[r],o=i.firstChild?i.firstChild.value:"","script"===t?(i.attr("type",(i.attr("type")||"text/javascript").replace(/^mce\-/,"")),o.length>0&&(i.firstChild.value="// <![CDATA[\n"+n(o)+"\n// ]]>")):o.length>0&&(i.firstChild.value="<!--\n"+n(o)+"\n-->")}),a.addNodeFilter("#comment",function(e){for(var t,n=e.length;n--;)t=e[n],0===t.value.indexOf("[CDATA[")?(t.name="#cdata",t.type=4,t.value=t.value.replace(/^\[CDATA\[|\]\]$/g,"")):0===t.value.indexOf("mce:protected ")&&(t.name="#text",t.type=3,t.raw=!0,t.value=unescape(t.value).substr(14))}),a.addNodeFilter("xml:namespace,input",function(e,t){for(var n,i=e.length;i--;)n=e[i],7===n.type?n.remove():1===n.type&&("input"!==t||"type"in n.attributes.map||n.attr("type","text"))}),t.fix_list_elements&&a.addNodeFilter("ul,ol",function(e){for(var t,n,i=e.length;i--;)t=e[i],n=t.parent,("ul"===n.name||"ol"===n.name)&&t.prev&&"li"===t.prev.name&&t.prev.append(t)}),a.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style",function(e,t){for(var n=e.length;n--;)e[n].attr(t,null)}),{schema:i,addNodeFilter:a.addNodeFilter,addAttributeFilter:a.addAttributeFilter,onPreProcess:o,onPostProcess:r,serialize:function(c,u){var d,h,p,f,m;return s&&n.select("script,style,select,map").length>0?(m=c.innerHTML,c=c.cloneNode(!1),n.setHTML(c,m)):c=c.cloneNode(!0),d=c.ownerDocument.implementation,d.createHTMLDocument&&(h=d.createHTMLDocument(""),l("BODY"==c.nodeName?c.childNodes:[c],function(e){h.body.appendChild(h.importNode(e,!0))}),c="BODY"!=c.nodeName?h.body.firstChild:h.body,p=n.doc,n.doc=h),u=u||{},u.format=u.format||"html",u.no_events||(u.node=c,o.dispatch(self,u)),f=new e.html.Serializer(t,i),u.content=f.serialize(a.parse(e.trim(u.getInner?c.innerHTML:n.getOuterHTML(c)),u)),u.cleanup||(u.content=u.content.replace(/\uFEFF/g,"")),u.no_events||r.dispatch(self,u),p&&(n.doc=p),u.node=null,u.content},addRules:function(e){i.addValidElements(e)},setRules:function(e){i.setValidElements(e)}}}}(tinymce),function(e){e.dom.ScriptLoader=function(){function t(t,n){function i(){c.remove(l),r&&(r.onreadystatechange=r.onload=r=null),n()}function o(){"undefined"!=typeof console&&console.log&&console.log("Failed to load: "+t)}var r,a,s,l,c=e.DOM;return l=c.uniqueId(),e.isIE6&&(a=new e.util.URI(t),s=location,a.host==s.hostname&&a.port==s.port&&a.protocol+":"==s.protocol&&"file"!=a.protocol.toLowerCase())?(e.util.XHR.send({url:e._addVer(a.getURI()),success:function(e){var t=c.create("script",{type:"text/javascript"});t.text=e,document.getElementsByTagName("head")[0].appendChild(t),c.remove(t),i()},error:o}),void 0):(r=document.createElement("script"),r.id=l,r.type="text/javascript",r.src=e._addVer(t),e.isIE||(r.onload=i),r.onerror=o,e.isOpera||(r.onreadystatechange=function(){var e=r.readyState;("complete"==e||"loaded"==e)&&i()}),(document.getElementsByTagName("head")[0]||document.body).appendChild(r),void 0)}var n,i=0,o=1,r=2,a={},s=[],l={},c=[],u=0;this.isDone=function(e){return a[e]==r},this.markDone=function(e){a[e]=r},this.add=this.load=function(e,t,o){var r=a[e];r==n&&(s.push(e),a[e]=i),t&&(l[e]||(l[e]=[]),l[e].push({func:t,scope:o||this}))},this.loadQueue=function(e,t){this.loadScripts(s,e,t)},this.loadScripts=function(i,s,d){function h(t){e.each(l[t],function(e){e.func.call(e.scope)}),l[t]=n}var p;c.push({func:s,scope:d||this,executing:!1}),p=function(){var n=e.grep(i);i.length=0,e.each(n,function(e){return a[e]==r?(h(e),void 0):(a[e]!=o&&(a[e]=o,u++,t(e,function(){a[e]=r,u--,h(e),p()})),void 0)}),u||(e.each(c,function(e){e.executing||(e.executing=!0,e.func.call(e.scope))}),c.length=0)},p()}},e.ScriptLoader=new e.dom.ScriptLoader}(tinymce),function(e){e.dom.RangeUtils=function(t){this.walk=function(n,i){function o(e){var t;return t=e[0],3===t.nodeType&&t===m&&g>=t.nodeValue.length&&e.splice(0,1),t=e[e.length-1],0===b&&e.length>0&&t===v&&3===t.nodeType&&e.splice(e.length-1,1),e}function r(e,t,n){for(var i=[];e&&e!=n;e=e[t])i.push(e);return i}function a(e,t){do{if(e.parentNode==t)return e;e=e.parentNode}while(e)}function s(e,t,n){var a=n?"nextSibling":"previousSibling";for(d=e,h=d.parentNode;d&&d!=t;d=h)h=d.parentNode,p=r(d==e?d:d[a],a),p.length&&(n||p.reverse(),i(o(p)))}var l,c,u,d,h,p,f,m=n.startContainer,g=n.startOffset,v=n.endContainer,b=n.endOffset;if(f=t.select("td.mceSelected,th.mceSelected"),f.length>0)return e.each(f,function(e){i([e])}),void 0;if(1==m.nodeType&&m.hasChildNodes()&&(m=m.childNodes[g]),1==v.nodeType&&v.hasChildNodes()&&(v=v.childNodes[Math.min(b-1,v.childNodes.length-1)]),m==v)return i(o([m]));for(l=t.findCommonAncestor(m,v),d=m;d;d=d.parentNode){if(d===v)return s(m,l,!0);if(d===l)break}for(d=v;d;d=d.parentNode){if(d===m)return s(v,l);if(d===l)break}c=a(m,l)||m,u=a(v,l)||v,s(m,c,!0),p=r(c==m?c:c.nextSibling,"nextSibling",u==v?u.nextSibling:u),p.length&&i(o(p)),s(v,u)},this.split=function(e){function t(e,t){return e.splitText(t)}var n=e.startContainer,i=e.startOffset,o=e.endContainer,r=e.endOffset;return n==o&&3==n.nodeType?i>0&&n.nodeValue.length>i&&(o=t(n,i),n=o.previousSibling,r>i?(r-=i,n=o=t(o,r).previousSibling,r=o.nodeValue.length,i=0):r=0):(3==n.nodeType&&i>0&&n.nodeValue.length>i&&(n=t(n,i),i=0),3==o.nodeType&&r>0&&o.nodeValue.length>r&&(o=t(o,r).previousSibling,r=o.nodeValue.length)),{startContainer:n,startOffset:i,endContainer:o,endOffset:r}}},e.dom.RangeUtils.compareRanges=function(e,t){if(e&&t){if(!e.item&&!e.duplicate)return e.startContainer==t.startContainer&&e.startOffset==t.startOffset;if(e.item&&t.item&&e.item(0)===t.item(0))return!0;if(e.isEqual&&t.isEqual&&t.isEqual(e))return!0}return!1}}(tinymce),function(e){var t=e.dom.Event,n=e.each;e.create("tinymce.ui.KeyboardNavigation",{KeyboardNavigation:function(i,o){var r,a,s,l,c,u=this,d=i.root,h=i.items,p=i.enableUpDown,f=i.enableLeftRight||!i.enableUpDown,m=i.excludeFromTabOrder;o=o||e.DOM,r=function(e){c=e.target.id},a=function(e){o.setAttrib(e.target.id,"tabindex","-1")},l=function(){var e=o.get(c);o.setAttrib(e,"tabindex","0"),e.focus()},u.focus=function(){o.get(c).focus()},u.destroy=function(){n(h,function(e){var t=o.get(e.id);o.unbind(t,"focus",r),o.unbind(t,"blur",a)});var e=o.get(d);o.unbind(e,"focus",l),o.unbind(e,"keydown",s),h=o=d=u.focus=r=a=s=l=null,u.destroy=function(){}},u.moveFocus=function(e,r){var a,s=-1;u.controls,c&&(n(h,function(e,t){return e.id===c?(s=t,!1):void 0}),s+=e,0>s?s=h.length-1:s>=h.length&&(s=0),a=h[s],o.setAttrib(c,"tabindex","-1"),o.setAttrib(a.id,"tabindex","0"),o.get(a.id).focus(),i.actOnFocus&&i.onAction(a.id),r&&t.cancel(r))},s=function(e){var n=37,o=39,r=38,a=40,s=27,l=14,d=13,h=32;switch(e.keyCode){case n:f&&u.moveFocus(-1);break;case o:f&&u.moveFocus(1);break;case r:p&&u.moveFocus(-1);break;case a:p&&u.moveFocus(1);break;case s:i.onCancel&&(i.onCancel(),t.cancel(e));break;case l:case d:case h:i.onAction&&(i.onAction(c),t.cancel(e))}},n(h,function(e,t){var n,i;e.id||(e.id=o.uniqueId("_mce_item_")),i=o.get(e.id),m?(o.bind(i,"blur",a),n="-1"):n=0===t?"0":"-1",i.setAttribute("tabindex",n),o.bind(i,"focus",r)}),h[0]&&(c=h[0].id),o.setAttrib(d,"tabindex","-1");var g=o.get(d);o.bind(g,"focus",l),o.bind(g,"keydown",s)}})}(tinymce),function(e){var t=e.DOM,n=e.is;e.create("tinymce.ui.Control",{Control:function(t,n,i){this.id=t,this.settings=n=n||{},this.rendered=!1,this.onRender=new e.util.Dispatcher(this),this.classPrefix="",this.scope=n.scope||this,this.disabled=0,this.active=0,this.editor=i},setAriaProperty:function(e,n){var i=t.get(this.id+"_aria")||t.get(this.id);i&&t.setAttrib(i,"aria-"+e,!!n)},focus:function(){t.get(this.id).focus()},setDisabled:function(e){e!=this.disabled&&(this.setAriaProperty("disabled",e),this.setState("Disabled",e),this.setState("Enabled",!e),this.disabled=e)},isDisabled:function(){return this.disabled},setActive:function(e){e!=this.active&&(this.setState("Active",e),this.active=e,this.setAriaProperty("pressed",e))},isActive:function(){return this.active},setState:function(e,n){var i=t.get(this.id);e=this.classPrefix+e,n?t.addClass(i,e):t.removeClass(i,e)},isRendered:function(){return this.rendered},renderHTML:function(){},renderTo:function(e){t.setHTML(e,this.renderHTML())},postRender:function(){var e,t=this;n(t.disabled)&&(e=t.disabled,t.disabled=-1,t.setDisabled(e)),n(t.active)&&(e=t.active,t.active=-1,t.setActive(e))},remove:function(){t.remove(this.id),this.destroy()},destroy:function(){e.dom.Event.clear(this.id)}})}(tinymce),tinymce.create("tinymce.ui.Container:tinymce.ui.Control",{Container:function(e,t,n){this.parent(e,t,n),this.controls=[],this.lookup={}},add:function(e){return this.lookup[e.id]=e,this.controls.push(e),e},get:function(e){return this.lookup[e]}}),tinymce.create("tinymce.ui.Separator:tinymce.ui.Control",{Separator:function(e,t){this.parent(e,t),this.classPrefix="mceSeparator",this.setDisabled(!0)},renderHTML:function(){return tinymce.DOM.createHTML("span",{"class":this.classPrefix,role:"separator","aria-orientation":"vertical",tabindex:"-1"})}}),function(e){var t=e.is;e.DOM,e.each,e.walk,e.create("tinymce.ui.MenuItem:tinymce.ui.Control",{MenuItem:function(e,t){this.parent(e,t),this.classPrefix="mceMenuItem"},setSelected:function(e){this.setState("Selected",e),this.setAriaProperty("checked",!!e),this.selected=e},isSelected:function(){return this.selected},postRender:function(){var e=this;e.parent(),t(e.selected)&&e.setSelected(e.selected)}})}(tinymce),function(e){var t=(e.is,e.DOM),n=(e.each,e.walk);e.create("tinymce.ui.Menu:tinymce.ui.MenuItem",{Menu:function(t,n){var i=this;i.parent(t,n),i.items={},i.collapsed=!1,i.menuCount=0,i.onAddItem=new e.util.Dispatcher(this)},expand:function(e){var t=this;e&&n(t,function(e){e.expand&&e.expand()},"items",t),t.collapsed=!1},collapse:function(e){var t=this;e&&n(t,function(e){e.collapse&&e.collapse()},"items",t),t.collapsed=!0},isCollapsed:function(){return this.collapsed},add:function(n){return n.settings||(n=new e.ui.MenuItem(n.id||t.uniqueId(),n)),this.onAddItem.dispatch(this,n),this.items[n.id]=n},addSeparator:function(){return this.add({separator:!0})},addMenu:function(e){return e.collapse||(e=this.createMenu(e)),this.menuCount++,this.add(e)},hasMenus:function(){return 0!==this.menuCount},remove:function(e){delete this.items[e.id]},removeAll:function(){var e=this;n(e,function(e){e.removeAll?e.removeAll():e.remove(),e.destroy()},"items",e),e.items={}},createMenu:function(n){var i=new e.ui.Menu(n.id||t.uniqueId(),n);return i.onAddItem.add(this.onAddItem.dispatch,this.onAddItem),i}})}(tinymce),function(e){var t=e.is,n=e.DOM,i=e.each,o=e.dom.Event,r=e.dom.Element;e.create("tinymce.ui.DropMenu:tinymce.ui.Menu",{DropMenu:function(i,o){o=o||{},o.container=o.container||n.doc.body,o.offset_x=o.offset_x||0,o.offset_y=o.offset_y||0,o.vp_offset_x=o.vp_offset_x||0,o.vp_offset_y=o.vp_offset_y||0,t(o.icons)&&!o.icons&&(o["class"]+=" mceNoIcons"),this.parent(i,o),this.onShowMenu=new e.util.Dispatcher(this),this.onHideMenu=new e.util.Dispatcher(this),this.classPrefix="mceMenu"},createMenu:function(t){var i,o=this,r=o.settings;return t.container=t.container||r.container,t.parent=o,t.constrain=t.constrain||r.constrain,t["class"]=t["class"]||r["class"],t.vp_offset_x=t.vp_offset_x||r.vp_offset_x,t.vp_offset_y=t.vp_offset_y||r.vp_offset_y,t.keyboard_focus=r.keyboard_focus,i=new e.ui.DropMenu(t.id||n.uniqueId(),t),i.onAddItem.add(o.onAddItem.dispatch,o.onAddItem),i},focus:function(){var e=this;e.keyboardNav&&e.keyboardNav.focus()},update:function(){var e,t,i=this,o=i.settings,r=n.get("menu_"+i.id+"_tbl"),a=n.get("menu_"+i.id+"_co");e=o.max_width?Math.min(r.offsetWidth,o.max_width):r.offsetWidth,t=o.max_height?Math.min(r.offsetHeight,o.max_height):r.offsetHeight,n.boxModel?i.element.setStyles({width:e,height:t}):i.element.setStyles({width:e+2,height:t+2}),o.max_width&&n.setStyle(a,"width",e),o.max_height&&(n.setStyle(a,"height",t),r.clientHeight<o.max_height&&n.setStyle(a,"overflow","hidden"))},showMenu:function(t,a,s){var l,c,u,d,h,p,f=this,m=f.settings,g=n.getViewPort(),v=2,b=f.classPrefix;f.collapse(1),f.isMenuVisible||(f.rendered?l=n.get("menu_"+f.id):(l=n.add(f.settings.container,f.renderNode()),i(f.items,function(e){e.postRender()}),f.element=new r("menu_"+f.id,{blocker:1,container:m.container})),e.isOpera||n.setStyles(l,{left:-65535,top:-65535}),n.show(l),f.update(),t+=m.offset_x||0,a+=m.offset_y||0,g.w-=4,g.h-=4,m.constrain&&(c=l.clientWidth-v,u=l.clientHeight-v,d=g.x+g.w,h=g.y+g.h,t+m.vp_offset_x+c>d&&(t=s?s-c:Math.max(0,d-m.vp_offset_x-c)),a+m.vp_offset_y+u>h&&(a=Math.max(0,h-m.vp_offset_y-u))),n.setStyles(l,{left:t,top:a}),f.element.update(),f.isMenuVisible=1,f.mouseClickFunc=o.add(l,"click",function(e){var t;if(e=e.target,e&&(e=n.getParent(e,"tr"))&&!n.hasClass(e,b+"ItemSub")){if(t=f.items[e.id],t.isDisabled())return;for(p=f;p;)p.hideMenu&&p.hideMenu(),p=p.settings.parent;return t.settings.onclick&&t.settings.onclick(e),!1}}),f.hasMenus()&&(f.mouseOverFunc=o.add(l,"mouseover",function(e){var t,i;if(e=e.target,e&&(e=n.getParent(e,"tr"))){if(t=f.items[e.id],f.lastMenu&&f.lastMenu.collapse(1),t.isDisabled())return;e&&n.hasClass(e,b+"ItemSub")&&(i=n.getRect(e),t.showMenu(i.x+i.w-v,i.y-v,i.x),f.lastMenu=t,n.addClass(n.get(t.id).firstChild,b+"ItemActive"))}})),o.add(l,"keydown",f._keyHandler,f),f.onShowMenu.dispatch(f),m.keyboard_focus&&f._setupKeyboardNav())},hideMenu:function(e){var t,i=this,r=n.get("menu_"+i.id);i.isMenuVisible&&(i.keyboardNav&&i.keyboardNav.destroy(),o.remove(r,"mouseover",i.mouseOverFunc),o.remove(r,"click",i.mouseClickFunc),o.remove(r,"keydown",i._keyHandler),n.hide(r),i.isMenuVisible=0,e||i.collapse(1),i.element&&i.element.hide(),(t=n.get(i.id))&&n.removeClass(t.firstChild,i.classPrefix+"ItemActive"),i.onHideMenu.dispatch(i))},add:function(e){var t,i=this;return e=i.parent(e),i.isRendered&&(t=n.get("menu_"+i.id))&&i._add(n.select("tbody",t)[0],e),e},collapse:function(e){this.parent(e),this.hideMenu(1)},remove:function(e){return n.remove(e.id),this.destroy(),this.parent(e)},destroy:function(){var e=this,t=n.get("menu_"+e.id);e.keyboardNav&&e.keyboardNav.destroy(),o.remove(t,"mouseover",e.mouseOverFunc),o.remove(n.select("a",t),"focus",e.mouseOverFunc),o.remove(t,"click",e.mouseClickFunc),o.remove(t,"keydown",e._keyHandler),e.element&&e.element.remove(),n.remove(t)},renderNode:function(){var e,t,o,a,s=this,l=s.settings;return a=n.create("div",{role:"listbox",id:"menu_"+s.id,"class":l["class"],style:"position:absolute;left:0;top:0;z-index:200000;outline:0"}),s.settings.parent&&n.setAttrib(a,"aria-parent","menu_"+s.settings.parent.id),o=n.add(a,"div",{role:"presentation",id:"menu_"+s.id+"_co","class":s.classPrefix+(l["class"]?" "+l["class"]:"")}),s.element=new r("menu_"+s.id,{blocker:1,container:l.container}),l.menu_line&&n.add(o,"span",{"class":s.classPrefix+"Line"}),e=n.add(o,"table",{role:"presentation",id:"menu_"+s.id+"_tbl",border:0,cellPadding:0,cellSpacing:0}),t=n.add(e,"tbody"),i(s.items,function(e){s._add(t,e)}),s.rendered=!0,a},_setupKeyboardNav:function(){var t,i,o=this;t=n.get("menu_"+o.id),i=n.select("a[role=option]","menu_"+o.id),i.splice(0,0,t),o.keyboardNav=new e.ui.KeyboardNavigation({root:"menu_"+o.id,items:i,onCancel:function(){o.hideMenu()},enableUpDown:!0}),t.focus()},_keyHandler:function(t){var n=this;switch(t.keyCode){case 37:n.settings.parent&&(n.hideMenu(),n.settings.parent.focus(),o.cancel(t));break;case 39:n.mouseOverFunc&&n.mouseOverFunc(t);break;case 38:case 40:return e.dom.Event.cancel(t),void 0}},_add:function(e,t){var i,o,r,a,s,l=t.settings,c=this.classPrefix;return l.separator?(r=n.add(e,"tr",{id:t.id,"class":c+"ItemSeparator"}),n.add(r,"td",{"class":c+"ItemSeparator"}),(i=r.previousSibling)&&n.addClass(i,"mceLast"),void 0):(i=r=n.add(e,"tr",{id:t.id,"class":c+"Item "+c+"ItemEnabled"}),i=a=n.add(i,l.titleItem?"th":"td"),i=o=n.add(i,"a",{id:t.id+"_aria",role:l.titleItem?"presentation":"option",href:"javascript:;",onclick:"return false;",onmousedown:"return false;"}),l.parent&&(n.setAttrib(o,"aria-haspopup","true"),n.setAttrib(o,"aria-owns","menu_"+t.id)),n.addClass(a,l["class"]),s=n.add(i,"span",{"class":"mceIcon"+(l.icon?" mce_"+l.icon:"")}),l.icon_src&&n.add(s,"img",{src:l.icon_src}),i=n.add(i,l.element||"span",{"class":"mceText",title:t.settings.title},t.settings.title),t.settings.style&&("function"==typeof t.settings.style&&(t.settings.style=t.settings.style()),n.setAttrib(i,"style",t.settings.style)),1==e.childNodes.length&&n.addClass(r,"mceFirst"),(i=r.previousSibling)&&n.hasClass(i,c+"ItemSeparator")&&n.addClass(r,"mceFirst"),t.collapse&&n.addClass(r,c+"ItemSub"),(i=r.previousSibling)&&n.removeClass(i,"mceLast"),n.addClass(r,"mceLast"),void 0)}})}(tinymce),function(e){var t=e.DOM;e.create("tinymce.ui.Button:tinymce.ui.Control",{Button:function(e,t,n){this.parent(e,t,n),this.classPrefix="mceButton"},renderHTML:function(){var e,n,i=this.classPrefix,o=this.settings;return n=t.encode(o.label||""),e='<a role="button" id="'+this.id+'" href="javascript:;" class="'+i+" "+i+"Enabled "+o["class"]+(n?" "+i+"Labeled":"")+'" onmousedown="return false;" onclick="return false;" aria-labelledby="'+this.id+'_voice" title="'+t.encode(o.title)+'">',e+=!o.image||this.editor&&this.editor.forcedHighContrastMode?'<span class="mceIcon '+o["class"]+'"></span>'+(n?'<span class="'+i+'Label">'+n+"</span>":""):'<span class="mceIcon '+o["class"]+'"><img class="mceIcon" src="'+o.image+'" alt="'+t.encode(o.title)+'" /></span>'+(n?'<span class="'+i+'Label">'+n+"</span>":""),e+='<span class="mceVoiceLabel mceIconOnly" style="display: none;" id="'+this.id+'_voice">'+o.title+"</span>",e+="</a>"},postRender:function(){var t,n=this,i=n.settings;e.isIE&&n.editor&&e.dom.Event.add(n.id,"mousedown",function(){var e=n.editor.selection.getNode().nodeName;t="IMG"===e?n.editor.selection.getBookmark():null}),e.dom.Event.add(n.id,"click",function(o){return n.isDisabled()?void 0:(e.isIE&&n.editor&&null!==t&&n.editor.selection.moveToBookmark(t),i.onclick.call(i.scope,o))}),e.dom.Event.add(n.id,"keyup",function(t){return n.isDisabled()||t.keyCode!=e.VK.SPACEBAR?void 0:i.onclick.call(i.scope,t)})}})}(tinymce),function(e){var t,n=e.DOM,i=e.dom.Event,o=e.each,r=e.util.Dispatcher;e.create("tinymce.ui.ListBox:tinymce.ui.Control",{ListBox:function(t,n,i){var o=this;o.parent(t,n,i),o.items=[],o.onChange=new r(o),o.onPostRender=new r(o),o.onAdd=new r(o),o.onRenderMenu=new e.util.Dispatcher(this),o.classPrefix="mceListBox",o.marked={}},select:function(e){var n,i,r=this;return r.marked={},e==t?r.selectByIndex(-1):(i=e&&"function"==typeof e?e:function(t){return t==e},e!=r.selectedValue&&(o(r.items,function(e,t){return i(e.value)?(n=1,r.selectByIndex(t),!1):void 0}),n||r.selectByIndex(-1)),void 0)},selectByIndex:function(e){var t,i,o,r=this;r.marked={},e!=r.selectedIndex&&(t=n.get(r.id+"_text"),o=n.get(r.id+"_voiceDesc"),i=r.items[e],i?(r.selectedValue=i.value,r.selectedIndex=e,n.setHTML(t,n.encode(i.title)),n.setHTML(o,r.settings.title+" - "+i.title),n.removeClass(t,"mceTitle"),n.setAttrib(r.id,"aria-valuenow",i.title)):(n.setHTML(t,n.encode(r.settings.title)),n.setHTML(o,n.encode(r.settings.title)),n.addClass(t,"mceTitle"),r.selectedValue=r.selectedIndex=null,n.setAttrib(r.id,"aria-valuenow",r.settings.title)),t=0)},mark:function(e){this.marked[e]=!0},add:function(t,n,i){var o=this;i=i||{},i=e.extend(i,{title:t,value:n}),o.items.push(i),o.onAdd.dispatch(o,i)},getLength:function(){return this.items.length},renderHTML:function(){var e="",t=this,i=t.settings,o=t.classPrefix;return e='<span role="listbox" aria-haspopup="true" aria-labelledby="'+t.id+'_voiceDesc" aria-describedby="'+t.id+'_voiceDesc"><table role="presentation" tabindex="0" id="'+t.id+'" cellpadding="0" cellspacing="0" class="'+o+" "+o+"Enabled"+(i["class"]?" "+i["class"]:"")+'"><tbody><tr>',e+="<td>"+n.createHTML("span",{id:t.id+"_voiceDesc","class":"voiceLabel",style:"display:none;"},t.settings.title),e+=n.createHTML("a",{id:t.id+"_text",tabindex:-1,href:"javascript:;","class":"mceText",onclick:"return false;",onmousedown:"return false;"},n.encode(t.settings.title))+"</td>",e+="<td>"+n.createHTML("a",{id:t.id+"_open",tabindex:-1,href:"javascript:;","class":"mceOpen",onclick:"return false;",onmousedown:"return false;"},'<span><span style="display:none;" class="mceIconOnly" aria-hidden="true">▼</span></span>')+"</td>",e+="</tr></tbody></table></span>"},showMenu:function(){var t,r,a=this,s=n.get(this.id);if(!a.isDisabled()&&0!==a.items.length){if(a.menu&&a.menu.isMenuVisible)return a.hideMenu();a.isMenuRendered||(a.renderMenu(),a.isMenuRendered=!0),t=n.getPos(s),r=a.menu,r.settings.offset_x=t.x,r.settings.offset_y=t.y,r.settings.keyboard_focus=!e.isOpera,o(a.items,function(e){r.items[e.id]&&r.items[e.id].setSelected(0)}),o(a.items,function(e){r.items[e.id]&&a.marked[e.value]&&r.items[e.id].setSelected(1),e.value===a.selectedValue&&r.items[e.id].setSelected(1)}),r.showMenu(0,s.clientHeight),i.add(n.doc,"mousedown",a.hideMenu,a),n.addClass(a.id,a.classPrefix+"Selected")}},hideMenu:function(e){var t=this;if(t.menu&&t.menu.isMenuVisible){if(n.removeClass(t.id,t.classPrefix+"Selected"),e&&"mousedown"==e.type&&(e.target.id==t.id+"_text"||e.target.id==t.id+"_open"))return;e&&n.getParent(e.target,".mceMenu")||(n.removeClass(t.id,t.classPrefix+"Selected"),i.remove(n.doc,"mousedown",t.hideMenu,t),t.menu.hideMenu())}},renderMenu:function(){var e,i=this;e=i.settings.control_manager.createDropMenu(i.id+"_menu",{menu_line:1,"class":i.classPrefix+"Menu mceNoIcons",max_width:250,max_height:150}),e.onHideMenu.add(function(){i.hideMenu(),i.focus()}),e.add({title:i.settings.title,"class":"mceMenuItemTitle",onclick:function(){i.settings.onselect("")!==!1&&i.select("")}}),o(i.items,function(o){o.value===t?e.add({title:o.title,role:"option","class":"mceMenuItemTitle",onclick:function(){i.settings.onselect("")!==!1&&i.select("")}}):(o.id=n.uniqueId(),o.role="option",o.onclick=function(){i.settings.onselect(o.value)!==!1&&i.select(o.value)},e.add(o))}),i.onRenderMenu.dispatch(i,e),i.menu=e},postRender:function(){var t=this,o=t.classPrefix;i.add(t.id,"click",t.showMenu,t),i.add(t.id,"keydown",function(e){32==e.keyCode&&(t.showMenu(e),i.cancel(e))}),i.add(t.id,"focus",function(){t._focused||(t.keyDownHandler=i.add(t.id,"keydown",function(e){40==e.keyCode&&(t.showMenu(),i.cancel(e))}),t.keyPressHandler=i.add(t.id,"keypress",function(e){var n;13==e.keyCode&&(n=t.selectedValue,t.selectedValue=null,i.cancel(e),t.settings.onselect(n))})),t._focused=1}),i.add(t.id,"blur",function(){i.remove(t.id,"keydown",t.keyDownHandler),i.remove(t.id,"keypress",t.keyPressHandler),t._focused=0}),(e.isIE6||!n.boxModel)&&(i.add(t.id,"mouseover",function(){n.hasClass(t.id,o+"Disabled")||n.addClass(t.id,o+"Hover")}),i.add(t.id,"mouseout",function(){n.hasClass(t.id,o+"Disabled")||n.removeClass(t.id,o+"Hover")})),t.onPostRender.dispatch(t,n.get(t.id))},destroy:function(){this.parent(),i.clear(this.id+"_text"),i.clear(this.id+"_open")}})}(tinymce),function(e){var t,n=e.DOM,i=e.dom.Event,o=e.each;e.util.Dispatcher,e.create("tinymce.ui.NativeListBox:tinymce.ui.ListBox",{NativeListBox:function(e,t){this.parent(e,t),this.classPrefix="mceNativeListBox"},setDisabled:function(e){n.get(this.id).disabled=e,this.setAriaProperty("disabled",e)},isDisabled:function(){return n.get(this.id).disabled},select:function(e){var n,i,r=this;return e==t?r.selectByIndex(-1):(i=e&&"function"==typeof e?e:function(t){return t==e},e!=r.selectedValue&&(o(r.items,function(e,t){return i(e.value)?(n=1,r.selectByIndex(t),!1):void 0}),n||r.selectByIndex(-1)),void 0)},selectByIndex:function(e){n.get(this.id).selectedIndex=e+1,this.selectedValue=this.items[e]?this.items[e].value:null},add:function(e,t,i){var o,r=this;i=i||{},i.value=t,r.isRendered()&&n.add(n.get(this.id),"option",i,e),o={title:e,value:t,attribs:i},r.items.push(o),r.onAdd.dispatch(r,o)},getLength:function(){return this.items.length},renderHTML:function(){var e,t=this;return e=n.createHTML("option",{value:""},"-- "+t.settings.title+" --"),o(t.items,function(t){e+=n.createHTML("option",{value:t.value},t.title)}),e=n.createHTML("select",{id:t.id,"class":"mceNativeListBox","aria-labelledby":t.id+"_aria"},e),e+=n.createHTML("span",{id:t.id+"_aria",style:"display: none"},t.settings.title)
},postRender:function(){function t(e){var t=r.items[e.target.selectedIndex-1];t&&(t=t.value)&&(r.onChange.dispatch(r,t),r.settings.onselect&&r.settings.onselect(t))}var o,r=this,a=!0;r.rendered=!0,i.add(r.id,"change",t),i.add(r.id,"keydown",function(n){var s;return i.remove(r.id,"change",o),a=!1,s=i.add(r.id,"blur",function(){a||(a=!0,i.add(r.id,"change",t),i.remove(r.id,"blur",s))}),!e.isWebKit||37!=n.keyCode&&39!=n.keyCode?13==n.keyCode||32==n.keyCode?(t(n),i.cancel(n)):void 0:i.prevent(n)}),r.onPostRender.dispatch(r,n.get(r.id))}})}(tinymce),function(e){var t=e.DOM,n=e.dom.Event;e.each,e.create("tinymce.ui.MenuButton:tinymce.ui.Button",{MenuButton:function(n,i,o){this.parent(n,i,o),this.onRenderMenu=new e.util.Dispatcher(this),i.menu_container=i.menu_container||t.doc.body},showMenu:function(){var e,i,o,r=this,a=t.get(r.id);if(!r.isDisabled()){if(r.isMenuRendered||(r.renderMenu(),r.isMenuRendered=!0),r.isMenuVisible)return r.hideMenu();e=t.getPos(r.settings.menu_container),i=t.getPos(a),o=r.menu,o.settings.offset_x=i.x,o.settings.offset_y=i.y,o.settings.vp_offset_x=i.x,o.settings.vp_offset_y=i.y,o.settings.keyboard_focus=r._focused,o.showMenu(0,a.firstChild.clientHeight),n.add(t.doc,"mousedown",r.hideMenu,r),r.setState("Selected",1),r.isMenuVisible=1}},renderMenu:function(){var e,t=this;e=t.settings.control_manager.createDropMenu(t.id+"_menu",{menu_line:1,"class":this.classPrefix+"Menu",icons:t.settings.icons}),e.onHideMenu.add(function(){t.hideMenu(),t.focus()}),t.onRenderMenu.dispatch(t,e),t.menu=e},hideMenu:function(e){var i=this;e&&"mousedown"==e.type&&t.getParent(e.target,function(e){return e.id===i.id||e.id===i.id+"_open"})||(e&&t.getParent(e.target,".mceMenu")||(i.setState("Selected",0),n.remove(t.doc,"mousedown",i.hideMenu,i),i.menu&&i.menu.hideMenu()),i.isMenuVisible=0)},postRender:function(){var e=this,t=e.settings;n.add(e.id,"click",function(){e.isDisabled()||(t.onclick&&t.onclick(e.value),e.showMenu())})}})}(tinymce),function(e){var t=e.DOM,n=e.dom.Event;e.each,e.create("tinymce.ui.SplitButton:tinymce.ui.MenuButton",{SplitButton:function(e,t,n){this.parent(e,t,n),this.classPrefix="mceSplitButton"},renderHTML:function(){var e,n,i=this.classPrefix,o=this,r=o.settings;e="<tbody><tr>";var a=t.encode(r.label||"");return n=r.image?t.createHTML("img ",{src:r.image,role:"presentation","class":"mceAction "+r["class"]})+1:t.createHTML("span",{"class":"mceAction "+r["class"]},"")+(a?'<span class="'+i+'Label">'+a+"</span>":""),n+=t.createHTML("span",{"class":"mceVoiceLabel mceIconOnly",id:o.id+"_voice",style:"display:none;"},r.title),e+="<td >"+t.createHTML("a",{role:"button",id:o.id+"_action",tabindex:"-1",href:"javascript:;","class":"mceAction "+r["class"],onclick:"return false;",onmousedown:"return false;",title:r.title},n)+"</td>",n=t.createHTML("span",{"class":"mceOpen "+r["class"]},""),e+="<td>"+t.createHTML("a",{id:o.id+"_open",href:"javascript:;","class":"mceOpen "+r["class"],onclick:"return false;",onmousedown:"return false;",title:r.title},n)+"</td>",e+="</tr></tbody>",t.createHTML("table",{id:o.id,"class":i+" "+i+"Enabled "+r["class"]+(a?" "+i+"Labeled":""),cellpadding:"0",cellspacing:"0",onmousedown:"return false;",title:r.title},e)},postRender:function(){var i,o=this,r=o.settings;r.onclick&&(i=function(e){o.isDisabled()||(r.onclick(o.value),n.cancel(e))},n.add(o.id+"_action","click",i),n.add(o.id,["click","keydown"],function(e){var t=40;32!==e.keyCode&&13!==e.keyCode&&14!==e.keyCode||e.altKey||e.ctrlKey||e.metaKey?("click"===e.type||e.keyCode===t)&&(o.showMenu(),n.cancel(e)):(i(),n.cancel(e))})),n.add(o.id+"_open","click",function(e){o.showMenu(),n.cancel(e)}),n.add([o.id,o.id+"_open"],"focus",function(){o._focused=1}),n.add([o.id,o.id+"_open"],"blur",function(){o._focused=0}),(e.isIE6||!t.boxModel)&&(n.add(o.id,"mouseover",function(){t.hasClass(o.id,"mceSplitButtonDisabled")||t.addClass(o.id,"mceSplitButtonHover")}),n.add(o.id,"mouseout",function(){t.hasClass(o.id,"mceSplitButtonDisabled")||t.removeClass(o.id,"mceSplitButtonHover")}))},destroy:function(){this.parent(),n.clear(this.id+"_action"),n.clear(this.id+"_open"),n.clear(this.id)}})}(tinymce),function(e){var t=e.DOM,n=e.dom.Event,i=e.is,o=e.each;e.create("tinymce.ui.ColorSplitButton:tinymce.ui.SplitButton",{ColorSplitButton:function(t,n,i){var o=this;o.parent(t,n,i),o.settings=n=e.extend({colors:"000000,993300,333300,003300,003366,000080,333399,333333,800000,FF6600,808000,008000,008080,0000FF,666699,808080,FF0000,FF9900,99CC00,339966,33CCCC,3366FF,800080,999999,FF00FF,FFCC00,FFFF00,00FF00,00FFFF,00CCFF,993366,C0C0C0,FF99CC,FFCC99,FFFF99,CCFFCC,CCFFFF,99CCFF,CC99FF,FFFFFF",grid_width:8,default_color:"#888888"},o.settings),o.onShowMenu=new e.util.Dispatcher(o),o.onHideMenu=new e.util.Dispatcher(o),o.value=n.default_color},showMenu:function(){var i,o,r=this;if(!r.isDisabled()){if(r.isMenuRendered||(r.renderMenu(),r.isMenuRendered=!0),r.isMenuVisible)return r.hideMenu();i=t.get(r.id),t.show(r.id+"_menu"),t.addClass(i,"mceSplitButtonSelected"),o=t.getPos(i),t.setStyles(r.id+"_menu",{left:o.x,top:o.y+i.firstChild.clientHeight,zIndex:2e5}),i=0,n.add(t.doc,"mousedown",r.hideMenu,r),r.onShowMenu.dispatch(r),r._focused&&(r._keyHandler=n.add(r.id+"_menu","keydown",function(e){27==e.keyCode&&r.hideMenu()}),t.select("a",r.id+"_menu")[0].focus()),r.keyboardNav=new e.ui.KeyboardNavigation({root:r.id+"_menu",items:t.select("a",r.id+"_menu"),onCancel:function(){r.hideMenu(),r.focus()}}),r.keyboardNav.focus(),r.isMenuVisible=1}},hideMenu:function(e){var i=this;if(i.isMenuVisible){if(e&&"mousedown"==e.type&&t.getParent(e.target,function(e){return e.id===i.id+"_open"}))return;e&&t.getParent(e.target,".mceSplitButtonMenu")||(t.removeClass(i.id,"mceSplitButtonSelected"),n.remove(t.doc,"mousedown",i.hideMenu,i),n.remove(i.id+"_menu","keydown",i._keyHandler),t.hide(i.id+"_menu")),i.isMenuVisible=0,i.onHideMenu.dispatch(),i.keyboardNav.destroy()}},renderMenu:function(){var r,a,s,l,c,u,d=this,h=0,p=d.settings;return c=t.add(p.menu_container,"div",{role:"listbox",id:d.id+"_menu","class":p.menu_class+" "+p["class"],style:"position:absolute;left:0;top:-1000px;"}),r=t.add(c,"div",{"class":p["class"]+" mceSplitButtonMenu"}),t.add(r,"span",{"class":"mceMenuLine"}),a=t.add(r,"table",{role:"presentation","class":"mceColorSplitMenu"}),s=t.add(a,"tbody"),h=0,o(i(p.colors,"array")?p.colors:p.colors.split(","),function(n){n=n.replace(/^#/,""),h--||(l=t.add(s,"tr"),h=p.grid_width-1),a=t.add(l,"td");var i={href:"javascript:;",style:{backgroundColor:"#"+n},title:d.editor.getLang("colors."+n,n),"data-mce-color":"#"+n};e.isIE||(i.role="option"),a=t.add(a,"a",i),d.editor.forcedHighContrastMode&&(a=t.add(a,"canvas",{width:16,height:16,"aria-hidden":"true"}),a.getContext&&(u=a.getContext("2d"))?(u.fillStyle="#"+n,u.fillRect(0,0,16,16)):t.remove(a))}),p.more_colors_func&&(a=t.add(s,"tr"),a=t.add(a,"td",{colspan:p.grid_width,"class":"mceMoreColors"}),a=t.add(a,"a",{role:"option",id:d.id+"_more",href:"javascript:;",onclick:"return false;","class":"mceMoreColors"},p.more_colors_title),n.add(a,"click",function(e){return p.more_colors_func.call(p.more_colors_scope||this),n.cancel(e)})),t.addClass(r,"mceColorSplitMenu"),n.add(d.id+"_menu","mousedown",function(e){return n.cancel(e)}),n.add(d.id+"_menu","click",function(e){var n;return e=t.getParent(e.target,"a",s),e&&"a"==e.nodeName.toLowerCase()&&(n=e.getAttribute("data-mce-color"))&&d.setColor(n),!1}),c},setColor:function(e){this.displayColor(e),this.hideMenu(),this.settings.onselect(e)},displayColor:function(e){var n=this;t.setStyle(n.id+"_preview","backgroundColor",e),n.value=e},postRender:function(){var e=this,n=e.id;e.parent(),t.add(n+"_action","div",{id:n+"_preview","class":"mceColorPreview"}),t.setStyle(e.id+"_preview","backgroundColor",e.value)},destroy:function(){var e=this;e.parent(),n.clear(e.id+"_menu"),n.clear(e.id+"_more"),t.remove(e.id+"_menu"),e.keyboardNav&&e.keyboardNav.destroy()}})}(tinymce),function(e){var t=e.DOM,n=e.each,i=e.dom.Event;e.create("tinymce.ui.ToolbarGroup:tinymce.ui.Container",{renderHTML:function(){var n=this,i=[],o=n.controls,r=e.each,a=n.settings;return i.push('<div id="'+n.id+'" role="group" aria-labelledby="'+n.id+'_voice">'),i.push("<span role='application'>"),i.push('<span id="'+n.id+'_voice" class="mceVoiceLabel" style="display:none;">'+t.encode(a.name)+"</span>"),r(o,function(e){i.push(e.renderHTML())}),i.push("</span>"),i.push("</div>"),i.join("")},focus:function(){var e=this;t.get(e.id).focus()},postRender:function(){var i=this,o=[];n(i.controls,function(e){n(e.controls,function(e){e.id&&o.push(e)})}),i.keyNav=new e.ui.KeyboardNavigation({root:i.id,items:o,onCancel:function(){e.isWebKit&&t.get(i.editor.id+"_ifr").focus(),i.editor.focus()},excludeFromTabOrder:!i.settings.tab_focus_toolbar})},destroy:function(){var e=this;e.parent(),e.keyNav.destroy(),i.clear(e.id)}})}(tinymce),function(e){var t=e.DOM;e.each,e.create("tinymce.ui.Toolbar:tinymce.ui.Container",{renderHTML:function(){var e,n,i,o,r,a,s=this,l="",c=s.settings;for(a=s.controls,i=0;a.length>i;i++)n=a[i],o=a[i-1],r=a[i+1],0===i&&(e="mceToolbarStart",n.Button?e+=" mceToolbarStartButton":n.SplitButton?e+=" mceToolbarStartSplitButton":n.ListBox&&(e+=" mceToolbarStartListBox"),l+=t.createHTML("td",{"class":e},t.createHTML("span",null,"<!-- IE -->"))),o&&n.ListBox&&(o.Button||o.SplitButton)&&(l+=t.createHTML("td",{"class":"mceToolbarEnd"},t.createHTML("span",null,"<!-- IE -->"))),l+=t.stdMode?'<td style="position: relative">'+n.renderHTML()+"</td>":"<td>"+n.renderHTML()+"</td>",r&&n.ListBox&&(r.Button||r.SplitButton)&&(l+=t.createHTML("td",{"class":"mceToolbarStart"},t.createHTML("span",null,"<!-- IE -->")));return e="mceToolbarEnd",n.Button?e+=" mceToolbarEndButton":n.SplitButton?e+=" mceToolbarEndSplitButton":n.ListBox&&(e+=" mceToolbarEndListBox"),l+=t.createHTML("td",{"class":e},t.createHTML("span",null,"<!-- IE -->")),t.createHTML("table",{id:s.id,"class":"mceToolbar"+(c["class"]?" "+c["class"]:""),cellpadding:"0",cellspacing:"0",align:s.settings.align||"",role:"presentation",tabindex:"-1"},"<tbody><tr>"+l+"</tr></tbody>")}})}(tinymce),function(e){var t=e.util.Dispatcher;e.each,e.create("tinymce.AddOnManager",{AddOnManager:function(){var e=this;e.items=[],e.urls={},e.lookup={},e.onAdd=new t(e)},get:function(e){return this.lookup[e]?this.lookup[e].instance:void 0},dependencies:function(e){var t;return this.lookup[e]&&(t=this.lookup[e].dependencies),t||[]},requireLangPack:function(t){var n=e.settings;n&&n.language&&n.language_load!==!1&&e.ScriptLoader.add(this.urls[t]+"/langs/"+n.language+".js")},add:function(e,t,n){return this.items.push(t),this.lookup[e]={instance:t,dependencies:n},this.onAdd.dispatch(this,e,t),t},createUrl:function(e,t){return"object"==typeof t?t:{prefix:e.prefix,resource:t,suffix:e.suffix}},addComponents:function(t,n){var i=this.urls[t];e.each(n,function(t){e.ScriptLoader.add(i+"/"+t)})},load:function(t,n,i,o){function r(){var r=a.dependencies(t);e.each(r,function(e){var t=a.createUrl(n,e);a.load(t.resource,t,void 0,void 0)}),i&&(o?i.call(o):i.call(e.ScriptLoader))}var a=this,s=n;a.urls[t]||("object"==typeof n&&(s=n.prefix+n.resource+n.suffix),0!==s.indexOf("/")&&-1==s.indexOf("://")&&(s=e.baseURL+"/"+s),a.urls[t]=s.substring(0,s.lastIndexOf("/")),a.lookup[t]?r():e.ScriptLoader.add(s,r,o))}}),e.PluginManager=new e.AddOnManager,e.ThemeManager=new e.AddOnManager}(tinymce),function(e){var t,n=e.each,i=e.extend,o=e.DOM,r=e.dom.Event,a=(e.ThemeManager,e.PluginManager,e.explode),s=e.util.Dispatcher,l=0;e.documentBaseURL=window.location.href.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(e.documentBaseURL)||(e.documentBaseURL+="/"),e.baseURL=new e.util.URI(e.documentBaseURL).toAbsolute(e.baseURL),e.baseURI=new e.util.URI(e.baseURL),e.onBeforeUnload=new s(e),r.add(window,"beforeunload",function(t){e.onBeforeUnload.dispatch(e,t)}),e.onAddEditor=new s(e),e.onRemoveEditor=new s(e),e.EditorManager=i(e,{editors:[],i18n:{},activeEditor:null,init:function(t){function i(e){var t=e.id;return t||(t=e.name,t=t&&!o.get(t)?e.name:o.uniqueId(),e.setAttribute("id",t)),t}function s(t,n,i){var o=t[n];if(o)return e.is(o,"string")&&(i=o.replace(/\.\w+$/,""),i=i?e.resolve(i):0,o=e.resolve(o)),o.apply(i||this,Array.prototype.slice.call(arguments,2))}function c(e,t){return t.constructor===RegExp?t.test(e.className):o.hasClass(e,t)}var u,d=this,h=(e.ScriptLoader,[]);d.settings=t,r.bind(window,"ready",function(){var r,d;switch(s(t,"onpageload"),t.mode){case"exact":r=t.elements||"",r.length>0&&n(a(r),function(i){o.get(i)?(u=new e.Editor(i,t),h.push(u),u.render(1)):n(document.forms,function(r){n(r.elements,function(n){n.name===i&&(i="mce_editor_"+l++,o.setAttrib(n,"id",i),u=new e.Editor(i,t),h.push(u),u.render(1))})})});break;case"textareas":case"specific_textareas":n(o.select("textarea"),function(n){t.editor_deselector&&c(n,t.editor_deselector)||(!t.editor_selector||c(n,t.editor_selector))&&(u=new e.Editor(i(n),t),h.push(u),u.render(1))});break;default:t.types?n(t.types,function(r){n(o.select(r.selector),function(n){var o=new e.Editor(i(n),e.extend({},t,r));h.push(o),o.render(1)})}):t.selector&&n(o.select(t.selector),function(n){var o=new e.Editor(i(n),t);h.push(o),o.render(1)})}t.oninit&&(r=d=0,n(h,function(e){d++,e.initialized?r++:e.onInit.add(function(){r++,r==d&&s(t,"oninit")}),r==d&&s(t,"oninit")}))})},get:function(e){return e===t?this.editors:this.editors.hasOwnProperty(e)?this.editors[e]:t},getInstanceById:function(e){return this.get(e)},add:function(t){var n=this,i=n.editors;return i[t.id]=t,i.push(t),n._setActive(t),n.onAddEditor.dispatch(n,t),e.adapter&&e.adapter.patchEditor(t),t},remove:function(e){var t,n=this,i=n.editors;if(!i[e.id])return null;for(delete i[e.id],t=0;i.length>t;t++)if(i[t]==e){i.splice(t,1);break}return n.activeEditor==e&&n._setActive(i[0]),e.destroy(),n.onRemoveEditor.dispatch(n,e),e},execCommand:function(t,n,i){function o(){s.destroy(),r.detachEvent("onunload",o),r=r.tinyMCE=r.tinymce=null}var r,a=this,s=a.get(i);switch(t){case"mceFocus":return s.focus(),!0;case"mceAddEditor":case"mceAddControl":return a.get(i)||new e.Editor(i,a.settings).render(),!0;case"mceAddFrameControl":return r=i.window,r.tinyMCE=tinyMCE,r.tinymce=e,e.DOM.doc=r.document,e.DOM.win=r,s=new e.Editor(i.element_id,i),s.render(),e.isIE&&r.attachEvent("onunload",o),i.page_window=null,!0;case"mceRemoveEditor":case"mceRemoveControl":return s&&s.remove(),!0;case"mceToggleEditor":return s?(s.isHidden()?s.show():s.hide(),!0):(a.execCommand("mceAddControl",0,i),!0)}return a.activeEditor?a.activeEditor.execCommand(t,n,i):!1},execInstanceCommand:function(e,t,n,i){var o=this.get(e);return o?o.execCommand(t,n,i):!1},triggerSave:function(){n(this.editors,function(e){e.save()})},addI18n:function(t,i){var o=this.i18n;e.is(t,"string")?n(i,function(e,n){o[t+"."+n]=e}):n(t,function(e,t){n(e,function(e,i){n(e,function(e,n){"common"===i?o[t+"."+n]=e:o[t+"."+i+"."+n]=e})})})},_setActive:function(e){this.selectedInstance=this.activeEditor=e}})}(tinymce),function(e){var t=e.DOM,n=e.dom.Event,i=e.extend,o=e.each,r=e.isGecko,a=e.isIE,s=(e.isWebKit,e.is),l=e.ThemeManager,c=e.PluginManager,u=e.explode;e.create("tinymce.Editor",{Editor:function(t,n){var o=this,r=!0;o.settings=n=i({id:t,language:"en",theme:"advanced",skin:"default",delta_width:0,delta_height:0,popup_css:"",plugins:"",document_base_url:e.documentBaseURL,add_form_submit_trigger:r,submit_patch:r,add_unload_trigger:r,convert_urls:r,relative_urls:r,remove_script_host:r,table_inline_editing:!1,object_resizing:r,accessibility_focus:r,doctype:e.isIE6?'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">':"<!DOCTYPE>",visual:r,font_size_style_values:"xx-small,x-small,small,medium,large,x-large,xx-large",font_size_legacy_values:"xx-small,small,medium,large,x-large,xx-large,300%",apply_source_formatting:r,directionality:"ltr",forced_root_block:"p",hidden_input:r,padd_empty_editor:r,render_ui:r,indentation:"30px",fix_table_elements:r,inline_styles:r,convert_fonts_to_spans:r,indent:"simple",indent_before:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,li,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,option,optgroup,datalist",indent_after:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,li,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,option,optgroup,datalist",validate:r,entity_encoding:"named",url_converter:o.convertURL,url_converter_scope:o,ie7_compat:r},n),o.id=o.editorId=t,o.isNotDirty=!1,o.plugins={},o.documentBaseURI=new e.util.URI(n.document_base_url||e.documentBaseURL,{base_uri:tinyMCE.baseURI}),o.baseURI=e.baseURI,o.contentCSS=[],o.contentStyles=[],o.setupEvents(),o.execCommands={},o.queryStateCommands={},o.queryValueCommands={},o.execCallback("setup",o)},render:function(){function i(){a.language&&a.language_load!==!1&&d.add(e.baseURL+"/langs/"+a.language+".js"),a.theme&&"function"!=typeof a.theme&&"-"!=a.theme.charAt(0)&&!l.urls[a.theme]&&l.load(a.theme,"themes/"+a.theme+"/editor_template"+e.suffix+".js"),o(u(a.plugins),function(t){if(t&&!c.urls[t])if("-"==t.charAt(0)){t=t.substr(1,t.length);var n=c.dependencies(t);o(n,function(t){var n={prefix:"plugins/",resource:t,suffix:"/editor_plugin"+e.suffix+".js"};t=c.createUrl(n,t),c.load(t.resource,t)})}else{if("safari"==t)return;c.load(t,{prefix:"plugins/",resource:t,suffix:"/editor_plugin"+e.suffix+".js"})}}),d.loadQueue(function(){r.removed||r.init()})}var r=this,a=r.settings,s=r.id,d=e.ScriptLoader;return n.domLoaded?(tinyMCE.settings=a,r.getElement()&&(!e.isIDevice||e.isIOS5)&&(!/TEXTAREA|INPUT/i.test(r.getElement().nodeName)&&a.hidden_input&&t.getParent(s,"form")&&t.insertAfter(t.create("input",{type:"hidden",name:s}),s),a.content_editable||(r.orgVisibility=r.getElement().style.visibility,r.getElement().style.visibility="hidden"),e.WindowManager&&(r.windowManager=new e.WindowManager(r)),"xml"==a.encoding&&r.onGetContent.add(function(e,n){n.save&&(n.content=t.encode(n.content))}),a.add_form_submit_trigger&&r.onSubmit.addToTop(function(){r.initialized&&(r.save(),r.isNotDirty=1)}),a.add_unload_trigger&&(r._beforeUnload=tinyMCE.onBeforeUnload.add(function(){!r.initialized||r.destroyed||r.isHidden()||r.save({format:"raw",no_events:!0})})),e.addUnload(r.destroy,r),a.submit_patch&&r.onBeforeRenderUI.add(function(){var t=r.getElement().form;t&&(t._mceOldSubmit||(t.submit.nodeType||t.submit.length||(r.formElement=t,t._mceOldSubmit=t.submit,t.submit=function(){return e.triggerSave(),r.isNotDirty=1,r.formElement._mceOldSubmit(r.formElement)}),t=null))}),i()),void 0):(n.add(window,"ready",function(){r.render()}),void 0)},init:function(){function n(t){var i,r=c.get(t),a=c.urls[t]||e.documentBaseURL.replace(/\/$/,"");r&&-1===e.inArray(x,t)&&(o(c.dependencies(t),function(e){n(e)}),i=new r(b,a),b.plugins[t]=i,i.init&&(i.init(b,a),x.push(t)))}var i,r,s,d,h,p,f,m,g,v,b=this,y=b.settings,w=b.getElement(),x=[];if(e.add(b),y.aria_label=y.aria_label||t.getAttrib(w,"aria-label",b.getLang("aria.rich_text_area")),y.theme&&("function"!=typeof y.theme?(y.theme=y.theme.replace(/-/,""),h=l.get(y.theme),b.theme=new h,b.theme.init&&b.theme.init(b,l.urls[y.theme]||e.documentBaseURL.replace(/\/$/,""))):b.theme=y.theme),o(u(y.plugins.replace(/\-/g,"")),n),y.popup_css!==!1&&(y.popup_css=y.popup_css?b.documentBaseURI.toAbsolute(y.popup_css):b.baseURI.toAbsolute("themes/"+y.theme+"/skins/"+y.skin+"/dialog.css")),y.popup_css_add&&(y.popup_css+=","+b.documentBaseURI.toAbsolute(y.popup_css_add)),b.controlManager=new e.ControlManager(b),b.onBeforeRenderUI.dispatch(b,b.controlManager),y.render_ui&&b.theme&&(b.orgDisplay=w.style.display,"function"!=typeof y.theme?(r=y.width||w.style.width||w.offsetWidth,s=y.height||w.style.height||w.offsetHeight,d=y.min_height||100,g=/^[0-9\.]+(|px)$/i,g.test(""+r)&&(r=Math.max(parseInt(r,10)+(h.deltaWidth||0),100)),g.test(""+s)&&(s=Math.max(parseInt(s,10)+(h.deltaHeight||0),d)),h=b.theme.renderUI({targetNode:w,width:r,height:s,deltaWidth:y.delta_width,deltaHeight:y.delta_height}),t.setStyles(h.sizeContainer||h.editorContainer,{width:r,height:s}),s=(h.iframeHeight||s)+("number"==typeof s?h.deltaHeight||0:""),d>s&&(s=d)):(h=y.theme(b,w),h.editorContainer.nodeType&&(h.editorContainer=h.editorContainer.id=h.editorContainer.id||b.id+"_parent"),h.iframeContainer.nodeType&&(h.iframeContainer=h.iframeContainer.id=h.iframeContainer.id||b.id+"_iframecontainer"),s=h.iframeHeight||w.offsetHeight,a&&b.onInit.add(function(e){e.dom.bind(e.getBody(),"beforedeactivate keydown",function(){e.lastIERng=e.selection.getRng()})})),b.editorContainer=h.editorContainer),y.content_css&&o(u(y.content_css),function(e){b.contentCSS.push(b.documentBaseURI.toAbsolute(e))}),y.content_style&&b.contentStyles.push(y.content_style),y.content_editable)return w=i=h=null,b.initContentBody();for(document.domain&&location.hostname!=document.domain&&(e.relaxedDomain=document.domain),b.iframeHTML=y.doctype+'<html><head xmlns="/web/20130613001053/http://www.w3.org/1999/xhtml">',y.document_base_url!=e.documentBaseURL&&(b.iframeHTML+='<base href="'+b.documentBaseURI.getURI()+'" />'),b.iframeHTML+=y.ie7_compat?'<meta http-equiv="X-UA-Compatible" content="IE=7" />':'<meta http-equiv="X-UA-Compatible" content="IE=edge" />',b.iframeHTML+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />',v=0;b.contentCSS.length>v;v++)b.iframeHTML+='<link type="text/css" rel="stylesheet" href="'+b.contentCSS[v]+'" />';b.contentCSS=[],f=y.body_id||"tinymce",-1!=f.indexOf("=")&&(f=b.getParam("body_id","","hash"),f=f[b.id]||f),m=y.body_class||"",-1!=m.indexOf("=")&&(m=b.getParam("body_class","","hash"),m=m[b.id]||""),b.iframeHTML+='</head><body id="'+f+'" class="mceContentBody '+m+'" onload="window.parent.tinyMCE.get(\''+b.id+"').onLoad.dispatch();\"><br></body></html>",e.relaxedDomain&&(a||e.isOpera&&11>parseFloat(opera.version()))&&(p='javascript:(function(){document.open();document.domain="'+document.domain+'";var ed = window.parent.tinyMCE.get("'+b.id+'");document.write(ed.iframeHTML);document.close();ed.initContentBody();})()'),i=t.add(h.iframeContainer,"iframe",{id:b.id+"_ifr",src:p||'javascript:""',frameBorder:"0",allowTransparency:"true",title:y.aria_label,style:{width:"100%",height:s,display:"block"}}),b.contentAreaContainer=h.iframeContainer,h.editorContainer&&(t.get(h.editorContainer).style.display=b.orgDisplay),w.style.visibility=b.orgVisibility,t.get(b.id).style.display="none",t.setAttrib(b.id,"aria-hidden",!0),e.relaxedDomain&&p||b.initContentBody(),w=i=h=null},initContentBody:function(){var n,i,r=this,s=r.settings,l=t.get(r.id),c=r.getDoc();a&&e.relaxedDomain||s.content_editable||(c.open(),c.write(r.iframeHTML),c.close(),e.relaxedDomain&&(c.domain=e.relaxedDomain)),s.content_editable&&(t.addClass(l,"mceContentBody"),r.contentDocument=c=s.content_document||document,r.contentWindow=s.content_window||window,r.bodyElement=l,s.content_document=s.content_window=null),n=r.getBody(),n.disabled=!0,s.readonly||(n.contentEditable=r.getParam("content_editable_state",!0)),n.disabled=!1,r.schema=new e.html.Schema(s),r.dom=new e.dom.DOMUtils(c,{keep_values:!0,url_converter:r.convertURL,url_converter_scope:r,hex_colors:s.force_hex_style_colors,class_filter:s.class_filter,update_styles:!0,root_element:s.content_editable?r.id:null,schema:r.schema}),r.parser=new e.html.DomParser(s,r.schema),r.parser.addAttributeFilter("src,href,style",function(e,t){for(var n,i,o,a=e.length,s=r.dom;a--;)n=e[a],i=n.attr(t),o="data-mce-"+t,n.attributes.map[o]||("style"===t?n.attr(o,s.serializeStyle(s.parseStyle(i),n.name)):n.attr(o,r.convertURL(i,t,n.name)))}),r.parser.addNodeFilter("script",function(e){for(var t,n=e.length;n--;)t=e[n],t.attr("type","mce-"+(t.attr("type")||"text/javascript"))}),r.parser.addNodeFilter("#cdata",function(e){for(var t,n=e.length;n--;)t=e[n],t.type=8,t.name="#comment",t.value="[CDATA["+t.value+"]]"}),r.parser.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div",function(t){for(var n,i=t.length,o=r.schema.getNonEmptyElements();i--;)n=t[i],n.isEmpty(o)&&(n.empty().append(new e.html.Node("br",1)).shortEnded=!0)}),r.serializer=new e.dom.Serializer(s,r.dom,r.schema),r.selection=new e.dom.Selection(r.dom,r.getWin(),r.serializer,r),r.formatter=new e.Formatter(r),r.undoManager=new e.UndoManager(r),r.forceBlocks=new e.ForceBlocks(r),r.enterKey=new e.EnterKey(r),r.editorCommands=new e.EditorCommands(r),r.onExecCommand.add(function(e,t){/^(FontName|FontSize)$/.test(t)||r.nodeChanged()}),r.serializer.onPreProcess.add(function(e,t){return r.onPreProcess.dispatch(r,t,e)}),r.serializer.onPostProcess.add(function(e,t){return r.onPostProcess.dispatch(r,t,e)}),r.onPreInit.dispatch(r),s.browser_spellcheck||s.gecko_spellcheck||(c.body.spellcheck=!1),s.readonly||r.bindNativeEvents(),r.controlManager.onPostRender.dispatch(r,r.controlManager),r.onPostRender.dispatch(r),r.quirks=e.util.Quirks(r),s.directionality&&(n.dir=s.directionality),s.nowrap&&(n.style.whiteSpace="nowrap"),s.protect&&r.onBeforeSetContent.add(function(e,t){o(s.protect,function(e){t.content=t.content.replace(e,function(e){return"<!--mce:protected "+escape(e)+"-->"})})}),r.onSetContent.add(function(){r.addVisual(r.getBody())}),s.padd_empty_editor&&r.onPostProcess.add(function(e,t){t.content=t.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\s|\u00a0|)<\/p>[\r\n]*|<br \/>[\r\n]*)$/,"")}),r.load({initial:!0,format:"html"}),r.startContent=r.getContent({format:"raw"}),r.initialized=!0,r.onInit.dispatch(r),r.execCallback("setupcontent_callback",r.id,n,c),r.execCallback("init_instance_callback",r),r.focus(!0),r.nodeChanged({initial:!0}),r.contentStyles.length>0&&(i="",o(r.contentStyles,function(e){i+=e+"\r\n"}),r.dom.addStyle(i)),o(r.contentCSS,function(e){r.dom.loadCSS(e)}),s.auto_focus&&setTimeout(function(){var t=e.get(s.auto_focus);t.selection.select(t.getBody(),1),t.selection.collapse(1),t.getBody().focus(),t.getWin().focus()},100),l=c=n=null},focus:function(t){var n,i,o,r,a=this,s=a.selection,l=a.settings.content_editable,c=a.getDoc();t||(a.lastIERng&&s.setRng(a.lastIERng),i=s.getRng(),i.item&&(o=i.item(0)),a._refreshContentEditable(),l||a.getWin().focus(),(e.isGecko||l)&&(r=a.getBody(),r.setActive?r.setActive():r.focus(),l&&s.normalize()),o&&o.ownerDocument==c&&(i=c.body.createControlRange(),i.addElement(o),i.select())),e.activeEditor!=a&&(null!=(n=e.activeEditor)&&n.onDeactivate.dispatch(n,a),a.onActivate.dispatch(a,n)),e._setActive(a)},execCallback:function(t){var n,i=this,o=i.settings[t];if(o)return i.callbackLookup&&(n=i.callbackLookup[t])&&(o=n.func,n=n.scope),s(o,"string")&&(n=o.replace(/\.\w+$/,""),n=n?e.resolve(n):0,o=e.resolve(o),i.callbackLookup=i.callbackLookup||{},i.callbackLookup[t]={func:o,scope:n}),o.apply(n||i,Array.prototype.slice.call(arguments,1))},translate:function(t){var n=this.settings.language||"en",i=e.i18n;return t?i[n+"."+t]||t.replace(/\{\#([^\}]+)\}/g,function(e,t){return i[n+"."+t]||"{#"+t+"}"}):""},getLang:function(t,n){return e.i18n[(this.settings.language||"en")+"."+t]||(s(n)?n:"{#"+t+"}")},getParam:function(t,n,i){var r,a=e.trim,l=s(this.settings[t])?this.settings[t]:n;return"hash"===i?(r={},s(l,"string")?o(l.indexOf("=")>0?l.split(/[;,](?![^=;,]*(?:[;,]|$))/):l.split(","),function(e){e=e.split("="),r[a(e[0])]=e.length>1?a(e[1]):a(e)}):r=l,r):l},nodeChanged:function(e){var t,n=this,i=n.selection;n.initialized&&(e=e||{},t=i.getStart()||n.getBody(),t=a&&t.ownerDocument!=n.getDoc()?n.getBody():t,e.parents=[],n.dom.getParent(t,function(t){return"BODY"==t.nodeName?!0:(e.parents.push(t),void 0)}),n.onNodeChange.dispatch(n,e?e.controlManager||n.controlManager:n.controlManager,t,i.isCollapsed(),e))},addButton:function(e,t){var n=this;n.buttons=n.buttons||{},n.buttons[e]=t},addCommand:function(e,t,n){this.execCommands[e]={func:t,scope:n||this}},addQueryStateHandler:function(e,t,n){this.queryStateCommands[e]={func:t,scope:n||this}},addQueryValueHandler:function(e,t,n){this.queryValueCommands[e]={func:t,scope:n||this}},addShortcut:function(e,t,n,i){var r,a=this;return a.settings.custom_shortcuts===!1?!1:(a.shortcuts=a.shortcuts||{},s(n,"string")&&(r=n,n=function(){a.execCommand(r,!1,null)}),s(n,"object")&&(r=n,n=function(){a.execCommand(r[0],r[1],r[2])}),o(u(e),function(e){var r={func:n,scope:i||this,desc:a.translate(t),alt:!1,ctrl:!1,shift:!1};o(u(e,"+"),function(e){switch(e){case"alt":case"ctrl":case"shift":r[e]=!0;break;default:r.charCode=e.charCodeAt(0),r.keyCode=e.toUpperCase().charCodeAt(0)}}),a.shortcuts[(r.ctrl?"ctrl":"")+","+(r.alt?"alt":"")+","+(r.shift?"shift":"")+","+r.keyCode]=r}),!0)},execCommand:function(e,t,n,r){var a,s,l=this,c=0;return/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint|SelectAll)$/.test(e)||r&&r.skip_focus||l.focus(),r=i({},r),l.onBeforeExecCommand.dispatch(l,e,t,n,r),r.terminate?!1:l.execCallback("execcommand_callback",l.id,l.selection.getNode(),e,t,n)?(l.onExecCommand.dispatch(l,e,t,n,r),!0):(a=l.execCommands[e])&&(s=a.func.call(a.scope,t,n),s!==!0)?(l.onExecCommand.dispatch(l,e,t,n,r),s):(o(l.plugins,function(i){return i.execCommand&&i.execCommand(e,t,n)?(l.onExecCommand.dispatch(l,e,t,n,r),c=1,!1):void 0}),c?!0:l.theme&&l.theme.execCommand&&l.theme.execCommand(e,t,n)?(l.onExecCommand.dispatch(l,e,t,n,r),!0):l.editorCommands.execCommand(e,t,n)?(l.onExecCommand.dispatch(l,e,t,n,r),!0):(l.getDoc().execCommand(e,t,n),l.onExecCommand.dispatch(l,e,t,n,r),void 0))},queryCommandState:function(e){var t,n,i=this;if(!i._isHidden()){if((t=i.queryStateCommands[e])&&(n=t.func.call(t.scope),n!==!0))return n;if(t=i.editorCommands.queryCommandState(e),-1!==t)return t;try{return this.getDoc().queryCommandState(e)}catch(o){}}},queryCommandValue:function(e){var t,n,i=this;if(!i._isHidden()){if((t=i.queryValueCommands[e])&&(n=t.func.call(t.scope),n!==!0))return n;if(t=i.editorCommands.queryCommandValue(e),s(t))return t;try{return this.getDoc().queryCommandValue(e)}catch(o){}}},show:function(){var e=this;t.show(e.getContainer()),t.hide(e.id),e.load()},hide:function(){var e=this,n=e.getDoc();a&&n&&n.execCommand("SelectAll"),e.save(),t.hide(e.getContainer()),t.setStyle(e.id,"display",e.orgDisplay)},isHidden:function(){return!t.isHidden(this.id)},setProgressState:function(e,t,n){return this.onSetProgressState.dispatch(this,e,t,n),e},load:function(e){var t,n=this,i=n.getElement();return i?(e=e||{},e.load=!0,t=n.setContent(s(i.value)?i.value:i.innerHTML,e),e.element=i,e.no_events||n.onLoadContent.dispatch(n,e),e.element=i=null,t):void 0},save:function(e){var n,i,r=this,a=r.getElement();if(a&&r.initialized)return e=e||{},e.save=!0,e.element=a,n=e.content=r.getContent(e),e.no_events||r.onSaveContent.dispatch(r,e),n=e.content,/TEXTAREA|INPUT/i.test(a.nodeName)?a.value=n:(a.innerHTML=n,(i=t.getParent(r.id,"form"))&&o(i.elements,function(e){return e.name==r.id?(e.value=n,!1):void 0})),e.element=a=null,n},setContent:function(t,n){var i,o=this,r=o.getBody();return n=n||{},n.format=n.format||"html",n.set=!0,n.content=t,n.no_events||o.onBeforeSetContent.dispatch(o,n),t=n.content,e.isIE||0!==t.length&&!/^\s+$/.test(t)?("raw"!==n.format&&(t=new e.html.Serializer({},o.schema).serialize(o.parser.parse(t))),n.content=e.trim(t),o.dom.setHTML(r,n.content),n.no_events||o.onSetContent.dispatch(o,n),o.settings.content_editable&&document.activeElement!==o.getBody()||o.selection.normalize(),n.content):(i=o.settings.forced_root_block,t=i?"<"+i+'><br data-mce-bogus="1"></'+i+">":'<br data-mce-bogus="1">',r.innerHTML=t,o.selection.select(r,!0),o.selection.collapse(!0),void 0)},getContent:function(t){var n,i=this,o=i.getBody();return t=t||{},t.format=t.format||"html",t.get=!0,t.getInner=!0,t.no_events||i.onBeforeGetContent.dispatch(i,t),n="raw"==t.format?o.innerHTML:"text"==t.format?o.innerText||o.textContent:i.serializer.serialize(o,t),t.content="text"!=t.format?e.trim(n):n,t.no_events||i.onGetContent.dispatch(i,t),t.content},isDirty:function(){var t=this;return e.trim(t.startContent)!=e.trim(t.getContent({format:"raw",no_events:1}))&&!t.isNotDirty},getContainer:function(){var e=this;return e.container||(e.container=t.get(e.editorContainer||e.id+"_parent")),e.container
},getContentAreaContainer:function(){return this.contentAreaContainer},getElement:function(){return t.get(this.settings.content_element||this.id)},getWin:function(){var e,n=this;return n.contentWindow||(e=t.get(n.id+"_ifr"),e&&(n.contentWindow=e.contentWindow)),n.contentWindow},getDoc:function(){var e,t=this;return t.contentDocument||(e=t.getWin(),e&&(t.contentDocument=e.document)),t.contentDocument},getBody:function(){return this.bodyElement||this.getDoc().body},convertURL:function(e,t,n){var i=this,o=i.settings;return o.urlconverter_callback?i.execCallback("urlconverter_callback",e,n,!0,t):!o.convert_urls||n&&"LINK"==n.nodeName||0===e.indexOf("file:")?e:o.relative_urls?i.documentBaseURI.toRelative(e):e=i.documentBaseURI.toAbsolute(e,o.remove_script_host)},addVisual:function(e){var t,n=this,i=n.settings,r=n.dom;e=e||n.getBody(),s(n.hasVisual)||(n.hasVisual=i.visual),o(r.select("table,a",e),function(e){var o;switch(e.nodeName){case"TABLE":return t=i.visual_table_class||"mceItemTable",o=r.getAttrib(e,"border"),o&&"0"!=o||(n.hasVisual?r.addClass(e,t):r.removeClass(e,t)),void 0;case"A":return r.getAttrib(e,"href",!1)||(o=r.getAttrib(e,"name")||e.id,t="mceItemAnchor",o&&(n.hasVisual?r.addClass(e,t):r.removeClass(e,t))),void 0}}),n.onVisualAid.dispatch(n,e,n.hasVisual)},remove:function(){var i=this,o=i.getContainer();i.removed||(i.removed=1,i.hide(),i.settings.content_editable||(n.unbind(i.getWin()),n.unbind(i.getDoc())),n.unbind(i.getBody()),n.clear(o),i.execCallback("remove_instance_callback",i),i.onRemove.dispatch(i),i.onExecCommand.listeners=[],e.remove(i),t.remove(o))},destroy:function(t){var i=this;i.destroyed||(r&&(n.unbind(i.getDoc()),n.unbind(i.getWin()),n.unbind(i.getBody())),t||(e.removeUnload(i.destroy),tinyMCE.onBeforeUnload.remove(i._beforeUnload),i.theme&&i.theme.destroy&&i.theme.destroy(),i.controlManager.destroy(),i.selection.destroy(),i.dom.destroy()),i.formElement&&(i.formElement.submit=i.formElement._mceOldSubmit,i.formElement._mceOldSubmit=null),i.contentAreaContainer=i.formElement=i.container=i.settings.content_element=i.bodyElement=i.contentDocument=i.contentWindow=null,i.selection&&(i.selection=i.selection.win=i.selection.dom=i.selection.dom.doc=null),i.destroyed=1)},_refreshContentEditable:function(){var e,t,n=this;n._isHidden()&&(e=n.getBody(),t=e.parentNode,t.removeChild(e),t.appendChild(e),e.focus())},_isHidden:function(){var e;return r?(e=this.selection.getSel(),!e||!e.rangeCount||0===e.rangeCount):0}})}(tinymce),function(e){var t=e.each;e.Editor.prototype.setupEvents=function(){var n=this,i=n.settings;t(["onPreInit","onBeforeRenderUI","onPostRender","onLoad","onInit","onRemove","onActivate","onDeactivate","onClick","onEvent","onMouseUp","onMouseDown","onDblClick","onKeyDown","onKeyUp","onKeyPress","onContextMenu","onSubmit","onReset","onPaste","onPreProcess","onPostProcess","onBeforeSetContent","onBeforeGetContent","onSetContent","onGetContent","onLoadContent","onSaveContent","onNodeChange","onChange","onBeforeExecCommand","onExecCommand","onUndo","onRedo","onVisualAid","onSetProgressState","onSetAttrib"],function(t){n[t]=new e.util.Dispatcher(n)}),i.cleanup_callback&&(n.onBeforeSetContent.add(function(e,t){t.content=e.execCallback("cleanup_callback","insert_to_editor",t.content,t)}),n.onPreProcess.add(function(e,t){t.set&&e.execCallback("cleanup_callback","insert_to_editor_dom",t.node,t),t.get&&e.execCallback("cleanup_callback","get_from_editor_dom",t.node,t)}),n.onPostProcess.add(function(e,t){t.set&&(t.content=e.execCallback("cleanup_callback","insert_to_editor",t.content,t)),t.get&&(t.content=e.execCallback("cleanup_callback","get_from_editor",t.content,t))})),i.save_callback&&n.onGetContent.add(function(e,t){t.save&&(t.content=e.execCallback("save_callback",e.id,t.content,e.getBody()))}),i.handle_event_callback&&n.onEvent.add(function(e,t,i){n.execCallback("handle_event_callback",t,e,i)===!1&&(t.preventDefault(),t.stopPropagation())}),i.handle_node_change_callback&&n.onNodeChange.add(function(e,t,n){e.execCallback("handle_node_change_callback",e.id,n,-1,-1,!0,e.selection.isCollapsed())}),i.save_callback&&n.onSaveContent.add(function(e,t){var n=e.execCallback("save_callback",e.id,t.content,e.getBody());n&&(t.content=n)}),i.onchange_callback&&n.onChange.add(function(e,t){e.execCallback("onchange_callback",e,t)})},e.Editor.prototype.bindNativeEvents=function(){function n(e,t){e.type,s.removed||s.onEvent.dispatch(s,e,t)!==!1&&s[a[e.fakeType||e.type]].dispatch(s,e,t)}function i(){s.focus(!0)}function o(t,n){65==n.keyCode&&e.VK.metaKeyPressed(n)||s.selection.normalize(),s.nodeChanged()}function r(n,i){(n.altKey||n.ctrlKey||n.metaKey)&&t(s.shortcuts,function(t){var o=e.isMac?n.metaKey:n.ctrlKey;if(t.ctrl==o&&t.alt==n.altKey&&t.shift==n.shiftKey)return n.keyCode==t.keyCode||n.charCode&&n.charCode==t.charCode?(n.preventDefault(),i&&t.func.call(t.scope),!0):void 0})}var a,s=this,l=s.settings,c=s.dom;a={mouseup:"onMouseUp",mousedown:"onMouseDown",click:"onClick",keyup:"onKeyUp",keydown:"onKeyDown",keypress:"onKeyPress",submit:"onSubmit",reset:"onReset",contextmenu:"onContextMenu",dblclick:"onDblClick",paste:"onPaste"},t(a,function(t,i){var o=l.content_editable?s.getBody():s.getDoc();switch(i){case"contextmenu":c.bind(o,i,n);break;case"paste":c.bind(s.getBody(),i,n);break;case"submit":case"reset":c.bind(s.getElement().form||e.DOM.getParent(s.id,"form"),i,n);break;default:c.bind(o,i,n)}}),c.bind(l.content_editable?s.getBody():e.isGecko?s.getDoc():s.getWin(),"focus",function(){s.focus(!0)}),l.content_editable&&e.isOpera&&(c.bind(s.getBody(),"click",i),c.bind(s.getBody(),"keydown",i)),s.onMouseUp.add(o),s.onKeyUp.add(function(t,n){var i=n.keyCode;(i>=33&&36>=i||i>=37&&40>=i||13==i||45==i||46==i||8==i||e.isMac&&(91==i||93==i)||n.ctrlKey)&&o(t,n)}),s.onReset.add(function(){s.setContent(s.startContent,{format:"raw"})}),s.onKeyUp.add(function(e,t){r(t)}),s.onKeyPress.add(function(e,t){r(t)}),s.onKeyDown.add(function(e,t){r(t,!0)}),e.isOpera&&s.onClick.add(function(e,t){t.preventDefault()})}}(tinymce),function(e){var t,n=e.each,i=!0,o=!1;e.EditorCommands=function(r){function a(e,t,n){var r;return e=e.toLowerCase(),(r=b.exec[e])?(r(e,t,n),i):o}function s(e){var t;return e=e.toLowerCase(),(t=b.state[e])?t(e):-1}function l(e){var t;return e=e.toLowerCase(),(t=b.value[e])?t(e):o}function c(e,t){t=t||"exec",n(e,function(e,i){n(i.toLowerCase().split(","),function(n){b[t][n]=e})})}function u(e,n,i){return n===t&&(n=o),i===t&&(i=null),r.getDoc().execCommand(e,n,i)}function d(e){return w.match(e)}function h(e,n){w.toggle(e,n?{value:n}:t)}function p(e){m=v.getBookmark(e)}function f(){v.moveToBookmark(m)}var m,g=r.dom,v=r.selection,b={state:{},exec:{},value:{}},y=r.settings,w=r.formatter;e.extend(this,{execCommand:a,queryCommandState:s,queryCommandValue:l,addCommands:c}),c({"mceResetDesignMode,mceBeginUndoLevel":function(){},"mceEndUndoLevel,mceAddUndoLevel":function(){r.undoManager.add()},"Cut,Copy,Paste":function(t){var n,o=r.getDoc();try{u(t)}catch(a){n=i}(n||!o.queryCommandSupported(t))&&(e.isGecko?r.windowManager.confirm(r.getLang("clipboard_msg"),function(e){e&&open("/web/20130613001053/http://www.mozilla.org/editor/midasdemo/securityprefs.html","_blank")}):r.windowManager.alert(r.getLang("clipboard_no_support")))},unlink:function(e){v.isCollapsed()&&v.select(v.getNode()),u(e),v.collapse(o)},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(e){var t=e.substring(7);n("left,center,right,full".split(","),function(e){t!=e&&w.remove("align"+e)}),h("align"+t),a("mceRepaint")},"InsertUnorderedList,InsertOrderedList":function(e){var t,n;u(e),t=g.getParent(v.getNode(),"ol,ul"),t&&(n=t.parentNode,/^(H[1-6]|P|ADDRESS|PRE)$/.test(n.nodeName)&&(p(),g.split(n,t),f()))},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(e){h(e)},"ForeColor,HiliteColor,FontName":function(e,t,n){h(e,n)},FontSize:function(t,n,i){var o,r;i>=1&&7>=i&&(r=e.explode(y.font_size_style_values),o=e.explode(y.font_size_classes),i=o?o[i-1]||i:r[i-1]||i),h(t,i)},RemoveFormat:function(e){w.remove(e)},mceBlockQuote:function(){h("blockquote")},FormatBlock:function(e,t,n){return h(n||"p")},mceCleanup:function(){var e=v.getBookmark();r.setContent(r.getContent({cleanup:i}),{cleanup:i}),v.moveToBookmark(e)},mceRemoveNode:function(e,t,n){var o=n||v.getNode();o!=r.getBody()&&(p(),r.dom.remove(o,i),f())},mceSelectNodeDepth:function(e,t,n){var i=0;g.getParent(v.getNode(),function(e){return 1==e.nodeType&&i++==n?(v.select(e),o):void 0},r.getBody())},mceSelectNode:function(e,t,n){v.select(n)},mceInsertContent:function(t,n,i){var o,a,s,l,c,u,d,h,p,f,m,b,y,w;if(o=r.parser,a=new e.html.Serializer({},r.schema),y='<span id="mce_marker" data-mce-type="bookmark">﻿</span>',u={content:i,format:"html"},v.onBeforeSetContent.dispatch(v,u),i=u.content,-1==i.indexOf("{$caret}")&&(i+="{$caret}"),i=i.replace(/\{\$caret\}/,y),v.isCollapsed()||r.getDoc().execCommand("Delete",!1,null),s=v.getNode(),u={context:s.nodeName.toLowerCase()},c=o.parse(i,u),m=c.lastChild,"mce_marker"==m.attr("id"))for(d=m,m=m.prev;m;m=m.walk(!0))if(3==m.type||!g.isBlock(m.name)){m.parent.insert(d,m,"br"===m.name);break}if(u.invalid){for(v.setContent(y),s=v.getNode(),l=r.getBody(),9==s.nodeType?s=m=l:m=s;m!==l;)s=m,m=m.parentNode;i=s==l?l.innerHTML:g.getOuterHTML(s),i=a.serialize(o.parse(i.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,function(){return a.serialize(c)}))),s==l?g.setHTML(l,i):g.setOuterHTML(s,i)}else i=a.serialize(c),m=s.firstChild,b=s.lastChild,!m||m===b&&"BR"===m.nodeName?g.setHTML(s,i):v.setContent(i);d=g.get("mce_marker"),h=g.getRect(d),p=g.getViewPort(r.getWin()),(h.y+h.h>p.y+p.h||h.y<p.y||h.x>p.x+p.w||h.x<p.x)&&(w=e.isIE?r.getDoc().documentElement:r.getBody(),w.scrollLeft=h.x,w.scrollTop=h.y-p.h+25),f=g.createRng(),m=d.previousSibling,m&&3==m.nodeType?f.setStart(m,m.nodeValue.length):(f.setStartBefore(d),f.setEndBefore(d)),g.remove(d),v.setRng(f),v.onSetContent.dispatch(v,u),r.addVisual()},mceInsertRawHTML:function(e,t,n){v.setContent("tiny_mce_marker"),r.setContent(r.getContent().replace(/tiny_mce_marker/g,function(){return n}))},mceToggleFormat:function(e,t,n){h(n)},mceSetContent:function(e,t,n){r.setContent(n)},"Indent,Outdent":function(e){var t,i,o;t=y.indentation,i=/[a-z%]+$/i.exec(t),t=parseInt(t),s("InsertUnorderedList")||s("InsertOrderedList")?u(e):(y.forced_root_block||g.getParent(v.getNode(),g.isBlock)||w.apply("div"),n(v.getSelectedBlocks(),function(n){"outdent"==e?(o=Math.max(0,parseInt(n.style.paddingLeft||0)-t),g.setStyle(n,"paddingLeft",o?o+i:"")):g.setStyle(n,"paddingLeft",parseInt(n.style.paddingLeft||0)+t+i)}))},mceRepaint:function(){if(e.isGecko)try{p(i),v.getSel()&&v.getSel().selectAllChildren(r.getBody()),v.collapse(i),f()}catch(t){}},mceToggleFormat:function(e,t,n){w.toggle(n)},InsertHorizontalRule:function(){r.execCommand("mceInsertContent",!1,"<hr />")},mceToggleVisualAid:function(){r.hasVisual=!r.hasVisual,r.addVisual()},mceReplaceContent:function(e,t,n){r.execCommand("mceInsertContent",!1,n.replace(/\{\$selection\}/g,v.getContent({format:"text"})))},mceInsertLink:function(e,t,n){var i;"string"==typeof n&&(n={href:n}),i=g.getParent(v.getNode(),"a"),n.href=n.href.replace(" ","%20"),i&&n.href||w.remove("link"),n.href&&w.apply("link",n,i)},selectAll:function(){var e=g.getRoot(),t=g.createRng();v.getRng().setStart?(t.setStart(e,0),t.setEnd(e,e.childNodes.length),v.setRng(t)):u("SelectAll")}}),c({"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(t){var n="align"+t.substring(7),o=v.isCollapsed()?[g.getParent(v.getNode(),g.isBlock)]:v.getSelectedBlocks(),r=e.map(o,function(e){return!!w.matchNode(e,n)});return-1!==e.inArray(r,i)},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(e){return d(e)},mceBlockQuote:function(){return d("blockquote")},Outdent:function(){var e;if(y.inline_styles){if((e=g.getParent(v.getStart(),g.isBlock))&&parseInt(e.style.paddingLeft)>0)return i;if((e=g.getParent(v.getEnd(),g.isBlock))&&parseInt(e.style.paddingLeft)>0)return i}return s("InsertUnorderedList")||s("InsertOrderedList")||!y.inline_styles&&!!g.getParent(v.getNode(),"BLOCKQUOTE")},"InsertUnorderedList,InsertOrderedList":function(e){var t=g.getParent(v.getNode(),"ul,ol");return t&&("insertunorderedlist"===e&&"UL"===t.tagName||"insertorderedlist"===e&&"OL"===t.tagName)}},"state"),c({"FontSize,FontName":function(e){var t,n=0;return(t=g.getParent(v.getNode(),"span"))&&(n="fontsize"==e?t.style.fontSize:t.style.fontFamily.replace(/, /g,",").replace(/[\'\"]/g,"").toLowerCase()),n}},"value"),c({Undo:function(){r.undoManager.undo()},Redo:function(){r.undoManager.redo()}})}}(tinymce),function(e){var t=e.util.Dispatcher;e.UndoManager=function(n){function i(){return e.trim(n.getContent({format:"raw",no_events:1}).replace(/<span[^>]+data-mce-bogus[^>]+>[\u200B\uFEFF]+<\/span>/g,""))}function o(){r.typing=!1,r.add()}var r,a,s,l,c,u=0,d=[];return onBeforeAdd=new t(r),s=new t(r),l=new t(r),c=new t(r),s.add(function(e,t){return e.hasUndo()?n.onChange.dispatch(n,t,e):void 0}),l.add(function(e,t){return n.onUndo.dispatch(n,t,e)}),c.add(function(e,t){return n.onRedo.dispatch(n,t,e)}),n.onInit.add(function(){r.add()}),n.onBeforeExecCommand.add(function(e,t,n,i,o){"Undo"==t||"Redo"==t||"mceRepaint"==t||o&&o.skip_undo||r.beforeChange()}),n.onExecCommand.add(function(e,t,n,i,o){"Undo"==t||"Redo"==t||"mceRepaint"==t||o&&o.skip_undo||r.add()}),n.onSaveContent.add(o),n.dom.bind(n.dom.getRoot(),"dragend",o),n.dom.bind(n.getDoc(),e.isGecko?"blur":"focusout",function(){!n.removed&&r.typing&&o()}),n.onKeyUp.add(function(e,t){var n=t.keyCode;(n>=33&&36>=n||n>=37&&40>=n||45==n||13==n||t.ctrlKey)&&o()}),n.onKeyDown.add(function(e,t){var n=t.keyCode;return n>=33&&36>=n||n>=37&&40>=n||45==n?(r.typing&&o(),void 0):((16>n||n>20)&&224!=n&&91!=n&&!r.typing&&(r.beforeChange(),r.typing=!0,r.add()),void 0)}),n.onMouseDown.add(function(){r.typing&&o()}),n.addShortcut("ctrl+z","undo_desc","Undo"),n.addShortcut("ctrl+y","redo_desc","Redo"),r={data:d,typing:!1,onBeforeAdd:onBeforeAdd,onAdd:s,onUndo:l,onRedo:c,beforeChange:function(){a=n.selection.getBookmark(2,!0)},add:function(e){var t,o,s=n.settings;if(e=e||{},e.content=i(),r.onBeforeAdd.dispatch(r,e),o=d[u],o&&o.content==e.content)return null;if(d[u]&&(d[u].beforeBookmark=a),s.custom_undo_redo_levels&&d.length>s.custom_undo_redo_levels){for(t=0;d.length-1>t;t++)d[t]=d[t+1];d.length--,u=d.length}return e.bookmark=n.selection.getBookmark(2,!0),d.length-1>u&&(d.length=u+1),d.push(e),u=d.length-1,r.onAdd.dispatch(r,e),n.isNotDirty=0,e},undo:function(){var e;return r.typing&&(r.add(),r.typing=!1),u>0&&(e=d[--u],n.setContent(e.content,{format:"raw"}),n.selection.moveToBookmark(e.beforeBookmark),r.onUndo.dispatch(r,e)),e},redo:function(){var e;return d.length-1>u&&(e=d[++u],n.setContent(e.content,{format:"raw"}),n.selection.moveToBookmark(e.bookmark),r.onRedo.dispatch(r,e)),e},clear:function(){d=[],u=0,r.typing=!1},hasUndo:function(){return u>0||this.typing},hasRedo:function(){return d.length-1>u&&!this.typing}}}}(tinymce),tinymce.ForceBlocks=function(e){function t(){var t,a,s,l,c,u,d,h,p,f=o.getStart(),m=e.getBody(),g=-16777215;if(f&&1===f.nodeType&&n.forced_root_block){for(;f&&f!=m;){if(r[f.nodeName])return;f=f.parentNode}for(t=o.getRng(),t.setStart?(a=t.startContainer,s=t.startOffset,l=t.endContainer,c=t.endOffset):(t.item&&(f=t.item(0),t=e.getDoc().body.createTextRange(),t.moveToElementText(f)),p=t.parentElement().ownerDocument===e.getDoc(),tmpRng=t.duplicate(),tmpRng.collapse(!0),s=-1*tmpRng.move("character",g),tmpRng.collapsed||(tmpRng=t.duplicate(),tmpRng.collapse(!1),c=-1*tmpRng.move("character",g)-s)),f=m.firstChild;f;)if(3===f.nodeType||1==f.nodeType&&!r[f.nodeName]){if(3===f.nodeType&&0==f.nodeValue.length){d=f,f=f.nextSibling,i.remove(d);continue}u||(u=i.create(n.forced_root_block),f.parentNode.insertBefore(u,f),h=!0),d=f,f=f.nextSibling,u.appendChild(d)}else u=null,f=f.nextSibling;if(h){if(t.setStart)t.setStart(a,s),t.setEnd(l,c),o.setRng(t);else if(p)try{t=e.getDoc().body.createTextRange(),t.moveToElementText(m),t.collapse(!0),t.moveStart("character",s),c>0&&t.moveEnd("character",c),t.select()}catch(v){}e.nodeChanged()}}}var n=e.settings,i=e.dom,o=e.selection,r=e.schema.getBlockElements();n.forced_root_block&&(e.onKeyUp.add(t),e.onNodeChange.add(t))},function(e){var t=(e.DOM,e.dom.Event),n=e.each,i=e.extend;e.create("tinymce.ControlManager",{ControlManager:function(t,i){var o=this;i=i||{},o.editor=t,o.controls={},o.onAdd=new e.util.Dispatcher(o),o.onPostRender=new e.util.Dispatcher(o),o.prefix=i.prefix||t.id+"_",o._cls={},o.onPostRender.add(function(){n(o.controls,function(e){e.postRender()})})},get:function(e){return this.controls[this.prefix+e]||this.controls[e]},setActive:function(e,t){var n=null;return(n=this.get(e))&&n.setActive(t),n},setDisabled:function(e,t){var n=null;return(n=this.get(e))&&n.setDisabled(t),n},add:function(e){var t=this;return e&&(t.controls[e.id]=e,t.onAdd.dispatch(e,t)),e},createControl:function(e){var t,i,o,r,a=this,s=a.editor;for(a.controlFactories||(a.controlFactories=[],n(s.plugins,function(e){e.createControl&&a.controlFactories.push(e)})),r=a.controlFactories,i=0,o=r.length;o>i;i++)if(t=r[i].createControl(e,a))return a.add(t);return"|"===e||"separator"===e?a.createSeparator():s.buttons&&(t=s.buttons[e])?a.createButton(e,t):a.add(t)},createDropMenu:function(t,n,o){var r,a,s,l,c=this,u=c.editor;return n=i({"class":"mceDropDown",constrain:u.settings.constrain_menus},n),n["class"]=n["class"]+" "+u.getParam("skin")+"Skin",(s=u.getParam("skin_variant"))&&(n["class"]+=" "+u.getParam("skin")+"Skin"+s.substring(0,1).toUpperCase()+s.substring(1)),n["class"]+="rtl"==u.settings.directionality?" mceRtl":"",t=c.prefix+t,l=o||c._cls.dropmenu||e.ui.DropMenu,r=c.controls[t]=new l(t,n),r.onAddItem.add(function(e,t){var n=t.settings;n.title=u.getLang(n.title,n.title),n.onclick||(n.onclick=function(){n.cmd&&u.execCommand(n.cmd,n.ui||!1,n.value)})}),u.onRemove.add(function(){r.destroy()}),e.isIE&&(r.onShowMenu.add(function(){u.focus(),a=u.selection.getBookmark(1)}),r.onHideMenu.add(function(){a&&(u.selection.moveToBookmark(a),a=0)})),c.add(r)},createListBox:function(n,o,r){function a(t){return t.settings.use_accessible_selects&&!e.isGecko}var s,l,c=this,u=c.editor;return c.get(n)?null:(o.title=u.translate(o.title),o.scope=o.scope||u,o.onselect||(o.onselect=function(e){u.execCommand(o.cmd,o.ui||!1,e||o.value)}),o=i({title:o.title,"class":"mce_"+n,scope:o.scope,control_manager:c},o),n=c.prefix+n,u.settings.use_native_selects||a(u)?s=new e.ui.NativeListBox(n,o):(l=r||c._cls.listbox||e.ui.ListBox,s=new l(n,o,u)),c.controls[n]=s,e.isWebKit&&s.onPostRender.add(function(e,n){t.add(n,"mousedown",function(){u.bookmark=u.selection.getBookmark(1)}),t.add(n,"focus",function(){u.selection.moveToBookmark(u.bookmark),u.bookmark=null})}),s.hideMenu&&u.onMouseDown.add(s.hideMenu,s),c.add(s))},createButton:function(t,n,o){var r,a,s=this,l=s.editor;return s.get(t)?null:(n.title=l.translate(n.title),n.label=l.translate(n.label),n.scope=n.scope||l,n.onclick||n.menu_button||(n.onclick=function(){l.execCommand(n.cmd,n.ui||!1,n.value)}),n=i({title:n.title,"class":"mce_"+t,unavailable_prefix:l.getLang("unavailable",""),scope:n.scope,control_manager:s},n),t=s.prefix+t,n.menu_button?(a=o||s._cls.menubutton||e.ui.MenuButton,r=new a(t,n,l),l.onMouseDown.add(r.hideMenu,r)):(a=s._cls.button||e.ui.Button,r=new a(t,n,l)),s.add(r))},createMenuButton:function(e,t,n){return t=t||{},t.menu_button=1,this.createButton(e,t,n)},createSplitButton:function(t,n,o){var r,a,s=this,l=s.editor;return s.get(t)?null:(n.title=l.translate(n.title),n.scope=n.scope||l,n.onclick||(n.onclick=function(e){l.execCommand(n.cmd,n.ui||!1,e||n.value)}),n.onselect||(n.onselect=function(e){l.execCommand(n.cmd,n.ui||!1,e||n.value)}),n=i({title:n.title,"class":"mce_"+t,scope:n.scope,control_manager:s},n),t=s.prefix+t,a=o||s._cls.splitbutton||e.ui.SplitButton,r=s.add(new a(t,n,l)),l.onMouseDown.add(r.hideMenu,r),r)},createColorSplitButton:function(t,n,o){var r,a,s,l=this,c=l.editor;return l.get(t)?null:(n.title=c.translate(n.title),n.scope=n.scope||c,n.onclick||(n.onclick=function(t){e.isIE&&(s=c.selection.getBookmark(1)),c.execCommand(n.cmd,n.ui||!1,t||n.value)}),n.onselect||(n.onselect=function(e){c.execCommand(n.cmd,n.ui||!1,e||n.value)}),n=i({title:n.title,"class":"mce_"+t,menu_class:c.getParam("skin")+"Skin",scope:n.scope,more_colors_title:c.getLang("more_colors")},n),t=l.prefix+t,a=o||l._cls.colorsplitbutton||e.ui.ColorSplitButton,r=new a(t,n,c),c.onMouseDown.add(r.hideMenu,r),c.onRemove.add(function(){r.destroy()}),e.isIE&&(r.onShowMenu.add(function(){c.focus(),s=c.selection.getBookmark(1)}),r.onHideMenu.add(function(){s&&(c.selection.moveToBookmark(s),s=0)})),l.add(r))},createToolbar:function(t,n,i){var o,r,a=this;return t=a.prefix+t,r=i||a._cls.toolbar||e.ui.Toolbar,o=new r(t,n,a.editor),a.get(t)?null:a.add(o)},createToolbarGroup:function(t,n,i){var o,r,a=this;return t=a.prefix+t,r=i||this._cls.toolbarGroup||e.ui.ToolbarGroup,o=new r(t,n,a.editor),a.get(t)?null:a.add(o)},createSeparator:function(t){var n=t||this._cls.separator||e.ui.Separator;return new n},setControlType:function(e,t){return this._cls[e.toLowerCase()]=t},destroy:function(){n(this.controls,function(e){e.destroy()}),this.controls=null}})}(tinymce),function(e){var t=e.util.Dispatcher,n=e.each,i=e.isIE,o=e.isOpera;e.create("tinymce.WindowManager",{WindowManager:function(e){var n=this;n.editor=e,n.onOpen=new t(n),n.onClose=new t(n),n.params={},n.features={}},open:function(t,r){var a,s,l,c,u=this,d="",h="modal"==u.editor.settings.dialog_type,p=e.DOM.getViewPort();t=t||{},r=r||{},s=o?p.w:screen.width,l=o?p.h:screen.height,t.name=t.name||"mc_"+(new Date).getTime(),t.width=parseInt(t.width||320),t.height=parseInt(t.height||240),t.resizable=!0,t.left=t.left||parseInt(s/2)-t.width/2,t.top=t.top||parseInt(l/2)-t.height/2,r.inline=!1,r.mce_width=t.width,r.mce_height=t.height,r.mce_auto_focus=t.auto_focus,h&&i&&(t.center=!0,t.help=!1,t.dialogWidth=t.width+"px",t.dialogHeight=t.height+"px",t.scroll=t.scrollbars||!1),n(t,function(t,n){e.is(t,"boolean")&&(t=t?"yes":"no"),/^(name|url)$/.test(n)||(d+=i&&h?(d?";":"")+n+":"+t:(d?",":"")+n+"="+t)}),u.features=t,u.params=r,u.onOpen.dispatch(u,t,r),c=t.url||t.file,c=e._addVer(c);try{i&&h?(a=1,window.showModalDialog(c,window,d)):a=window.open(c,t.name,d)}catch(f){}a||alert(u.editor.getLang("popup_blocked"))},close:function(e){e.close(),this.onClose.dispatch(this)},createInstance:function(t,n,i,o,r,a){var s=e.resolve(t);return new s(n,i,o,r,a)},confirm:function(e,t,n,i){i=i||window,t.call(n||this,i.confirm(this._decode(this.editor.getLang(e,e))))},alert:function(e,t,n,i){var o=this;i=i||window,i.alert(o._decode(o.editor.getLang(e,e))),t&&t.call(n||o)},resizeBy:function(e,t,n){n.resizeBy(e,t)},_decode:function(t){return e.DOM.decode(t).replace(/\\n/g,"\n")}})}(tinymce),function(e){e.Formatter=function(t){function n(e,t){return j.getParents(e,t,j.getRoot())}function i(e){return 1===e.nodeType&&"_mce_caret"===e.id}function o(){s({alignleft:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"left"},defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{"float":"left"}}],aligncenter:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"center"},defaultBlock:"div"},{selector:"img",collapsed:!1,styles:{display:"block",marginLeft:"auto",marginRight:"auto"}},{selector:"table",collapsed:!1,styles:{marginLeft:"auto",marginRight:"auto"}}],alignright:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"right"},defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{"float":"right"}}],alignfull:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"justify"},defaultBlock:"div"}],bold:[{inline:"strong",remove:"all"},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all"}],italic:[{inline:"em",remove:"all"},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all"}],underline:[{inline:"span",styles:{textDecoration:"underline"},exact:!0},{inline:"u",remove:"all"}],strikethrough:[{inline:"span",styles:{textDecoration:"line-through"},exact:!0},{inline:"strike",remove:"all"}],forecolor:{inline:"span",styles:{color:"%value"},wrap_links:!1},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},wrap_links:!1},fontname:{inline:"span",styles:{fontFamily:"%value"}},fontsize:{inline:"span",styles:{fontSize:"%value"}},fontsize_class:{inline:"span",attributes:{"class":"%value"}},blockquote:{block:"blockquote",wrapper:1,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},link:{inline:"a",selector:"a",remove:"all",split:!0,deep:!0,onmatch:function(){return!0},onformat:function(e,t,n){R(n,function(t,n){j.setAttrib(e,n,t)})}},removeformat:[{selector:"b,strong,em,i,font,u,strike",remove:"all",split:!0,expand:!1,block_expand:!0,deep:!0},{selector:"span",attributes:["style","class"],remove:"empty",split:!0,expand:!1,deep:!0},{selector:"*",attributes:["style","class"],split:!1,expand:!1,deep:!0}]}),R("p h1 h2 h3 h4 h5 h6 div address pre div code dt dd samp".split(/\s/),function(e){s(e,{block:e,remove:"all"})}),s(t.settings.formats)}function r(){t.addShortcut("ctrl+b","bold_desc","Bold"),t.addShortcut("ctrl+i","italic_desc","Italic"),t.addShortcut("ctrl+u","underline_desc","Underline");for(var e=1;6>=e;e++)t.addShortcut("ctrl+"+e,"",["FormatBlock",!1,"h"+e]);t.addShortcut("ctrl+7","",["FormatBlock",!1,"p"]),t.addShortcut("ctrl+8","",["FormatBlock",!1,"div"]),t.addShortcut("ctrl+9","",["FormatBlock",!1,"address"])}function a(e){return e?L[e]:L}function s(e,t){e&&("string"!=typeof e?R(e,function(e,t){s(t,e)}):(t=t.length?t:[t],R(t,function(e){e.deep===I&&(e.deep=!e.selector),e.split===I&&(e.split=!e.selector||e.inline),e.remove===I&&e.selector&&!e.inline&&(e.remove="none"),e.selector&&e.inline&&(e.mixed=!0,e.block_expand=!0),"string"==typeof e.classes&&(e.classes=e.classes.split(/\s+/))}),L[e]=t))}function l(n,o,r){function s(e,t){t=t||b,e&&(t.onformat&&t.onformat(e,t,o,r),R(t.styles,function(t,n){j.setStyle(e,n,y(t,o))}),R(t.attributes,function(t,n){j.setAttrib(e,n,y(t,o))}),R(t.classes,function(t){t=y(t,o),j.hasClass(e,t)||j.addClass(e,t)}))}function c(){function e(e,t){var n=new O(t);for(r=n.current();r;r=n.prev())if(r.childNodes.length>1||r==e||"BR"==r.tagName)return r}var n=t.selection.getRng(),i=n.startContainer,o=n.endContainer;if(i!=o&&0===n.endOffset){var a=e(i,o),s=3==a.nodeType?a.length:a.childNodes.length;n.setEnd(a,s)}return n}function u(t,n,i,o,r){var a,s,l=[],c=-1,u=-1,d=-1;return R(t.childNodes,function(e,t){return"UL"===e.nodeName||"OL"===e.nodeName?(c=t,a=e,!1):void 0}),R(t.childNodes,function(e,t){"SPAN"===e.nodeName&&"bookmark"==j.getAttrib(e,"data-mce-type")&&(e.id==n.id+"_start"?u=t:e.id==n.id+"_end"&&(d=t))}),0>=c||c>u&&d>c?(R(e.grep(t.childNodes),r),0):(s=j.clone(i,V),R(e.grep(t.childNodes),function(e,t){(c>u&&c>t||u>c&&t>c)&&(l.push(e),e.parentNode.removeChild(e))}),c>u?t.insertBefore(s,a):u>c&&t.insertBefore(s,a.nextSibling),o.push(s),R(l,function(e){s.appendChild(e)}),s)}function h(t,r,a){var l,c,h=[],p=!0;l=b.inline||b.block,c=j.create(l),s(c),B.walk(t,function(t){function f(t){var y,w,k,_,C;return C=p,y=t.nodeName.toLowerCase(),w=t.parentNode.nodeName.toLowerCase(),1===t.nodeType&&G(t)&&(C=p,p="true"===G(t),_=!0),v(y,"br")?(g=0,b.block&&j.remove(t),void 0):b.wrapper&&d(t,n,o)?(g=0,void 0):p&&!_&&b.block&&!b.wrapper&&D(y)?(t=j.rename(t,l),s(t),h.push(t),g=0,void 0):b.selector&&(R(m,function(e){"collapsed"in e&&e.collapsed!==x||j.is(t,e.selector)&&!i(t)&&(s(t,e),k=!0)}),!b.inline||k)?(g=0,void 0):(p&&!_&&H(l,y)&&H(w,l)&&(a||3!==t.nodeType||1!==t.nodeValue.length||65279!==t.nodeValue.charCodeAt(0))&&!i(t)?(g||(g=j.clone(c,V),t.parentNode.insertBefore(g,t),h.push(g)),g.appendChild(t)):"li"==y&&r?g=u(t,r,c,h,f):(g=0,R(e.grep(t.childNodes),f),_&&(p=C),g=0),void 0)}var g;R(t,f)}),b.wrap_links===!1&&R(h,function(t){function n(t){var i,o,r;if("A"===t.nodeName){for(o=j.clone(c,V),h.push(o),r=e.grep(t.childNodes),i=0;r.length>i;i++)o.appendChild(r[i]);t.appendChild(o)}R(e.grep(t.childNodes),n)}n(t)}),R(h,function(e){function t(e){var t=0;return R(e.childNodes,function(e){w(e)||S(e)||t++}),t}function r(e){var t,n;return R(e.childNodes,function(e){return 1!=e.nodeType||S(e)||i(e)?void 0:(t=e,V)}),t&&g(t,b)&&(n=j.clone(t,V),s(n),j.replace(n,e,Q),j.remove(t,1)),n||e}var a;if(a=t(e),(h.length>1||!z(e))&&0===a)return j.remove(e,1),void 0;if(b.inline||b.wrapper){if(b.exact||1!==a||(e=r(e)),R(m,function(t){R(j.select(t.inline,e),function(e){var n;if(t.wrap_links===!1){n=e.parentNode;do if("A"===n.nodeName)return;while(n=n.parentNode)}_(t,o,e,t.exact?e:null)})}),d(e.parentNode,n,o))return j.remove(e,1),e=0,Q;b.merge_with_parents&&j.getParent(e.parentNode,function(t){return d(t,n,o)?(j.remove(e,1),e=0,Q):void 0}),e&&b.merge_siblings!==!1&&(e=E(T(e),e),e=E(e,T(e,Q)))}})}var p,f,m=a(n),b=m[0],x=F.isCollapsed();if(b)if(r)r.nodeType?(f=j.createRng(),f.setStartBefore(r),f.setEndAfter(r),h(k(f,m),null,!0)):h(r,null,!0);else if(x&&b.inline&&!j.select("td.mceSelected,th.mceSelected").length)N("apply",n,o);else{var C=t.selection.getNode();W||!m[0].defaultBlock||j.getParent(C,j.isBlock)||l(m[0].defaultBlock),t.selection.setRng(c()),p=F.getBookmark(),h(k(F.getRng(Q),m),p),b.styles&&(b.styles.color||b.styles.textDecoration)&&(e.walk(C,Y,"childNodes"),Y(C)),F.moveToBookmark(p),A(F.getRng(Q)),t.nodeChanged()}}function c(i,o,r){function s(t){var n,i,r,a,l;if(1===t.nodeType&&G(t)&&(a=y,y="true"===G(t),l=!0),n=e.grep(t.childNodes),y&&!l)for(i=0,r=v.length;r>i&&!_(v[i],o,t,t);i++);if(b.deep&&n.length){for(i=0,r=n.length;r>i;i++)s(n[i]);l&&(y=a)}}function l(e){var t;return R(n(e.parentNode).reverse(),function(e){var n;t||"_start"==e.id||"_end"==e.id||(n=d(e,i,o),n&&n.split!==!1&&(t=e))}),t}function c(e,t,n,i){var r,a,s,l,c,u;if(e){for(u=e.parentNode,r=t.parentNode;r&&r!=u;r=r.parentNode){for(a=j.clone(r,V),c=0;v.length>c;c++)if(_(v[c],o,a,a)){a=0;break}a&&(s&&a.appendChild(s),l||(l=a),s=a)}!i||b.mixed&&z(e)||(t=j.split(e,t)),s&&(n.parentNode.insertBefore(s,n),l.appendChild(n))}return t}function u(e){return c(l(e),e,e,!0)}function p(e){var t=j.get(e?"_start":"_end"),n=t[e?"firstChild":"lastChild"];return S(n)&&(n=n[e?"firstChild":"lastChild"]),j.remove(t,!0),n}function f(e){var n,i;e=k(e,v,Q),b.split&&(n=M(e,Q),i=M(e),n!=i?(/^(TR|TD)$/.test(n.nodeName)&&n.firstChild&&(n=("TD"==n.nodeName?n.firstChild:n.firstChild.firstChild)||n),n=x(n,"span",{id:"_start","data-mce-type":"bookmark"}),i=x(i,"span",{id:"_end","data-mce-type":"bookmark"}),u(n),u(i),n=p(Q),i=p()):n=i=u(n),e.startContainer=n.parentNode,e.startOffset=U(n),e.endContainer=i.parentNode,e.endOffset=U(i)+1),B.walk(e,function(e){R(e,function(e){s(e),1===e.nodeType&&"underline"===t.dom.getStyle(e,"text-decoration")&&e.parentNode&&"underline"===K(e.parentNode)&&_({deep:!1,exact:!0,inline:"span",styles:{textDecoration:"underline"}},null,e)})})}var m,g,v=a(i),b=v[0],y=!0;return r?(r.nodeType?(g=j.createRng(),g.setStartBefore(r),g.setEndAfter(r),f(g)):f(r),void 0):(F.isCollapsed()&&b.inline&&!j.select("td.mceSelected,th.mceSelected").length?N("remove",i,o):(m=F.getBookmark(),f(F.getRng(Q)),F.moveToBookmark(m),b.inline&&h(i,o,F.getStart())&&A(F.getRng(!0)),t.nodeChanged()),void 0)}function u(e,t,n){var i=a(e);!h(e,t,n)||"toggle"in i[0]&&!i[0].toggle?l(e,t,n):c(e,t,n)}function d(e,t,n,i){function o(e,t,o){var r,a,s,l=t[o];if(t.onmatch)return t.onmatch(e,t,o);if(l)if(l.length===I){for(r in l)if(l.hasOwnProperty(r)){if(a="attributes"===o?j.getAttrib(e,r):b(e,r),i&&!a&&!t.exact)return;if((!i||t.exact)&&!v(a,y(l[r],n)))return}}else for(s=0;l.length>s;s++)if("attributes"===o?j.getAttrib(e,l[s]):b(e,l[s]))return t;return t}var r,s,l,c=a(t);if(c&&e)for(s=0;c.length>s;s++)if(r=c[s],g(e,r)&&o(e,r,"attributes")&&o(e,r,"styles")){if(l=r.classes)for(s=0;l.length>s;s++)if(!j.hasClass(e,l[s]))return;return r}}function h(e,t,n){function i(n){return n=j.getParent(n,function(n){return!!d(n,e,t,!0)}),d(n,e,t)
}var o;return n?i(n):(n=F.getNode(),i(n)?Q:(o=F.getStart(),o!=n&&i(o)?Q:V))}function p(e,t){var n,i=[],o={};return n=F.getStart(),j.getParent(n,function(n){var r,a;for(r=0;e.length>r;r++)a=e[r],!o[a]&&d(n,a,t)&&(o[a]=!0,i.push(a))},j.getRoot()),i}function f(e){var t,i,o,r,s,l=a(e);if(l)for(t=F.getStart(),i=n(t),r=l.length-1;r>=0;r--){if(s=l[r].selector,!s)return Q;for(o=i.length-1;o>=0;o--)if(j.is(i[o],s))return Q}return V}function m(e,i,o){var r;return P||(P={},r={},t.onNodeChange.addToTop(function(e,t,i){var o=n(i),a={};R(P,function(e,t){R(o,function(n){return d(n,t,{},e.similar)?(r[t]||(R(e,function(e){e(!0,{node:n,format:t,parents:o})}),r[t]=e),a[t]=e,!1):void 0})}),R(r,function(e,t){a[t]||(delete r[t],R(e,function(e){e(!1,{node:i,format:t,parents:o})}))})})),R(e.split(","),function(e){P[e]||(P[e]=[],P[e].similar=o),P[e].push(i)}),this}function g(e,t){return v(e,t.inline)?Q:v(e,t.block)?Q:t.selector?j.is(e,t.selector):void 0}function v(e,t){return e=e||"",t=t||"",e=""+(e.nodeName||e),t=""+(t.nodeName||t),e.toLowerCase()==t.toLowerCase()}function b(e,t){var n=j.getStyle(e,t);return("color"==t||"backgroundColor"==t)&&(n=j.toHex(n)),"fontWeight"==t&&700==n&&(n="bold"),""+n}function y(e,t){return"string"!=typeof e?e=e(t):t&&(e=e.replace(/%(\w+)/g,function(e,n){return t[n]||e})),e}function w(e){return e&&3===e.nodeType&&/^([\t \r\n]+|)$/.test(e.nodeValue)}function x(e,t,n){var i=j.create(t,n);return e.parentNode.insertBefore(i,e),i.appendChild(e),i}function k(e,i,o){function r(e){var t,n,o,r,a;if(t=n=e?f:g,r=e?"previousSibling":"nextSibling",a=j.getRoot(),3==t.nodeType&&!w(t)&&(e?m>0:t.nodeValue.length>b))return t;for(;;){if(!i[0].block_expand&&z(n))return n;for(o=n[r];o;o=o[r])if(!S(o)&&!w(o))return n;if(n.parentNode==a){t=n;break}n=n.parentNode}return t}function a(e,t){for(t===I&&(t=3===e.nodeType?e.length:e.childNodes.length);e&&e.hasChildNodes();)e=e.childNodes[t],e&&(t=3===e.nodeType?e.length:e.childNodes.length);return{node:e,offset:t}}function s(e){for(var t=e;t;){if(1===t.nodeType&&G(t))return"false"===G(t)?t:e;t=t.parentNode}return e}function l(e,n,i){function r(e,t){var n,r,a=e.nodeValue;return t===void 0&&(t=i?a.length:0),i?(n=a.lastIndexOf(" ",t),r=a.lastIndexOf(" ",t),n=n>r?n:r,-1===n||o||n++):(n=a.indexOf(" ",t),r=a.indexOf(" ",t),n=-1!==n&&(-1===r||r>n)?n:r),n}var a,s,l,c;if(3===e.nodeType){if(l=r(e,n),-1!==l)return{container:e,offset:l};c=e}for(a=new O(e,j.getParent(e,z)||t.getBody());s=a[i?"prev":"next"]();)if(3===s.nodeType){if(c=s,l=r(s),-1!==l)return{container:s,offset:l}}else if(z(s))break;return c?(n=i?0:c.length,{container:c,offset:n}):void 0}function c(t,o){var r,a,s,l;for(3==t.nodeType&&0===t.nodeValue.length&&t[o]&&(t=t[o]),r=n(t),a=0;r.length>a;a++)for(s=0;i.length>s;s++)if(l=i[s],!("collapsed"in l&&l.collapsed!==e.collapsed)&&j.is(r[a],l.selector))return r[a];return t}function u(e,t){var o;if(i[0].wrapper||(o=j.getParent(e,i[0].block)),o||(o=j.getParent(3==e.nodeType?e.parentNode:e,z)),o&&i[0].wrapper&&(o=n(o,"ul,ol").reverse()[0]||o),!o)for(o=e;o[t]&&!z(o[t])&&(o=o[t],!v(o,"br")););return o||e}var d,h,p,f=e.startContainer,m=e.startOffset,g=e.endContainer,b=e.endOffset;if(1==f.nodeType&&f.hasChildNodes()&&(d=f.childNodes.length-1,f=f.childNodes[m>d?d:m],3==f.nodeType&&(m=0)),1==g.nodeType&&g.hasChildNodes()&&(d=g.childNodes.length-1,g=g.childNodes[b>d?d:b-1],3==g.nodeType&&(b=g.nodeValue.length)),f=s(f),g=s(g),(S(f.parentNode)||S(f))&&(f=S(f)?f:f.parentNode,f=f.nextSibling||f,3==f.nodeType&&(m=0)),(S(g.parentNode)||S(g))&&(g=S(g)?g:g.parentNode,g=g.previousSibling||g,3==g.nodeType&&(b=g.length)),i[0].inline&&(e.collapsed&&(p=l(f,m,!0),p&&(f=p.container,m=p.offset),p=l(g,b),p&&(g=p.container,b=p.offset)),h=a(g,b),h.node)){for(;h.node&&0===h.offset&&h.node.previousSibling;)h=a(h.node.previousSibling);h.node&&h.offset>0&&3===h.node.nodeType&&" "===h.node.nodeValue.charAt(h.offset-1)&&h.offset>1&&(g=h.node,g.splitText(h.offset-1))}return(i[0].inline||i[0].block_expand)&&(i[0].inline&&3==f.nodeType&&0!==m||(f=r(!0)),i[0].inline&&3==g.nodeType&&b!==g.nodeValue.length||(g=r())),i[0].selector&&i[0].expand!==V&&!i[0].inline&&(f=c(f,"previousSibling"),g=c(g,"nextSibling")),(i[0].block||i[0].selector)&&(f=u(f,"previousSibling"),g=u(g,"nextSibling"),i[0].block&&(z(f)||(f=r(!0)),z(g)||(g=r()))),1==f.nodeType&&(m=U(f),f=f.parentNode),1==g.nodeType&&(b=U(g)+1,g=g.parentNode),{startContainer:f,startOffset:m,endContainer:g,endOffset:b}}function _(e,t,n,i){var o,r,a;if(!g(n,e))return V;if("all"!=e.remove)for(R(e.styles,function(e,o){e=y(e,t),"number"==typeof o&&(o=e,i=0),(!i||v(b(i,o),e))&&j.setStyle(n,o,""),a=1}),a&&""==j.getAttrib(n,"style")&&(n.removeAttribute("style"),n.removeAttribute("data-mce-style")),R(e.attributes,function(e,o){var r;if(e=y(e,t),"number"==typeof o&&(o=e,i=0),!i||v(j.getAttrib(i,o),e)){if("class"==o&&(e=j.getAttrib(n,o),e&&(r="",R(e.split(/\s+/),function(e){/mce\w+/.test(e)&&(r+=(r?" ":"")+e)}),r)))return j.setAttrib(n,o,r),void 0;"class"==o&&n.removeAttribute("className"),q.test(o)&&n.removeAttribute("data-mce-"+o),n.removeAttribute(o)}}),R(e.classes,function(e){e=y(e,t),(!i||j.hasClass(i,e))&&j.removeClass(n,e)}),r=j.getAttribs(n),o=0;r.length>o;o++)if(0!==r[o].nodeName.indexOf("_"))return V;return"none"!=e.remove?(C(n,e),Q):void 0}function C(t,n){function i(e,t,n){return e=T(e,t,n),!e||"BR"==e.nodeName||z(e)}var o,r=t.parentNode;n.block&&(W?r==j.getRoot()&&(n.list_block&&v(t,n.list_block)||R(e.grep(t.childNodes),function(e){H(W,e.nodeName.toLowerCase())?o?o.appendChild(e):o=x(e,W):o=0})):z(t)&&!z(r)&&(i(t,V)||i(t.firstChild,Q,1)||t.insertBefore(j.create("br"),t.firstChild),i(t,Q)||i(t.lastChild,V,1)||t.appendChild(j.create("br")))),n.selector&&n.inline&&!v(n.inline,t)||j.remove(t,1)}function T(e,t,n){if(e)for(t=t?"nextSibling":"previousSibling",e=n?e:e[t];e;e=e[t])if(1==e.nodeType||!w(e))return e}function S(e){return e&&1==e.nodeType&&"bookmark"==e.getAttribute("data-mce-type")}function E(t,n){function i(e,t){function n(e){var t={};return R(j.getAttribs(e),function(n){var i=n.nodeName.toLowerCase();0!==i.indexOf("_")&&"style"!==i&&(t[i]=j.getAttrib(e,i))}),t}function i(e,t){var n,i;for(i in e)if(e.hasOwnProperty(i)){if(n=t[i],n===I)return V;if(e[i]!=n)return V;delete t[i]}for(i in t)if(t.hasOwnProperty(i))return V;return Q}return e.nodeName!=t.nodeName?V:i(n(e),n(t))?i(j.parseStyle(j.getAttrib(e,"style")),j.parseStyle(j.getAttrib(t,"style")))?Q:V:V}function o(e,t){for(r=e;r;r=r[t]){if(3==r.nodeType&&0!==r.nodeValue.length)return e;if(1==r.nodeType&&!S(r))return r}return e}var r,a;if(t&&n&&(t=o(t,"previousSibling"),n=o(n,"nextSibling"),i(t,n))){for(r=t.nextSibling;r&&r!=n;)a=r,r=r.nextSibling,t.appendChild(a);return j.remove(n),R(e.grep(n.childNodes),function(e){t.appendChild(e)}),t}return n}function D(e){return/^(h[1-6]|p|div|pre|address|dl|dt|dd)$/.test(e)}function M(e,n){var i,o,r;return i=e[n?"startContainer":"endContainer"],o=e[n?"startOffset":"endOffset"],1==i.nodeType&&(r=i.childNodes.length-1,!n&&o&&o--,i=i.childNodes[o>r?r:o]),3===i.nodeType&&n&&o>=i.nodeValue.length&&(i=new O(i,t.getBody()).next()||i),3!==i.nodeType||n||0!==o||(i=new O(i,t.getBody()).prev()||i),i}function N(n,i,o){function r(e){var n=j.create("span",{id:v,"data-mce-bogus":!0,style:b?"color:red":""});return e&&n.appendChild(t.getDoc().createTextNode($)),n}function s(e,t){for(;e;){if(3===e.nodeType&&e.nodeValue!==$||e.childNodes.length>1)return!1;t&&1===e.nodeType&&t.push(e),e=e.firstChild}return!0}function u(e){for(;e;){if(e.id===v)return e;e=e.parentNode}}function h(e){var t;if(e)for(t=new O(e,e),e=t.current();e;e=t.next())if(3===e.nodeType)return e}function p(e,t){var n,i;if(e)i=F.getRng(!0),s(e)?(t!==!1&&(i.setStartBefore(e),i.setEndBefore(e)),j.remove(e)):(n=h(e),n.nodeValue.charAt(0)===$&&(n=n.deleteData(0,1)),j.remove(e,1)),F.setRng(i);else if(e=u(F.getStart()),!e)for(;e=j.get(v);)p(e,!1)}function f(){var e,t,n,s,c,d,p;e=F.getRng(!0),s=e.startOffset,d=e.startContainer,p=d.nodeValue,t=u(F.getStart()),t&&(n=h(t)),p&&s>0&&p.length>s&&/\w/.test(p.charAt(s))&&/\w/.test(p.charAt(s-1))?(c=F.getBookmark(),e.collapse(!0),e=k(e,a(i)),e=B.split(e),l(i,o,e),F.moveToBookmark(c)):(t&&n.nodeValue===$?l(i,o,t):(t=r(!0),n=t.firstChild,e.insertNode(t),s=1,l(i,o,t)),F.setCursorLocation(n,s))}function m(){var e,t,n,s,l,u,h,p,f=F.getRng(!0),m=[];for(e=f.startContainer,t=f.startOffset,l=e,3==e.nodeType&&((t!=e.nodeValue.length||e.nodeValue===$)&&(s=!0),l=l.parentNode);l;){if(d(l,i,o)){u=l;break}l.nextSibling&&(s=!0),m.push(l),l=l.parentNode}if(u)if(s)n=F.getBookmark(),f.collapse(!0),f=k(f,a(i),!0),f=B.split(f),c(i,o,f),F.moveToBookmark(n);else{for(p=r(),l=p,h=m.length-1;h>=0;h--)l.appendChild(j.clone(m[h],!1)),l=l.firstChild;l.appendChild(j.doc.createTextNode($)),l=l.firstChild,j.insertAfter(p,u),F.setCursorLocation(l,1)}}function g(){var t;t=u(F.getStart()),t&&!j.isEmpty(t)&&e.walk(t,function(e){1!=e.nodeType||e.id===v||j.isEmpty(e)||j.setAttrib(e,"data-mce-bogus",null)},"childNodes")}var v="_mce_caret",b=t.settings.caret_debug;self._hasCaretEvents||(t.onBeforeGetContent.addToTop(function(){var e,t=[];if(s(u(F.getStart()),t))for(e=t.length;e--;)j.setAttrib(t[e],"data-mce-bogus","1")}),e.each("onMouseUp onKeyUp".split(" "),function(e){t[e].addToTop(function(){p(),g()})}),t.onKeyDown.addToTop(function(e,t){var n=t.keyCode;(8==n||37==n||39==n)&&p(u(F.getStart())),g()}),F.onSetContent.add(g),self._hasCaretEvents=!0),"apply"==n?f():m()}function A(e){var t,n,i,o,r,a=e.startContainer,s=e.startOffset;if(3==a.nodeType&&s>=a.nodeValue.length&&(s=U(a),a=a.parentNode,t=!0),1==a.nodeType)for(o=a.childNodes,a=o[Math.min(s,o.length-1)],n=new O(a,j.getParent(a,j.isBlock)),(s>o.length-1||t)&&n.next(),i=n.current();i;i=n.next())if(3==i.nodeType&&!w(i))return r=j.create("a",null,$),i.parentNode.insertBefore(r,i),e.setStart(i,0),F.setRng(e),j.remove(r),void 0}var P,I,L={},R=e.each,j=t.dom,F=t.selection,O=e.dom.TreeWalker,B=new e.dom.RangeUtils(j),H=t.schema.isValidChild,z=j.isBlock,W=t.settings.forced_root_block,U=j.nodeIndex,$="﻿",q=/^(src|href|style)$/,V=!1,Q=!0,G=j.getContentEditable,K=function(e){var n;return t.dom.getParent(e,function(e){return n=t.dom.getStyle(e,"text-decoration"),n&&"none"!==n}),n},Y=function(e){var n;1===e.nodeType&&e.parentNode&&1===e.parentNode.nodeType&&(n=K(e.parentNode),t.dom.getStyle(e,"color")&&n?t.dom.setStyle(e,"text-decoration",n):t.dom.getStyle(e,"textdecoration")===n&&t.dom.setStyle(e,"text-decoration",null))};e.extend(this,{get:a,register:s,apply:l,remove:c,toggle:u,match:h,matchAll:p,matchNode:d,canApply:f,formatChanged:m}),o(),r()}}(tinymce),tinymce.onAddEditor.add(function(e,t){function n(t,n){e.each(n,function(e,n){e&&a.setStyle(t,n,e)}),a.rename(t,"span")}function i(n,i){a=n.dom,s.convert_fonts_to_spans&&e.each(a.select("font,u,strike",i.node),function(e){o[e.nodeName.toLowerCase()](t.dom,e)})}var o,r,a,s=t.settings;s.inline_styles&&(r=e.explode(s.font_size_legacy_values),o={font:function(e,t){n(t,{backgroundColor:t.style.backgroundColor,color:t.color,fontFamily:t.face,fontSize:r[parseInt(t.size,10)-1]})},u:function(e,t){n(t,{textDecoration:"underline"})},strike:function(e,t){n(t,{textDecoration:"line-through"})}},t.onPreProcess.add(i),t.onSetContent.add(i),t.onInit.add(function(){t.selection.onSetContent.add(i)}))}),function(e){var t=e.dom.TreeWalker;e.EnterKey=function(n){function i(i){function c(e){return e&&o.isBlock(e)&&!/^(TD|TH|CAPTION|FORM)$/.test(e.nodeName)&&!/^(fixed|absolute)/i.test(e.style.position)&&"true"!==o.getContentEditable(e)}function u(t){var n;e.isIE&&o.isBlock(t)&&(n=r.getRng(),t.appendChild(o.create("span",null," ")),r.select(t),t.lastChild.outerHTML="",r.setRng(n))}function d(e){for(var t,n=e,i=[];n=n.firstChild;){if(o.isBlock(n))return;1!=n.nodeType||l[n.nodeName.toLowerCase()]||i.push(n)}for(t=i.length;t--;)n=i[t],!n.hasChildNodes()||n.firstChild==n.lastChild&&""===n.firstChild.nodeValue?o.remove(n):"A"==n.nodeName&&" "===(n.innerText||n.textContent)&&o.remove(n)}function h(e){var i,a,s,c,u,d,h=e;if(s=o.createRng(),e.hasChildNodes()){for(i=new t(e,e);a=i.current();){if(3==a.nodeType){s.setStart(a,0),s.setEnd(a,0);break}if(l[a.nodeName.toLowerCase()]){s.setStartBefore(a),s.setEndBefore(a);break}h=a,a=i.next()}a||(s.setStart(h,0),s.setEnd(h,0))}else"BR"==e.nodeName?e.nextSibling&&o.isBlock(e.nextSibling)?((!E||9>E)&&(d=o.create("br"),e.parentNode.insertBefore(d,e)),s.setStartBefore(e),s.setEndBefore(e)):(s.setStartAfter(e),s.setEndAfter(e)):(s.setStart(e,0),s.setEnd(e,0));r.setRng(s),o.remove(d),u=o.getViewPort(n.getWin()),c=o.getPos(e).y,(u.y>c||c+25>u.y+u.h)&&n.getWin().scrollTo(0,u.y>c?c:c-u.h+25)}function p(t){var n,i,r,s=C;if(n=t||"TABLE"==P?o.create(t||L):S.cloneNode(!1),r=n,a.keep_styles!==!1)do/^(SPAN|STRONG|B|EM|I|FONT|STRIKE|U)$/.test(s.nodeName)&&(i=s.cloneNode(!1),o.setAttrib(i,"id",""),n.hasChildNodes()?(i.appendChild(n.firstChild),n.appendChild(i)):(r=i,n.appendChild(i)));while(s=s.parentNode);return e.isIE||(r.innerHTML="<br>"),n}function f(e){var n,i,o;if(3==C.nodeType&&(e?T>0:C.nodeValue.length>T))return!1;if(C.parentNode==S&&R&&!e)return!0;if(e&&1==C.nodeType&&C==S.firstChild)return!0;if("TABLE"===C.nodeName||C.previousSibling&&"TABLE"==C.previousSibling.nodeName)return R&&!e||!R&&e;for(n=new t(C,S),3==C.nodeType&&(e&&0==T?n.prev():e||T!=C.nodeValue.length||n.next());i=n.current();){if(1===i.nodeType){if(!i.getAttribute("data-mce-bogus")&&(o=i.nodeName.toLowerCase(),l[o]&&"br"!==o))return!1}else if(3===i.nodeType&&!/^[ \t\r\n]*$/.test(i.nodeValue))return!1;e?n.prev():n.next()}return!0}function m(e,t){var n,i,r,a,s,l=L||"P";if(i=o.getParent(e,o.isBlock),!i||!c(i)){if(i=i||_,!i.hasChildNodes())return n=o.create(l),i.appendChild(n),j.setStart(n,0),j.setEnd(n,0),n;for(a=e;a.parentNode!=i;)a=a.parentNode;for(;a&&!o.isBlock(a);)r=a,a=a.previousSibling;if(r){for(n=o.create(l),r.parentNode.insertBefore(n,r),a=r;a&&!o.isBlock(a);)s=a.nextSibling,n.appendChild(a),a=s;j.setStart(e,t),j.setEnd(e,t)}}return e}function g(){function e(e){for(var t=A[e?"firstChild":"lastChild"];t&&1!=t.nodeType;)t=t[e?"nextSibling":"previousSibling"];return t===S}M=L?p(L):o.create("BR"),e(!0)&&e()?o.replace(M,A):e(!0)?A.parentNode.insertBefore(M,A):e()?(o.insertAfter(M,A),u(M)):(k=j.cloneRange(),k.setStartAfter(S),k.setEndAfter(A),N=k.extractContents(),o.insertAfter(N,A),o.insertAfter(M,A)),o.remove(S),h(M),s.add()}function v(){for(var e,n=new t(C,S);e=n.current();){if("BR"==e.nodeName)return!0;e=n.next()}}function b(){var t,n;C&&3==C.nodeType&&T>=C.nodeValue.length&&(e.isIE||v()||(t=o.create("br"),j.insertNode(t),j.setStartAfter(t),j.setEndAfter(t),n=!0)),t=o.create("br"),j.insertNode(t),e.isIE&&"PRE"==P&&(!E||8>E)&&t.parentNode.insertBefore(o.doc.createTextNode("\r"),t),n?(j.setStartBefore(t),j.setEndBefore(t)):(j.setStartAfter(t),j.setEndAfter(t)),r.setRng(j),s.add()}function y(e){do 3===e.nodeType&&(e.nodeValue=e.nodeValue.replace(/^[\r\n]+/,"")),e=e.firstChild;while(e)}function w(e){var t,n,i=o.getRoot();for(t=e;t!==i&&"false"!==o.getContentEditable(t);)"true"===o.getContentEditable(t)&&(n=t),t=t.parentNode;return t!==i?n:i}function x(t){var n;e.isIE||(t.normalize(),n=t.lastChild,(!n||/^(left|right)$/gi.test(o.getStyle(n,"float",!0)))&&o.add(t,"br"))}var k,_,C,T,S,E,D,M,N,A,P,I,L,R,j=r.getRng(!0);if(!j.collapsed)return n.execCommand("Delete"),void 0;if(!i.isDefaultPrevented()&&(C=j.startContainer,T=j.startOffset,L=(a.force_p_newlines?"p":"")||a.forced_root_block,L=L?L.toUpperCase():"",E=o.doc.documentMode,D=i.shiftKey,1==C.nodeType&&C.hasChildNodes()&&(R=T>C.childNodes.length-1,C=C.childNodes[Math.min(T,C.childNodes.length-1)]||C,T=R&&3==C.nodeType?C.nodeValue.length:0),_=w(C))){if(s.beforeChange(),!o.isBlock(_)&&_!=o.getRoot())return(!L||D)&&b(),void 0;if((L&&!D||!L&&D)&&(C=m(C,T)),S=o.getParent(C,o.isBlock),A=S?o.getParent(S.parentNode,o.isBlock):null,P=S?S.nodeName.toUpperCase():"",I=A?A.nodeName.toUpperCase():"","LI"!=I||i.ctrlKey||(S=A,P=I),"LI"==P){if(!L&&D)return b(),void 0;if(o.isEmpty(S))return/^(UL|OL|LI)$/.test(A.parentNode.nodeName)?!1:(g(),void 0)}if("PRE"==P&&a.br_in_pre!==!1){if(!D)return b(),void 0}else if(!L&&!D&&"LI"!=P||L&&D)return b(),void 0;L=L||"P",f()?(M=/^(H[1-6]|PRE)$/.test(P)&&"HGROUP"!=I?p(L):p(),a.end_container_on_empty_block&&c(A)&&o.isEmpty(S)?M=o.split(A,S):o.insertAfter(M,S),h(M)):f(!0)?(M=S.parentNode.insertBefore(p(),S),u(M)):(k=j.cloneRange(),k.setEndAfter(S),N=k.extractContents(),y(N),M=N.firstChild,o.insertAfter(N,S),d(M),x(S),h(M)),o.setAttrib(M,"id",""),s.add()}}var o=n.dom,r=n.selection,a=n.settings,s=n.undoManager,l=n.schema.getNonEmptyElements();n.onKeyDown.add(function(e,t){13==t.keyCode&&i(t)!==!1&&t.preventDefault()})}}(tinymce),function(){function e(e,t){return e.getParam(t,n[t])}var t=tinymce.each,n={paste_auto_cleanup_on_paste:!0,paste_enable_default_filters:!0,paste_block_drop:!1,paste_retain_style_properties:"none",paste_strip_class_attributes:"mso",paste_remove_word_images:!0,paste_remove_spans:!1,paste_remove_styles:!1,paste_remove_styles_if_webkit:!0,paste_convert_middot_lists:!0,paste_convert_headers_to_strong:!1,paste_dialog_width:"450",paste_dialog_height:"400",paste_text_use_dialog:!1,paste_text_sticky:!1,paste_text_sticky_default:!1,paste_text_notifyalways:!1,paste_text_linebreaktype:"combined",paste_text_replacements:[[/\u2026/g,"..."],[/[\x93\x94\u201c\u201d]/g,'"'],[/[\x60\x91\x92\u2018\u2019]/g,"'"]]};tinymce.create("tinymce.plugins.PastePlugin",{init:function(n,i){function o(t,i){var o,r=n.dom;a.onPreProcess.dispatch(a,t),t.node=r.create("div",0,t.content),tinymce.isGecko&&(o=n.selection.getRng(!0),o.startContainer==o.endContainer&&3==o.startContainer.nodeType&&1===t.node.childNodes.length&&/^(p|h[1-6]|pre)$/i.test(t.node.firstChild.nodeName)&&-1===t.content.indexOf("__MCE_ITEM__")&&r.remove(t.node.firstChild,!0)),a.onPostProcess.dispatch(a,t),t.content=n.serializer.serialize(t.node,{getInner:1,forced_root_block:""}),!i&&n.pasteAsPlainText?(a._insertPlainText(t.content),e(n,"paste_text_sticky")||(n.pasteAsPlainText=!1,n.controlManager.setActive("pastetext",!1))):a._insert(t.content)}function r(e){function i(e){e.preventDefault()}var r,a,s,l,c,u,d=n.selection,h=n.dom,p=n.getBody();if((e.clipboardData||h.doc.dataTransfer)&&(u=(e.clipboardData||h.doc.dataTransfer).getData("Text"),n.pasteAsPlainText))return e.preventDefault(),o({content:h.encode(u).replace(/\r?\n/g,"<br />")}),void 0;if(!h.get("_mcePaste")){if(r=h.add(p,"div",{id:"_mcePaste","class":"mcePaste","data-mce-bogus":"1"},"﻿﻿"),p!=n.getDoc().body)c=h.getPos(n.selection.getStart(),p).y;else{var f=h.getViewPort(n.getWin());c=f.y+f.h/2}return h.setStyles(r,{position:"absolute",left:tinymce.isGecko?-40:0,top:c-25,width:1,height:1,overflow:"hidden"}),tinymce.isIE?(l=d.getRng(),s=h.doc.body.createTextRange(),s.moveToElementText(r),s.execCommand("Paste"),h.remove(r),"﻿﻿"===r.innerHTML?(n.execCommand("mcePasteWord"),e.preventDefault(),void 0):(d.setRng(l),d.setContent(""),setTimeout(function(){o({content:r.innerHTML})},0),tinymce.dom.Event.cancel(e))):(h.bind(n.getDoc(),"mousedown",i),h.bind(n.getDoc(),"keydown",i),a=n.selection.getRng(),r=r.firstChild,s=n.getDoc().createRange(),s.setStart(r,0),s.setEnd(r,2),d.setRng(s),window.setTimeout(function(){var e,r="";h.select("div.mcePaste > div.mcePaste").length?r="<p>"+h.encode(u).replace(/\r?\n\r?\n/g,"</p><p>").replace(/\r?\n/g,"<br />")+"</p>":(e=h.select("div.mcePaste"),t(e,function(e){var n=e.firstChild;n&&"DIV"==n.nodeName&&n.style.marginTop&&n.style.backgroundColor&&h.remove(n,1),t(h.select("span.Apple-style-span",e),function(e){h.remove(e,1)}),t(h.select("br[data-mce-bogus]",e),function(e){h.remove(e)}),"mcePaste"!=e.parentNode.className&&(r+=e.innerHTML)})),t(h.select("div.mcePaste"),function(e){h.remove(e)}),a&&d.setRng(a),o({content:r}),h.unbind(n.getDoc(),"mousedown",i),h.unbind(n.getDoc(),"keydown",i)},0),void 0)}}var a=this;a.editor=n,a.url=i,a.onPreProcess=new tinymce.util.Dispatcher(a),a.onPostProcess=new tinymce.util.Dispatcher(a),a.onPreProcess.add(a._preProcess),a.onPostProcess.add(a._postProcess),a.onPreProcess.add(function(e,t){n.execCallback("paste_preprocess",e,t)}),a.onPostProcess.add(function(e,t){n.execCallback("paste_postprocess",e,t)}),n.onKeyDown.addToTop(function(e,t){return(tinymce.isMac?t.metaKey:t.ctrlKey)&&86==t.keyCode||t.shiftKey&&45==t.keyCode?!1:void 0}),n.pasteAsPlainText=e(n,"paste_text_sticky_default"),n.addCommand("mceInsertClipboardContent",function(e,t){o(t,!0)}),e(n,"paste_text_use_dialog")||n.addCommand("mcePasteText",function(){var t=tinymce.util.Cookie;n.pasteAsPlainText=!n.pasteAsPlainText,n.controlManager.setActive("pastetext",n.pasteAsPlainText),n.pasteAsPlainText&&!t.get("tinymcePasteText")&&(e(n,"paste_text_sticky")?n.windowManager.alert(n.translate("paste.plaintext_mode_sticky")):n.windowManager.alert(n.translate("paste.plaintext_mode")),e(n,"paste_text_notifyalways")||t.set("tinymcePasteText","1",new Date((new Date).getFullYear()+1,12,31)))}),n.addButton("pastetext",{title:"paste.paste_text_desc",cmd:"mcePasteText"}),n.addButton("selectall",{title:"paste.selectall_desc",cmd:"selectall"}),e(n,"paste_auto_cleanup_on_paste")&&(tinymce.isOpera||/Firefox\/2/.test(navigator.userAgent)?n.onKeyDown.addToTop(function(e,t){((tinymce.isMac?t.metaKey:t.ctrlKey)&&86==t.keyCode||t.shiftKey&&45==t.keyCode)&&r(t)}):n.onPaste.addToTop(function(e,t){return r(t)})),n.onInit.add(function(){n.controlManager.setActive("pastetext",n.pasteAsPlainText),e(n,"paste_block_drop")&&n.dom.bind(n.getBody(),["dragend","dragover","draggesture","dragdrop","drop","drag"],function(e){return e.preventDefault(),e.stopPropagation(),!1})}),a._legacySupport()},getInfo:function(){return{longname:"Paste text/word",author:"Moxiecode Systems AB",authorurl:"/web/20130613001053/http://tinymce.moxiecode.com",infourl:"/web/20130613001053/http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/paste",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_preProcess:function(n,i){function o(e){t(e,function(e){c=e.constructor==RegExp?c.replace(e,""):c.replace(e[0],e[1])})}function r(e,t){if("all"===s)return"";var n=u(d(t.replace(/^(["'])(.*)\1$/,"$2")," "),function(e){return/^(?!mso)/i.test(e)});return n.length?' class="'+n.join(" ")+'"':""}var a,s,l=this.editor,c=i.content,u=tinymce.grep,d=tinymce.explode,h=tinymce.trim;if(0!=l.settings.paste_enable_default_filters){if(tinymce.isIE&&document.documentMode>=9&&/<(h[1-6r]|p|div|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|caption|blockquote|center|dl|dt|dd|dir|fieldset)/.test(i.content)&&(o([[/(?:<br>&nbsp;[\s\r\n]+|<br>)*(<\/?(h[1-6r]|p|div|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|caption|blockquote|center|dl|dt|dd|dir|fieldset)[^>]*>)(?:<br>&nbsp;[\s\r\n]+|<br>)*/g,"$1"]]),o([[/<br><br>/g,"<BR><BR>"],[/<br>/g," "],[/<BR><BR>/g,"<br>"]])),/class="?Mso|style="[^"]*\bmso-|w:WordDocument/i.test(c)||i.wordContent){i.wordContent=!0,o([/^\s*(&nbsp;)+/gi,/(&nbsp;|<br[^>]*>)+\s*$/gi]),e(l,"paste_convert_headers_to_strong")&&(c=c.replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>")),e(l,"paste_convert_middot_lists")&&o([[/<!--\[if !supportLists\]-->/gi,"$&__MCE_ITEM__"],[/(<span[^>]+(?:mso-list:|:\s*symbol)[^>]+>)/gi,"$1__MCE_ITEM__"],[/(<p[^>]+(?:MsoListParagraph)[^>]+>)/gi,"$1__MCE_ITEM__"]]),e(l,"paste_remove_word_images")&&o([/<img[^>]*>/gi]),o([/<!--[\s\S]+?-->/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi," "]]);do a=c.length,c=c.replace(/(<[a-z][^>]*\s)(?:id|name|language|type|on\w+|\w+:\w+)=(?:"[^"]*"|\w+)\s?/gi,"$1");while(a!=c.length);0==e(l,"paste_retain_style_properties").replace(/^none$/i,"").length?c=c.replace(/<\/?span[^>]*>/gi,""):o([[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(e,t){return t.length>0?t.replace(/./," ").slice(Math.floor(t.length/2)).split("").join(" "):""}],[/(<[a-z][^>]*)\sstyle="([^"]*)"/gi,function(e,n,i){var o=[],r=0,a=d(h(i).replace(/&quot;/gi,"'"),";");return t(a,function(e){function t(e){return e+("0"!==e&&/\d$/.test(e))?"px":""}var n,i,a=d(e,":");if(2==a.length){switch(n=a[0].toLowerCase(),i=a[1].toLowerCase(),n){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-table-layout-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":return o[r++]=n.replace(/^mso-|-alt$/g,"")+":"+t(i),void 0;case"horiz-align":return o[r++]="text-align:"+i,void 0;case"vert-align":return o[r++]="vertical-align:"+i,void 0;case"font-color":case"mso-foreground":return o[r++]="color:"+i,void 0;case"mso-background":case"mso-highlight":return o[r++]="background:"+i,void 0;case"mso-default-height":return o[r++]="min-height:"+t(i),void 0;case"mso-default-width":return o[r++]="min-width:"+t(i),void 0;case"mso-padding-between-alt":return o[r++]="border-collapse:separate;border-spacing:"+t(i),void 0;case"text-line-through":return("single"==i||"double"==i)&&(o[r++]="text-decoration:line-through"),void 0;case"mso-zero-height":return"yes"==i&&(o[r++]="display:none"),void 0}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?!align|decor|indent|trans)|top-bar|version|vnd|word-break)/.test(n))return;o[r++]=n+":"+a[1]}}),r>0?n+' style="'+o.join(";")+'"':n}]])}e(l,"paste_convert_headers_to_strong")&&o([[/<h[1-6][^>]*>/gi,"<p><strong>"],[/<\/h[1-6][^>]*>/gi,"</strong></p>"]]),o([[/Version:[\d.]+\nStartHTML:\d+\nEndHTML:\d+\nStartFragment:\d+\nEndFragment:\d+/gi,""]]),s=e(l,"paste_strip_class_attributes"),"none"!==s&&(c=c.replace(/ class="([^"]+)"/gi,r),c=c.replace(/ class=([\-\w]+)/gi,r)),e(l,"paste_remove_spans")&&(c=c.replace(/<\/?span[^>]*>/gi,"")),i.content=c}},_postProcess:function(n,i){var o,r=this,a=r.editor,s=a.dom;0!=a.settings.paste_enable_default_filters&&(i.wordContent&&(t(s.select("a",i.node),function(e){e.href&&-1==e.href.indexOf("#_Toc")||s.remove(e,1)}),e(a,"paste_convert_middot_lists")&&r._convertLists(n,i),o=e(a,"paste_retain_style_properties"),tinymce.is(o,"string")&&"all"!==o&&"*"!==o&&(o=tinymce.explode(o.replace(/^none$/i,"")),t(s.select("*",i.node),function(e){var t,n,i,r={},a=0;if(o)for(t=0;o.length>t;t++)n=o[t],i=s.getStyle(e,n),i&&(r[n]=i,a++);s.setAttrib(e,"style",""),o&&a>0?s.setStyles(e,r):"SPAN"!=e.nodeName||e.className||s.remove(e,!0)}))),e(a,"paste_remove_styles")||e(a,"paste_remove_styles_if_webkit")&&tinymce.isWebKit?t(s.select("*[style]",i.node),function(e){e.removeAttribute("style"),e.removeAttribute("data-mce-style")}):tinymce.isWebKit&&t(s.select("*",i.node),function(e){e.removeAttribute("data-mce-style")}))},_convertLists:function(e,n){var i,o,r,a,s,l=e.editor.dom,c=-1,u=[];t(l.select("p",n.node),function(e){var n,s,d,h,p,f="";for(n=e.firstChild;n&&3==n.nodeType;n=n.nextSibling)f+=n.nodeValue;f=e.innerHTML.replace(/<\/?\w+[^>]*>/gi,"").replace(/&nbsp;/g," "),/^(__MCE_ITEM__)+[\u2022\u00b7\u00a7\u00d8o\u25CF]\s*\u00a0*/.test(f)&&(s="ul"),/^__MCE_ITEM__\s*\w+\.\s*\u00a0+/.test(f)&&(s="ol"),s?(r=parseFloat(e.style.marginLeft||0),r>c&&u.push(r),i&&s==a?r>c?i=o.appendChild(l.create(s)):c>r&&(h=tinymce.inArray(u,r),p=l.getParents(i.parentNode,s),i=p[p.length-1-h]||i):(i=l.create(s),l.insertAfter(i,e)),t(l.select("span",e),function(e){var t=e.innerHTML.replace(/<\/?\w+[^>]*>/gi,"");"ul"==s&&/^__MCE_ITEM__[\u2022\u00b7\u00a7\u00d8o\u25CF]/.test(t)?l.remove(e):/^__MCE_ITEM__[\s\S]*\w+\.(&nbsp;|\u00a0)*\s*/.test(t)&&l.remove(e)}),d=e.innerHTML,d="ul"==s?e.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^[\u2022\u00b7\u00a7\u00d8o\u25CF]\s*(&nbsp;|\u00a0)+\s*/,""):e.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^\s*\w+\.(&nbsp;|\u00a0)+\s*/,""),o=i.appendChild(l.create("li",0,d)),l.remove(e),c=r,a=s):i=c=0}),s=n.node.innerHTML,-1!=s.indexOf("__MCE_ITEM__")&&(n.node.innerHTML=s.replace(/__MCE_ITEM__/g,""))},_insert:function(e,t){var n=this.editor,i=n.selection.getRng();n.selection.isCollapsed()||i.startContainer==i.endContainer||n.getDoc().execCommand("Delete",!1,null),n.execCommand("mceInsertContent",!1,e,{skip_undo:t})},_insertPlainText:function(n){function i(e){t(e,function(e){n=e.constructor==RegExp?n.replace(e,""):n.replace(e[0],e[1])})}var o=this.editor,r=e(o,"paste_text_linebreaktype"),a=e(o,"paste_text_replacements"),s=tinymce.is;"string"==typeof n&&n.length>0&&(/<(?:p|br|h[1-6]|ul|ol|dl|table|t[rdh]|div|blockquote|fieldset|pre|address|center)[^>]*>/i.test(n)?i([/[\n\r]+/g]):i([/\r+/g]),i([[/<\/(?:p|h[1-6]|ul|ol|dl|table|div|blockquote|fieldset|pre|address|center)>/gi,"\n\n"],[/<br[^>]*>|<\/tr>/gi,"\n"],[/<\/t[dh]>\s*<t[dh][^>]*>/gi,"	"],/<[a-z!\/?][^>]*>/gi,[/&nbsp;/gi," "],[/(?:(?!\n)\s)*(\n+)(?:(?!\n)\s)*/gi,"$1"],[/\n{3,}/g,"\n\n"]]),n=o.dom.decode(tinymce.html.Entities.encodeRaw(n)),s(a,"array")?i(a):s(a,"string")&&i(RegExp(a,"gi")),"none"==r?i([[/\n+/g," "]]):"br"==r?i([[/\n/g,"<br />"]]):"p"==r?i([[/\n+/g,"</p><p>"],[/^(.*<\/p>)(<p>)$/,"<p>$1"]]):i([[/\n\n/g,"</p><p>"],[/^(.*<\/p>)(<p>)$/,"<p>$1"],[/\n/g,"<br />"]]),o.execCommand("mceInsertContent",!1,n))},_legacySupport:function(){var t=this,n=t.editor;n.addCommand("mcePasteWord",function(){n.windowManager.open({file:t.url+"/pasteword.htm",width:parseInt(e(n,"paste_dialog_width")),height:parseInt(e(n,"paste_dialog_height")),inline:1})}),e(n,"paste_text_use_dialog")&&n.addCommand("mcePasteText",function(){n.windowManager.open({file:t.url+"/pastetext.htm",width:parseInt(e(n,"paste_dialog_width")),height:parseInt(e(n,"paste_dialog_height")),inline:1})}),n.addButton("pasteword",{title:"paste.paste_word_desc",cmd:"mcePasteWord"})}}),tinymce.PluginManager.add("paste",tinymce.plugins.PastePlugin)}(),function(e){e.fn.farbtastic=function(t){return e.farbtastic(this,t),this},e.farbtastic=function(t,n){var t=e(t).get(0);return t.farbtastic||(t.farbtastic=new e._farbtastic(t,n))},e._farbtastic=function(t,n){var i=this;e(t).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var o=e(".farbtastic",t);i.wheel=e(".wheel",t).get(0),i.radius=84,i.square=100,i.width=194,i.firstClick=!0,navigator.appVersion.match(/MSIE [0-6]\./)&&e("*",o).each(function(){if("none"!=this.currentStyle.backgroundImage){var t=this.currentStyle.backgroundImage;t=this.currentStyle.backgroundImage.substring(5,t.length-2),e(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+t+"')"})}}),i.linkTo=function(t){return"object"==typeof i.callback&&e(i.callback).unbind("keyup",i.updateValue),i.color=null,"function"==typeof t?i.callback=t:("object"==typeof t||"string"==typeof t)&&(i.callback=e(t),i.callback.bind("keyup",i.updateValue),i.callback.get(0).value&&i.setColor(i.callback.get(0).value)),this},i.updateValue=function(){this.value&&this.value!=i.color&&i.setColor(this.value)},i.setColor=function(e){var t=i.unpack(e);return i.color!=e&&t&&(i.color=e,i.rgb=t,i.hsl=i.RGBToHSL(i.rgb),i.updateDisplay()),this},i.setHSL=function(e){return i.hsl=e,i.rgb=i.HSLToRGB(e),i.color=i.pack(i.rgb),i.updateDisplay(),this},i.widgetCoords=function(t){var n=e(i.wheel).offset();return{x:t.pageX-n.left-i.width/2,y:t.pageY-n.top-i.width/2}},i.mousedown=function(t){document.dragging||(e(document).bind("mousemove",i.mousemove).bind("mouseup",i.mouseup),document.dragging=!0);var n=i.widgetCoords(t);return i.circleDrag=2*Math.max(Math.abs(n.x),Math.abs(n.y))>i.square,i.mousemove(t),!1},i.mousemove=function(e){var t=i.widgetCoords(e);if(i.circleDrag){var n=Math.atan2(t.x,-t.y)/6.28;0>n&&(n+=1),!i.firstClick||0!=i.hsl[2]&&1!=i.hsl[2]?i.setHSL([n,i.hsl[1],i.hsl[2]]):(i.firstClick=!1,i.setHSL([n,1,.5]))}else{var o=Math.max(0,Math.min(1,-(t.x/i.square)+.5)),r=Math.max(0,Math.min(1,-(t.y/i.square)+.5));i.setHSL([i.hsl[0],o,r])}return!1},i.mouseup=function(){e(document).unbind("mousemove",i.mousemove),e(document).unbind("mouseup",i.mouseup),document.dragging=!1
},i.updateDisplay=function(){var t=6.28*i.hsl[0];e(".h-marker",o).css({left:Math.round(Math.sin(t)*i.radius+i.width/2)+"px",top:Math.round(-Math.cos(t)*i.radius+i.width/2)+"px"}),e(".sl-marker",o).css({left:Math.round(i.square*(.5-i.hsl[1])+i.width/2)+"px",top:Math.round(i.square*(.5-i.hsl[2])+i.width/2)+"px"}),e(".color",o).css("backgroundColor",i.pack(i.HSLToRGB([i.hsl[0],1,.5]))),"object"==typeof i.callback?(e(i.callback).css({backgroundColor:i.color,color:i.hsl[2]>.5?"#000":"#fff"}),e(i.callback).each(function(){this.value&&this.value!=i.color&&(this.value=i.color)})):"function"==typeof i.callback&&i.callback.call(i,i.color)},i.pack=function(e){var t=Math.round(255*e[0]),n=Math.round(255*e[1]),i=Math.round(255*e[2]);return"#"+(16>t?"0":"")+t.toString(16)+(16>n?"0":"")+n.toString(16)+(16>i?"0":"")+i.toString(16)},i.unpack=function(e){return 7==e.length?[parseInt("0x"+e.substring(1,3))/255,parseInt("0x"+e.substring(3,5))/255,parseInt("0x"+e.substring(5,7))/255]:4==e.length?[parseInt("0x"+e.substring(1,2))/15,parseInt("0x"+e.substring(2,3))/15,parseInt("0x"+e.substring(3,4))/15]:void 0},i.HSLToRGB=function(e){var t,n,i=e[0],o=e[1],r=e[2];return n=.5>=r?r*(o+1):r+o-r*o,t=2*r-n,[this.hueToRGB(t,n,i+.33333),this.hueToRGB(t,n,i),this.hueToRGB(t,n,i-.33333)]},i.hueToRGB=function(e,t,n){return n=0>n?n+1:n>1?n-1:n,1>6*n?e+6*(t-e)*n:1>2*n?t:2>3*n?e+6*(t-e)*(.66666-n):e},i.RGBToHSL=function(e){var t,n,i,o,r,a,s=e[0],l=e[1],c=e[2];return t=Math.min(s,Math.min(l,c)),n=Math.max(s,Math.max(l,c)),i=n-t,a=(t+n)/2,r=0,a>0&&1>a&&(r=i/(.5>a?2*a:2-2*a)),o=0,i>0&&(n==s&&n!=l&&(o+=(l-c)/i),n==l&&n!=c&&(o+=2+(c-s)/i),n==c&&n!=s&&(o+=4+(s-l)/i),o/=6),[o,r,a]},e("*",o).mousedown(i.mousedown),i.setColor("#000000"),n&&i.linkTo(n)}}(jQuery),function(){function e(){this.returnValue=!1}function t(){this.cancelBubble=!0}var n,i,o=0,r=[],a={},s={},l={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},c=/[<>&\"\']/g,u=window.setTimeout,d={};(function(e){var t,n,i,o=e.split(/,/);for(t=0;o.length>t;t+=2)for(i=o[t+1].split(/ /),n=0;i.length>n;n++)s[i[n]]=o[t]})("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mpga mpega mp2 mp3,audio/x-wav,wav,audio/mp4,m4a,image/bmp,bmp,image/gif,gif,image/jpeg,jpeg jpg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/vnd.rn-realvideo,rv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe");var h={VERSION:"@@version@@",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:s,ua:function(){var e,t,n,i=navigator,o=i.userAgent,r=i.vendor;return e=/WebKit/.test(o),n=e&&-1!==r.indexOf("Apple"),t=window.opera&&window.opera.buildNumber,{windows:-1!==navigator.platform.indexOf("Win"),ie:!e&&!t&&/MSIE/gi.test(o)&&/Explorer/gi.test(i.appName),webkit:e,gecko:!e&&/Gecko/.test(o),safari:n,opera:!!t}}(),typeOf:function(e){return{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},extend:function(e){return h.each(arguments,function(t,n){n>0&&h.each(t,function(t,n){e[n]=t})}),e},cleanName:function(e){var t,n;for(n=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],t=0;n.length>t;t+=2)e=e.replace(n[t],n[t+1]);return e=e.replace(/\s+/g,"_"),e=e.replace(/[^a-z0-9_\-\.]+/gi,"")},addRuntime:function(e,t){return t.name=e,r[e]=t,r.push(t),t},guid:function(){var e,t=(new Date).getTime().toString(32);for(e=0;5>e;e++)t+=Math.floor(65535*Math.random()).toString(32);return(h.guidPrefix||"p")+t+(o++).toString(32)},buildUrl:function(e,t){var n="";return h.each(t,function(e,t){n+=(n?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)}),n&&(e+=(e.indexOf("?")>0?"&":"?")+n),e},each:function(e,t){var i,o,r;if(e)if(i=e.length,i===n){for(o in e)if(e.hasOwnProperty(o)&&t(e[o],o)===!1)return}else for(r=0;i>r;r++)if(t(e[r],r)===!1)return},formatSize:function(e){return e===n||/\D/.test(e)?h.translate("N/A"):e>1073741824?Math.round(e/1073741824,1)+" GB":e>1048576?Math.round(e/1048576,1)+" MB":e>1024?Math.round(e/1024,1)+" KB":e+" b"},getPos:function(e,t){function n(e){var t,n,i=0,o=0;return e&&(n=e.getBoundingClientRect(),t="CSS1Compat"===l.compatMode?l.documentElement:l.body,i=n.left+t.scrollLeft,o=n.top+t.scrollTop),{x:i,y:o}}var i,o,r,a=0,s=0,l=document;if(e=e,t=t||l.body,e&&e.getBoundingClientRect&&navigator.userAgent.indexOf("MSIE")>0&&8>l.documentMode)return o=n(e),r=n(t),{x:o.x-r.x,y:o.y-r.y};for(i=e;i&&i!=t&&i.nodeType;)a+=i.offsetLeft||0,s+=i.offsetTop||0,i=i.offsetParent;for(i=e.parentNode;i&&i!=t&&i.nodeType;)a-=i.scrollLeft||0,s-=i.scrollTop||0,i=i.parentNode;return{x:a,y:s}},getSize:function(e){return{w:e.offsetWidth||e.clientWidth,h:e.offsetHeight||e.clientHeight}},parseSize:function(e){var t;return"string"==typeof e&&(e=/^([0-9]+)([mgk]?)$/.exec(e.toLowerCase().replace(/[^0-9mkg]/g,"")),t=e[2],e=+e[1],"g"==t&&(e*=1073741824),"m"==t&&(e*=1048576),"k"==t&&(e*=1024)),e},xmlEncode:function(e){return e?(""+e).replace(c,function(e){return l[e]?"&"+l[e]+";":e}):e},toArray:function(e){var t,n=[];for(t=0;e.length>t;t++)n[t]=e[t];return n},inArray:function(e,t){if(t){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(t,e);for(var n=0,i=t.length;i>n;n++)if(t[n]===e)return n}return-1},addI18n:function(e){return h.extend(a,e)},translate:function(e){return a[e]||e},isEmptyObj:function(e){if(e===n)return!0;for(var t in e)return!1;return!0},hasClass:function(e,t){var n;return""==e.className?!1:(n=RegExp("(^|\\s+)"+t+"(\\s+|$)"),n.test(e.className))},addClass:function(e,t){h.hasClass(e,t)||(e.className=""==e.className?t:e.className.replace(/\s+$/,"")+" "+t)},removeClass:function(e,t){var n=RegExp("(^|\\s+)"+t+"(\\s+|$)");e.className=e.className.replace(n,function(e,t,n){return" "===t&&" "===n?" ":""})},getStyle:function(e,t){if(e.currentStyle)return e.currentStyle[t];if(window.getComputedStyle){var n=window.getComputedStyle(e,null);return n?n[t]:void 0}},addEvent:function(o,r,a){var s,l,c;c=arguments[3],r=r.toLowerCase(),i===n&&(i="Plupload_"+h.guid()),o.addEventListener?(s=a,o.addEventListener(r,s,!1)):o.attachEvent&&(s=function(){var n=window.event;n.target||(n.target=n.srcElement),n.preventDefault=e,n.stopPropagation=t,a(n)},o.attachEvent("on"+r,s)),o[i]===n&&(o[i]=h.guid()),d.hasOwnProperty(o[i])||(d[o[i]]={}),l=d[o[i]],l.hasOwnProperty(r)||(l[r]=[]),l[r].push({func:s,orig:a,key:c})},removeEvent:function(e,t){var o,r,a;if("function"==typeof arguments[2]?r=arguments[2]:a=arguments[2],t=t.toLowerCase(),e[i]&&d[e[i]]&&d[e[i]][t]){o=d[e[i]][t];for(var s=o.length-1;s>=0&&(o[s].key!==a&&o[s].orig!==r||(e.removeEventListener?e.removeEventListener(t,o[s].func,!1):e.detachEvent&&e.detachEvent("on"+t,o[s].func),o[s].orig=null,o[s].func=null,o.splice(s,1),r===n));s--);if(o.length||delete d[e[i]][t],h.isEmptyObj(d[e[i]])){delete d[e[i]];try{delete e[i]}catch(l){e[i]=n}}}},removeAllEvents:function(e){var t=arguments[1];e[i]!==n&&e[i]&&h.each(d[e[i]],function(n,i){h.removeEvent(e,i,t)})}};h.Uploader=function(e){function t(){var e,t,n=0;if(this.state==h.STARTED){for(t=0;l.length>t;t++)e||l[t].status!=h.QUEUED?n++:(e=l[t],e.status=h.UPLOADING,this.trigger("BeforeUpload",e)&&this.trigger("UploadFile",e));n==l.length&&(this.stop(),this.trigger("UploadComplete",l))}}function i(){var e,t;for(o.reset(),e=0;l.length>e;e++)t=l[e],t.size!==n?(o.size+=t.size,o.loaded+=t.loaded):o.size=n,t.status==h.DONE?o.uploaded++:t.status==h.FAILED?o.failed++:o.queued++;o.size===n?o.percent=l.length>0?Math.ceil(100*(o.uploaded/l.length)):0:(o.bytesPerSec=Math.ceil(o.loaded/((+new Date-a||1)/1e3)),o.percent=o.size>0?Math.ceil(100*(o.loaded/o.size)):0)}var o,a,s={},l=[],c=!1;o=new h.QueueProgress,e=h.extend({chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",filters:[]},e),h.extend(this,{state:h.STOPPED,runtime:"",features:{},files:l,settings:e,total:o,id:h.guid(),init:function(){function o(){var e,t,n,i=c[f++];if(i){if(e=i.getFeatures(),t=p.settings.required_features)for(t=t.split(","),n=0;t.length>n;n++)if(!e[t[n]])return o(),void 0;i.init(p,function(t){t&&t.success?(p.features=e,p.runtime=i.name,p.trigger("Init",{runtime:i.name}),p.trigger("PostInit"),p.refresh()):o()})}else p.trigger("Error",{code:h.INIT_ERROR,message:h.translate("Init error.")})}var s,c,d,p=this,f=0;if("function"==typeof e.preinit?e.preinit(p):h.each(e.preinit,function(e,t){p.bind(t,e)}),e.page_url=e.page_url||document.location.pathname.replace(/\/[^\/]+$/g,"/"),/^(\w+:\/\/|\/)/.test(e.url)||(e.url=e.page_url+e.url),e.chunk_size=h.parseSize(e.chunk_size),e.max_file_size=h.parseSize(e.max_file_size),p.bind("FilesAdded",function(t,i){var o,r,a,s=0,c=e.filters;for(c&&c.length&&(a=[],h.each(c,function(e){h.each(e.extensions.split(/,/),function(e){/^\s*\*\s*$/.test(e)?a.push("\\.*"):a.push("\\."+e.replace(RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),a=RegExp(a.join("|")+"$","i")),o=0;i.length>o;o++)r=i[o],r.loaded=0,r.percent=0,r.status=h.QUEUED,!a||a.test(r.name)?r.size!==n&&r.size>e.max_file_size?t.trigger("Error",{code:h.FILE_SIZE_ERROR,message:h.translate("File size error."),file:r}):(l.push(r),s++):t.trigger("Error",{code:h.FILE_EXTENSION_ERROR,message:h.translate("File extension error."),file:r});return s?(u(function(){p.trigger("QueueChanged"),p.refresh()},1),void 0):!1}),e.unique_names&&p.bind("UploadFile",function(e,t){var n=t.name.match(/\.([^.]+)$/),i="tmp";n&&(i=n[1]),t.target_name=t.id+"."+i}),p.bind("UploadProgress",function(e,t){t.percent=t.size>0?Math.ceil(100*(t.loaded/t.size)):100,i()}),p.bind("StateChanged",function(e){if(e.state==h.STARTED)a=+new Date;else if(e.state==h.STOPPED)for(s=e.files.length-1;s>=0;s--)e.files[s].status==h.UPLOADING&&(e.files[s].status=h.QUEUED,i())}),p.bind("QueueChanged",i),p.bind("Error",function(e,n){n.file&&(n.file.status=h.FAILED,i(),e.state==h.STARTED&&u(function(){t.call(p)},1))}),p.bind("FileUploaded",function(e,n){n.status=h.DONE,n.loaded=n.size,e.trigger("UploadProgress",n),u(function(){t.call(p)},1)}),e.runtimes)for(c=[],d=e.runtimes.split(/\s?,\s?/),s=0;d.length>s;s++)r[d[s]]&&c.push(r[d[s]]);else c=r;o(),"function"==typeof e.init?e.init(p):h.each(e.init,function(e,t){p.bind(t,e)})},refresh:function(){this.trigger("Refresh")},start:function(){l.length&&this.state!=h.STARTED&&(this.state=h.STARTED,this.trigger("StateChanged"),t.call(this))},stop:function(){this.state!=h.STOPPED&&(this.state=h.STOPPED,this.trigger("CancelUpload"),this.trigger("StateChanged"))},disableBrowse:function(){c=arguments[0]!==n?arguments[0]:!0,this.trigger("DisableBrowse",c)},getFile:function(e){var t;for(t=l.length-1;t>=0;t--)if(l[t].id===e)return l[t]},removeFile:function(e){var t;for(t=l.length-1;t>=0;t--)if(l[t].id===e.id)return this.splice(t,1)[0]},splice:function(e,t){var i;return i=l.splice(e===n?0:e,t===n?l.length:t),this.trigger("FilesRemoved",i),this.trigger("QueueChanged"),i},trigger:function(e){var t,n,i=s[e.toLowerCase()];if(i)for(n=Array.prototype.slice.call(arguments),n[0]=this,t=0;i.length>t;t++)if(i[t].func.apply(i[t].scope,n)===!1)return!1;return!0},hasEventListener:function(e){return!!s[e.toLowerCase()]},bind:function(e,t,n){var i;e=e.toLowerCase(),i=s[e]||[],i.push({func:t,scope:n||this}),s[e]=i},unbind:function(e){e=e.toLowerCase();var t,i=s[e],o=arguments[1];if(i){if(o!==n){for(t=i.length-1;t>=0;t--)if(i[t].func===o){i.splice(t,1);break}}else i=[];i.length||delete s[e]}},unbindAll:function(){var e=this;h.each(s,function(t,n){e.unbind(n)})},destroy:function(){this.stop(),this.trigger("Destroy"),this.unbindAll()}})},h.File=function(e,t,n){var i=this;i.id=e,i.name=t,i.size=n,i.loaded=0,i.percent=0,i.status=0},h.Runtime=function(){this.getFeatures=function(){},this.init=function(){}},h.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},h.runtimes={},window.plupload=h}(),function(e,t,n,i){function o(e){var t,n,r,a,s=typeof e;if(e===i||null===e)return"null";if("string"===s)return t="\bb	t\nn\ff\rr\"\"''\\\\",'"'+e.replace(/([\u0080-\uFFFF\x00-\x1f\"])/g,function(e,n){var i=t.indexOf(n);return i+1?"\\"+t.charAt(i+1):(e=n.charCodeAt().toString(16),"\\u"+"0000".substring(e.length)+e)})+'"';if("object"==s){if(n=e.length!==i,t="",n){for(r=0;e.length>r;r++)t&&(t+=","),t+=o(e[r]);t="["+t+"]"}else{for(a in e)e.hasOwnProperty(a)&&(t&&(t+=","),t+=o(a)+":"+o(e[a]));t="{"+t+"}"}return t}return""+e}function r(e){var t,n,i,o,r,a=!1,s=null,l=0;try{try{s=new ActiveXObject("AgControl.AgControl"),s.IsVersionSupported(e)&&(a=!0),s=null}catch(c){var u=navigator.plugins["Silverlight Plug-In"];if(u){for(t=u.description,"1.0.30226.2"===t&&(t="2.0.30226.2"),n=t.split(".");n.length>3;)n.pop();for(;4>n.length;)n.push(0);for(i=e.split(".");i.length>4;)i.pop();do o=parseInt(i[l],10),r=parseInt(n[l],10),l++;while(i.length>l&&o===r);r>=o&&!isNaN(o)&&(a=!0)}}}catch(d){a=!1}return a}var a={},s={};n.silverlight={trigger:function(e,t){var i,o=a[e];o&&(i=n.toArray(arguments).slice(1),i[0]="Silverlight:"+t,setTimeout(function(){o.trigger.apply(o,i)},0))}},n.runtimes.Silverlight=n.addRuntime("silverlight",{getFeatures:function(){return{jpgresize:!0,pngresize:!0,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(i,l){function c(){return t.getElementById(i.id+"_silverlight").content.Upload}var u,d,h="",p=i.settings.filters,f=t.body;if(!r("2.0.31005.0")||e.opera&&e.opera.buildNumber)return l({success:!1}),void 0;for(s[i.id]=!1,a[i.id]=i,u=t.createElement("div"),u.id=i.id+"_silverlight_container",n.extend(u.style,{position:"absolute",top:"0px",background:i.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100px",height:"100px",overflow:"hidden",opacity:i.settings.shim_bgcolor||t.documentMode>8?"":.01}),u.className="plupload silverlight",i.settings.container&&(f=t.getElementById(i.settings.container),"static"===n.getStyle(f,"position")&&(f.style.position="relative")),f.appendChild(u),d=0;p.length>d;d++)h+=(""!=h?"|":"")+p[d].title+" | *."+p[d].extensions.replace(/,/g,";*.");u.innerHTML='<object id="'+i.id+'_silverlight" data="data:application/x-silverlight," type="application/x-silverlight-2" style="outline:none;" width="1024" height="1024">'+'<param name="source" value="'+i.settings.silverlight_xap_url+'"/>'+'<param name="background" value="Transparent"/>'+'<param name="windowless" value="true"/>'+'<param name="enablehtmlaccess" value="true"/>'+'<param name="initParams" value="id='+i.id+",filter="+h+",multiselect="+i.settings.multi_selection+'"/>'+"</object>",i.bind("Silverlight:Init",function(){var e,r={};s[i.id]||(s[i.id]=!0,i.bind("Silverlight:StartSelectFiles",function(){e=[]}),i.bind("Silverlight:SelectFile",function(t,i,o,a){var s;s=n.guid(),r[s]=i,r[i]=s,e.push(new n.File(s,o,a))}),i.bind("Silverlight:SelectSuccessful",function(){e.length&&i.trigger("FilesAdded",e)}),i.bind("Silverlight:UploadChunkError",function(e,t,o,a,s){i.trigger("Error",{code:n.IO_ERROR,message:"IO Error.",details:s,file:e.getFile(r[t])})}),i.bind("Silverlight:UploadFileProgress",function(e,t,i,o){var a=e.getFile(r[t]);a.status!=n.FAILED&&(a.size=o,a.loaded=i,e.trigger("UploadProgress",a))}),i.bind("Refresh",function(e){var i,o,r;i=t.getElementById(e.settings.browse_button),i&&(o=n.getPos(i,t.getElementById(e.settings.container)),r=n.getSize(i),n.extend(t.getElementById(e.id+"_silverlight_container").style,{top:o.y+"px",left:o.x+"px",width:r.w+"px",height:r.h+"px"}))}),i.bind("Silverlight:UploadChunkSuccessful",function(e,t,i,o,a){var s,l=e.getFile(r[t]);s={chunk:i,chunks:o,response:a},e.trigger("ChunkUploaded",l,s),l.status!=n.FAILED&&e.state!==n.STOPPED&&c().UploadNextChunk(),i==o-1&&(l.status=n.DONE,e.trigger("FileUploaded",l,{response:a}))}),i.bind("Silverlight:UploadSuccessful",function(e,t,i){var o=e.getFile(r[t]);o.status=n.DONE,e.trigger("FileUploaded",o,{response:i})}),i.bind("FilesRemoved",function(e,t){var n;for(n=0;t.length>n;n++)c().RemoveFile(r[t[n].id])}),i.bind("UploadFile",function(e,t){var i=e.settings,a=i.resize||{};c().UploadFile(r[t.id],e.settings.url,o({name:t.target_name||t.name,mime:n.mimeTypes[t.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",chunk_size:i.chunk_size,image_width:a.width,image_height:a.height,image_quality:a.quality||90,multipart:!!i.multipart,multipart_params:i.multipart_params||{},file_data_name:i.file_data_name,headers:i.headers}))}),i.bind("CancelUpload",function(){c().CancelUpload()}),i.bind("Silverlight:MouseEnter",function(e){var o,r;o=t.getElementById(i.settings.browse_button),r=e.settings.browse_button_hover,o&&r&&n.addClass(o,r)}),i.bind("Silverlight:MouseLeave",function(e){var o,r;o=t.getElementById(i.settings.browse_button),r=e.settings.browse_button_hover,o&&r&&n.removeClass(o,r)}),i.bind("Silverlight:MouseLeftButtonDown",function(e){var o,r;o=t.getElementById(i.settings.browse_button),r=e.settings.browse_button_active,o&&r&&(n.addClass(o,r),n.addEvent(t.body,"mouseup",function(){n.removeClass(o,r)}))}),i.bind("Sliverlight:StartSelectFiles",function(e){var o,r;o=t.getElementById(i.settings.browse_button),r=e.settings.browse_button_active,o&&r&&n.removeClass(o,r)}),i.bind("DisableBrowse",function(e,t){c().DisableBrowse(t)}),i.bind("Destroy",function(e){var i;n.removeAllEvents(t.body,e.id),delete s[e.id],delete a[e.id],i=t.getElementById(e.id+"_silverlight_container"),i&&f.removeChild(i)}),l({success:!0}))})}})}(window,document,plupload),function(e,t,n){function i(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(n){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1])}var o={},r={};n.flash={trigger:function(e,t,n){setTimeout(function(){var i=o[e];i&&i.trigger("Flash:"+t,n)},0)}},n.runtimes.Flash=n.addRuntime("flash",{getFeatures:function(){return{jpgresize:!0,pngresize:!0,maxWidth:8091,maxHeight:8091,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(e,a){function s(){return t.getElementById(e.id+"_flash")}function l(){return d++>5e3?(a({success:!1}),void 0):(r[e.id]===!1&&setTimeout(l,1),void 0)}var c,u,d=0,h=t.body;return 10>i()?(a({success:!1}),void 0):(r[e.id]=!1,o[e.id]=e,c=t.getElementById(e.settings.browse_button),u=t.createElement("div"),u.id=e.id+"_flash_container",n.extend(u.style,{position:"absolute",top:"0px",background:e.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100%",height:"100%"}),u.className="plupload flash",e.settings.container&&(h=t.getElementById(e.settings.container),"static"===n.getStyle(h,"position")&&(h.style.position="relative")),h.appendChild(u),function(){var i,o;i='<object id="'+e.id+'_flash" type="application/x-shockwave-flash" data="'+e.settings.flash_swf_url+'" ',n.ua.ie&&(i+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),i+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+e.settings.flash_swf_url+'" />'+'<param name="flashvars" value="id='+escape(e.id)+'" />'+'<param name="wmode" value="transparent" />'+'<param name="allowscriptaccess" value="always" />'+"</object>",n.ua.ie?(o=t.createElement("div"),u.appendChild(o),o.outerHTML=i,o=null):u.innerHTML=i}(),l(),c=u=null,e.bind("Destroy",function(e){var i;n.removeAllEvents(t.body,e.id),delete r[e.id],delete o[e.id],i=t.getElementById(e.id+"_flash_container"),i&&h.removeChild(i)}),e.bind("Flash:Init",function(){var i={};try{s().setFileFilters(e.settings.filters,e.settings.multi_selection)}catch(o){return a({success:!1}),void 0}r[e.id]||(r[e.id]=!0,e.bind("UploadFile",function(t,o){var r=t.settings,a=e.settings.resize||{};s().uploadFile(i[o.id],r.url,{name:o.target_name||o.name,mime:n.mimeTypes[o.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",chunk_size:r.chunk_size,width:a.width,height:a.height,quality:a.quality,multipart:r.multipart,multipart_params:r.multipart_params||{},file_data_name:r.file_data_name,format:/\.(jpg|jpeg)$/i.test(o.name)?"jpg":"png",headers:r.headers,urlstream_upload:r.urlstream_upload})}),e.bind("CancelUpload",function(){s().cancelUpload()}),e.bind("Flash:UploadProcess",function(e,t){var o=e.getFile(i[t.id]);o.status!=n.FAILED&&(o.loaded=t.loaded,o.size=t.size,e.trigger("UploadProgress",o))}),e.bind("Flash:UploadChunkComplete",function(e,t){var o,r=e.getFile(i[t.id]);o={chunk:t.chunk,chunks:t.chunks,response:t.text},e.trigger("ChunkUploaded",r,o),r.status!==n.FAILED&&e.state!==n.STOPPED&&s().uploadNextChunk(),t.chunk==t.chunks-1&&(r.status=n.DONE,e.trigger("FileUploaded",r,{response:t.text}))}),e.bind("Flash:SelectFiles",function(t,o){var r,a,s,l=[];for(a=0;o.length>a;a++)r=o[a],s=n.guid(),i[s]=r.id,i[r.id]=s,l.push(new n.File(s,r.name,r.size));l.length&&e.trigger("FilesAdded",l)}),e.bind("Flash:SecurityError",function(t,o){e.trigger("Error",{code:n.SECURITY_ERROR,message:n.translate("Security error."),details:o.message,file:e.getFile(i[o.id])})}),e.bind("Flash:GenericError",function(t,o){e.trigger("Error",{code:n.GENERIC_ERROR,message:n.translate("Generic error."),details:o.message,file:e.getFile(i[o.id])})}),e.bind("Flash:IOError",function(t,o){e.trigger("Error",{code:n.IO_ERROR,message:n.translate("IO error."),details:o.message,file:e.getFile(i[o.id])})}),e.bind("Flash:ImageError",function(t,o){e.trigger("Error",{code:parseInt(o.code,10),message:n.translate("Image error."),file:e.getFile(i[o.id])})}),e.bind("Flash:StageEvent:rollOver",function(i){var o,r;o=t.getElementById(e.settings.browse_button),r=i.settings.browse_button_hover,o&&r&&n.addClass(o,r)}),e.bind("Flash:StageEvent:rollOut",function(i){var o,r;o=t.getElementById(e.settings.browse_button),r=i.settings.browse_button_hover,o&&r&&n.removeClass(o,r)}),e.bind("Flash:StageEvent:mouseDown",function(i){var o,r;o=t.getElementById(e.settings.browse_button),r=i.settings.browse_button_active,o&&r&&(n.addClass(o,r),n.addEvent(t.body,"mouseup",function(){n.removeClass(o,r)},i.id))}),e.bind("Flash:StageEvent:mouseUp",function(i){var o,r;o=t.getElementById(e.settings.browse_button),r=i.settings.browse_button_active,o&&r&&n.removeClass(o,r)}),e.bind("Flash:ExifData",function(t,n){e.trigger("ExifData",e.getFile(i[n.id]),n.data)}),e.bind("Flash:GpsData",function(t,n){e.trigger("GpsData",e.getFile(i[n.id]),n.data)}),e.bind("QueueChanged",function(){e.refresh()}),e.bind("FilesRemoved",function(e,t){var n;for(n=0;t.length>n;n++)s().removeFile(i[t[n].id])}),e.bind("StateChanged",function(){e.refresh()}),e.bind("Refresh",function(i){var o,r,a;s().setFileFilters(e.settings.filters,e.settings.multi_selection),o=t.getElementById(i.settings.browse_button),o&&(r=n.getPos(o,t.getElementById(i.settings.container)),a=n.getSize(o),n.extend(t.getElementById(i.id+"_flash_container").style,{top:r.y+"px",left:r.x+"px",width:a.w+"px",height:a.h+"px"}))}),e.bind("DisableBrowse",function(e,t){s().disableBrowse(t)}),a({success:!0}))}),void 0)}})}(window,document,plupload),function(e,t,n,o){function r(t,n){var i;return"FileReader"in e?(i=new FileReader,i.readAsDataURL(t),i.onload=function(){n(i.result)},void 0):n(t.getAsDataURL())}function a(t,n){var i;return"FileReader"in e?(i=new FileReader,i.readAsBinaryString(t),i.onload=function(){n(i.result)},void 0):n(t.getAsBinary())}function s(e,n,i,o){var a,s,l,d,p=this;r(h[e.id],function(r){a=t.createElement("canvas"),a.style.display="none",t.body.appendChild(a),s=a.getContext("2d"),l=new Image,l.onerror=l.onabort=function(){o({success:!1})},l.onload=function(){var t,h,f,m;if(n.width||(n.width=l.width),n.height||(n.height=l.height),d=Math.min(n.width/l.width,n.height/l.height),1>d||1===d&&"image/jpeg"===i){if(t=Math.round(l.width*d),h=Math.round(l.height*d),a.width=t,a.height=h,s.drawImage(l,0,0,t,h),"image/jpeg"===i){if(f=new c(atob(r.substring(r.indexOf("base64,")+7))),f.headers&&f.headers.length&&(m=new u,m.init(f.get("exif")[0])&&(m.setExif("PixelXDimension",t),m.setExif("PixelYDimension",h),f.set("exif",m.getBinary()),p.hasEventListener("ExifData")&&p.trigger("ExifData",e,m.EXIF()),p.hasEventListener("GpsData")&&p.trigger("GpsData",e,m.GPS()))),n.quality)try{r=a.toDataURL(i,n.quality/100)}catch(g){r=a.toDataURL(i)}}else r=a.toDataURL(i);r=r.substring(r.indexOf("base64,")+7),r=atob(r),f&&f.headers&&f.headers.length&&(r=f.restore(r),f.purge()),a.parentNode.removeChild(a),o({success:!0,data:r})}else o({success:!1})},l.src=r})}function l(){function e(e,t){var n,o=r?0:-8*(t-1),a=0;for(n=0;t>n;n++)a|=i.charCodeAt(e+n)<<Math.abs(o+8*n);return a}function t(e,t,n){var n=3===arguments.length?n:i.length-t-1;i=i.substr(0,t)+e+i.substr(n+t)}function n(e,n,i){var o,a="",s=r?0:-8*(i-1);for(o=0;i>o;o++)a+=String.fromCharCode(255&n>>Math.abs(s+8*o));t(a,e,i)}var i,r=!1;return{II:function(e){return e===o?r:(r=e,void 0)},init:function(e){r=!1,i=e},SEGMENT:function(e,n,o){switch(arguments.length){case 1:return i.substr(e,i.length-e-1);case 2:return i.substr(e,n);case 3:t(o,e,n);break;default:return i}},BYTE:function(t){return e(t,1)},SHORT:function(t){return e(t,2)},LONG:function(t,i){return i===o?e(t,4):(n(t,i,4),void 0)},SLONG:function(t){var n=e(t,4);return n>2147483647?n-4294967296:n},STRING:function(t,n){var i="";for(n+=t;n>t;t++)i+=String.fromCharCode(e(t,1));return i}}}function c(e){var t,n,i,r={65505:{app:"EXIF",name:"APP1",signature:"Exif\0"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\0"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\0"}},a=[],s=o,u=0;if(t=new l,t.init(e),65496===t.SHORT(0)){for(n=2,i=Math.min(1048576,e.length);i>=n;)if(s=t.SHORT(n),s>=65488&&65495>=s)n+=2;else{if(65498===s||65497===s)break;u=t.SHORT(n+2)+2,r[s]&&t.STRING(n+4,r[s].signature.length)===r[s].signature&&a.push({hex:s,app:r[s].app.toUpperCase(),name:r[s].name.toUpperCase(),start:n,length:u,segment:t.SEGMENT(n,u)}),n+=u}return t.init(null),{headers:a,restore:function(e){t.init(e);var i=new c(e);if(!i.headers)return!1;for(var o=i.headers.length;o>0;o--){var r=i.headers[o-1];t.SEGMENT(r.start,r.length,"")}i.purge(),n=65504==t.SHORT(2)?4+t.SHORT(4):2;for(var o=0,s=a.length;s>o;o++)t.SEGMENT(n,0,a[o].segment),n+=a[o].length;return t.SEGMENT()},get:function(e){for(var t=[],n=0,i=a.length;i>n;n++)a[n].app===e.toUpperCase()&&t.push(a[n].segment);return t},set:function(e,t){var n=[];"string"==typeof t?n.push(t):n=t;for(var i=ii=0,o=a.length;o>i&&(a[i].app===e.toUpperCase()&&(a[i].segment=n[ii],a[i].length=n[ii].length,ii++),!(ii>=n.length));i++);},purge:function(){a=[],t.init(null)}}}}function u(){function e(e,t){var n,i,r,s,l,d,h,p,f=a.SHORT(e),m=[],g={};for(n=0;f>n;n++)if(h=d=e+12*n+2,r=t[a.SHORT(h)],r!==o){switch(s=a.SHORT(h+=2),l=a.LONG(h+=2),h+=4,m=[],s){case 1:case 7:for(l>4&&(h=a.LONG(h)+u.tiffHeader),i=0;l>i;i++)m[i]=a.BYTE(h+i);break;case 2:l>4&&(h=a.LONG(h)+u.tiffHeader),g[r]=a.STRING(h,l-1);continue;case 3:for(l>2&&(h=a.LONG(h)+u.tiffHeader),i=0;l>i;i++)m[i]=a.SHORT(h+2*i);break;case 4:for(l>1&&(h=a.LONG(h)+u.tiffHeader),i=0;l>i;i++)m[i]=a.LONG(h+4*i);break;case 5:for(h=a.LONG(h)+u.tiffHeader,i=0;l>i;i++)m[i]=a.LONG(h+4*i)/a.LONG(h+4*i+4);break;case 9:for(h=a.LONG(h)+u.tiffHeader,i=0;l>i;i++)m[i]=a.SLONG(h+4*i);break;case 10:for(h=a.LONG(h)+u.tiffHeader,i=0;l>i;i++)m[i]=a.SLONG(h+4*i)/a.SLONG(h+4*i+4);break;default:continue}p=1==l?m[0]:m,g[r]=c.hasOwnProperty(r)&&"object"!=typeof p?c[r][p]:p}return g}function t(){var t=o,n=u.tiffHeader;return a.II(18761==a.SHORT(n)),42!==a.SHORT(n+=2)?!1:(u.IFD0=u.tiffHeader+a.LONG(n+=2),t=e(u.IFD0,s.tiff),u.exifIFD="ExifIFDPointer"in t?u.tiffHeader+t.ExifIFDPointer:o,u.gpsIFD="GPSInfoIFDPointer"in t?u.tiffHeader+t.GPSInfoIFDPointer:o,!0)}function r(e,t,n){var o,r,l,c=0;if("string"==typeof t){var d=s[e.toLowerCase()];for(hex in d)if(d[hex]===t){t=hex;break}}for(o=u[e.toLowerCase()+"IFD"],r=a.SHORT(o),i=0;r>i;i++)if(l=o+12*i+2,a.SHORT(l)==t){c=l+8;break}return c?(a.LONG(c,n),!0):!1}var a,s,c,u={};return a=new l,s={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},c={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(e){return u={tiffHeader:10},e!==o&&e.length?(a.init(e),65505===a.SHORT(0)&&"EXIF\0"===a.STRING(4,5).toUpperCase()?t():!1):!1
},EXIF:function(){var t;if(t=e(u.exifIFD,s.exif),t.ExifVersion&&"array"===n.typeOf(t.ExifVersion)){for(var i=0,o="";t.ExifVersion.length>i;i++)o+=String.fromCharCode(t.ExifVersion[i]);t.ExifVersion=o}return t},GPS:function(){var t;return t=e(u.gpsIFD,s.gps),t.GPSVersionID&&(t.GPSVersionID=t.GPSVersionID.join(".")),t},setExif:function(e,t){return"PixelXDimension"!==e&&"PixelYDimension"!==e?!1:r("exif",e,t)},getBinary:function(){return a.SEGMENT()}}}var d,h={};n.runtimes.Html5=n.addRuntime("html5",{getFeatures:function(){var i,o,r,a,s,l;return o=r=s=l=!1,e.XMLHttpRequest&&(i=new XMLHttpRequest,r=!!i.upload,o=!(!i.sendAsBinary&&!i.upload)),o&&(a=!!(i.sendAsBinary||e.Uint8Array&&e.ArrayBuffer),s=!(!File||!File.prototype.getAsDataURL&&!e.FileReader||!a),l=!(!File||!(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice))),d=n.ua.safari&&n.ua.windows,{html5:o,dragdrop:function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e}(),jpgresize:s,pngresize:s,multipart:s||!!e.FileReader||!!e.FormData,canSendBinary:a,cantSendBlobInFormData:!(!(n.ua.gecko&&e.FormData&&e.FileReader)||FileReader.prototype.readAsArrayBuffer),progress:r,chunks:l,multi_selection:!(n.ua.safari&&n.ua.windows),triggerDialog:n.ua.gecko&&e.FormData||n.ua.webkit}},init:function(i,o){function r(e){var t,o,r,a=[],s={};for(o=0;e.length>o;o++)t=e[o],s[t.name]||(s[t.name]=!0,r=n.guid(),h[r]=t,a.push(new n.File(r,t.fileName||t.name,t.fileSize||t.size)));a.length&&i.trigger("FilesAdded",a)}var l,c;return l=this.getFeatures(),l.html5?(i.bind("Init",function(e){var o,a,s,l,c,u,d,h=[],p=e.settings.filters,f=t.body;o=t.createElement("div"),o.id=e.id+"_html5_container",n.extend(o.style,{position:"absolute",background:i.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:i.settings.shim_bgcolor?"":0}),o.className="plupload html5",i.settings.container&&(f=t.getElementById(i.settings.container),"static"===n.getStyle(f,"position")&&(f.style.position="relative")),f.appendChild(o);e:for(s=0;p.length>s;s++)for(c=p[s].extensions.split(/,/),l=0;c.length>l;l++){if("*"===c[l]){h=[];break e}u=n.mimeTypes[c[l]],u&&-1===n.inArray(u,h)&&h.push(u)}if(o.innerHTML='<input id="'+i.id+'_html5" '+' style="font-size:999px"'+' type="file" accept="'+h.join(",")+'" '+(i.settings.multi_selection&&i.features.multi_selection?'multiple="multiple"':"")+" />",o.scrollTop=100,d=t.getElementById(i.id+"_html5"),e.features.triggerDialog?n.extend(d.style,{position:"absolute",width:"100%",height:"100%"}):n.extend(d.style,{cssFloat:"right",styleFloat:"right"}),d.onchange=function(){r(this.files),this.value=""},a=t.getElementById(e.settings.browse_button)){var m=e.settings.browse_button_hover,g=e.settings.browse_button_active,v=e.features.triggerDialog?a:o;m&&(n.addEvent(v,"mouseover",function(){n.addClass(a,m)},e.id),n.addEvent(v,"mouseout",function(){n.removeClass(a,m)},e.id)),g&&(n.addEvent(v,"mousedown",function(){n.addClass(a,g)},e.id),n.addEvent(t.body,"mouseup",function(){n.removeClass(a,g)},e.id)),e.features.triggerDialog&&n.addEvent(a,"click",function(n){var i=t.getElementById(e.id+"_html5");i&&!i.disabled&&i.click(),n.preventDefault()},e.id)}}),i.bind("PostInit",function(){var e=t.getElementById(i.settings.drop_element);if(e){if(d)return n.addEvent(e,"dragenter",function(){var o,a,s;o=t.getElementById(i.id+"_drop"),o||(o=t.createElement("input"),o.setAttribute("type","file"),o.setAttribute("id",i.id+"_drop"),o.setAttribute("multiple","multiple"),n.addEvent(o,"change",function(){r(this.files),n.removeEvent(o,"change",i.id),o.parentNode.removeChild(o)},i.id),e.appendChild(o)),a=n.getPos(e,t.getElementById(i.settings.container)),s=n.getSize(e),"static"===n.getStyle(e,"position")&&n.extend(e.style,{position:"relative"}),n.extend(o.style,{position:"absolute",display:"block",top:0,left:0,width:s.w+"px",height:s.h+"px",opacity:0})},i.id),void 0;n.addEvent(e,"dragover",function(e){e.preventDefault()},i.id),n.addEvent(e,"drop",function(e){var t=e.dataTransfer;t&&t.files&&r(t.files),e.preventDefault()},i.id)}}),i.bind("Refresh",function(e){var o,r,a,s,l;o=t.getElementById(i.settings.browse_button),o&&(r=n.getPos(o,t.getElementById(e.settings.container)),a=n.getSize(o),s=t.getElementById(i.id+"_html5_container"),n.extend(s.style,{top:r.y+"px",left:r.x+"px",width:a.w+"px",height:a.h+"px"}),i.features.triggerDialog&&("static"===n.getStyle(o,"position")&&n.extend(o.style,{position:"relative"}),l=parseInt(n.getStyle(o,"zIndex"),10),isNaN(l)&&(l=0),n.extend(o.style,{zIndex:l}),n.extend(s.style,{zIndex:l-1})))}),i.bind("DisableBrowse",function(e,n){var i=t.getElementById(e.id+"_html5");i&&(i.disabled=n)}),i.bind("CancelUpload",function(){c&&c.abort&&c.abort()}),i.bind("UploadFile",function(t,i){function o(e,t,n){var i;if(!File.prototype.slice)return(i=File.prototype.webkitSlice||File.prototype.mozSlice)?i.call(e,t,n):null;try{return e.slice(),e.slice(t,n)}catch(o){return e.slice(t,n-t)}}function r(r){function a(){function p(o){var r,d=0,h="----pluploadboundary"+n.guid(),p="--",x="\r\n",k="";if(c=new XMLHttpRequest,c.upload&&(c.upload.onprogress=function(e){i.loaded=Math.min(i.size,u+e.loaded-d),t.trigger("UploadProgress",i)}),c.onreadystatechange=function(){var e,l;if(4==c.readyState&&t.state!==n.STOPPED){try{e=c.status}catch(d){e=0}if(e>=400)t.trigger("Error",{code:n.HTTP_ERROR,message:n.translate("HTTP Error."),file:i,status:e});else{if(m){if(l={chunk:s,chunks:m,response:c.responseText,status:e},t.trigger("ChunkUploaded",i,l),u+=b,l.cancelled)return i.status=n.FAILED,void 0;i.loaded=Math.min(i.size,(s+1)*v)}else i.loaded=i.size;t.trigger("UploadProgress",i),o=f=r=k=null,!m||++s>=m?(i.status=n.DONE,t.trigger("FileUploaded",i,{response:c.responseText,status:e})):a()}}},t.settings.multipart&&l.multipart){if(g.name=i.target_name||i.name,c.open("post",w,!0),n.each(t.settings.headers,function(e,t){c.setRequestHeader(t,e)}),"string"!=typeof o&&e.FormData)return r=new FormData,n.each(n.extend(g,t.settings.multipart_params),function(e,t){r.append(t,e)}),r.append(t.settings.file_data_name,o),c.send(r),void 0;if("string"==typeof o){if(c.setRequestHeader("Content-Type","multipart/form-data; boundary="+h),n.each(n.extend(g,t.settings.multipart_params),function(e,t){k+=p+h+x+'Content-Disposition: form-data; name="'+t+'"'+x+x,k+=unescape(encodeURIComponent(e))+x}),y=n.mimeTypes[i.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",k+=p+h+x+'Content-Disposition: form-data; name="'+t.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(i.name))+'"'+x+"Content-Type: "+y+x+x+o+x+p+h+p+x,d=k.length-o.length,o=k,c.sendAsBinary)c.sendAsBinary(o);else if(l.canSendBinary){for(var _=new Uint8Array(o.length),C=0;o.length>C;C++)_[C]=255&o.charCodeAt(C);c.send(_.buffer)}return}}w=n.buildUrl(t.settings.url,n.extend(g,t.settings.multipart_params)),c.open("post",w,!0),c.setRequestHeader("Content-Type","application/octet-stream"),n.each(t.settings.headers,function(e,t){c.setRequestHeader(t,e)}),c.send(o)}var f,m,g,v,b,y,w=t.settings.url;i.status!=n.DONE&&i.status!=n.FAILED&&t.state!=n.STOPPED&&(g={name:i.target_name||i.name},d.chunk_size&&i.size>d.chunk_size&&(l.chunks||"string"==typeof r)?(v=d.chunk_size,m=Math.ceil(i.size/v),b=Math.min(v,i.size-s*v),f="string"==typeof r?r.substring(s*v,s*v+b):o(r,s*v,s*v+b),g.chunk=s,g.chunks=m):(b=i.size,f=r),t.settings.multipart&&l.multipart&&"string"!=typeof f&&h&&l.cantSendBlobInFormData&&l.chunks&&t.settings.chunk_size?(h.onload=function(){p(h.result)},h.readAsBinaryString(f)):p(f))}var s=0,u=0,h="FileReader"in e?new FileReader:null;a()}var u,d=t.settings;u=h[i.id],l.jpgresize&&t.settings.resize&&/\.(png|jpg|jpeg)$/i.test(i.name)?s.call(t,i,t.settings.resize,/\.png$/i.test(i.name)?"image/png":"image/jpeg",function(e){e.success?(i.size=e.data.length,r(e.data)):l.chunks?r(u):a(u,r)}):!l.chunks&&l.jpgresize?a(u,r):r(u)}),i.bind("Destroy",function(e){var i,o,r=t.body,a={inputContainer:e.id+"_html5_container",inputFile:e.id+"_html5",browseButton:e.settings.browse_button,dropElm:e.settings.drop_element};for(i in a)o=t.getElementById(a[i]),o&&n.removeAllEvents(o,e.id);n.removeAllEvents(t.body,e.id),e.settings.container&&(r=t.getElementById(e.settings.container)),r.removeChild(t.getElementById(a.inputContainer))}),o({success:!0}),void 0):(o({success:!1}),void 0)}})}(window,document,plupload),function(e,t,n){function i(e){return t.getElementById(e)}n.runtimes.Html4=n.addRuntime("html4",{getFeatures:function(){return{multipart:!0,triggerDialog:n.ua.gecko&&e.FormData||n.ua.webkit}},init:function(o,r){o.bind("Init",function(r){function a(){var e,s,l,c;u=n.guid(),v.push(u),e=t.createElement("form"),e.setAttribute("id","form_"+u),e.setAttribute("method","post"),e.setAttribute("enctype","multipart/form-data"),e.setAttribute("encoding","multipart/form-data"),e.setAttribute("target",r.id+"_iframe"),e.style.position="absolute",s=t.createElement("input"),s.setAttribute("id","input_"+u),s.setAttribute("type","file"),s.setAttribute("accept",y),s.setAttribute("size",1),c=i(r.settings.browse_button),r.features.triggerDialog&&c&&n.addEvent(i(r.settings.browse_button),"click",function(e){s.disabled||s.click(),e.preventDefault()},r.id),n.extend(s.style,{width:"100%",height:"100%",opacity:0,fontSize:"99px",cursor:"pointer"}),n.extend(e.style,{overflow:"hidden"}),l=r.settings.shim_bgcolor,l&&(e.style.background=l),b&&n.extend(s.style,{filter:"alpha(opacity=0)"}),n.addEvent(s,"change",function(t){var l,d=t.target,h=[];d.value&&(i("form_"+u).style.top="-1048575px",l=d.value.replace(/\\/g,"/"),l=l.substring(l.length,l.lastIndexOf("/")+1),h.push(new n.File(u,l)),r.features.triggerDialog?n.removeEvent(c,"click",r.id):n.removeAllEvents(e,r.id),n.removeEvent(s,"change",r.id),a(),h.length&&o.trigger("FilesAdded",h))},r.id),e.appendChild(s),m.appendChild(e),r.refresh()}function s(){var i=t.createElement("div");i.innerHTML='<iframe id="'+r.id+'_iframe" name="'+r.id+'_iframe" src="'+g+':&quot;&quot;" style="display:none"></iframe>',l=i.firstChild,m.appendChild(l),n.addEvent(l,"load",function(t){var i,o,a=t.target;if(c){try{i=a.contentWindow.document||a.contentDocument||e.frames[a.id].document}catch(s){return r.trigger("Error",{code:n.SECURITY_ERROR,message:n.translate("Security error."),file:c}),void 0}o=i.body.innerHTML,o.match(/success/)?(c.status=n.DONE,c.loaded=1025,c.percent=100,r.trigger("UploadProgress",c),r.trigger("FileUploaded",c,{response:o})):r.trigger("Error",{code:n.GENERIC_ERROR,message:o,file:c})}},r.id)}var l,c,u,d,h,p,f,m=t.body,g="javascript",v=[],b=/MSIE/.test(navigator.userAgent),y=[],w=r.settings.filters;e:for(d=0;w.length>d;d++)for(h=w[d].extensions.split(/,/),f=0;h.length>f;f++){if("*"===h[f]){y=[];break e}p=n.mimeTypes[h[f]],p&&-1===n.inArray(p,y)&&y.push(p)}y=y.join(","),r.settings.container&&(m=i(r.settings.container),"static"===n.getStyle(m,"position")&&(m.style.position="relative")),r.bind("UploadFile",function(e,o){var r,a;o.status!=n.DONE&&o.status!=n.FAILED&&e.state!=n.STOPPED&&(r=i("form_"+o.id),a=i("input_"+o.id),a.setAttribute("name",e.settings.file_data_name),r.setAttribute("action",e.settings.url),n.each(n.extend({name:o.target_name||o.name},e.settings.multipart_params),function(e,i){var o=t.createElement("input");n.extend(o,{type:"hidden",name:i,value:e}),r.insertBefore(o,r.firstChild)}),c=o,i("form_"+u).style.top="-1048575px",r.submit())}),r.bind("FileUploaded",function(e){e.refresh()}),r.bind("StateChanged",function(t){t.state==n.STARTED?s():t.state==n.STOPPED&&e.setTimeout(function(){n.removeEvent(l,"load",t.id),l.parentNode&&l.parentNode.removeChild(l)},0),n.each(t.files,function(e){if(e.status===n.DONE||e.status===n.FAILED){var t=i("form_"+e.id);t&&t.parentNode.removeChild(t)}})}),r.bind("Refresh",function(e){var o,r,a,s,l,c,d,h,p;o=i(e.settings.browse_button),o&&(l=n.getPos(o,i(e.settings.container)),c=n.getSize(o),d=i("form_"+u),h=i("input_"+u),n.extend(d.style,{top:l.y+"px",left:l.x+"px",width:c.w+"px",height:c.h+"px"}),e.features.triggerDialog&&("static"===n.getStyle(o,"position")&&n.extend(o.style,{position:"relative"}),p=parseInt(o.style.zIndex,10),isNaN(p)&&(p=0),n.extend(o.style,{zIndex:p}),n.extend(d.style,{zIndex:p-1})),a=e.settings.browse_button_hover,s=e.settings.browse_button_active,r=e.features.triggerDialog?o:d,a&&(n.addEvent(r,"mouseover",function(){n.addClass(o,a)},e.id),n.addEvent(r,"mouseout",function(){n.removeClass(o,a)},e.id)),s&&(n.addEvent(r,"mousedown",function(){n.addClass(o,s)},e.id),n.addEvent(t.body,"mouseup",function(){n.removeClass(o,s)},e.id)))}),o.bind("FilesRemoved",function(e,t){var n,o;for(n=0;t.length>n;n++)o=i("form_"+t[n].id),o&&o.parentNode.removeChild(o)}),o.bind("DisableBrowse",function(e,n){var i=t.getElementById("input_"+u);i&&(i.disabled=n)}),o.bind("Destroy",function(e){var o,r,a,s={inputContainer:"form_"+u,inputFile:"input_"+u,browseButton:e.settings.browse_button};for(o in s)r=i(s[o]),r&&n.removeAllEvents(r,e.id);n.removeAllEvents(t.body,e.id),n.each(v,function(e){a=i("form_"+e),a&&m.removeChild(a)})}),a()}),r({success:!0})}})}(window,document,plupload),function(e,t){e.create("wikispaces.plugins.AssessmentPlugin",{data:{},init:function(e){var t=this;this.editor=e,e.onKeyPress.addToTop(function(){t.add("characters",1)}),e.onInit.add(function(){var e=function(e){return t.getScore(e)};ws.assessment.schedule("edit",e)})},add:function(e,t){var n=this.getBucket();void 0===n[e]&&(n[e]=0),n[e]+=t},clearBucket:function(e){e>=ws.assessment.getCurrentDate()||delete this.data[e]},getBucket:function(e){return e||(e=ws.assessment.getCurrentDate()),this.data[e]||(this.data[e]={}),this.data[e]},getData:function(){return this.data},getScore:function(e){var n=0;return e||(e=ws.assessment.getCurrentDate()),this.data[e]?(t.each(this.data[e],function(e,t){switch(e){case"characters":n+=t}}),n):0},getInfo:function(){return{longname:"Wikispaces assessment",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}}}),e.PluginManager.add("wsassessment",wikispaces.plugins.AssessmentPlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.AutoloadPlugin",{init:function(n){this.editor=n;var i=this;n.onInit.add(function(n){if(n.onInitSubEditor&&n.onInitSubEditor.add(function(t){t.onChange.add(function(){e.mainEditor.plugins.wsautosave.autosaveDelayed()})}),i.editor.plugins.wscommon.getOption("contentPresent")){i.loadVersionFromForm();var o=t("#autosaveData").get(0);if(o){var r=o.autosaveContent.value,a=JSON.parse(o.autosavePageComments.value),s=o.autosaveDate.value,l=o.autosaveVersion.value,c=o.autosaveCleanup.value,u=o.autosaveAge.value,d=o.autosaveConflict.value;i.autoload(r,a,s,l,c,u,d)}i.editorLoaded()}else t("#wsMainEditor_container").hide(),t.ajax({url:ws.common.pathFor("page","dump",wikispaces_page,wikispaces_page_version),type:"GET",cache:!1,data:{mode:n.plugins.wscommon.getOption("mode"),format:n.plugins.wscommon.getOption("mode")},global:!1,error:function(e,t,n){i.error(e,t,n)},success:function(e){i.loadData(e),t("#content_view").hide(),i.editorLoaded()},complete:function(){t("#wsMainEditor_container").show(),n.plugins.wstoolbarscroll.moveScroller()}})})},convertHtml:function(){return t("#contentEditButton").remove(),t("#content_view").contents().filter(function(){return 8==this.nodeType&&"ws:"!=t.trim(this.data).substring(0,3)}).remove(),t.trim(t("#content_view").html().replace(/<!-- ws:start:WikiText[a-zA-Z]+Rule:(\d+):([\s\S]*?) -->[\s\S]*?<!-- ws:end:WikiText[a-zA-Z]+Rule:\1 -->/g,function(){return arguments[2]?t("<div>").html(arguments[2]).text():""}))},getInfo:function(){return{longname:"Wikispaces autoload",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},error:function(){ws.common.track("Editor","Start","Inline Failure"),ws.editor._editorDeferred.reject(),document.location=ws.common.pathFor("page","edit",wikispaces_page)},loadData:function(e){var n=t(e);try{var i=n.find("checkout checkoutStatus").text(),o=n.find("checkout checkoutUser").text(),r=n.find("checkout checkoutDate").text(),a=n.find("checkout checkoutRefreshDate").text();this.checkout(i,o,r,a);var s,l=parseInt(n.find("dump contentChanged").text());s=l?n.find("dump content").text():this.convertHtml();var c=n.find("dump version").text(),u=n.find("dump editorCleanup").text(),d=JSON.parse(n.find("dump pageComments").text());this.loadVersion(s,d,c,u);var h=n.find("dump autosave autosaveContent").text(),p=n.find("dump autosave autosaveDate").text(),f=n.find("dump autosave autosaveVersion").text(),m=n.find("dump autosave autosaveCleanup").text(),g=n.find("dump autosave autosaveAge").text(),v=n.find("dump autosave autosaveConflict").text(),d=n.find("dump autosave autosavePageComments").text(),b=d?JSON.parse(d):{};this.autoload(h,b,p,f,m,g,v),ws.common.track("Editor","Start","Inline")}catch(y){this.error()}},checkout:function(e,t,n){return"locked"!=e||wikispaces_isUserLoggedIn&&t==wikispaces_username?void 0:(alert(this.checkoutMessage),document.location=ws.common.pathFor(wikispaces_page),void 0)},loadVersionFromForm:function(){var e=t("#wsMainEditor").val(),n=JSON.parse(this.editor.plugins.wscommon.getOption("pageComments")),i=this.editor.plugins.wscommon.getOption("version"),o=this.editor.plugins.wscommon.getOption("editorCleanup");this.loadVersion(e,n,i,o)},loadVersion:function(n,i,o,r){var a=this;t("html, body").animate({scrollTop:0},"fast"),this.editor.plugins.wscommon.setOption("version",o),this.editor.plugins.wscommon.setOption("editorCleanup",r),"plain"==this.editor.plugins.wscommon.getOption("mode")?this.editor.plugins.wstext.flipToText(n):(this.editor.setContent(n,{wsautoload:!0}),e.isIE&&(r+=",brTable"),wikispaces.util.Cleanup.cleanup(this.editor,r,!1),this.editor.undoManager.clear(),this.editor.setClean(),this.editor.onModeSwitch.dispatch("visual"),setTimeout(function(){a.editor.focus(),a.editor.wsselection.ensureCursor(),a.editor.onNeedsResize.dispatch()},100),t("img",this.editor.getBody()).load(function(){a.editor.onNeedsResize.dispatch()}).each(function(){this.src=this.src})),this.editor.plugins.wscomment.loadComments(i)},editorForm:function(){return t(this.editor.getContainer()).closest("form").get(0)},autoload:function(n,i,o,r,a,s,l){var c=this;if(o)if(parseInt(l)&&s>=86400)e.mainEditor.plugins.wspopup.show("expiredDraft"),t("#expiredDraftDate").text(o),t("#expiredDraftContent").html(n);else{this.autosaveContent=n,this.autosavePageComments=i,this.autosaveVersion=r,this.autosaveCleanup=a,e.mainEditor.plugins.wspopup.show("draftRecovered"),t("#recoveredDraftDate").text(o);var u=this.editor.plugins.wscommon.getOption("version");if(r!=u){t("#outOfDateDraft").show();var d=ws.common.pathFor("page","diff",wikispaces_page)+"?v1="+encodeURIComponent(r)+"&v2="+encodeURIComponent(u);t("#outOfDateDraft a").attr("href",d)}}this.editor.onChange.add(function(){c.editor.plugins.wsautosave.autosaveDelayed()})},editorLoaded:function(){window.setTimeout(function(){ws.editor._editorDeferred.resolve()},1e3)}}),e.PluginManager.add("wsautoload",wikispaces.plugins.AutoloadPlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.AutosavePlugin",{AUTOSAVE_INTERVAL:3e4,concurrentEditors:[],savedVersions:[],init:function(n){this.editor=n,this.autosaveEnabled=e.activeEditor.getParam("wsautosave_enabled");var i=this;n.addCommand("wsautosave",function(){i.autosave()}),n.onInit.add(function(){ws.editor.content.isLoaded||(t("#concurrentEditorDetails").prop("disabled",!0),ws.editor.content.add(function(){t("#concurrentEditorDetails").prop("disabled",!1)})),setInterval(function(){e.activeEditor.undoManager.add()},61e3)})},getInfo:function(){return{longname:"Wikispaces autosave",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},autosaveDelayed:function(){var e=this;this.autosaveDelayedHandle||(this.autosaveDelayedHandle=setTimeout(function(){e.autosave(!0)},this.AUTOSAVE_INTERVAL))},autosave:function(e,n){if(clearTimeout(this.autosaveDelayedHandle),delete this.autosaveDelayedHandle,!this.autosaveEnabled)return ws.common.log("not autosaving (disabled)",e),void 0;ws.common.log("autosave",e);var i=this;e===void 0&&(e=!0),this.setStatus("Saving Draft..."),n===void 0&&(n=this.editor.plugins.wscommon.fullContent(!1));var o=function(){ws.session.reloadSession(function(){i.autosave(e)},3e3,function(){i.editor.plugins.wscommon.sessionReloadFailed()})};t.ajaxq("autosave",{url:this.getAutosaveUrl(),type:"POST",async:e,cache:!1,data:{content:n,pageComments:this.editor.plugins.wscomment.newComments()},dataType:"xml",global:!1,error:o,success:function(e){i.autosaveProcessResponse(e),ws.session.reloadSessionSuccess()}}),ws.common.log("autosave finished")},getAutosaveUrl:function(){var e=this.editor.plugins.wscommon.getOption("mode"),t=this.editor.plugins.wscommon.getOption("version");return ws.common.pathFor("page","autosave",wikispaces_page,t)+"?mode="+encodeURIComponent(e)},setStatus:function(e,n){t("#autosaveStatus").hide().html(e).fadeIn(2e3),n&&t("#autosaveStatus").css("color","red")},autosaveProcessResponse:function(e){ws.common.log("autosaveProcessResponse",e);var n=this,i=t(e),o=!1,r=i.find("autosave save").text(),a=i.find("autosave error").attr("message");r?this.setStatus("Draft Saved at "+r,!1):a?this.setStatus(a,!0):this.setStatus("");var s=this.savedVersions.length;"changed"==i.find("status").attr("type")&&(this.savedVersions=[],i.find("status revision").each(function(){var e=t(this).find("user").text(),i=t(this).find("date").text(),o=t(this).attr("id");n.savedVersions.push({id:o,editor:e,time:i})})),this.savedVersions.length>s&&(ws.common.track("Editor","Concurrent Editing","Concurrent Save"),o=!0);var l=this.concurrentEditors.length>0;this.concurrentEditors=[],i.find("concurrent editor").each(function(){var e=t(this).find("user").text(),i=t(this).find("date").text();n.concurrentEditors.push({editor:e,time:i})}),!l&&this.concurrentEditors.length&&(ws.common.track("Editor","Concurrent Editing","Start"),o=!0),l&&0==this.concurrentEditors.length&&ws.common.track("Editor","Concurrent Editing","End"),this.concurrentEditors.length&&ws.common.track("Editor","Concurrent Editing","Editor Count",this.concurrentEditors.length);var c=t.trim(i.find("autosave merge mergeStatus").text());this.mergeResult="","failed"==c?ws.common.track("Editor","Concurrent Editing","Merge Failed"):"success"==c&&(ws.common.track("Editor","Concurrent Editing","Merge Success"),this.mergeResult=i.find("autosave merge mergeResult").text()),this.mergeStatus=c,o&&this.statusUpdated()},showConcurrentEditorPopup:function(){if(e.mainEditor.plugins.wspopup.show("concurrentEditor"),this.savedVersions.length){var n=this.editor.plugins.wscommon.getOption("version");if(t("#concurrentEditor_savedVersions").empty(),t.each(this.savedVersions,function(e,n){var i=t('<li><img src="/user/pic/'+n.editor+'-sm.jpg" height="16" width="16" style="vertical-align: text-top;"/> '+n.editor+" saved a new version at "+n.time+'.  <a href="'+ws.common.pathFor("page","diff",wikispaces_page)+"/"+n.id+'" target="_new">View the changes</a></li>');t("#concurrentEditor_savedVersions").append(i)}),this.savedVersions.length>1){var i=this.savedVersions[this.savedVersions.length-1].id;t("#concurrentEditor_savedVersion_viewChanges").html('<a href="'+ws.common.pathFor("page","diff",wikispaces_page)+"?v1="+n+"&v2="+i+'" target="_new">View all changes since I started editing</a>').show()}t("#concurrentEditor_savedVersion_heading").show()}this.concurrentEditors.length?(t("#concurrentEditor_otherEditors").empty(),t.each(this.concurrentEditors,function(e,n){var i=t('<li><img src="/user/pic/'+n.editor+'-sm.jpg" height="16" width="16" style="vertical-align: text-top"/> '+n.editor+" started editing this page at "+n.time+"</li>");t("#concurrentEditor_otherEditors").append(i)}),t("#concurrentEditor_otherEditor_heading").show(),t("#concurrentEditor_noEditors").hide()):(t("#concurrentEditor_otherEditor_heading").hide(),t("#concurrentEditor_noEditors").show()),e.mainEditor.plugins.wspopup.resize("concurrentEditor")},statusUpdated:function(){var e=this,n="";if(1!=this.savedVersions.length||this.concurrentEditors.length)if(this.savedVersions.length>1&&!this.concurrentEditors.length)n=this.savedVersions.length+" people have saved this page.";else if(this.savedVersions.length||1!=this.concurrentEditors.length)if(!this.savedVersions.length&&this.concurrentEditors.length>1)n=this.concurrentEditors.length+" people are editing.";else{if(!this.savedVersions.length||!this.concurrentEditors.length)return;n="This page is being edited and has been saved."}else{var i=this.concurrentEditors[0].editor;n='<img src="/user/pic/'+i+'-sm.jpg" height="16" width="16" style="vertical-align: text-top;"/> '+i+" is editing."}else{var i=this.savedVersions[0].editor;n='<img src="/user/pic/'+i+'-sm.jpg" height="16" width="16" style="vertical-align: text-top;"/> '+i+" saved this page."}var o=t("#concurrentEditorNotice");if(o.get(0))t("#concurrentEditorNoticeMessage").html(n);else{o=t('<div id="concurrentEditorNotice" class="mceToolbar">').hide();var r=t('<div id="concurrentEditorNoticeMessage" style="display: inline;">');r.html(n);var a=t('<button class="wsbtn" id="concurrentEditorDetails">Details</button>');a.click(function(t){return e.showConcurrentEditorPopup(),o.hide(),t.preventDefault(),!1});var s=t('<button class="wsbtn">Hide</button>');s.click(function(e){return o.hide(),e.preventDefault(),!1}),o.append(r).append(a).append(s),t(".mceExternalToolbar").append(o)}o.is(":visible")||o.slideDown()}}),e.PluginManager.add("wsautosave",wikispaces.plugins.AutosavePlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.BlockFormatPlugin",{init:function(n){if(this.editor=n,n.addCommand("wsFormatBlock",function(i,o){if(e.isIE){var r=t(n.selection.getNode());r.is("p")&&0==r.contents().length&&r.append("﻿"),n.execCommand("FormatBlock",i,o)}else{n.undoManager.begin();var a=n.selection.getBookmark(2);t(e.activeEditor.selection.getNode()).closest("li").length>0?(n.execCommand("FormatBlock",i,"p"),n.execCommand("FormatBlock",i,o),t(e.activeEditor.selection.getNode()).closest("li").find("p").each(function(e,n){t(n).replaceWith(n.childNodes)})):(n.execCommand("FormatBlock",i,o),t(n.plugins.wscommon.getSiblingOfElement(n.theme.getHeaderParent(n.selection.getNode()),"previous")).filter("br").after("<br>")),n.selection.moveToBookmark(a),n.undoManager.end()}}),n.onKeyDown.add(function(n,i){if(13==i.keyCode&&i.shiftKey&&t(n.selection.getNode()).closest("h1,h2,h3,h4,h5,h6").length>0&&!n.wsselection.isAtTheEndOf("h1,h2,h3,h4,h5,h6")){var o=t(n.selection.getNode()).closest("h1,h2,h3,h4,h5,h6").get(0);n.selection.setContent("<span id='_ws_tmp'></span>");var r=t("#_ws_tmp",n.getDoc()).get(0);n.dom.split(o,r),n.plugins.wscommon.cursorToAndRemoveElement(t("<span>",n.getDoc()).prependTo(t(r).next())),t(r).remove(),e.dom.Event.cancel(i)}}),e.isWebKit){var i=!1;n.onKeyDown.add(function(e,n){i=13==n.keyCode&&t(e.selection.getNode()).closest("h1,h2,h3,h4,h5,h6").length>0}),n.onKeyUp.add(function(e){if(i&&t(e.selection.getNode()).closest("div").length>0){var n=t("<span>",e.getDoc()).replaceAll(t(e.selection.getNode()).closest("div")).after("<br/>");e.plugins.wscommon.cursorToAndRemoveElement(n)}})}e.isGecko&&n.onKeyUp.add(function(e,n){if(9==n.keyCode){var i=t(e.selection.getNode()).closest("p");/padding-left/.test(i.attr("style"))&&(i.css("padding-left",""),e.undoManager.add()&&e.undoManager.remove())}})},getInfo:function(){return{longname:"Wikispaces block Format",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}}}),e.PluginManager.add("wsblockformat",wikispaces.plugins.BlockFormatPlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.BrToP",{init:function(e){var n=this;n.editor=e,e.onBeforeSetContent.add(function(e,t){"raw"!=t.format&&"visual"==e.plugins.wscommon.getOption("mode")&&(t.content=n.processContent(t.content))}),e.plugins.paste&&e.plugins.paste.onPostProcess.add(function(e,i){t.browser.msie&&(t("span[style]",i.node).each(function(){var e=t(this);"left"==e.css("text-align")&&e.css("text-align","")}),t("span:empty",i.node).remove(),t("p br",i.node).remove(),t("li br",i.node).remove());var o=t(i.node).html();t(i.node).html(n.processContent(o))}),e.onKeyDown.add(function(e,n){if(n.shiftKey&&13==n.keyCode){var i=t(e.selection.getNode()).closest("li,td,th,p,pre,code");if(i.is("pre,code"))return;n.stopPropagation(),n.preventDefault(),e.undoManager.begin(),e.selection.setContent('<span id="wsTemp">﻿</span>'),i.is("p")||(i.wrapInner('<p id="wsHolder">'),i=t(i).find("#wsHolder").removeAttr("id")),i.children().last().is("br")&&i.children().last().remove();var o=!0,r=!0,a=!1;if(t(i).contents().each(function(n,i){!a||1!=i.nodeType&&e.plugins.wscommon.isTextEmpty(i.nodeValue)||(r=!1),t(i).is("#wsTemp")&&(a=!0),a||1!=i.nodeType&&e.plugins.wscommon.isTextEmpty(i.nodeValue)||(o=!1)}),!a){o=!1;for(var s=t(i).contents().get(0);!a&&s;){for(var l=1;s&&3==s.nodeType&&e.plugins.wscommon.isTextEmpty(s.nodeValue);)s=t(s).parent().contents().get(l++);t(s).is("#wsTemp")?(a=!0,o=!0):s=t(s).contents().get(0)}for(r=!1,s=t(i).contents().last().get(0);!a&&s;){for(var l=t(s).parent().contents().length-2;s&&3==s.nodeType&&e.plugins.wscommon.isTextEmpty(s.nodeValue);)s=t(s).parent().contents().get(l--);t(s).is("#wsTemp")?(a=!0,r=!0):s=t(s).contents().last().get(0)}}return o||r?r?(t("#wsTemp",e.getDoc()).closest("p").after("<p><br/></p>"),e.plugins.wscommon.isNodeEmpty(t("#wsTemp",e.getDoc()).closest("p"))&&0==t("#wsTemp",e.getDoc()).closest("p").children().not("#wsTemp").length&&t("#wsTemp",e.getDoc()).after("<br/>"),e.selection.select(t("#wsTemp",e.getDoc()).closest("p").next("p").get(0),!0),e.selection.collapse(!0)):o&&(t("#wsTemp",e.getDoc()).closest("p").before("<p><br/></p>"),e.selection.select(t("#wsTemp",e.getDoc()).closest("p").get(0),!0),e.selection.collapse(!0)):(e.dom.split(i.get(0),t("#wsTemp",e.getDoc()).get(0)),e.selection.select(t("#wsTemp",e.getDoc()).next("p").get(0),!0),e.selection.collapse(!0)),t("#wsTemp",e.getDoc()).remove(),e.undoManager.end(),!1}})},processContent:function(e){var n=t("<div>",this.editor.getDoc()).html(e);return this.convertDisplayBlockToDiv(n),this.convertBrToP(n),n.html()},convertDisplayBlockToDiv:function(e){var n=this.editor;t("span",e).each(function(e,i){var o=t(i),r=o.css("text-align"),a=o.attr("style");if("block"==o.css("display")||a&&a.match(/text-align/i)&&("left"==r||"right"==r||"center"==r||"justify"==r)){o.css("display","");var s=t("<div>",n.getDoc()).html(o.html());o.attr("style")&&s.attr("style",o.attr("style")),o.replaceWith(s)}})},convertBrToP:function(e){var n=this;this.splitOnBr(e),this.convertBrToPElements(e);var i=t.browser.msie?"<BR>":"<br>\n";t(e).find("th,td").each(function(e,o){o.innerHTML==i?o.innerHTML="&nbsp;":n.convertBrToPElements(t(o))})},splitOnBr:function(e){var n=this.editor;t(e).find("br").each(function(e,i){for(;!t(i).parent().is("td,th,li,pre,code,div,body");)n.dom.split(i.parentNode,i)})},convertBrToPElements:function(e){var n=this.editor,i=null;t(e).contents().each(function(e,o){if(1==o.nodeType&&"br"==o.nodeName.toLowerCase())i?i=null:(i=t("<p>",n.getDoc()).insertBefore(o),i=null),t(o).remove();else if(3==o.nodeType||1==o.nodeType&&!n.dom.isBlock(o)){if(!i){if(3==o.nodeType&&n.plugins.wscommon.isTextEmpty(o.nodeValue))return;i=t("<p>",n.getDoc()).insertBefore(o)}i.append(o)}else 1==o.nodeType&&n.dom.isBlock(o)&&(i=null)})}}),e.PluginManager.add("wsbrtop",wikispaces.plugins.BrToP)}(tinymce,jQuery),function(e,t){e.create("static wikispaces.util.Cleanup",{cleanupEmptySpans:function(e){ws.common.log("cleanupEmptySpans",e);for(var n=e.length-1;n>=0;n--){var i=t(e[n]);if(!i.is(".commentBase")&&!i.is(".commentRef")){var o=t.trim(i.text());i.parents("body").length>0&&(0==e[n].childNodes.length||1==e[n].childNodes.length&&3==e[n].childNodes[0].nodeType&&(""==o||8203==o.charCodeAt(0)))&&i.replaceWith(i.text())
}}},cleanupEmptyDivs:function(e){ws.common.log("cleanupEmptyDivs",e);for(var n=e.length-1;n>=0;n--){var i=t(e[n]),o=t.trim(i.text());i.parents("body").length>0&&(0==e[n].childNodes.length||1==e[n].childNodes.length&&3==e[n].childNodes[0].nodeType&&(""==o||8203==o.charCodeAt(0)))&&i.replaceWith("<div> </div>")}},cleanupNoAttributeSpans:function(e){var n=this;ws.common.log("cleanupNoAttributeSpans"),t(e).find("span").each(function(){if(!n.selectedSpans||this!=n.selectedSpans[0]){var e=t(this);e.attr("style")||e.attr("class")||e.replaceWith(e.contents())}}),(t(e).find(":last").is("span,div")||t(e).find(":last").is("br")&&t(e).find(":last").prev().is("span,div"))&&t(e).append("&nbsp;")},getStyleArray:function(n){if(!n)return{};var i=t(n).attr("style");return i?e.activeEditor.dom.parseStyle(i):{}},normalizeCssSelector:function(e){return e==e.toUpperCase()&&(e=e.toLowerCase()),ws.common.camelize(e)},mergeStyles:function(e,t){var n={};for(var i in e)"function"!=typeof e[i]&&(n[i]=e[i]);for(var i in t)"function"!=typeof t[i]&&(n[i]=this.mergeCss(e[i],i,t[i]));return n},collapseNodes:function(e){ws.common.log("collapseNodes");for(var n=[],i=e.length-1;i>=0;i--)if(t(e[i]).parents("body").length>0){var o=this.collapseNodeDown(e[i]);n[n.length]=o}return n},flattenNodes:function(e){ws.common.log("flattenNodes",e);for(var n=e.length-1;n>=0;n--)for(var i,o=[t(e[n])];i=o.pop();){var r=i.parent();if(r.is(i.get(0).tagName)){ws.common.log("flattening",i.get(0),i.html());var a=r.contents(),s=a.index(i),l=r.clone().empty().append(a.slice(s+1));t(r).after(l).after(i);var c=this.mergeStyles(this.getStyleArray(r.get(0)),this.getStyleArray(i.get(0)));for(var u in c)if("function"!=typeof c[u])try{i.css(u,c[u])}catch(d){}""==t.trim(r.html())&&r.remove(),""==t.trim(l.html())?l.remove():o.push(l),o.push(i)}}},collapseNodeDown:function(e){for(;t(e).parent().is(t(e).get(0).tagName)&&t(e).parent().attr("class")==t(e).attr("class")&&1==t(e).parent().children().length;){for(var n=!0,i=0;e.parentNode.childNodes.length>i;i++)if(3==e.parentNode.childNodes[i].nodeType&&""==!t.trim(e.parentNode.childNodes[i].nodeValue)){n=!1;break}if(!n)break;e=e.parentNode}for(var o="",r="",a=this.getStyleArray(e),s=e;1==t(s).children().length&&t(s).children().eq(0).is(s.tagName)&&t(s).attr("class")==t(s).children().eq(0).attr("class");){for(var l=!0,n=!0,i=0;s.childNodes.length>i;i++)if(1==s.childNodes[i].nodeType)l=!1;else{if(3!=s.childNodes[i].nodeType||""!=t.trim(s.childNodes[i].nodeValue)){n=!1;break}l?o+=s.childNodes[i].nodeValue:r+=s.childNodes[i].nodeValue}if(!n)break;s=t(s).children().get(0),a=this.mergeStyles(a,this.getStyleArray(s))}if(s&&s!=e){t(s).prepend(o),t(s).append(r);var c=t(s).html();t(e).empty(),t(e).html(c);for(var u in a)if("function"!=typeof a[u])try{t(e).css(u,a[u])}catch(d){}}return e},mergeNodes:function(e){if(ws.common.log("mergeNodes",e),e&&0!=e.length){for(var n=this.editorDocument,i=e[0].tagName,o=!0;o;)o=!1,t(n.body).find(i+" + br").each(function(){1==this.previousSibling.nodeType&&(o=!0,t(this).prev().append("<br/>"),t(this).remove())});t(n.body).find(i).each(function(){var e=this.nextSibling;e&&3==e.nodeType&&""==t.trim(e.nodeValue)&&e.nextSibling&&1==e.nextSibling.nodeType&&e.nextSibling.tagName==i.toUpperCase()&&t(e.nextSibling).attr("style")==t(this).attr("style")&&t(e.nextSibling).attr("class")==t(this).attr("class")&&(t(this).append(e.nodeValue),e.parentNode.removeChild(e))});for(var r=e.length-1;r>=0;r--)t(e[r]).parents("body").length>0&&this.mergeNode(e[r]);for(o=!0;o;)o=!1,t(n.body).find(i+" br:last-child").each(function(){this.nextSibling||(o=!0,t(this).parent().after("<br/>"),t(this).remove())});ws.common.log("end mergeNodes",e)}},mergeNode:function(e){var n=t(e);if(e.previousSibling&&e.previousSibling.tagName==e.tagName&&n.prev().attr("class")==n.attr("class")&&n.prev().attr("style")==n.attr("style")){var i=n.prev();i.html(i.html()+n.html()),n.remove()}},mergeCss:function(e,t,n){if(!e||"fontSize"!=t)return n;var i=e.substr(0,e.length-2),o=e.substr(e.length-2,2);"%"==o[1]&&(o="%",i=e.substr(0,e.length-1));var r=n.substr(n.length-2,2),a=n.substr(0,n.length-2);if("%"==r[1]&&(r="%",a=n.substr(0,n.length-1)),("em"==r||"ex"==r)&&(r="%",a=100*a),("em"==o||"ex"==o)&&(o="%",i=100*i),"%"==r){var s=Math.round(100*i*a)/1e4;return s+o}return n},removeBrInTable:function(e){t(e).find("td br:last-child, th br:last-child").remove()},removeSafariSpans:function(e){ws.common.log("removeSafariSpans"),t("span.wkzw",e).remove(),t("span",e).removeClass("Apple-tab-span Apple-style-span"),this.cleanupNoAttributeSpans(e)},removeMsoStyles:function(e){var n=this;t(e).each(function(){var e=n.getStyleArray(this),i=!1;for(var o in e)"function"==typeof e[o]?delete e[o]:0==o.indexOf("mso")&&(delete e[o],i=!0);if(i)try{var r=t("<"+t(this)[0].tagName+">",this.ownerDocument).attr("class",t(this).attr("class")).html(t(this).html()).attr("id",t(this).attr("id")).css(e);t(this).replaceWith(r)}catch(a){}})},actionableSpans:function(e){return t(e).find("span")},actionableDivs:function(e){return t(e).find("div")},cleanup:function(n,i,o){var r=this;if(ws.common.log("cleanup",i),"none"!=i){var a=[];if(i&&(a=i.split(",")),a.length>0){this.editorDocument=n.getDoc();var s=this.editorDocument.body,l=null;o&&(l=e.mainEditor.plugins.wspopup.show("cleanupPopupContents")),t.each(a,function(e,n){switch(n){case"safari":return r.removeSafariSpans(s),void 0;case"mso":return r.removeMsoStyles(r.actionableSpans(s)),void 0;case"collapse":return r.collapseNodes(r.actionableSpans(s)),void 0;case"merge":return r.mergeNodes(r.actionableSpans(s)),void 0;case"flatten":return r.flattenNodes(r.actionableSpans(s)),void 0;case"empty":return r.cleanupEmptySpans(r.actionableSpans(s)),r.cleanupEmptyDivs(r.actionableDivs(s)),void 0;case"bookmarks":return t(s).find("span[_mce_type='bookmark']").remove(),void 0;case"trailingLinebreaks":return t(s).find("p > br:last-child, div > br:last-child").remove(),void 0;case"brTable":return r.removeBrInTable(s),void 0;case"relativeFiles":return t(s).find("img").each(function(){t(this).attr("src").match(/^file\/view/)?t(this).attr("src","/"+t(this).attr("src")):t(this).attr("src").match(/^\.\.\/\.\.\/file\/view/)&&t(this).attr("src",t(this).attr("src").slice(5))}),void 0}}),l&&l.close()}}}}),e.PluginManager.add("wscleanup",wikispaces.util.Cleanup)}(tinymce,jQuery),function(e){e.create("wikispaces.popups.Cleanup",{init:function(e){e.plugins.wspopup.register({wsname:"cleanupPopupContents",title:"Optimize Page",width:340,height:160})}}),e.PluginManager.add("wscleanuppopup",wikispaces.popups.Cleanup)}(tinymce),function(e,t){e.create("wikispaces.plugins.CommentPlugin",{popup:null,init:function(t){this.editor=t,WikispacesCommentManager.clear(),WikispacesCommentManager.readOnly=!1,t.addButton("wscomment",{title:"Add Comment",label:"Comment",onclick:function(){e.activeEditor.wsExecCommand("wsComment")}}),t.onInit.add(function(){_.defer(function(){WikispacesCommentManager.showAll()}),_.delay(function(){WikispacesCommentManager.redrawAll()},1e3),_.delay(function(){WikispacesCommentManager.redrawAll()},3e3)}),t.onModeSwitch.add(function(e){"visual"==e?_.defer(function(){WikispacesCommentManager.showAll()}):"plain"==e&&WikispacesCommentManager.hideAll()})},getInfo:function(){return{longname:"Wikispaces comment",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},isAutoSaveComments:function(e){return _(e).any(function(e){return _.isString(e)})},loadComments:function(e){this.isAutoSaveComments(e)?WikispacesCommentManager.retrieveData(function(){_(e).each(function(e,t){var n=WikispacesCommentManager.commentById(t),i=_(e).isString()?e:e.body;n?n.setReply(i):WikispacesCommentManager.addComment(new WikispacesComment({content:i,commentId:t}))})}):WikispacesCommentManager.commentsFromDigests(e),t(".commentColumn").insertAfter("#wsMainEditor_external"),t(".commentColumn").css("right",-58)},newComments:function(){return _(WikispacesCommentManager.unsavedComments()).reduce(function(e,t){return e[t.commentId()]=t.memo(),e},{})},markCommentsSaved:function(){WikispacesCommentManager.markCommentsSaved()}}),e.PluginManager.add("wscomment",wikispaces.plugins.CommentPlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.CommentSpacePlugin",{popup:null,MINIMUM_REDISCOVER_MILLISECONDS:600,init:function(n){this.editor=n;var i=this;this.commentSpace=null,this.commentsDisabled=!!n.plugins.wscommon.getOption("commentsDisabled"),n.onInit.add(function(){t(".mceIframeContainer iframe").css("background-color","transparent").attr("allowTransparency",!0),i.commentSpace=new WikispacesCommentSpace(n.getBody(),n.getContainer(),n.getContainer(),t(n.getContainer()).find(".mceIframeContainer"),n),n.theme.controlManager().setDisabled("wscomment",i.commentsDisabled)}),n.onSetContent.add(function(){var e=t("a.range[name^=comment-]:last",n.getBody());e.size()>0&&0==e.next().size()&&(e.parent().is("body")||0==e.parent().next().size())&&t(n.getBody()).append("<p><br/></p>")}),n.onRemove.add(function(){i.commentSpace&&(WikispacesCommentManager.removeSpace(i.commentSpace),i.commentSpace=null)}),n.addCommand("wsComment",function(){function i(e){return e?(1==e.nodeType?t(e).text():e.nodeValue||"")+i(e.nextSibling):""}if(!(n.wsselection&&n.wsselection.withinCode()||n.selection.isCollapsed())){var o=new WikispacesComment;n.wsselection.normalizeOutsideLinks();var r=n.selection.getRng(!0).cloneRange(),a=n.selection.getRng(!0).cloneRange();r.collapse(!0),a.collapse(!1);var s=n.getDoc().createTextNode(" ");a.insertNode(s),t.trim(i(s.nextSibling))&&s.parentNode.removeChild(s);var l=o.generateCloser(n.getDoc());a.insertNode(l);var c=o.generateOpener(n.getDoc());r.insertNode(c),e.isIE&&(l=t(l),!l.parent().is("p")&&l.prev().is("p")&&l.appendTo(l.prev()),8>=t.browser.version&&(n.dom.setOuterHTML(c,n.dom.createHTML("a",{name:o.openAnchorName(),"class":"range"},"")),n.dom.setOuterHTML(l,n.dom.createHTML("a",{name:o.closeAnchorName(),"class":"range"},"")))),WikispacesCommentManager.addComment(o),o.open(),n.selection.collapse()}});var o=0,r=function(e){var t=(new Date).getTime();i.MINIMUM_REDISCOVER_MILLISECONDS>t-o?setTimeout(function(){t>o&&(o=(new Date).getTime(),WikispacesCommentManager.redrawAll(e))},i.MINIMUM_REDISCOVER_MILLISECONDS):(o=t,WikispacesCommentManager.redrawAll(e))};n.onChange.add(function(){setTimeout(r,0)}),n.onUndo.add(function(){r(!0)}),n.onRedo.add(function(){r(!0)}),n.onKeyUp.add(r)},getInfo:function(){return{longname:"Wikispaces comment space",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},loadComments:function(e){WikispacesCommentManager.load(e)}}),e.PluginManager.add("wscommentspace",wikispaces.plugins.CommentSpacePlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.CommonPlugin",{init:function(e){var n=this;if(this.editor=e,e.onLoadContent.add(function(e){n.startingSpanCount=t(e.getDoc()).find("span").length}),(t.browser.mozilla||t.browser.webkit)&&e.onBeforeSetContent.add(function(e,t){t.content.match(/<hr ?\/>\s*$/)&&(t.content+="<br/>")}),e.plugins.paste){e.plugins.paste.onPreProcess.add(function(e,t){t.content=t.content.replace(/<\/?pre>/gi,"")});var i=["font-family","font-size","background-color","text-align","vertical-align","text-decoration","color"];e.plugins.paste.onPostProcess.add(function(e,n){t("*",n.node).each(function(){var e=t(this);if(e.attr("style")){var n={};t.each(i,function(t,i){e.attr("style").match(RegExp("\\b"+i+"\\b","i"))&&(n[i]=e.css(i))}),e.attr("style",""),e.css(n)}}),wikispaces.util.Cleanup.collapseNodes(t("span",n.node)),wikispaces.util.Cleanup.flattenNodes(t("span",n.node))})}},getInfo:function(){return{longname:"Wikispaces common",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},fullContent:function(n,i){if("visual"==this.editor.plugins.wscommon.getOption("mode")){try{var o=i?i.split(","):[];o.push("mso"),o.push("merge"),o.push("relativeFiles");var r=t(this.editor.getDoc()).find("span").length;r!=this.startingSpanCount&&o.push("collapse"),e.isWebKit&&o.push("safari"),wikispaces.util.Cleanup.cleanup(this.editor,o.join(","),n),this.startingSpanCount=t(this.editor.getDoc()).find("span").length}catch(a){}return t("img[data-mce-src]",this.editor.getDoc()).each(function(){t(this).attr("src",t(this).data("mce-src"))}),this.editor.plugins.wsreference.pushInReferences(this.editor.getContent({format:"raw"}))}return t("#textEditor").val()},editorIFrame:function(){return document.getElementById(this.editor.id+"_ifr")},editorToolbar:function(){return document.getElementById(this.editor.id+"_external")},editorContainer:function(){return document.getElementById(this.editor.id+"_container")},sessionReloadFailed:function(){var t=e.mainEditor;this.reloadFailed=!0,t.plugins.wsautosave.autosaveEnabled=!1,t.plugins.wsautosave.setStatus("Autosave Disabled",!0),t.controlManager.setDisabled("wspreview",!0),t.controlManager.setDisabled("wsimage",!0),t.plugins.wslinkpopup.disableSelect(),alert("Your connection to Wikispaces has been disrupted.  We recommend you save your page now, and try editing the page again.")},getIframeInParentWindow:function(e){var t=e.ownerDocument,n=t.parentWindow;return n||(n=t.defaultView),n?n.parent==n?null:n.frameElement:null},absoluteOffset:function(e){for(var t=0,n=0;e&&("BODY"!=e.tagName.toUpperCase()||(e=this.getIframeInParentWindow(e)));)t+=e.offsetTop||0,n+=e.offsetLeft||0,e=e.offsetParent;return{left:n,top:t}},getPositionWith:function(e,n,i){n=t(n),e=t(e);var o=this.absoluteOffset(n[0]),r=this.absoluteOffset(e[0].offsetParent),a=o.left+n.outerWidth()-r.left,s=o.top+n.outerHeight()-r.top;i&&(s+=i,a+=i);var l=e.outerWidth(),c=e.outerHeight(),u=t(this.editor.getContentAreaContainer()),d=this.absoluteOffset(u[0]),h=d.left+u.outerWidth(),p=d.top+u.outerHeight();return r.left+a+l>h&&(a=h-l-r.left),r.top+s+c>p&&(s=p-c-r.top),d.top>s&&(s=d.top-r.top),d.left>a&&(a=d.left-r.left),{left:a,top:s}},positionBelow:function(e,n){n=t(n),e=t(e);var i=this.absoluteOffset(n[0]),o=t(window).scrollLeft(),r=t(window).scrollTop(),a=i.left+2,s=i.top+n.outerHeight()+4,l=e.outerWidth(),c=t(window).width()+o;a+l>c&&(a=c-l);var u=e.outerHeight(),d=t(window).height()+r;s+u>d&&(s=d-u),r>s&&(s=r),o>a&&(a=o);var h=this.absoluteOffset(e[0].offsetParent);return{left:a-h.left,top:s-h.top}},scrollToElement:function(e){e=t(e);var n=this.absoluteOffset(e[0]).top,i=e.outerHeight({margin:!0}),o=n+i,r=document.body.scrollTop;0==r&&(window.pageYOffset?r=window.pageYOffset:document.body.parentElement?r=document.body.parentElement.scrollTop:widowTop=0);var a=t(window).height(),s=r+a,l=n-(r+50);if(0>l||i>a-50&&n>r+50)return t(window).scrollTo({top:"+="+(l-30)+"px",left:"+=0px"}),void 0;var c=o-s;c>0&&t(window).scrollTo({top:"+="+(c+150)+"px",left:"+=0px"})},cursorToAndRemoveElement:function(e){e=t(e),e.length&&(this.editor.selection.select(e[0],!0),this.editor.selection.collapse(!0),this.editor.focus(),this.scrollToElement(e),e.remove(),this.editor.nodeChanged())},getSiblingOfElement:function(e,t){if(!e)return null;t||(t="next");for(var n=e[t+"Sibling"];n&&3==n.nodeType&&""==n.nodeValue;)n=n[t+"Sibling"];return n},disableUntilLibsLoad:function(e,t){e.onInit.add(function(){ws.editor.content.isLoaded||(e.theme.controlManager().setDisabled(t,!0),ws.editor.content.add(function(){e.theme.controlManager().setDisabled(t,!1)}))})},isNodeEmpty:function(e){return this.isTextEmpty(t(e).text())},isTextEmpty:function(e){return e=e.replace(/\uFEFF/g,""),e=t.trim(e),0==e.length},areNodesAdjacent:function(e,t){for(var n=e;n&&n!=t;){if(1==n.nodeType)return!1;if(!this.isTextEmpty(n))return!1;n.prev.nextSibling}return n==t?!0:!1},isCommentEditor:function(){return t(this.editor.getContainer()).parent().is(".commentEditor")},getOption:function(e){return t(this.editor.getElement()).closest("form").find('input[title="'+e+'"]').val()},setOption:function(e,n){return t(this.editor.getElement()).closest("form").find('input[title="'+e+'"]').val(n)},resizeToolbar:function(){var e=906,n=706,i=631,o=t("#wsMainEditor_external");t("#wsMainEditor_wspreview").closest("td"),t(window).width()<n+o.offset().left?(t(".mceButtonLabel").slice(0,5).hide(),o.css("min-width",i)):t(window).width()<e+o.offset().left?(t(".mceButtonLabel").slice(0,5).hide(),o.css("min-width",n)):(t(".mceButtonLabel").show(),o.css("min-width",e))}}),e.PluginManager.add("wscommon",wikispaces.plugins.CommonPlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.popups.ConcurrentEditor",{editor:null,init:function(e){var t=this;t.editor=e,e.plugins.wspopup.register({wsname:"concurrentEditor",title:"Page Activity",width:300,height:100,uiSetup:function(e){t.uiSetup(e)}})},uiSetup:function(e){t("#concurrentEditorClose").click(function(t){return e.close(),t.preventDefault(),!1})}}),e.PluginManager.add("wsconcurrenteditorpopup",wikispaces.popups.ConcurrentEditor)}(tinymce,jQuery),function(e,t){e.create("wikispaces.popups.DraftRecovered",{editor:null,init:function(e){var t=this;t.editor=e,e.plugins.wspopup.register({wsname:"draftRecovered",title:"Draft Recovered",width:440,height:130,uiSetup:function(e){t.uiSetup(e)}})},uiSetup:function(e){var n=this.editor,i=n.plugins.wsautoload;t("#recoverDraft").click(function(t){return ws.common.track("Editor","Autosave","Load"),i.loadVersion(i.autosaveContent,i.autosavePageComments,i.autosaveVersion,i.autosaveCleanup),e.close(),n.undoManager.clear(),n.plugins.wsautosave.autosave(!1,i.autosaveContent),t.preventDefault(),!1}),t("#discardDraft").click(function(n){return ws.common.track("Editor","Autosave","Discard"),e.close(),t.ajax({url:ws.common.pathFor("page","discardautosave",wikispaces_page),type:"GET",cache:!1,global:!1}),n.preventDefault(),!1})}}),e.PluginManager.add("wsdraftrecoveredpopup",wikispaces.popups.DraftRecovered)}(tinymce,jQuery),function(e,t){e.create("wikispaces.popups.ExpiredDraft",{editor:null,init:function(e){var t=this;t.editor=e,e.plugins.wspopup.register({wsname:"expiredDraft",title:"Expired Draft Recovered",width:600,height:350,uiSetup:function(e){t.uiSetup(e)}})},uiSetup:function(e){var n=this.editor;n.plugins.wsautoload,t("#expireDraft").click(function(n){return ws.common.track("Editor","Autosave","Forced Discard"),e.close(),t.ajax({url:ws.common.pathFor("page","discardautosave",wikispaces_page),type:"GET",cache:!1,global:!1}),n.preventDefault(),!1})}}),e.PluginManager.add("wsexpireddraftpopup",wikispaces.popups.ExpiredDraft)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.ImagePlugin",{"static":{newImageIdCounter:1},init:function(n){var i=this;n.addCommand("wsimage",function(){e.mainEditor.plugins.wspopup.show("imageTool",{plugin:i})}),n.addButton("wsimage",{title:"Insert Images and Files",label:"File",onclick:function(){e.activeEditor.wsExecCommand("wsimage"),ws.common.track("Editor","Open Image Tool")}}),n.onNodeChange.add(function(t,n,o){if("visual"!=t.plugins.wscommon.getOption("mode"))return t.theme.controlManager().setActive("wsimage",!1),void 0;var r=i.isFilePlaceholder(o);t.theme.controlManager().setActive("wsimage",r),r?e.mainEditor.plugins.wsimageoverlay.show(t,o):e.mainEditor.plugins.wsimageoverlay.hide()}),n.onSetContent.add(function(e){t('img[src*="embedthumbnail/placeholder"]',e.getBody()).addClass("missing")}),n.onClick.add(function(n,o){t(o.target).is("img.missing")&&(n.selection.select(o.target),e.mainEditor.plugins.wspopup.show("imageTool",{plugin:i}))}),n.plugins.paste.onPostProcess.add(function(e,n){t("img",n.node).each(function(){var e=t(this);if(!e.attr("src").match(/https?:\/\//)){var n=Math.max(e.attr("width"),200),i=Math.max(e.attr("height"),50),o=window.location.protocol+"//"+window.location.host+ws.common.pathFor("site","embedthumbnail","placeholder")+"?w="+n+"&h="+i;e.attr("src",o).attr("width",n).attr("height",i).addClass("missing")}})}),e.isGecko&&n.onInit.add(function(){n.dom.bind(n.getBody(),"drop",function(){setTimeout(function(){t("img",n.getDoc()).each(function(){t(this).attr("alt",t(this).attr("alt").replace(/\n/g,""))})},0)})}),n.plugins.wscommon.disableUntilLibsLoad(n,"wsimage")},getInfo:function(){return{longname:"Wikispaces image",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},isFilePlaceholder:function(e){return"IMG"==e.nodeName&&!t(e).hasClass("missing")&&!t(e).hasClass("WikiMedia")&&!t(e).hasClass("WikiReference")&&!t(e).hasClass("WikiAnchor")||t(e).hasClass("WikiMediaFile")},isLocalContext:function(e){var t=null;return"/"==e&&wikispaces_isDefaultSpace?!0:(t=e.match(/^\/([^\/]+)\/([^\/]+)\//))?t[1]==wikispaces_projectName&&t[2]==wikispaces_spaceName:!1},insertImageInEditor:function(e,n,i,o,r,a){var s=this;if("image"==i){ws.common.track("Editor","Add Image",n);var l;o?l=o:"file"==e?l=r+ws.common.encodePath(e,"view",n):"doc"==e&&(l=r+ws.common.encodePath(e,"viewfile",n));var c=t("<img>").attr("src",l).hide().appendTo(t("body"));c.load(function(){s.insertImageInEditorCallback(e,n,i,o,r,a,c)}),c.attr("src",c.attr("src"))}else ws.common.track("Editor","Add File",n),this.insertImageInEditorCallback(e,n,i,o,r,a)},insertImageInEditorCallback:function(n,i,o,r,a,s,l){var c,u,d,h,p,f,m=e.activeEditor,g="",v="newImage-"+wikispaces.plugins.ImagePlugin.newImageIdCounter++,b=v,y=s&&this.isLocalContext(s)?"":s;if("file"==n)d="view",h="WikiMediaFile",p="WikiFile",f="File";else if("doc"==n)d="viewfile",h="WikiMediaDoc",p="GoogleDoc",f="Google Doc";else if("external"!=n)return;if("image"==o){var w="";if(l.width()>800){var x=Math.floor(800/l.width()*l.height());w=' width="800" height="'+x+'"'}u=r?r:this.isLocalContext(s)?ws.common.pathFor(n,d,i):l.attr("src"),g='<img id="'+v+'" src="'+u+'"'+w+"/>",c=e.mainEditor.plugins.wsimageoverlay}else"audio"==o?(b='wikitext@@media@@type="'+n+'" key="'+y+i+'"',u=window.location.protocol+"//www."+wikispaces_domain+"/site/embedthumbnail/"+n+"-audio/"+encodeURIComponent(i)+"?h=20&w=240",g='<img src="'+u+'" class="WikiMedia '+h+'" id="'+v+'" title="Audio Player: '+ws.common.escapeHtml(i)+'" />',c=e.mainEditor.plugins.wswidgetoverlay):"video"==o?(b='wikitext@@media@@type="'+n+'" key="'+y+i+'"',u=window.location.protocol+"//www."+wikispaces_domain+"/site/embedthumbnail/"+n+"-video/"+encodeURIComponent(i)+"?h=300&w=300",g='<img src="'+u+'" class="WikiMedia '+h+'" id="'+v+'" title="Video Player: '+ws.common.escapeHtml(i)+'" />',c=e.mainEditor.plugins.wswidgetoverlay):(b="wikitext@@"+n+"@@"+y+i,u=window.location.protocol+"//www."+wikispaces_domain+"/site/embedthumbnail/"+n+"/"+encodeURIComponent(i)+"?h=40&w=200",g='<img src="'+u+'" class="'+p+'" id="'+v+'" title="'+f+": "+ws.common.escapeHtml(i)+'" />',c=e.mainEditor.plugins.wsimageoverlay);m.wsselection.setContent(g);var k=t("#"+v,m.getBody()).attr("id",b).attr("src",u).get(0);m.wsselection.updateBookmarkToNode(k),m.wsselection.restore(),m.plugins.wscommon.scrollToElement(k),c.show(m,k)}}),e.PluginManager.add("wsimage",wikispaces.plugins.ImagePlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.ImageOverlay",{init:function(e,t){var n=this;e.onInit.add(function(e){var t=function(e){e.onClick.add(function(e,t){e.plugins.wsimage.isFilePlaceholder(t.target)?n.show(e,t.target):n.hide()})};e.onInitSubEditor.add(t),t(e)}),this.overlayInit(e,t)},overlayInit:function(e){var n=this;e.onModeSwitch.add(function(e){"plain"==e&&n.hide()}),e.onKeyDown.add(function(e,t){return!n.img||8!=t.keyCode&&46!=t.keyCode?void 0:(n.removeImage(),!1)}),t(window).resize(function(){n.img&&t(n.img).is(":visible")&&n.repositionAndShow()})},getInfo:function(){return{longname:"Wikispaces image overlay",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},overlayContent:function(){return ws.editor.content.loadContent("imageProperties")},show:function(n,i){var o=this;this.editor=n,this.img!=i&&(this.img=i,null==this.overlay&&(this.overlay=t("<div>").addClass("WikiOverlay overlayLayer").css({position:"absolute"}).html(this.overlayContent()).hide().appendTo("#pageEditor"),this.setup()),e.mainEditor.plugins.wstableoverlay.unselectTableCell(),this.refreshLinkStatus(!0),this.refreshAlignment(),this.setCaption(t(this.img).attr("alt"),!0),t(this.img).hasClass("WikiMediaFile")?(t("#imageAttributes").hide(),t("#imageAppearance").show(),t("#fileRemove").show(),t("#docRemove").hide()):t(this.img).hasClass("WikiFile")?(t("#imageAttributes").hide(),t("#imageAppearance").hide(),t("#fileRemove").show(),t("#docRemove").hide()):t(this.img).hasClass("GoogleDoc")?(t("#imageAttributes").hide(),t("#imageAppearance").hide(),t("#fileRemove").hide(),t("#docRemove").show()):(t("#imageAttributes").show(),t("#imageAppearance").show(),t("#fileRemove").show(),t("#docRemove").hide()),t(this.img).height()>0?this.toggleFitImage():t(this.img).load(function(){o.toggleFitImage(i)}),this.repositionAndShow())},hide:function(){t(this.img).closest("td,th").length&&e.mainEditor.plugins.wstableoverlay.selectTableCell(t(this.img).closest("td,th").get(0)),this.img=null,this.overlay&&this.overlay.hide()},repositionAndShow:function(){this.overlay.css({left:"-10000px",top:"-10000px"}).show();var e=this.editor.plugins.wscommon.positionBelow(this.overlay,this.img);this.overlay.css(e)},refreshLinkStatus:function(e){null!=this.img&&(this.findParentLinkElement(this.img)?this.setImageLink(this.findParentLinkElement(this.img).href,e):this.unsetImageLink(e))},currentAlignment:function(){if(null==this.img)return null;var e=t(this.img).parent("div");return e.length&&"center"==e.css("text-align")?"center":t(this.img).attr("align")},refreshAlignment:function(){switch(t("#imageAlign a").removeClass("buttonSelected"),this.currentAlignment()){case"left":t("#imageAlignLeft").addClass("buttonSelected");break;case"center":t("#imageAlignCenter").addClass("buttonSelected");break;case"right":t("#imageAlignRight").addClass("buttonSelected")}},setCaption:function(e,n){t("#captionText").html(ws.common.truncify(e,80)),t("#imageCaptionInput").val(e),t(this.img).attr("alt",e),t("#captionEditor").hide(),t("#existingCaption").show(),e?(t("#addImageCaption").hide(),t("#imageCaptionControls").show()):(t("#addImageCaption").show(),t("#imageCaptionControls").hide()),n||this.repositionAndShow()},editCaption:function(){t("#imageCaptionControls").show(),t("#existingCaption").hide(),t("#captionEditor").show(),t("#imageCaptionInput").focus()},setup:function(){var e=this;t("#imageAlignLeft").click(function(){return e.setImageAlignment("left"),!1}),t("#imageAlignCenter").click(function(){return e.setImageAlignment("center"),!1}),t("#imageAlignRight").click(function(){return e.setImageAlignment("right"),!1}),t("#imageAlignNone").click(function(){return e.setImageAlignment(""),!1}),t("#imageSizeDown").click(function(){return e.adjustImageSize(-.1),!1}),t("#imageSizeUp").click(function(){return e.adjustImageSize(.1),!1}),t("#imageSizeOriginal").click(function(){return e.adjustImageSize(0,!0),!1}),t("#imageSizeFit").click(function(){return e.adjustImageSize(0,!1,!0),!1}),t("#addImageCaption, #editCaption").click(function(){return e.editCaption(),!1}),t("#saveImageCaption").click(function(){return e.setCaption(t("#imageCaptionInput").val()),!1}),t("#cancelCaption").click(function(){return e.setCaption(t(e.img).attr("alt")),!1}),t("#removeCaption").click(function(){return e.setCaption(null),!1}),t("#addImageLink, #editImageLink").click(function(){return e.editor.selection.select(e.img),e.editor.execCommand("wslink"),!1}),t("#removeImageLink").click(function(){return t(e.img).parent("a").replaceWith(t(e.img).parent("a").contents()),e.unsetImageLink(),e.editor.wsselection.updateBookmarkToNode(e.img),!1}),t("#visitImageLink").click(function(){return window.open(t(e.img).parent("a").attr("href")),!1}),t(".imageRemoveLink").click(function(){return e.removeImage(),!1})},removeImage:function(){this.editor.undoManager.begin();var e=t(this.img);this.findCenteringElement(this.img)?e=t(this.findCenteringElement(this.img)):this.findParentLinkElement(this.img)&&(e=t(this.findParentLinkElement(this.img)));var n=t("<span>",this.editor.getDoc()).insertBefore(e);e.remove(),this.editor.plugins.wscommon.cursorToAndRemoveElement(n),this.editor.undoManager.end(),this.hide()},toggleFitImage:function(){t(this.img).width()>800?t("#imageSizeFit").show():t("#imageSizeFit").hide()},setImageLink:function(e,n){t("#imageLinkText").html(ws.common.truncify(e,60)).attr("title",e),t("#imageLinkControls").show(),t("#addImageLink").hide(),n||this.repositionAndShow()},unsetImageLink:function(e){t("#imageLinkControls").hide(),t("#addImageLink").show(),e||this.repositionAndShow()},updateImageCaption:function(e,n){t(this.img).attr("alt",e),n||this.repositionAndShow()},setImageAlignment:function(e,n){if("center"==e){if(this.findCenteringElement(this.img))return;this.img.align="";var i=t("<div>",this.img.ownerDocument).css("text-align","center"),o=t(this.img);o.parent().is("a")&&(o=o.parent()),o.replaceWith(i).appendTo(i)}else{var r=this.findCenteringElement(this.img);r&&t(r).replaceWith(r.childNodes),this.img.align=e}this.refreshAlignment(),n||this.repositionAndShow()},findCenteringElement:function(e){for(;e;){if(e.tagName&&("CENTER"==e.tagName.toUpperCase()||"DIV"==e.tagName.toUpperCase()&&("center"==e.style.textAlign||"center"==e.align)))return e;if(!e.parentNode)return null;e=e.parentNode}return null},findParentLinkElement:function(e){return t(e).parent("a[href]").get(0)},adjustImageSize:function(e,n,i){var o=this,r=t(this.img);this.starting_width&&this.starting_height?this.adjustImageSizeCallback(e,n,i):r.width()>0&&r.height()>0?(this.starting_width=r.width(),this.starting_height=r.height(),this.adjustImageSizeCallback(e,n,i)):r.load(function(){this.starting_width=r.width(),this.starting_height=r.height(),o.adjustImageSizeCallback(e,n,i)})},adjustImageSizeCallback:function(e,n,i){var o=t(this.img);if(n)return o.removeAttr("height").removeAttr("width").css({height:"auto",width:"auto"}),this.repositionAndShow(),void 0;var r,a;if(i)this.starting_width>800?(a=800,r=Math.round(800/this.starting_width*this.starting_height)):(a=this.starting_width,r=this.starting_height);else if(0!=e){var s=o.height()/this.starting_height,l=o.width()/this.starting_width;r=Math.floor(this.starting_height*(s+e)),a=Math.floor(this.starting_width*(l+e))}r>0&&a>0&&r>=Math.floor(.05*this.starting_height)&&a>=Math.floor(.05*this.starting_width)&&(o.height(r),o.width(a)),this.repositionAndShow(),this.toggleFitImage(),this.editor.plugins.autoresize&&this.editor.plugins.autoresize.fitEditor(),this.editor.onNeedsResize&&this.editor.onNeedsResize.dispatch()}}),e.PluginManager.add("wsimageoverlay",wikispaces.plugins.ImageOverlay)}(tinymce,jQuery),function(e,t){e.create("wikispaces.popups.Image",{MAX_PER_ROW:8,MAX_ROWS:8,PER_PAGE:6,IMAGE_SIZE:32,externalPosition:0,currentMode:"all",newUploads:[],plugin:null,editor:null,tagFilter:null,fileSource:"",init:function(e){var t=this;t.editor=e,e.plugins.wspopup.register({wsname:"imageTool",title:"Images and Files",width:670,height:387,wsselection:0,onShow:function(e){t.onShow(e)},uiSetup:function(e){t.uiSetup(e)}})},onShow:function(e){this.showPage(1),this.setPlugin(e.plugin),this.uploader&&this.uploader.refresh()},setPlugin:function(e){this.plugin=e},addPage:function(e){var n=this,i=document.createElement("a");i.href="#",t(i).click(function(){return ws.common.track("Editor","Show File Page",e),n.showPage(e),!1}),t(i).html(e),t(i).addClass("pageNumber"),t("#imagePages").append(i).append("&nbsp;")},showPage:function(n){var i=this;this.showFileSpinner();var o=(n-1)*this.PER_PAGE,r=this.PER_PAGE,a="";t("#filenameAutocomplete").val()!=t("#filenameAutocomplete").attr("title")&&(a=t("#filenameAutocomplete").val());var s=function(){ws.session.reloadSession(function(){i.showPage(n)},3e3,function(){e.activeEditor.plugins.wscommon.sessionReloadFailed()})},l=ws.common.pathFor("file","listjson",this.currentMode);this.fileSource&&(l=(match=this.fileSource.match(/(.*)\*$/))?match[1]+"file/listjson/"+this.currentMode+"?allTeams=1":this.fileSource+"file/listjson/"+this.currentMode),t.ajaxq("imageList"),t.ajaxq("imageList",{url:l,type:"GET",cache:!1,data:{offset:o,pageLimit:r,filename:a,tag:this.tagFilter.getTags(),sources:t("#fileSourcesList").length?"":"t"},dataType:"json",global:!1,error:s,success:function(e){ws.session.reloadSessionSuccess(),i.loadFileData(e),i.editor.plugins.wspopup.resize("imageTool"),e.sources&&i.buildSourcesList(e.sources,e.currentSource)
}})},buildSourcesList:function(e,n){$fileSources=t("<select/>",{id:"fileSourcesList"}),_.each(e,function(e,i){$option=t("<option/>",{value:i}).text(e).appendTo($fileSources),i==n&&$option.prop("selected",!0)}),t(".filterSourcesDrop").append($fileSources),t(".filterSources").show();var i=this;$fileSources.change(function(){i.fileSource=t(this).val(),i.resetPages(),i.showPage(1)})},showFileSpinner:function(){t("#filenameAutocomplete").css("background","white url('/i/spinner.gif') no-repeat center right")},hideFileSpinner:function(){t("#filenameAutocomplete").css("background-image","none")},setListMode:function(e){t("#fileListMode").val(e),this.currentMode=e,this.tagFilter.setMode(e),this.showPage(1),this.tagFilter.showPage(1)},getCell:function(e,n){return t("#"+e+" tr").eq(Math.floor(n/this.MAX_PER_ROW)).find("td").get(n%this.MAX_PER_ROW)},addRow:function(e){var n=document.createElement("tr");for(j=0;this.MAX_PER_ROW>j;j++)n.appendChild(document.createElement("td"));t("#"+e).append(n)},addFileRow:function(n,i,o,r,a,s,l,c,u){var d=this,h=null;"image"==r||this.isImage(r)||"application/vnd.google-apps.drawing"==r?h="image":this.isAudio(r)?h="audio":this.isVideo(r)&&(h="video"),li1=t("<li>").attr("title",o).addClass("active"),u||li1.click(function(){d.plugin.insertImageInEditor(i,o,h,null,s,l),d.editor.plugins.wspopup.hide("imageTool")});var p=document.createElement("img");if(u)p.src="/i/c.gif",p.width=d.IMAGE_SIZE,p.height=d.IMAGE_SIZE;else if("image"==h&&c)p.src=c,p.height>p.width?(p.width=p.width/p.height*d.IMAGE_SIZE,p.height=d.IMAGE_SIZE):(p.height=p.height/p.width*d.IMAGE_SIZE,p.width=d.IMAGE_SIZE);else{var f=(s?s:"")+ws.common.encodePath(i,"thumbnail",o);p.src=f+"?size="+d.IMAGE_SIZE+(u?"&rnd="+Math.random():""),p.width=d.IMAGE_SIZE,p.height=d.IMAGE_SIZE}t(li1).append(p).append(t('<div class="fileName">').text(ws.common.truncify(o,40)));var m=e.mainEditor.getParam("wsimage_page_view_group");if(1==ws.common.compareGroupPermissionValues(a,m)){var g="This file has more restrictive permissions than this page. Some users may not be able to see it.";t('<img src="/i/icon_16_hidden.png"/>').css({"float":"right","padding-top":6}).attr("title",g).attr("alt",g).appendTo(li1)}return t(".fileList ul").append(li1),li1},addFileCell:function(e,n,i,o,r,a){var s=this,l=this.getCell(e,o);l||(this.addRow(e),l=this.getCell(e,o));var c=document.createElement("td");c.style.textAlign="center",c.style.padding="5px;",c.title=n,t(c).click(function(){s.plugin.insertImageInEditor("external",n,"image",r),s.editor.plugins.wspopup.hide("imageTool")}),a||(a=document.createElement("img")),r&&(a.src=r,a.height>a.width?(a.width=a.width/a.height*s.IMAGE_SIZE,a.height=s.IMAGE_SIZE):(a.height=a.height/a.width*s.IMAGE_SIZE,a.width=s.IMAGE_SIZE)),t(a).appendTo(c),l.parentNode.replaceChild(c,l)},resetPages:function(){var e=this,n=7,i=1;t("#imagePages").html('<a href="#" class="pageNumber pageCurrent" style="visibility: hidden;">&nbsp;</a>');var o=1,r=this.pageCount;this.pageCount>n&&(o=this.currentPage-i,1>o&&(o=1),r=o+i,r>this.pageCount&&(r=this.pageCount));for(var a=1+r-o+(r==this.pageCount?0:1)+(1==o?0:1),s=0;n>a&&(1!=o||r!=this.pageCount);)s%2?(o--,1>o&&(o=1)):(r++,r>this.pageCount&&(r=this.pageCount)),s++,a=1+r-o+(r==this.pageCount?0:1)+(1==o?0:1);if(this.pageCount>1){if(1==this.currentPage)t("#imagePages").append('<span class="pageFirst inactive">&laquo; Previous</span>');else{var l=t('<a href="#" class="pageFirst">&laquo; Previous</a>').click(function(){e.showPage(e.currentPage-1)});t("#imagePages").append(l)}for(o>1&&(this.addPage(1),o>2&&t("#imagePages").append(" ... ")),s=o;r>=s;s++)this.addPage(s);if(this.pageCount>r&&(this.pageCount>r+1&&t("#imagePages").append(" ... "),this.addPage(this.pageCount)),this.currentPage==this.pageCount)t("#imagePages").append('<span class="inactive">Next &raquo;</span>');else{var c=t('<a href="#">Next &raquo;</a>').click(function(){e.showPage(e.currentPage+1)});t("#imagePages").append(c)}}},loadFileData:function(e){var n=this;t(".fileList ul").empty();var i=0;if("myrecent"==this.currentMode){var o=(n.currentPage-1)*n.PER_PAGE;t.each(this.newUploads,function(e,r){if(!(o>e)){if(i>=n.PER_PAGE)return!1;var a=n.addFileRow("imageTable",r.f_type,r.f_name,r.r_mime_type,r.f_view_group,r.f_location,r.f_context,null,!0);t(a).attr("id","swfu_file_"+r.id).find("div.fileName").append("&nbsp;&nbsp;").append(t("<a>").attr("href","#").addClass("uploadCancelButton").attr("id",r.id+"cancel").text("cancel").click(function(e){a.remove(),n.uploader.removeFile(n.uploader.getFile(r.id)),e.preventDefault()})).append('<div class="progressContainer"><div class="progressBar" id="'+r.id+'progress"></div></div>'),i++}})}if(t.each(e.files,function(e,t){return i>=n.PER_PAGE?!1:(n.addFileRow("imageTable",t.f_type,t.f_name,t.r_mime_type,t.f_view_group,t.f_location,t.f_context),i++,void 0)}),!i){var r=t("<li>").text("No files found").addClass("nodata");t(".fileList ul").append(r),i++}for(;this.PER_PAGE>i;){var a=document.createElement("li"),s=document.createElement("img");s.src="/i/c.gif",s.height=n.IMAGE_SIZE,s.width=n.IMAGE_SIZE,a.appendChild(s),a.appendChild(document.createTextNode(" ")),t(".fileList ul").append(a),i++}this.pageCount=e.pagedata.numpages,this.currentPage=e.pagedata.current,this.resetPages(),this.highlightPage(this.currentPage),this.hideFileSpinner()},highlightPage:function(e){t("#imagePages a.pageNumber").each(function(){t(this).html()==e?t(this).addClass("pageCurrent"):t(this).removeClass("pageCurrent")})},externalImageOnloadCallback:function(){},showExternalImage:function(){var e=this,n=document.getElementById("externalImageUrl").value;if(!n)return alert("Please enter the address of an external image."),void 0;var i=t("<img/>");i.one("load",function(){if(0===i[0].height)return alert("The external image could not be found."),void 0;var t=n.match(/.*\/([^\/\?]+)/)[1];e.addFileCell("externalTable",t,"image",e.externalPosition++,n,i[0])}),i.one("error",function(){alert("The external image could not be found.")}),i.attr("src",n)},uiSetup:function(n){var o=this;for(t("#imageCloseButton").click(function(){return n.close(),!1}),i=0;this.MAX_ROWS>i;i++)this.addRow("externalTable");ws.session.reloadSessionAt(0),t("#fileListMode").change(function(){o.setListMode(t(this).val())}),wikispaces_isUserLoggedIn&&wikispaces_isUploadCapable||t("#uploadButtons button").prop("disabled",!0),t("#externalTabCell button").click(function(){return o.showExternalImage(),!1}),t("#imageDiv .modeSelector li.tab").click(function(){t("#imageDiv .modeSelector li.tab").removeClass("selected"),t(this).addClass("selected"),t("#imageDiv .fileMode").hide(),t("#imageDiv").find("#"+t(this).attr("id")+"Cell").show()}),t("#filenameAutocomplete").keyup(function(){o.showPage(1),o.tagFilter.showPage(1)}),wikispaces_username&&t("#fileListMode").append('<option value="myrecent">My Recent Uploads</option>'),ws.autocomplete.registerAutocompleters(t("#imageDiv")),this.tagFilter=ws.cob.initFilter(t("#imageDiv .filterWrapper"),{tagChangeCallback:function(){o.showPage(1)},sessionFailCallback:function(){e.activeEditor.plugins.wscommon.sessionReloadFailed()},tagPageChangeCallback:function(){n.resize()}}),-1!=navigator.platform.indexOf("Mac")&&t("#ctrlKeyName").html("&#8984;"),wikispaces_isUserLoggedIn&&this.setupUploader()},setupUploader:function(){var n=this,i=e.mainEditor;this.uploader=new plupload.Uploader({runtimes:_(ws.common.pluploadRuntimes()).without("silverlight").join(","),browse_button:"uploadFiles",url:i.getParam("wsimage_upload_url"),flash_swf_url:"/s/plupload.flash.swf",silverlight_xap_url:"/s/plupload.silverlight.xap",multipart_params:Cookie.all(),max_file_size:i.getParam("wsimage_max_file_size_mb")+"MB",drop_element:"imageDivTable",container:"uploadButtons"}),this.uploader.init(),this.uploader.bind("FilesAdded",function(e,i){_(i).each(function(e){var t="application/octet-stream";n.isImageFilename(e.name)&&(t="image"),n.newUploads.push({f_name:e.name,r_mime_type:t,id:e.id})}),n.setListMode("myrecent"),t("#imageDivTable .filterTagShow").effect("highlight",{},3e3),t("#filenameAutocomplete").val(""),t("#imageDiv .WikiTokenAutocomplete .closebutton").click(),t("#uploadFiles").hide(),t("#cancelQueueBtn").show(),e.refresh(),e.start()}),this.uploader.bind("UploadProgress",function(e,n){t("#swfu_file_"+n.id).find(".progressBar").css("width",n.percent+"%")}),this.uploader.bind("FileUploaded",function(e,n){t("#swfu_file_"+n.id).attr("id","").find(".progressContainer").remove(),t("#"+n.id+"cancel").remove()});var o=function(){n.newUploads=[],t("#cancelQueueBtn").hide(),t("#uploadFiles").show(),$iframe=t("<iframe>").css({width:0,height:0,border:0}).attr("src",ws.common.pathFor("file","upload")+"?multiModeConfirm=1&remoteMode=true").bind("load",function(){n.setListMode("myrecent"),t("#filenameAutocomplete").val(""),t("#imageDiv .WikiTokenAutocomplete .closebutton").click()}).appendTo(document.body)};this.uploader.bind("UploadComplete",o),t("#cancelQueueBtn").click(function(){n.uploader.stop(),o()}),this.uploader.bind("Error",function(e,n){ws.common.logFileUploadError(n,i.getParam("wsimage_max_file_size_mb")+"MB"),n.file&&t("#"+n.file.id).length&&t("#"+n.file.id).removeClass("fileUploading").addClass("uploadError"),e.refresh()})},isImage:function(e){switch(e){case"image/png":case"image/x-png":case"image/jpeg":case"image/gif":case"image/jpg":case"image/pjpeg":return!0}return!1},isImageFilename:function(e){return e.match(/.*\.(?:gif|jpg|jpeg|png)$/i)},isMedia:function(e){return this.isAudio(e)||this.isVideo(e)},isAudio:function(e){switch(e){case"audio/mpeg":case"audio/mpg":case"audio/mp3":case"audio/x-mp3":case"audio/x-mpeg":case"audio/x-mpg":case"application/asx":case"application/x-mplayer2":case"audio/x-ms-wma":case"audio/x-ms-wax":case"audio/3gpp":case"audio/3gpp2":case"audio/aac":case"audio/x-aac":case"audio/aiff":case"audio/x-aiff":case"audio/mid":case"audio/midi":case"audio/x-midi":case"audio/mp4":case"audio/m4a":case"audio/x-m4a":case"audio/wav":case"audio/x-wav":case"audio/x-pn-realaudio":case"audio/x-pn-realaudio-plugin":return!0}return!1},isVideo:function(e){switch(e){case"video/x-ms-asf-plugin":case"video/x-ms-asf":case"video/x-ms-wm":case"video/x-ms-wmv":case"video/x-ms-wvx":case"video/avi":case"video/3gpp":case"video/3gpp2":case"video/m4v":case"video/x-m4v":case"video/mp4":case"video/mpeg":case"video/x-mpeg":case"video/quicktime":case"video/sd-video":case"video/flv":case"video/x-flv":case"video/x-msvideo":case"application/x-shockwave-flash":case"application/futuresplash":return!0}return!1}}),e.PluginManager.add("wsimagepopup",wikispaces.popups.Image)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.LinkPlugin",{init:function(t){var n=this;this.editor=t,t.addCommand("wslink",function(){e.mainEditor.plugins.wspopup.show("linkTool",{plugin:n})}),t.addButton("wslink",{title:"Insert Link",label:"Link",onclick:function(){e.activeEditor.wsExecCommand("wslink"),ws.common.track("Editor","Open Link Tool")}}),t.onNodeChange.add(function(t,n,i,o,r){t.theme.controlManager().setActive("wslink","A"==i.nodeName&&!i.name||"IMG"==i.nodeName&&"A"==i.parentNode.nodeName),r.initial||("A"!=i.nodeName||i.name||-1!=i.href.indexOf("#mce_temp_url#")||"visual"!=t.plugins.wscommon.getOption("mode")?e.mainEditor.plugins.wslinkoverlay.hide():e.mainEditor.plugins.wslinkoverlay.show(i))}),t.onDblClick.add(function(e,t){"A"==t.target.nodeName&&("A"==t.target.nodeName&&e.selection.select(t.target),e.execCommand("wslink"))}),t.plugins.wscommon.disableUntilLibsLoad(t,"wslink")},getInfo:function(){return{longname:"Wikispaces link",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},setupForms:function(){var n=e.activeEditor;n.wsselection.restore(!0),this.linkEnclosingSelectedImage()?n.plugins.wslinkpopup.prefill(this.parseLink(t(this.linkEnclosingSelectedImage()))):this.selectedLink()?n.plugins.wslinkpopup.prefill(this.parseLink(t(this.selectedLink()))):this.selectedImage()||this.isBlockElementSelected()?n.plugins.wslinkpopup.prefill({linkText:null}):n.plugins.wslinkpopup.prefill({linkText:this.selectedText()})},insertLinkFromComponents:function(n){var o,r=this.editor,a=this.componentsToLink(n),s=this.selectedText()!=n.linkText;if(this.linkEnclosingSelectedImage())this.linkEnclosingSelectedImage().setAttribute("href",a.attr("href")),n.targetNew?this.linkEnclosingSelectedImage().setAttribute("target","_blank"):this.linkEnclosingSelectedImage().removeAttribute("target");else if(o=this.selectedImage())o.parentNode.appendChild(a.get(0)),this.selectedImage().parentNode.replaceChild(a.get(0),o),a.get(0).appendChild(o),e.mainEditor.plugins.wsimageoverlay.refreshLinkStatus(),r.wsselection.updateBookmarkToNode(o);else if(this.selectedLink())r.dom.replace(a.get(0),this.selectedLink()),r.wsselection.updateBookmarkToNode(a.get(0));else if(this.selectedText()&&!s){if(r.wsselection.restore(),r.getDoc().execCommand("unlink",!1,null),t.browser.msie){var l=r.selection.getRng(!0).cloneRange();"A"==l.endContainer.parentNode.nodeName&&0==l.endOffset&&(span=t('<span class="ie-is-the-best">&nbsp</span>').insertBefore(l.endContainer.parentNode),l.setEndBefore(span.get(0)),r.selection.setRng(l))}r.execCommand("CreateLink",!1,"#mce_temp_url#"),t.browser.msie&&t(".ie-is-the-best",r.getDoc()).remove();var c=r.dom.select("a[href='#mce_temp_url#']");for(i=0;c.length>i;i++)if(r.dom.setAttrib(c[i],"href",a.attr("href")),r.dom.removeClass(c[i],"wiki_link"),r.dom.removeClass(c[i],"wiki_link_ext"),r.dom.addClass(c[i],a.attr("class")),n.targetNew&&r.dom.setAttrib(c[i],"target","_blank"),e.mainEditor.plugins.wslinkoverlay.show(c[i]),s&&0==i){r.dom.setHTML(c[i],t("<div>").text(n.linkText).html());break}t("a > a",e.activeEditor.getDoc()).each(function(){t(this).parent().replaceWith(this)})}else r.wsselection.setContent(this.editor.dom.getOuterHTML(a.get(0)));return ws.common.track("Editor","Add Link",a.attr("href")),!0},removeLink:function(){var n=e.activeEditor;if(n.selection.isCollapsed()){n.wsselection.restore(!0);var i=n.dom.getParent(n.selection.getNode(),"A");i&&n.dom.replace(t("<span>",n.getDoc()).get(0),i,!0)}else{if(n.wsselection.restore(),e.isIE&&!n.selection.isCollapsed()){n.selection.setContent('<span id="startMarker">﻿</span>'+n.selection.getContent()+'<span id="endMarker">﻿</span>');var o=t("#startMarker",n.getDoc()),r=t("#endMarker",n.getDoc());n.dom.split(o.closest("a").get(0),o.get(0)),n.dom.split(r.closest("a").get(0),r.get(0));var a=o.next("a");n.selection.select(a.get(0),!0),o.remove(),r.remove()}n.getDoc().execCommand("unlink",!1,null),n.wsselection.tightenSelection();var s=t(n.selection.getRng(!0).startContainer).closest("span.wiki_link,span.wiki_link_new");s.before(s.html()).remove(),n.nodeChanged()}},componentsToLink:function(e){var n,i=null;if(e.pageName){var o=null,r=null;"doc"==e.objectClass?(o="doc",r="view"):"file"==e.objectClass&&(o="file",r="view");var a=ws.common.parseLink(e.pageName,o,r);n=e.wikiName==wikispaces_wikiName?a:"http://"+e.wikiName+"."+wikispaces_domain+a,e.anchor&&(n+="#"+e.anchor),i="wiki_link"}else e.mailTo?(n="mailto:"+e.mailTo,i="wiki_link_ext"):(n=e.url,i="wiki_link_ext");n=encodeURI(n).replace(/%25/g,"%");var s=t("<a></a>",this.editor.getDoc()).attr("href",n).addClass(i);return e.linkText&&s.text(e.linkText),e.targetNew&&s.attr("target","_blank"),s},parseLink:function(e){var t=e.attr("href"),n="",i="",o="",r="",a="",s="page";t=t.replace(/^(\.\.\/)+/,"/");var l="(?:/"+ws.common.PROJECT_INDICATOR+"/(.*?/.*?))?/(?:(page|file|doc)/view/)?([^#/]+)?(?:#(.+))?$",c=RegExp("^(?:https?://)?([a-z0-9-]+)."+ws.common.escapeRegExp(wikispaces_domain)+l,"i"),u=RegExp("^(?:https?://)?"+ws.common.escapeRegExp(location.hostname)+l,"i"),d=RegExp("^"+l,"i"),h=null;(h=c.exec(t))?(n=h[1],i=h[4],i||h[5]||(i="home"),h[2]&&(i=h[2]+"/"+i),h[3]&&(s=h[3]),o=h[5]):(h=u.exec(t))||(h=d.exec(t))?(n=wikispaces_wikiName,i=h[3],i||h[4]||(i="home"),h[1]&&(i=h[1]+"/"+i),h[2]&&(s=h[2]),o=h[4]):(h=t.match(/^mailto:(.+)/i))?a=h[1]:r=t,s=s.replace(/\/view\//,""),i&&(i=i.replace(/\+/g," "),i=decodeURIComponent(i)),o&&(o=o.replace(/\+/g," "),o=decodeURIComponent(o));var p=e.text().replace(/\uFEFF/g,"");e.find("img").length&&(p=null);var f=e.attr("target")&&e.attr("target").match(/^_(blank|new)/);return{linkText:p,objectClass:s,pageName:i,wikiName:n,anchor:o,extLink:r,mailTo:a,targetNew:!!f}},selectedLink:function(){return this.editor.wsselection.selectedLink()},selectedImage:function(){return this.editor.wsselection.restore(!0),t(this.editor.selection.getNode()).closest("img").get(0)},linkEnclosingSelectedImage:function(){return t(this.selectedImage()).parent("a").get(0)},isBlockElementSelected:function(){return this.editor.selection.getContent().match(/(<\/?table>)|(<\/?tr>)|(<\/?td>)|(<\/?ul>)|(<\/?ol>)|(<\/?li>)/i)},selectedText:function(){return this.editor.wsselection.restore(!0),this.editor.selection.getContent({format:"text"}).replace(/\uFEFF/g,"")}}),e.PluginManager.add("wslink",wikispaces.plugins.LinkPlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.LinkOverlay",{init:function(e){var n=this;this.editor=e,this.overlay=null,e.onInit.add(function(e){var t=function(e){e.onClick.add(function(e,t){"A"==t.target.nodeName?n.show(t.target):n.hide()})};e.onInitSubEditor.add(t),t(e)}),e.onModeSwitch.add(function(e){"plain"==e&&n.hide()}),t(window).resize(function(){n.link&&t(n.link).is(":visible")&&n.repositionAndShow()})},getInfo:function(){return{longname:"Wikispaces link overlay",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},overlayContent:function(){return ws.editor.content.loadContent("linkProperties")},show:function(n){if(this.link!=n){this.link=n,null==this.overlay&&(this.overlay=t("<div>").addClass("WikiOverlay overlayLayer").css({position:"absolute"}).html(this.overlayContent()).hide().appendTo("#pageEditor"),this.setup()),e.mainEditor.plugins.wstableoverlay.unselectTableCell();var i=this.editor.plugins.wslink.parseLink(t(this.link));t(".linkOverlayLabel").hide(),t("#linkOverlayVisit").text("Visit").show(),i.extLink?(t("#linkOverlayLabelUrl").show(),t("#linkOverlayHref").text(ws.common.truncify(i.extLink,60))):i.mailTo?(t("#linkOverlayLabelMailTo").show(),t("#linkOverlayHref").text(ws.common.truncify(i.mailTo,60)),t("#linkOverlayVisit").hide()):(i.wikiName&&i.wikiName!=wikispaces_wikiName&&(t("#linkOverlayLabelWiki").show(),t("#linkOverlayWiki").text(i.wikiName).show()),t("#linkOverlayLabel"+ws.common.ucfirst(i.objectClass)).show(),t("#linkOverlayHref").text(ws.common.truncify(i.pageName,60)),"file"==i.objectClass&&t("#linkOverlayVisit").text("Show")),this.repositionAndShow()}},hide:function(){t(this.link).closest("td,th").length&&e.mainEditor.plugins.wstableoverlay.selectTableCell(t(this.link).closest("td,th").get(0)),this.overlay&&this.overlay.hide(),this.link=null},repositionAndShow:function(){this.overlay.css({left:"-10000px",top:"-10000px"}).show();var e=this.editor.plugins.wscommon.positionBelow(this.overlay,this.link);this.overlay.css(e)},setup:function(){var e=this;t("#linkOverlayVisit").click(function(){return e.visitLink(),!1}),t("#linkOverlayChange").click(function(){return e.changeLink(),!1}),t("#linkOverlayRemove").click(function(){return e.removeLink(),!1})},visitLink:function(){window.open(t(this.link).attr("href")),this.hide()},changeLink:function(){this.editor.execCommand("wslink"),this.hide()},removeLink:function(){this.editor.undoManager.begin(),this.editor.selection.select(this.link),this.editor.plugins.wslink.removeLink(),this.editor.undoManager.end(),this.hide()}}),e.PluginManager.add("wslinkoverlay",wikispaces.plugins.LinkOverlay)}(tinymce,jQuery),function(e,t){e.create("wikispaces.popups.Link",{init:function(e){var t=this;t.editor=e,e.plugins.wspopup.register({wsname:"linkTool",title:"Insert Link",width:480,height:250,wsselection:2,onShow:function(e){t.onShow(e)},uiSetup:function(e){t.uiSetup(e)}})},setPlugin:function(e){this.plugin=e},onShow:function(e){this.setPlugin(e.plugin),this.resetForms(),e.plugin&&e.plugin.setupForms()},resetForms:function(){t("#linkDiv input").val(""),t("#linkText").closest("tr").show(),t("#linkTargetNew").prop("checked",!1).prop("disabled",!1),t("#linkDiv #submitLink span span").text("Add Link"),t("#linkDiv #removeExistingLink").hide(),t("#linkWikiName").val(wikispaces_wikiName),t("#linkWikiName").select2("data",{id:wikispaces_wikiName,text:wikispaces_wikiText}),t("#linkPageName").val(""),t("#linkPageName").select2("data",{id:"",text:""}),t("#linkPageNameError").hide(),this.hideAnchorField()},prefill:function(e){null===e.linkText&&t("#linkText").closest("tr").hide(),e.pageName||e.wikiName?this.prefillInternal(e.linkText,e.objectClass,e.pageName,e.wikiName,e.anchor,e.targetNew):e.mailTo?this.prefillEmail(e.linkText,e.mailTo):e.extLink?this.prefillExternal(e.linkText,e.extLink,e.targetNew):e.linkText&&(t("#linkText").val(e.linkText),t("#linkPageName").val(e.linkText),t("#linkPageName").select2("data",{id:"page:"+e.linkText,text:e.linkText}))},prefillInternal:function(e,n,i,o,r,a){t("#linkText").val(e);var s=o;wikispaces_wikiName==o&&(s=wikispaces_wikiText),t("#linkWikiName").val(o),t("#linkWikiName").select2("data",{id:o,text:s}),t("#linkPageName").val(("page"==n?"":n+":")+i),t("#linkPageName").select2("data",{id:n+":"+i,text:i}),t("#linkAnchor").val(r),r&&this.showAnchorField(),t("#linkTargetNew").prop("checked",a),t("#linkDiv #submitLink span span").text("Change Link"),t("#linkDiv #removeExistingLink").show(),this.showInternal()},prefillExternal:function(e,n,i){t("#linkText").val(e),t("#linkUrl").val(n),t("#linkTargetNew").prop("checked",i),t("#linkDiv #submitLink span span").text("Change Link"),t("#linkDiv #removeExistingLink").show(),this.showExternal()},prefillEmail:function(e,n){t("#linkText").val(e),t("#linkEmailAddress").val(n),t("#linkDiv #submitLink span span").text("Change Link"),t("#linkDiv #removeExistingLink").show(),this.showEmail()},disableSelect:function(){this.sessionFailure=!0},getValidatedLinkComponents:function(){var e;if(t("#linkText").is(":visible")){if(e=t("#linkText").val(),""===e)return alert("Please enter link text."),!1;if(!this.validateLinkText(e))return!1}var n=t("#linkTargetNew").prop("checked");if("Internal"==this.linkType){var i=t("#linkWikiName").val(),o=t("#linkPageName").val(),r="page",a=o.match(/(.+):(.+)/);if(a&&(r=a[1],o=a[2]),""===i||""===o)return alert("Please enter a wiki and page name."),!1;if(!this.validatePageName(o))return!1;var s=null;return"page"==r&&(s=t("#linkAnchor").val(),s&&!this.validateAnchor(s))?!1:{linkText:e,wikiName:i,pageName:o,objectClass:r,anchor:s,targetNew:n}}if("Email"==this.linkType){var l=t("#linkEmailAddress").val();return l.match(/.+@.+\..+/)?(l=l.replace(/[\]\[{}|]/g,encodeURIComponent),{linkText:e,mailTo:l}):(alert("Please enter a valid e-mail address."),!1)}if("External"==this.linkType){var c=t("#linkUrl").val();return c=c.replace(/[\]\[{}|]/g,encodeURIComponent),""===c?(alert("Please enter a URL."),!1):(c.match(/^[a-zA-Z0-9.+-]+:\/\//)||(c="http://"+c),{linkText:e,url:c,targetNew:n})}},validatePageName:function(e){if(e.match(/^\.\.?\s*$/))return t("#linkPageNameError").text("Wiki page names cannot be '.' or '..'.").show(),!1;if(e.length>255)return t("#linkPageNameError").text("Wiki page name cannot be more than 255 characters.").show(),!1;var n,i,o,r=e.match(ws.common.full_link_regex);r&&(n=r[1],i=r[2],o=r[3]);var a=e.match(ws.common.single_page_regex);return a&&(o=a[2]),r||a?n&&n.match(ws.common.projectNameRegex)?(t("#linkPageNameError").text("Project names cannot contain: [ ] :").show(),!1):i&&i.match(ws.common.teamNameRegex)?(t("#linkPageNameError").text("Team names cannot contain: [ ] :").show(),!1):o.match(ws.common.pageNameRegex)?(t("#linkPageNameError").text('Wiki page names cannot contain: [ ] : | { } $ + " # @').show(),!1):(t("#linkPageNameError").hide(),!0):(t("#linkPageNameError").text("To link to a page in another team, use the format 'project/team/page'.").show(),!1)},validateLinkText:function(e){return e.match(/]]|]$/)?(t("#linkTextError").show(),!1):(t("#linkTextError").hide(),!0)},validateAnchor:function(e){return e.match(/^[^\]\|]+$/)?(t("#linkAnchorError").hide(),!0):(t("#linkAnchorError").show(),!1)},showInternal:function(){this.linkType="Internal",t("#linkDiv .selected").removeClass("selected"),t("#switchToInternal").addClass("selected"),t("#linkDiv .modeRow").hide(),t("#linkDiv .internalLink").show(),t("#linkTargetNew").prop("disabled",!1),t("#linkTextWiki").focus(),t("#linkAnchor").val()?this.showAnchorField():this.hideAnchorField()},showExternal:function(){this.linkType="External",t("#linkDiv .selected").removeClass("selected"),t("#switchToExternal").addClass("selected"),t("#linkDiv .modeRow").hide(),t("#linkDiv .externalLink").show(),t("#linkTargetNew").prop("disabled",!1),t("#url").focus()},showEmail:function(){this.linkType="Email",t("#linkDiv .selected").removeClass("selected"),t("#switchToEmail").addClass("selected"),t("#linkDiv .modeRow").hide(),t("#linkDiv .emailLink").show(),t("#linkTargetNew").prop("disabled",!0),t("#linkTextEmail").focus()},showAnchorField:function(){t("#anchorCellOff").hide(),t("#anchorCellOn").show()},hideAnchorField:function(){t("#anchorCellOff").show(),t("#anchorCellOn").hide()},uiSetup:function(n){var i=this;this.linkType="Internal",t("#switchToInternal").click(function(){i.showInternal()}),t("#switchToExternal").click(function(){i.showExternal()}),t("#switchToEmail").click(function(){i.showEmail()}),t("#linkWikiAnchor").click(function(){return i.showAnchorField(),!1}),ws.select2.wikiAndObject(t("#linkWikiName"),t("#linkPageName")),t("#linkText").is(":visible")&&(t("#linkPageName").change(function(){var e=t(this).val().match(/(?:\w+\:)?(.*)/)[1];!e||t("#linkText").val()&&!i.linkTextFromSelection||(t("#linkText").val(e),i.linkTextFromSelection=!0)}),t("#linkText").change(function(){i.linkTextFromSelection=!1}));var o=function(){return e.activeEditor.focus(),n.close(),e.mainEditor.plugins.wsimageoverlay.refreshLinkStatus(),!1};t("#submitLink").click(function(){var e=i.getValidatedLinkComponents();e&&(i.plugin.insertLinkFromComponents(e),o())}),t("#removeExistingLink").click(function(){i.plugin.removeLink(),o()}),t("#linkCloseButton, #cancelLink").click(o)}}),e.PluginManager.add("wslinkpopup",wikispaces.popups.Link)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.ListPlugin",{init:function(n){function i(i){var o=null;if(t(n.selection.getNode()).closest("h1,h2,h3,h4,h5,h6").size()>0&&(o=t(n.selection.getNode()).closest("h1,h2,h3,h4,h5,h6").get(0).nodeName),t(n.selection.getNode()).closest("ul,ol"),n.execCommand(i),e.isWebKit&&o){var a=n.selection.getBookmark();t(n.selection.getNode()).closest("li").wrapInner("<"+o+">"),n.selection.moveToBookmark(a)}r.mergeLists(n.selection.getNode())}var o=this,r=this;this.editor=n,this.selectedItem=null,n.addCommand("wsInsertOrderedList",function(){i("InsertOrderedList")}),n.addCommand("wsInsertUnorderedList",function(){i("InsertUnorderedList")}),n.onNodeChange.add(function(e,n,i){o.selectedItem=t(i).closest("li").get(0);var r=e.wsselection&&e.wsselection.selectedElements("table").length>0;e.theme.controlManager().setDisabled("insertorderedlist",r),e.theme.controlManager().setDisabled("insertunorderedlist",r),e.theme.controlManager().setDisabled("hr",null!=o.selectedItem)}),n.onKeyDown.addToTop(function(n,i){if(o.selectedItem&&!i.ctrlKey&&!i.altKey){if("9"==i.keyCode){try{n.wsExecCommand("useCSS",!1,!0)}catch(r){}n.undoManager.add(),n.undoManager.begin();var a="wsTmpLiWorkingClass";t("."+a,n.getDoc()).removeClass(a);var s=t(n.selection.getNode()).closest("li").addClass(a).children("ol,ul")[0];if(s){for(var l=n.selection.getBookmark();s;)n.dom.split(s.parentNode,s),s=t("."+a,n.getDoc()).eq(0).removeClass(a).end().eq(1).children("ol,ul")[0];n.selection.moveToBookmark(l)}if(t("."+a,n.getDoc()).removeClass(a),i.shiftKey)if(e.isGecko){l=n.selection.getBookmark();var c=t(n.selection.getNode()).closest("li"),u=c.parent("ol,ul");u.length&&(c=u.children().length>1?t(n.dom.split(u[0],c[0])):u.children().replaceAll(u)),c.parent().is("ol,ul")||c.replaceWith(t("<p>",n.getDoc()).append(c.contents())),n.selection.moveToBookmark(l)}else n.wsExecCommand("outdent",!1,"");else{if(n.wsExecCommand("indent",!1,""),e.isWebKit){l=n.selection.getBookmark(),t(n.selection.getStart()).closest("li").addClass("wsholdstart"),t(n.selection.getEnd()).closest("li").addClass("wsholdend");var d=!1,h=!1;t(n.selection.getStart()).parents("ul,ol").last().find("li").each(function(e,n){d||(t(n).is(".wsholdstart")&&(t(n).removeClass("wsholdstart"),h=!0),t(n).is(".wsholdend")&&(t(n).removeClass("wsholdend"),d=!0),h&&t(n).children("br:first-child").remove())}),n.selection.moveToBookmark(l)}if(e.isGecko){var p=t(n.selection.getNode()).parent().closest("blockquote"),f=p.children();if(1==f.length&&f.eq(0).is("ol,ul")){var l=n.selection.getBookmark(),m=f[0].nodeName.toLowerCase();p.wrapInner("<"+m+">").children().eq(0).unwrap(),n.selection.moveToBookmark(l)}}}return n.undoManager.end(),i.preventDefault(),i.stopPropagation(),!1}e.isGecko&&n.onSetContent.add(function(){t("li",n.getBody()).each(function(e,n){0==n.childNodes.length&&t(n).html("<br/>")})})}});var a=!1;n.onKeyDown.addToTop(function(n,i){function r(){var o=t(n.selection.getNode()).closest("li").find("ul,ol").first();o.length||(o=t(n.selection.getNode()).next("ul,ol"));var r=t("<li>&nbsp;</li>").insertBefore(o);o.appendTo(r);var a=t("<span>",n.getDoc()).prependTo(r);n.plugins.wscommon.cursorToAndRemoveElement(a),e.dom.Event.cancel(i)}if(o.selectedItem&&!i.ctrlKey&&!i.altKey){if("13"==i.keyCode&&!i.shiftKey&&e.isIE){var s=t(n.selection.getNode()).closest("li");if(s.length&&""==s.text()&&!s.find("img").length){n.selection.setContent('<span id="_ws_new_cursor">﻿</span>'),s.parent().find("li").each(function(e,n){""!=t(n).text()||t(n).find("img").length||t(n).html('<span class="wsTemp">﻿</span>')}),s=t(n.dom.split(s.parent()[0],s[0])),s.parent().find("span.wsTemp").remove(),s.parent().is("ol,ul")||(s.find("br:last-child").length||s.append("<br>"),s.wrapInner("<p>").replaceWith(s.contents()));var l=t("#_ws_new_cursor",n.getDoc());return l.after(n.getDoc().createTextNode("")),n.selection.select(l[0].nextSibling,!0),n.selection.collapse(!1),l.remove(),e.dom.Event.cancel(i),void 0}if(s=t(n.selection.getNode()).closest("h1,h2,h3,h4,h5,h6,p,div").closest("li"),s.length){n.selection.setContent('<span id="_ws_splitonme">﻿</span><span id="_ws_new_cursor">﻿</span>');var c=t("#_ws_splitonme",n.getDoc());t(n.dom.split(c.closest("li")[0],c[0])).remove();var u=t("#_ws_new_cursor",n.getDoc()).closest("h1,h2,h3,h4,h5,h6,p,div");u.replaceWith(u.contents());var l=t("#_ws_new_cursor",n.getDoc()),s=l.closest("li");return l.remove(),s.prepend(n.getDoc().createTextNode("")),n.selection.select(s[0].firstChild,!0),n.selection.collapse(!1),e.dom.Event.cancel(i),void 0}}if("13"==i.keyCode)if(e.isGecko&&!i.shiftKey&&n.wsselection.isInFrontOf("ul,ol"))r();else if((e.isGecko||e.isWebKit)&&""==t(n.selection.getNode()).text()&&!t(n.selection.getNode()).find("img").length&&t(n.selection.getNode()).parents("ol,ul").length>=2){var d,s=t(n.selection.getNode()).closest("li");s.parent("ul,ol").prev("li").get(0)?(d=t("<span>",n.getDoc()).prependTo(t("<li><br/>").insertAfter(s.parent())),e.isGecko&&setTimeout(function(){t("ul > br:only-child",n.getDoc()).parent().remove()},100)):d=t("<span>",n.getDoc()).prependTo(t("<li><br/>").insertAfter(s.parents("li").first())),setTimeout(function(){n.plugins.wscommon.cursorToAndRemoveElement(d)},100),s.remove(),e.dom.Event.cancel(i)}else if(e.isWebKit)if(i.shiftKey&&n.wsselection.isInFrontOf("ul,ol"))t(n.selection.getNode()).closest("li").find("ul,ol").first().before("<br/>");else if(!i.shiftKey&&t(n.selection.getNode()).closest("h1,h2,h3,h4,h5,h6").size()>0)if(n.wsselection.isAtTheEndOf("li")){var d=t("<span>",n.getDoc()).prependTo(t("<li><br/>").insertAfter(t(n.selection.getNode()).parent("li")));n.plugins.wscommon.cursorToAndRemoveElement(d),e.dom.Event.cancel(i)
}else n.wsselection.isInFrontOf("ul,ol")?reinsertNestedList():a=!0}}),n.onKeyUp.add(function(n,i){if(!(i.shiftKey||i.ctrlKey||i.altKey)&&e.isWebKit){if(o.selectedItem&&"8"==i.keyCode){var r=t(n.selection.getNode()).closest("li"),s=r.next("li").children();if(s.eq(0).is("ul,ol")){var l=s.eq(0);l.remove(),r.append(l),0==r.next("li").children().length&&r.next("li").remove()}}if(a){var c=t(n.selection.getNode()).closest("h1,h2,h3,h4,h5,h6").wrap("<li>");n.plugins.wscommon.cursorToAndRemoveElement(t("<span>",n.getDoc()).prependTo(c)),a=!1}}})},mergeLists:function(e){for(var n=this.editor,i=t(e).parents("ul,ol").last();i.prev().is("ul,ol");)i=i.prev();for(;i.is("ul,ol");)i.find("ol,ul").each(function(e,i){var o=t(i);o.closest("body")[0]==n.getBody()&&o.prev().length&&o.prev()[0].nodeName==o[0].nodeName&&n.plugins.wscommon.areNodesAdjacent(o.prev()[0],o[0])&&(o.prepend(o.prev().html()),o.prev().remove())}),i=i.next(),i[0]&&i[0].nodeName==i.prev()[0].nodeName&&(i.prepend(i.prev().html()),i.prev().remove())},getInfo:function(){return{longname:"Wikispaces list",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}}}),e.PluginManager.add("wslist",wikispaces.plugins.ListPlugin)}(tinymce,jQuery),function(e,t){var n=["WikiAnchor","WikiReference","WikiMediaRss","WikiMediaToc","WikiMediaCustom"];e.create("wikispaces.plugins.ObjectResizePlugin",{init:function(t){this.editor=t;var n=this;t.onInit.add(function(){e.isGecko&&(t.onMouseDown.add(function(e,t){n.enableObjectResizing(n.isResizable(t.target))}),t.onKeyDown.add(function(e,t){t.keyCode>=33&&40>=t.keyCode&&n.enableObjectResizing(!1)})),e.isIE&&t.dom.bind(t.getDoc(),"controlselect",function(e){return n.isResizable(e.srcElement)})})},getInfo:function(){return{longname:"Wikispaces object resize",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},isResizable:function(e){var i=t(e);return i.is("img,pre")&&!this.hasAnyClass(i,n)},enableObjectResizing:function(e){if(this.resizingEnabled!==e){this.resizingEnabled=e;try{this.editor.execCommand("enableObjectResizing",!1,e,{skip_undo:!0})}catch(t){}this.editor.execCommand("mceRepaint",!1)}},hasAnyClass:function(e,n){for(var i=0;n.length>i;i++)if(t(e).hasClass(n[i]))return!0;return!1}}),e.PluginManager.add("wsobjectresize",wikispaces.plugins.ObjectResizePlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.PopupPlugin",{popups:{},popupStack:[],zIndex:4e5,BORDER_HEIGHT:40,BORDER_WIDTH:15,register:function(e){return!e.wsname||this.popups[e.wsname]?!1:(e=t.extend({},e),this.popups[e.wsname]=e,void 0)},show:function(n,i){var o=this.popups[n];if(!o)return!1;void 0!==o.wsselection&&o.wsselection!==!1&&(o.stackPosition>=0||e.activeEditor.undoManager.begin(),e.activeEditor.wsselection.save(o.wsselection)),o.popup||(o.popup=this._openPopup(o));var r=this._getTopPopup();if(r&&o.wsname==r.wsname)return o.popup;o.stackPosition>=0&&this.popupStack.splice(o.stackPosition,1),r&&r.popup.blur();var a=this._getMaxZIndex()||this.zIndex,s=t("#"+o.popup.id);return s.css("z-index",a+2),o.stackPosition=this.popupStack.length,this.popupStack.push(o),o.popup.focus(),s.show(),t(window).bind("resize."+o.popup.id,function(){clearTimeout(o.popup.resizeTimeoutId),o.popup.resizeTimeoutId=setTimeout(function(){o.popup.resize()},10)}),o.popup.resize(!0),this._lightBox(),o.onShow&&(i||(i={}),o.onShow(i)),o.popup},hide:function(n){var i=this.popups[n];if(!i||!i.popup)return!1;if(i.stackPosition>=0){this.popupStack.splice(i.stackPosition,1),i.stackPosition=-1;var o=this._getTopPopup();o?o.popup.focus():(e.activeEditor.focus(),void 0!==i.wsselection&&i.wsselection!==!1&&e.activeEditor.wsselection.restore()),void 0!==i.wsselection&&i.wsselection!==!1&&e.activeEditor.undoManager.end()}return t(window).unbind("."+i.popup.id),t("#"+i.popup.id).hide(),this._lightBox(),!0},resize:function(e,t){var n=this.popups[e];return n&&n.popup?(n.popup.resize(t),!0):!1},_getTopPopup:function(){return this.popupStack[this.popupStack.length-1]},_getMaxZIndex:function(){var e=this._getTopPopup();return e?t("#"+e.popup.id).css("z-index"):0},_lightBox:function(){var e=this._getMaxZIndex()-1,n=t("#wsPopupModalBlocker");n.length||(n=t("<div>").attr("id","wsPopupModalBlocker").addClass("ui-widget-overlay").appendTo(t("body"))),0>e?n.hide():n.css("z-index",e).show()},_openPopup:function(n){var i=this;n=t.extend({min_width:n.width,min_height:n.height},n),void 0==n.content&&(n.content="<div>"+ws.editor.content.loadContent(n.wsname)+"</div>"),n.id=e.DOM.uniqueId();var o=t("<div>").addClass("wsPopup ui-corner-all").attr("id",n.id).css({width:n.width,height:n.height,overflow:"hidden","z-index":-1}).append(n.content).appendTo(t("body"));return t.extend(n,{close:function(){i.hide(n.wsname)},blur:function(){o.removeClass("wsPopupFocus")},focus:function(){o.addClass("wsPopupFocus")},resize:function(e){i._resizePopup(this,e)}}),n.uiSetup&&n.uiSetup(n),this._moveIntoView(n,!0),this._resizePopup(n,!0),n},_resizePopup:function(e,n){if(!e)return!1;var i=this,o=t("#"+e.id),r=o.children().eq(0);o.ready(function(){setTimeout(function(){var a={margin:!0},s=r.outerWidth(a),l=r.outerHeight(a);t.browser.safari&&(alternateWidth=r.outerWidth(),alternateHeight=r.outerHeight(),alternateWidth>s&&(s=alternateWidth),alternateHeight>l&&(l=alternateHeight));var c=0,u=function(){var e=t(this).outerWidth(a)+c,n=t(this).outerHeight(a)+c;e>s&&(s=e),n>l&&(l=n)};r.find("table").each(u),c=20,r.find("iframe").each(u),e.min_height>l&&(l=e.min_height),e.min_width>s&&(s=e.min_width);var d={},h=!1,p=!1,f=t(window).height()-i.BORDER_HEIGHT,m=t(window).width()-i.BORDER_WIDTH;l>f&&(s+=t.getScrollbarWidth()),s>m?(l+=t.getScrollbarWidth(),s=m,d.overflowX="scroll",h=!0):d.overflowX="hidden",l>f?(l=f,d.overflowY="scroll",p=!0):d.overflowY="hidden",d.width=s,d.height=l,o.css(d),i._moveIntoView(e,n)},10)})},_moveIntoView:function(e,n){var i=t(window).height(),o=t(window).width(),r=t("#"+e.id),a={};if(n)a.top=(i-r.height()+this.BORDER_WIDTH)/2,a.left=(o-r.width())/2;else{var s=parseInt(r.css("top")),l=parseInt(r.css("left")),c=i-r.height()-s-this.BORDER_WIDTH/2,u=o-r.width()-l-this.BORDER_WIDTH/2;0>c&&(a.top=s+c),0>u&&(a.left=l+u)}r.css(a)}}),e.PluginManager.add("wspopup",wikispaces.plugins.PopupPlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.PreviewPlugin",{init:function(e){this.editor=e;var n=this;e.addCommand("preview",function(){n.showPreview()}),e.addCommand("endPreview",function(){n.hidePreview()}),e.onModeSwitch.add(function(){t("#previewBox").length&&n.hidePreview()})},getInfo:function(){return{longname:"Wikispaces preview",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},showPreview:function(){var e=this,n=this.editor.plugins.wscommon.fullContent(!0,"empty");this.getPreviewData(n,this.editor.plugins.wscommon.getOption("mode"),function(n){e.hideEditor();var i=t("<div></div>").attr("id","previewBox").addClass("wiki editorLayer").css({width:"100%",position:"relative"}).html(n);t(e.editor.getContainer()).append(i),e.editor.theme.showToolSet("preview"),WikispacesCommentManager.hideAll(),e.commentSpaces=WikispacesCommentManager.preemptSpaces(),WikispacesCommentManager.readOnly=!0,e.previewSpace=new WikispacesCommentSpace(i,"#wsMainEditor_container","#wsMainEditor_container"),WikispacesCommentManager.showAll(),ws.math.process("previewBox")})},hidePreview:function(){t("#previewBox").remove(),this.editor.theme.showToolSet(),t(".mceToolbar.spinner").remove(),t(".mceToolbar").show(),this.showEditor(),WikispacesCommentManager.removeSpace(this.previewSpace),WikispacesCommentManager.restoreSpaces(this.commentSpaces),WikispacesCommentManager.readOnly=!1,"visual"==this.editor.plugins.wscommon.getOption("mode")?WikispacesCommentManager.redrawAll(!0):WikispacesCommentManager.hideAll()},getPreviewData:function(e,n,i){var o=this,r=t("<div></div>").attr("id","previewSpinner").addClass("wikispaces_content").addClass("mceToolbar spinner").css({textAlign:"center"}).html('Loading Preview <img src="/i/spinner.gif" alt="" width="18" height="18" style="padding-top: 9px; vertical-align: -4px;"/>');t(".mceToolbar").hide(),t(o.editor.plugins.wscommon.editorToolbar()).append(r);var a=function(){ws.session.reloadSession(function(){o.showPreview()},3e3,function(){o.editor.plugins.wscommon.sessionReloadFailed(),t(".mceToolbar.spinner").remove(),t(".mceToolbar").show()})};t.ajax({url:ws.common.pathFor("page","preview",wikispaces_page),type:"POST",async:!0,cache:!1,data:{content:e,mode:n},dataType:"xml",global:!1,error:a,success:function(e){ws.common.log("showPreviewResponse",e),ws.session.reloadSessionSuccess();var n=t(e);if(n.find("preview").length&&i(n.find("preview").text()),t(".mceToolbar.spinner").remove(),t(".mceToolbar").show(),!n.find("preview").length)if(n.find("error").length){var o=n.find("error").attr("message");alert(o)}else alert("An unexpected error occurred.")}})},hideEditor:function(){this.bookmark=null;try{this.bookmark=this.editor.selection.getBookmark(2)}catch(e){}t(".WikiOverlay").hide(),this.frameHeight=t(this.editor.plugins.wscommon.editorIFrame()).height(),t(this.editor.getContentAreaContainer()).hide(),t("#referenceEditors").hide()},showEditor:function(){t(this.editor.getContentAreaContainer()).show(),t(this.editor.plugins.wscommon.editorIFrame()).height(this.frameHeight),t("#referenceEditors").show();var e=this;setTimeout(function(){try{e.bookmark&&e.editor.selection.moveToBookmark(e.bookmark)}catch(t){}e.editor.focus(),e.editor.wsselection.ensureCursor()},100)}}),e.PluginManager.add("wspreview",wikispaces.plugins.PreviewPlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.ReferencePlugin",{popup:null,init:function(n){this.editor=n;var i=this;this.nextRefId=0,n.onBeforeSetContent.addToTop(function(e,t){(t.load||t.wsautoload)&&"visual"==e.plugins.wscommon.getOption("mode")&&(i.removeReferenceEditors(),i.pullOutReferences(t))}),n.onModeSwitch.add(function(e){"plain"==e&&i.removeReferenceEditors()});var o=function(){for(var e=0;i.nextRefId>=e;e++){var o=t(n.getDoc()).find("#citation-"+e).length>0,r=i.isReferenceActive(e);(r&&!o||!r&&o)&&i.toggleReference(e)}},r=function(){o()};n.onChange.add(function(){setTimeout(r,0)}),n.onUndo.add(r),n.onRedo.add(r);var a=!1;n.onKeyDown.add(function(e){a=!e.selection.isCollapsed()}),n.onKeyUp.add(function(e,t){(8==t.keyCode||46==t.keyCode||a)&&o()}),n.onDblClick.add(function(n,o){if(t(o.target).is("img.WikiReference")){var r=i.elementIdToRefId(t(o.target).attr("id")),a=e.editors["reference-editor-"+r];t.scrollTo(a.getContentAreaContainer(),{axis:"y",duration:500}),a.focus()}})},getInfo:function(){return{longname:"Wikispaces reference",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},getNextRefId:function(){return++this.nextRefId},elementIdToRefId:function(e){return e.match(/-(\d+)$/)[1]},pullOutReferences:function(e){var t=!1,n=this;e.content=e.content.replace(/(&lt;ref(?:&gt;|>)((?:.|\n)*?)&lt;\/ref(?:&gt;|>))|(<pre\s+.*?>)|(<\/pre>)/gim,function(){if(arguments[1]&&!t){var e=n.getNextRefId(),i=n.makeReferenceHtml(e);return n.addReferenceEditor(e,arguments[2]),i}return arguments[3]?t=!0:arguments[4]&&(t=!1),arguments[0]})},pushInReferences:function(t){return ws.common.log("pushInReferences"),t.replace(/<img[^>]*?id="?citation-(\d+)[^>]*?>/gi,function(t,n){var i=e.editors["reference-editor-"+n].getContent();return"&lt;ref&gt;"+i+"&lt;/ref&gt;"})},makeReferenceHtml:function(e){return'<img src="/i/icon_16_numbersquare.png" alt="Reference - double click to edit" title="Reference - double click to view" width="16" height="16" class="WikiReference" id="citation-'+e+'"/> '},insertReferenceAtSelection:function(){var e=this.getNextRefId();this.editor.wsselection.setContent(this.makeReferenceHtml(e));var n=t(this.editor.getDoc()).find("#citation-"+e),i=t(this.editor.getDoc()).find("img.WikiReference").index(n);return this.addReferenceEditor(e,"Type the content of your reference here.",i)},addReferenceEditor:function(e,n,i){var o="reference-editor-"+e,r='<div id="reference-editor-container-'+e+'" class="editorLayer referenceEditorContainer">'+'<textarea id="'+o+'"></textarea></div>';0==t("#referenceEditors").length&&t("#pageEditor").append('<div id="referenceEditors"></div>'),i!==void 0&&t("div#referenceEditors > div:nth-child("+(i+1)+")").size()>0?t("div#referenceEditors > div:nth-child("+(i+1)+")").before(r):t("#referenceEditors").append(r);var a=function(e){e.setContent(n)};return this.editor.plugins.wssubeditor.create(o,{reference_reference_id:e,height:"50",theme:"-reference"},null,a)},toggleReference:function(e){this.isReferenceActive(e)?(t("#reference-editor-container-"+e).hide(),this.editor.focus(),this.editor.undoManager.begin(),t(this.editor.getDoc()).find("#citation-"+e).remove(),this.editor.undoManager.end()):t("#reference-editor-container-"+e).show()},isReferenceActive:function(e){return t("#reference-editor-container-"+e).is(":visible")},referenceCount:function(){return t("#referenceEditors div.referenceEditorContainer").size()},killEditor:function(e,n){e.remove(),e.destroy(),t("#reference-editor-container"+n).remove(),t("#reference-editor-"+n).remove()},killZombieEditor:function(e,t,n){var i=this;_.delay(function(){e.initialized?i.killEditor(e,t):i.killZombieEditor(e,t,2*n)},n)},removeReferenceEditors:function(){var n=this;t.each(e.editors.concat(),function(){if(match=this.id.match(/^reference-editor-(\d)+/)){var e=parseInt(match[1]);this.initialized?n.killEditor(this,e):n.killZombieEditor(this,e,500)}})}}),e.PluginManager.add("wsreference",wikispaces.plugins.ReferencePlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.util.TimeTracker",{TimeTracker:function(e){this.bucket_=e?e.sort(this.sortNumber):this.DEFAULT_BUCKET},startTime_:null,stopTime_:null,bucket_:null,DEFAULT_BUCKET:[100,500,1500,2500,5e3],_getTimeDiff:function(){return this.stopTime_-this.startTime_},sortNumber:function(e,t){return e-t},_recordStartTime:function(e){this.startTime_=void 0!=e?e:(new Date).getTime()},_recordEndTime:function(e){this.stopTime_=void 0!=e?e:(new Date).getTime()},_track:function(e,t,n){var i;i=void 0!=t&&0!=t.length?e._createEventTracker(t):e._createEventTracker("TimeTracker");var o,r;for(o=0;this.bucket_.length>o;o++)if(this._getTimeDiff()<this.bucket_[o]){if(0==o){r="0-"+this.bucket_[0];break}r=this.bucket_[o-1]+"-"+(this.bucket_[o]-1);break}r||(r=this.bucket_[o-1]+"+");try{i._trackEvent(r,n,this._getTimeDiff())}catch(a){}},_setHistogramBuckets:function(e){this.bucket_=e.sort(this.sortNumber)}}),e.create("wikispaces.plugins.SavePlugin",{timeTracker:null,init:function(t){this.editor=t,this.noDirtyCheck=!1,this.timeTracker=new wikispaces.util.TimeTracker,this.timeTracker._setHistogramBuckets([6e4,12e4,3e5,6e5,12e5,18e5,36e5]),this.timeTracker._recordStartTime();var n=this;t.addCommand("wsSave",function(){n.save()}),t.addCommand("wsSaveAndContinue",function(){n.saveAndContinue()}),t.onSaveContent.add(function(){n.editor.plugins.wsautosave.autosave(!1)}),t.onInit.add(function(){window.onbeforeunload=function(){return!n.noDirtyCheck&&n.isContentDirty()?(e.mainEditor.plugins.wsautosave.autosave(!1),"You have not saved your changes."):void 0}})},createControl:function(n,i){var o=this;if("wssave"==n){var r,a,s,l=i.createSplitButton("wssave",{title:"Save",label:"Save",onclick:function(){o.editor.wsExecCommand("wsSave")}});l.onRenderMenu.add(function(n,i){r=i.add({title:"Save with Comment",icon:"saveWithComment",onclick:function(){e.mainEditor.plugins.wspopup.show("saveWithComment"),t("#saveWithCommentComment").focus()}}),r.setDisabled(!0),s=i.add({title:"Save and Continue",icon:"saveContinue",onclick:function(){n.setDisabled(!0),o.editor.wsExecCommand("wsSaveAndContinue")}}),s.setDisabled(!0),a=i.add({id:"switchEditorModes",title:"visual"==o.editor.plugins.wscommon.getOption("mode")?"Wikitext Editor":"Visual Editor",icon:"saveTextEditor",onclick:function(){o.editor.execCommand("wstext")}})}),l.originalShow=l.showMenu,l.showMenu=function(){var e=t(window).scrollTop();l.originalShow(),t(window).scrollTop(e),t("#menu_wsMainEditor_wsMainEditor_wssave_menu").css({borderBottom:"1px solid #d4d0c9",borderRight:"1px solid #d4d0c9"}).appendTo(document.body),o.editor.plugins.wstoolbarscroll.moveScroller(),ws.editor.content.isLoaded&&(r.setDisabled(!1),s.setDisabled(!1)),o.editor.plugins.wscommon.reloadFailed&&a.setDisabled(!0),o.editor.plugins.wscommon.resizeToolbar()}}else if("wscancel"==n)var l=i.createButton("wscancel",{title:"Cancel",label:"Cancel","class":"mceButtonNotReallyLabeled mceButtonGroup",onclick:function(){ws.common.track("Editor","Stop","Cancel"),o.timeTracker._recordEndTime();try{_gaq.push(function(){o.timeTracker._track(_gat._getTrackerByName(),void 0,"Editor")})}catch(e){}o.isContentDirty()&&o.editor.plugins.wsautosave.autosave(!1),o.noDirtyCheck=!0,document.location=o.editor.getParam("wssave_cancel_url")}});return l},getInfo:function(){return{longname:"Wikispaces save",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},save:function(){this.editor.plugins.wsautosave.autosave(!1);var e;if("failed"==this.editor.plugins.wsautosave.mergeStatus){var n=confirm("Someone else has saved changes to this page since you started editing. You are about to overwrite some of their changes.\n\nClick OK to save. Your edits will overwrite the other person's changes.\n\nClick Cancel to return to editing. We will show you the other person's saved changes. Where there are conflicts, you can copy their changes into your edit by hand.");if(!n)return ws.common.track("Editor","Concurrent Editing","Merge Failed - Cancel"),this.editor.plugins.wsautosave.showConcurrentEditorPopup(),!1;ws.common.track("Editor","Concurrent Editing","Merge Failed - Overwrite"),e=this.editor.plugins.wscommon.fullContent(!0,"bookmarks,empty")}else e="success"==this.editor.plugins.wsautosave.mergeStatus?this.editor.plugins.wsautosave.mergeResult:this.editor.plugins.wscommon.fullContent(!0,"bookmarks,empty");ws.common.track("Editor","Stop","Save"),this.timeTracker._recordEndTime();try{_gaq.push(function(){this.timeTracker&&this.timeTracker._track(_gat._getTrackerByName(),void 0,"Editor")})}catch(i){}var o=t(this.editor.getElement()).closest("form");this.noDirtyCheck=!0,this.addComments(o.get(0)),o.find("#wsMainEditor").val(e),o.submit()},saveAndContinue:function(){if(this.editor.plugins.wsautosave.autosave(!1),"failed"==this.editor.plugins.wsautosave.mergeStatus){var e=confirm("Someone else has saved changes to this page since you started editing. You are about to overwrite some of their changes.\n\nClick OK to save. Your edits will overwrite the other person's changes.\n\nClick Cancel to return to editing. We will show you the other person's saved changes. Where there are conflicts, you can copy their changes into your edit by hand.");if(!e)return ws.common.track("Editor","Concurrent Editing","Merge Failed - Cancel"),this.editor.plugins.wsautosave.showConcurrentEditorPopup(),!1;ws.common.track("Editor","Concurrent Editing","Merge Failed - Overwrite")}var n=this.editor.plugins.wscommon.fullContent(!0,"bookmarks,empty"),i=t(this.editor.getElement()).closest("form");this.noDirtyCheck=!0,this.addComments(i.get(0)),i.find("#wsMainEditor").val(n),i.attr("target","target_editor"),this.editor.plugins.wscommon.setOption("saveAndContinue",1);var o=this;t("#target_editor").one("load",function(){o.editor.plugins.wscomment.markCommentsSaved()}),i.submit()},isContentDirty:function(){if("visual"==this.editor.plugins.wscommon.getOption("mode")){for(var t=0;e.editors.length>t;t++)if(e.editors[t].isDirty())return!0;return!1}return e.mainEditor.plugins.wstext.isDirty()},addComments:function(){this.editor.plugins.wscommon.setOption("pageComments",JSON.stringify(this.editor.plugins.wscomment.newComments()))}}),e.PluginManager.add("wssave",wikispaces.plugins.SavePlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.popups.SaveWithComment",{editor:null,init:function(e){var t=this;t.editor=e,e.plugins.wspopup.register({wsname:"saveWithComment",title:"Save With Comment",width:430,height:100,uiSetup:function(e){t.uiSetup(e)}})},uiSetup:function(e){var n=this.editor;t("#saveWithCommentComment").keydown(function(e){switch(e.which){case 13:t("#saveWithCommentSave").click();break;case 27:t("#saveWithCommentCancel").click()}}),t("#saveWithCommentSave").click(function(e){return ws.common.track("Editor","Stop","Comment"),n.plugins.wscommon.setOption("comment",t("#saveWithCommentComment").val()),n.wsExecCommand("wsSave"),e.preventDefault(),!1}),t("#saveWithCommentCancel").click(function(t){return e.close(),t.preventDefault(),!1}),t("#saveWithCommentClose").click(function(t){return e.close(),t.preventDefault(),!1})}}),e.PluginManager.add("wssavewithcommentpopup",wikispaces.popups.SaveWithComment)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.SelectionPlugin",{init:function(t){t.onInit.add(function(){t.wsselection=new wikispaces.util.Selection(t)}),e.isIE||(t.onKeyUp.add(function(e,t){16!=t.keyCode||e.selection.isCollapsed()||e.wsselection.tightenSelection()}),t.onMouseUp.add(function(e){e.selection.isCollapsed()||e.wsselection.tightenSelection()}),t.onExecCommand.add(function(e){e.selection.isCollapsed()||e.wsselection.tightenSelection()}))},getInfo:function(){return{longname:"Wikispaces selection",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}}}),e.create("wikispaces.util.Selection",{bookmark:null,type:null,textBookmark:null,editor:null,Selection:function(e){this.editor=e},save:function(e){return"visual"==this.editor.plugins.wscommon.getOption("mode")&&this.bookmark||"visual"!=this.editor.plugins.wscommon.getOption("mode")&&this.textBookmark?null:this.saveOver(e)},saveOver:function(e){if("visual"==this.editor.plugins.wscommon.getOption("mode")){this.bookmarkIsCollapsed=this.editor.selection.isCollapsed();try{return this.bookmark=this.editor.selection.getBookmark(e),this.type=e,this.bookmark}catch(t){return null}}var n=this.editor.plugins.wstext.editorTextArea();return this.editor.plugins.wstext.prepareSelection(n),this.textBookmark={start:n.sel_start,end:n.sel_end},this.textBookmark},updateBookmarkToNode:function(e){this.editor.selection.select(e),this.editor.nodeChanged();var t=this.type;null===t&&(t=0),this.saveOver(t)},restore:function(e){if("visual"==this.editor.plugins.wscommon.getOption("mode"))this.bookmark&&(this.editor.selection.moveToBookmark(t.extend({},this.bookmark,{keep:e})),this.bookmarkIsCollapsed&&this.editor.selection.collapse(!0),e||(this.bookmark=null,this.type=null));else if(this.textBookmark){var n=this.editor.plugins.wstext.editorTextArea();this.editor.plugins.wstext.setSelectionRange(n,this.textBookmark.start,this.textBookmark.end),e||(this.textBookmark=null)}},setContent:function(e,n){var i=this.editor;if("visual"==this.editor.plugins.wscommon.getOption("mode")){var o=t("<div>").append(e);o.find("img").addClass("NewWikiImage"),e=o.html(),i.focus(),this.restore(),n&&this.avoid(n),i.selection.setContent(e),i.undoManager.add(),i.onNeedsResize&&i.onNeedsResize.dispatch(),t("img.NewWikiImage",i.selection.getNode()).removeClass("NewWikiImage").load(function(){i.onNeedsResize&&i.onNeedsResize.dispatch()}).each(function(){this.src=this.src})}else this.editor.plugins.wstext.editorTextArea().focus(),this.restore(),this.editor.plugins.wstext.insertInEditor(e),this.textBookmark&&(this.textBookmark.end=this.textBookmark.start)},avoid:function(e){var n=this.editor.selection,i=t(n.getNode()).closest(e).get(0);i&&(n.select(i),n.collapse())},selectedLink:function(){if(this.bookmark&&this.bookmark.id){var e=t("#"+this.bookmark.id+"_start",this.editor.getDoc()).closest("a");if(e.length>0)return e.get(0);var n=t("#"+this.bookmark.id+"_end",this.editor.getDoc()).closest("a");if(n.length>0)return n.get(0);var i=t("#"+this.bookmark.id+"_start",this.editor.getDoc()).next("a");if(i.length>0)return i.get(0)}return t(this.editor.selection.getNode()).closest("a").get(0)},ensureCursor:function(){if(!e.isIE&&"visual"==this.editor.plugins.wscommon.getOption("mode")){var n=this;setTimeout(function(){t("input.WikiSearchInput").first().focus(),t(n.editor.plugins.wscommon.editorIFrame()).focus()},500)}},selectAll:function(){this.editor.selection.select(this.editor.getBody(),!0)},canStepIntoNode:function(e){if(!e||3!=e.nodeType&&1!=e.nodeType)return!1;switch(e.nodeName){case"BR":case"HR":case"EMBED":case"FRAMESET":case"FRAME":case"IFRAME":case"IMG":case"OBJECT":return!1;default:return!0}},tightenSelection:function(){if(!e.isIE){var t=this.editor.selection,n=t.getRng(!0),i=n.startContainer,o=n.startOffset,r=n.endContainer,a=n.endOffset;for(l=null;n.compareBoundaryPoints(Range.START_TO_END,n)>0;){if(3==r.nodeType){if(a>0)break;l=r.previousSibling}else{if(1!=r.nodeType)break;l=a>0?r.childNodes[a-1]:r.previousSibling}var s=null;if(l||(l=r.parentNode,s=0),!this.canStepIntoNode(l))break;if(null===s)if(3==l.nodeType)s=l.nodeValue.length;else{if(1!=l.nodeType)break;s=l.childNodes.length}r=l,a=s,n.setEnd(r,a)}0>=n.compareBoundaryPoints(Range.START_TO_END,n)&&(r=i,a=o,n.setStart(i,o));for(var l=null;n.compareBoundaryPoints(Range.START_TO_END,n)>0;){if(3==i.nodeType){if(i.nodeValue.length>o)break;l=i.nextSibling}else{if(1!=i.nodeType)break;l=i.childNodes.length>o?i.childNodes[o]:i.nextSibling}var s=null;if(l||(l=i.parentNode,3==l.nodeType?s=l.nodeValue.length:1==l.nodeType&&(s=l.childNodes.length)),!this.canStepIntoNode(l))break;null===s&&(s=0),i=l,o=s,n.setStart(i,o)}0>=n.compareBoundaryPoints(Range.START_TO_END,n)&&(i=r,o=a,n.setEnd(r,a)),t.setRng(n)}},isInitialTextNode:function(e){if(3!=e.nodeType)return!1;for(var t=e.prevSibling;null!=t;){if(3!=t.nodeType||""!=t.nodeValue)return!1;t=t.prevSibling}return!0},isTerminalTextNode:function(e){if(3!=e.nodeType)return!1;for(var t=e.nextSibling;null!=t;){if(3!=t.nodeType||""!=t.nodeValue)return!1;t=t.nextSibling}return!0},isAtTheBeginningOf:function(e){if(!this.editor.selection.isCollapsed()||!t(this.editor.selection.getNode()).closest(e).length>0)return!1;var n=this.editor.selection.getRng(!0);if(0!=n.startOffset||!this.isInitialTextNode(n.startContainer))return!1;for(var i=this.editor.selection.getNode();!t(i).is(e);){if(t(i).prev().size()>0)return!1;i=i.parentNode}return!0},isAtTheEndOf:function(e){if(!this.editor.selection.isCollapsed()||!t(this.editor.selection.getNode()).closest(e).length>0)return!1;var n=this.editor.selection.getRng(!0);if(n.endContainer.length!=n.endOffset||!this.isTerminalTextNode(n.endContainer))return!1;for(var i=this.editor.selection.getNode();!t(i).is(e);){if(t(i).next().size()>0)return!1;i=i.parentNode}return!0},mineOrParentsNextSibling:function(e,n){return 0==t(e).next().size()&&e.parentNode?this.mineOrParentsNextSibling(e.parentNode,n):t(e).next().is(n)},isInFrontOf:function(e){if(!this.editor.selection.isCollapsed())return!1;var n=this.editor.selection.getRng(!0);return 3!=n.endContainer.nodeType||n.endContainer.length!=n.endOffset?!1:t(n.endContainer.nextSibling).is(e)?!0:this.mineOrParentsNextSibling(this.editor.selection.getNode(),e)},selectedElements:function(e){for(var n=this.editor.selection.getRng(!0),i=1!=n.startContainer.nodeType?n.startContainer.parentNode:n.startContainer,o=1!=n.endContainer.nodeType?n.endContainer.parentNode:n.endContainer,r=i,a=[];null!=r&&(t(r).is(e)&&a.push(r),r!=o);){if(t(r).has(o).size()>0){t(r).find("*").each(function(){return t(this).is(e)&&a.push(this),this==o?!1:void 0});break}t(r).find(e).each(function(){a.push(this)}),r=t(r).next().size()>0?t(r).next().get(0):t(r).parents().next().get(0)}return a},normalizeOutsideLinks:function(){var e=this.editor.selection.getRng(!0),n=e.startContainer;3==n.nodeType&&(n=n.parentNode),t(n).is("a")&&e.setStartBefore(n);var i=e.endContainer;3==i.nodeType&&(i=i.parentNode),t(i).is("a")&&e.setEndAfter(i),this.editor.selection.setRng(e)},contentBefore:function(){var e=this.editor.selection.getRng(!0),n=e.cloneRange();n.collapse(!0),n.insertNode(t("<span>",this.editor.getDoc()).attr("id","_CB").get(0));var i=this.editor.getContent({format:"raw",no_events:1});t("#_CB",this.editor.getDoc()).remove(),this.editor.selection.setRng(e);var o=i.match(/<span id="_CB"/i);return o?i.substring(0,o.index):""},contentAfter:function(){var e=this.editor.selection.getRng(!0),n=e.cloneRange();n.collapse(!1),n.insertNode(t("<span>",this.editor.getDoc()).attr("id","_CB").get(0));var i=this.editor.getContent({format:"raw",no_events:1});t("#_CB",this.editor.getDoc()).remove(),this.editor.selection.setRng(e);var o=i.match(/<span id="_CB".*?\/span>/i);return o?i.substr(o.index+o[0].length):""},withinCode:function(){return t(this.editor.selection.getStart()).closest("pre").size()>0||t(this.editor.selection.getEnd()).closest("pre").size()>0},withinMath:function(){var e=/\[\[math\]\]/g,t=this.contentBefore().match(e),n=this.contentAfter().match(e);return t&&0!=t.length%2||n&&0!=n.length%2}}),e.PluginManager.add("wsselection",wikispaces.plugins.SelectionPlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.StylePlugin",{firstTime:!0,init:function(n){var i=this;this.editor=n,n.addCommand("wsStyle",function(){ws.common.track("Editor","Open Style Tool");var o=n.selection;if(t(o.getNode()).closest("pre").length)return alert("You cannot apply a style inside of a code block."),void 0;var r=i.getSelectedSpan(o),a=i.getSelectedDiv(o);e.mainEditor.plugins.wspopup.show("stylePopupContents",{plugin:i,span:r,div:a})}),n.addButton("wsstyle",{title:"Style Text",onclick:function(){e.activeEditor.wsExecCommand("wsStyle")}}),n.onNodeChange.add(function(e,n,i){ws.editor.content.isLoaded&&n.setDisabled("wsstyle",e.wsselection&&e.wsselection.withinCode()),n.setActive("wsstyle",t(i).closest("span,div,font,strike,s").length>0)}),n.plugins.wscommon.disableUntilLibsLoad(n,"wsstyle")},getInfo:function(){return{longname:"Wikispaces style",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},applyStyle:function(){ws.common.track("Editor","Apply Style");var n=t(document.styleForm.styleText).val(),i=e.activeEditor;if(i.wsselection.restore(),i.selection.isCollapsed()){var o=t(i.selection.getNode()).closest("span").get(0);if(o){i.selection.setContent('<span id="splitter">﻿</span>');var r=t("#splitter",i.getDoc()).removeAttr("id").get(0);i.dom.split(o,r),i.selection.select(r,!0),e.isWebKit||(i.selection.collapse(),t(r).remove())}}else this.removeStyle();var a=i.dom.parseStyle(n);if(a["text-align"]&&"auto"!=a["text-align"]){var s=t(i.selection.getNode()).closest("div,p,td,th,li,h1,h2,h3,h4,h5,h6");if(s.length){if(!s.is("div")){var l=i.selection.getBookmark();div=t("<div>",i.getDoc()),s.wrapInner("<div>"),s=s.children("div").eq(0),i.selection.moveToBookmark(l)}s.css("text-align",a["text-align"]),delete a.display,delete a["text-align"]}}else a["text-align"]&&"auto"!=a["text-align"]||t(i.selection.getNode()).closest("div,p,td,th,li,h1,h2,h3,h4,h5,h6").css("text-align","");n="";for(var c in a)n+=c+": "+a[c]+";"+"\n";if(n){if(i.selection.isCollapsed()&&e.isIE)return this.applyCaretStyleIE(i,n);i.formatter.register("ws_style",{inline:"span",styles:a}),i.formatter.apply("ws_style")}},applyCaretStyleIE:function(e,n){var i=e.dom.uniqueId(),o=e.getDoc(),r=o.selection.createRange();e.selection.setContent(t("<div>").append(t("<span>").attr("style",n).attr("id",i).text("﻿")).html()),r.moveToElementText(t("#"+i,o)[0]),r.select()},removeStyle:function(){var t=e.activeEditor;t.wsselection.restore(!0),t.execCommand("RemoveFormat"),t.nodeChanged()},setSpanText:function(n){if(n){var i=t(n).attr("style");if(i){var o=this;document.styleForm.removeStyleButton.disabled=!1,t.each(e.activeEditor.dom.parseStyle(i),function(e,t){"function"!=typeof t&&o.setSpanTextValue(e,t)})}}},setSpanTextValue:function(e,n){var i=ws.common.normalizeCssSelector(e);switch(ws.common.log("setting "+e+" as "+i+" with "+n),i){case"fontSize":t(document.styleForm.styleSize).val(n);
break;case"fontFamily":var o=n.replace(/,\s*/gi,", ");t(document.styleForm.styleFont).val(o);break;case"color":var r=new RGBColor(n).toHex().toUpperCase();t(document.styleForm.styleColor).val(r),t.farbtastic("#colorpickerColor").setColor(r);break;case"backgroundColor":var r=new RGBColor(n).toHex().toUpperCase();t(document.styleForm.styleBackgroundColor).val(r),t.farbtastic("#colorpickerBackgroundColor").setColor(r);break;case"textAlign":t(document.styleForm.styleAlignment).val(n);break;case"verticalAlign":if(t(document.styleForm.styleVertical).val(n),t(document.styleForm.styleVertical).val()!=n){var a=t("<option>").val(n).html(n);t(document.styleForm.styleVertical).append(a),t(document.styleForm.styleVertical).val(n)}break;case"textDecoration":("line-through"==n||"lineThrough"==n)&&t(document.styleForm.styleStrike).prop("checked",!0);break;case"accelerator":case"csstext":case"cssText":break;default:t(document.styleForm.styleText).val(t(document.styleForm.styleText).val()+"\n"+e+": "+n+";")}},getUsedColors:function(){var n=[];return t.each(e.editors,function(){t(this.dom.select("span,div")).each(function(){var e=t(this);e.css("color")&&"transparent"!=e.css("color")&&(n[n.length]=new RGBColor(e.css("color")).toHex().toUpperCase()),e.css("backgroundColor")&&"transparent"!=e.css("backgroundColor")&&(n[n.length]=new RGBColor(e.css("backgroundColor")).toHex().toUpperCase())})}),n},getSelectedDiv:function(e){e.getRng(!0).cloneContents();var n=null;return n||(n=t(e.getNode()).closest("div").get(0)),n},getSelectedSpan:function(n){for(var i=n.getRng(!0).cloneContents(),o=null,r=0;i.childNodes.length>r;++r){var a=i.childNodes[r];if(3!=a.nodeType||""!=a.nodeValue&&"﻿"!=a.nodeValue){if(1!=a.nodeType||o){o=null;break}o=a}}if(o||(o=t(n.getNode()).closest("span,font,strike,s").get(0)),o&&o.nodeName.toLowerCase().match(/^(font|strike|s)$/)){var s=o.nodeName.toLowerCase();"s"==s&&(s="strike");var l=e.explode(e.settings.font_size_style_values),c={font:{backgroundColor:o.style.backgroundColor,color:o.color,fontFamily:o.face,fontSize:l[parseInt(o.size)-1]},strike:{textDecoration:"line-through"}};this.editor.wsselection.restore(),this.editor.wsselection.save();var u=this.editor.dom.create("span",{style:c[s]});this.editor.dom.replace(u,o,1),this.editor.wsselection.restore(!0),o=u}return o}}),e.PluginManager.add("wsstyle",wikispaces.plugins.StylePlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.popups.Style",{plugin:null,currentColorInput:null,init:function(e){var t=this;t.editor=e,e.plugins.wspopup.register({wsname:"stylePopupContents",title:"Color and Style",width:680,height:350,wsselection:0,onShow:function(e){t.onShow(e)},uiSetup:function(e){t.uiSetup(e)}})},onShow:function(e){this.setPlugin(e.plugin),this.resetSpanText();var n=[];e.plugin&&(e.plugin.setSpanText(e.div),e.plugin.setSpanText(e.span),n=this.dedupeColors(e.plugin.getUsedColors())),this.setupSwatches(this.getStyleColors(n)),this.mergeBasicStyleToAdvanced(),this.updatePreviewStyle(),this.editor.selection.isCollapsed()?t("#removeStyleButton").hide():t("#removeStyleButton").show()},setPlugin:function(e){this.plugin=e},resetSpanText:function(){this.resetSpanStyleSize(),this.resetSpanStyleFont(),this.resetSpanStyleColor(),this.resetSpanStyleBackgroundColor(),this.resetSpanStyleAlignment(),this.resetSpanStyleVertical(),this.resetSpanStyleStrike(),t(document.styleForm.styleText).val("")},resetSpanStyleSize:function(){t(document.styleForm.styleSize).val("100%")},resetSpanStyleFont:function(){t(document.styleForm.styleFont).val("")},resetSpanStyleColor:function(){t.farbtastic("#colorpickerColor").setColor("#000000"),t(document.styleForm.styleColor).val("")},resetSpanStyleBackgroundColor:function(){t.farbtastic("#colorpickerBackgroundColor").setColor("#FFFFFF"),t(document.styleForm.styleBackgroundColor).val("")},resetSpanStyleAlignment:function(){t(document.styleForm.styleAlignment).val("")},resetSpanStyleVertical:function(){t(document.styleForm.styleVertical).val("")},resetSpanStyleStrike:function(){t(document.styleForm.styleStrike).prop("checked",!1)},mergeAdvancedStyleToBasic:function(){var e,n=t(document.styleForm.styleText).val();(e=n.match(/^\s*font-size:\s*(.+?);*\s*$/im))?this.plugin.setSpanTextValue("font-size",e[1]):this.resetSpanStyleSize(),(e=n.match(/^\s*font-family:\s*(.+?);*\s*$/im))?this.plugin.setSpanTextValue("font-family",e[1]):this.resetSpanStyleFont(),(e=n.match(/^\s*color:\s*(.+?);*\s*$/im))?this.plugin.setSpanTextValue("color",e[1]):this.resetSpanStyleColor(),(e=n.match(/^\s*background-color:\s*(.+?);*\s*$/im))?this.plugin.setSpanTextValue("background-color",e[1]):this.resetSpanStyleBackgroundColor(),(e=n.match(/^\s*text-align:\s*(.+?);*\s*$/im))?this.plugin.setSpanTextValue("text-align",e[1]):this.resetSpanStyleAlignment(),(e=n.match(/^\s*vertical-align:\s*(.+?);*\s*$/im))?this.plugin.setSpanTextValue("vertical-align",e[1]):this.resetSpanStyleVertical(),(e=n.match(/^\s*text-decoration:\s*(.+?);*\s*$/im))?this.plugin.setSpanTextValue("text-decoration",e[1]):this.resetSpanStyleStrike()},updatePreviewStyle:function(){"none"!=t(".styleBasic").css("display")&&this.mergeBasicStyleToAdvanced();var e=t.trim(document.styleForm.styleText.value).replace(/;?\n/gim,"; ");t("#stylePreviewApplied").attr("style",e)},mergeBasicStyleToAdvanced:function(){var e=t(document.styleForm.styleText).val(),n=t(document.styleForm.styleSize).val(),i=t(document.styleForm.styleFont).val(),o=t(document.styleForm.styleColor).val(),r=t(document.styleForm.styleBackgroundColor).val(),a=t(document.styleForm.styleAlignment).val(),s=t(document.styleForm.styleVertical).val(),l=t(document.styleForm.styleStrike).prop("checked");e=n&&"100%"!=n?e.match(/^\s*font-size:\s*.*$/gim)?e.replace(/^\s*font-size:\s*.*$/gim,"font-size: "+n+";"):e+"\nfont-size: "+n+";":e.replace(/^\s*font-size:\s*.*$/gim,""),e=i?e.match(/^\s*font-family:\s*.*$/gim)?e.replace(/^\s*font-family:\s*.*$/gim,"font-family: "+i+";"):e+"\nfont-family: "+i+";":e.replace(/^\s*font-family:\s*.*$/gim,""),e=o?e.match(/^\s*color:\s*.*$/gim)?e.replace(/^\s*color:\s*.*$/gim,"color: "+o+";"):e+"\ncolor: "+o+";":e.replace(/^\s*color:\s*.*$/gim,""),e=r?e.match(/^\s*background-color:\s*.*$/gim)?e.replace(/^\s*background-color:\s*.*$/gim,"background-color: "+r+";"):e+"\nbackground-color: "+r+";":e.replace(/^\s*background-color:\s*.*$/gim,""),a?(e=e.match(/^\s*text-align:\s*.*$/gim)?e.replace(/^\s*text-align:\s*.*$/gim,"text-align: "+a+";"):e+"\ntext-align: "+a+";",e.match(/^\s*display:\s*block;\s*$/gim)||(e+="\ndisplay: block;")):(e=e.replace(/^\s*text-align:\s*.*$/gim,""),e=e.replace(/^\s*display:\s*block;\s*$/gim,"")),e=s?e.match(/^\s*vertical-align:\s*.*$/gim)?e.replace(/^\s*vertical-align:\s*.*$/gim,"vertical-align: "+s+";"):e+"\nvertical-align: "+s+";":e.replace(/^\s*vertical-align:\s*.*$/gim,""),l?e.match(/^\s*text-decoration:\s*.*$/gim)?e=e.replace(/^\s*text-decoration:\s*.*$/gim,"text-decoration: line-through;"):e+="\ntext-decoration: line-through;":e=e.replace(/^\s*text-decoration:\s*.*$/gim,""),t(document.styleForm.styleText).val(t.trim(e))},dedupeColors:function(e){e.sort();for(var t=[],n=null,i=0;e.length>i;i++)e[i]!=n&&(t[t.length]=e[i]),n=e[i];return t},getBasicColors:function(){return["#000000","#404040","#808080","#C0C0C0","#FFFFFF","#FF0000","#00FF00","#0000FF","#FFFF00","#00FFFF","#FF00FF","#800000","#008000","#000080","#808000","#008080","#800080"]},getStyleColors:function(e){for(var t=this.getBasicColors(),n=t,i=0;e.length>i;i++){for(var o=!1,r=0;t.length>r;r++)if(e[i]==t[r]){o=!0;break}o||(n[n.length]=e[i])}return n},setupSwatches:function(e){var n=this;t("#styleColors").empty();for(var i={"float":"left",margin:"3px",width:"20px",height:"15px",cursor:"crosshair",border:"1px black solid"},o=0;e.length>o;o++){var r=document.createElement("div");i["background-color"]=e[o],t(r).css(i),t(r).attr("title",e[o]),t(r).click(function(e){n.chooseStyleColor(t(this).css("backgroundColor")),e.preventDefault()}),t("#styleColors").append(r)}},chooseStyleColor:function(e){if(e=new RGBColor(e).toHex().toUpperCase()){var n=this.currentColorInput.name;t.farbtastic("#colorpicker"+n.substring(5)).setColor(e),document.styleForm[n].focus()}},adjustFont:function(e){var n=t(document.styleForm.styleSize).val();n.match(/%\s*$/gi)&&(n=parseInt(n),n+=e,t(document.styleForm.styleSize).val(n+"%")),this.updatePreviewStyle()},uiSetup:function(n){var i=this;t("#switchToAdvanced").click(function(){return i.hideColorPickers(),i.mergeBasicStyleToAdvanced(),t("#stylePopupContents .styleAdvanced").show(),t("#stylePopupContents .styleBasic").hide(),t("#switchToBasic").removeClass("selected"),t("#switchToAdvanced").addClass("selected"),!1}),t("#switchToBasic").click(function(){return i.mergeAdvancedStyleToBasic(),t("#stylePopupContents .styleAdvanced").hide(),t("#stylePopupContents .styleBasic").show(),t("#switchToAdvanced").removeClass("selected"),t("#switchToBasic").addClass("selected"),!1}),t("#styleAdvancedTextarea").keyup(function(){i.updatePreviewStyle()}),t("#styleAdvancedTextarea").change(function(){i.updatePreviewStyle()}),t("#styleFont").focus(function(){i.hideColorPickers()}),t("#styleFont").change(function(){i.updatePreviewStyle()}),t("#sizeDown").click(function(){return i.hideColorPickers(),i.adjustFont(-10),!1}),t("#styleSize").focus(function(){i.hideColorPickers()}),t("#styleSize").keyup(function(){i.updatePreviewStyle()}),t("#sizeUp").click(function(){return i.hideColorPickers(),i.adjustFont(10),!1}),t("#styleColor").focus(function(){i.hideColorPickers(),t("#colorpickerColor").show(),t("#styleColors").show(),i.currentColorInput=this}),t("#styleColor").focus(function(){i.updatePreviewStyle()}),t("#styleBackgroundColor").focus(function(){i.hideColorPickers(),t("#colorpickerBackgroundColor").show(),t("#styleColors").show(),i.currentColorInput=this}),t("#styleBackgroundColor").focus(function(){i.updatePreviewStyle()}),t("#styleAlignment").focus(function(){i.hideColorPickers()}),t("#styleAlignment").change(function(){i.updatePreviewStyle()}),t("#styleVertical").focus(function(){i.hideColorPickers()}),t("#styleVertical").change(function(){i.updatePreviewStyle()}),t("#styleStrike").focus(function(){i.hideColorPickers()}),t("#styleStrike").click(function(){i.updatePreviewStyle()}).change(function(){i.updatePreviewStyle()});var o=function(){return e.activeEditor.focus(),n.close(),!1};t("#applyStyleButton").click(function(){return t("#stylePopupContents .styleBasic").is(":visible")&&i.mergeBasicStyleToAdvanced(),i.plugin.applyStyle(),o()}),t("#removeStyleButton").click(function(){return i.plugin.removeStyle(),o()}),t("#styleCancel").click(o),t("#styleCloseButton").click(o),t("#colorpickerColor").farbtastic(function(e){i.farbtasticCallback.call(this,e,document.styleForm.styleColor),i.updatePreviewStyle()}),t("#colorpickerBackgroundColor").farbtastic(function(e){i.farbtasticCallback.call(this,e,document.styleForm.styleBackgroundColor),i.updatePreviewStyle()})},farbtasticCallback:function(e,n){t(n).css({backgroundColor:e,color:this.hsl[2]>.5?"#000":"#fff"}),t(n).each(function(){this.value=e})},hideColorPickers:function(){t("#colorpickerColor").hide(),t("#colorpickerBackgroundColor").hide(),t("#styleColors").hide()}}),e.PluginManager.add("wsstylepopup",wikispaces.popups.Style)}(tinymce,jQuery),function(e){e.create("wikispaces.plugins.SubEditorPlugin",{init:function(t){this.editor=t,t.onInitSubEditor=new e.util.Dispatcher(t),this.plugins=t.getParam("wssubeditor_plugins"),this.options=t.getParam("wssubeditor_options");var n=this.options.setup,i=function(e){e.onInit.add(function(e){t.onInitSubEditor.dispatch(e)})};this.options.setup=n?function(e){n(e),i(e)}:i;var o=this;t.addCommand("wssubeditor",function(){o.create()})},getInfo:function(){return{longname:"Wikispaces sub editor",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},create:function(t,n,i,o){this.options.plugins=i?i:this.plugins;var r=new e.Editor(t,jQuery.extend({},this.options,n));return r.render(),o&&(r.initialized?o(r):r.onInit.add(o)),r}}),e.PluginManager.add("wssubeditor",wikispaces.plugins.SubEditorPlugin)}(tinymce),function(e,t){e.create("wikispaces.plugins.TablePlugin",{init:function(n){function i(e,t){var n,i,o=t.ownerDocument,r=o.createRange();return r.setStartBefore(t),r.setEnd(e.endContainer,e.endOffset),n=o.createElement("body"),n.appendChild(r.cloneContents()),i=n.innerHTML.replace(/<(br|img)[^>]*>/gi,"-"),i=i.replace(/<table[^>]*>\s*(<tbody[^>]*>\s*)?(<tr[^>]*>\s*|(<tr[^>]*>\s*)?<t(d|h)[^>]*>)/g,""),i=i.replace(/<[^>]+>/g,""),0==i.length}var o=this;this.editor=n,this.emptyCellContents=e.isIE?"&nbsp;":"<br/>",n.addCommand("wsTable",function(){n.dom.getParent(n.selection.getNode(),"TABLE,UL,OL")||(e.mainEditor.plugins.wspopup.show("tablePopupContents",{plugin:o}),t("#tablePopupContents input").first().focus())}),n.addButton("wstable",{title:"Insert Table",label:"Table",onclick:function(){e.activeEditor.wsExecCommand("wsTable"),ws.common.track("Editor","Open Table Tool")}}),n.onNodeChange.add(function(n,i,o){if(o=n.selection.getStart(),!o||t(o).parents().addBack().is(".mceContentBody")){var r=n.dom.getParent(o,"td,th"),a="TABLE"===o.nodeName||!!r;"visual"==n.plugins.wscommon.getOption("mode")?(n.theme.controlManager().setActive("wstable",a),n.theme.controlManager().setDisabled("wstable",t(o).parents().is("ol,ul"))):(n.theme.controlManager().setActive("wstable",!1),n.theme.controlManager().setDisabled("wstable",!1)),r&&!t(o).is("img")&&"visual"==n.plugins.wscommon.getOption("mode")?e.mainEditor.plugins.wstableoverlay.selectTableCell(r):e.mainEditor.plugins.wstableoverlay.unselectTableCell()}}),n.onInit.add(function(t){function n(){var e;for(e=t.getBody().lastChild;e&&3==e.nodeType&&!e.nodeValue.length;e=e.previousSibling);e&&"TABLE"==e.nodeName&&t.dom.add(t.getBody(),"p",null,'<br mce_bogus="1" />')}e.isIE||(e.isGecko&&t.onKeyDown.add(function(e,t){var n,o,r=e.dom;(37==t.keyCode||38==t.keyCode)&&(n=e.selection.getRng(),o=r.getParent(n.startContainer,"table"),o&&e.getBody().firstChild==o&&i(n,o)&&(n=r.createRng(),n.setStartBefore(o),n.setEndBefore(o),e.selection.setRng(n),t.preventDefault()))}),t.onKeyUp.add(n),t.onSetContent.add(n),t.onVisualAid.add(n),t.onPreProcess.add(function(e,t){var n=t.node.lastChild;n&&1==n.childNodes.length&&"BR"==n.firstChild.nodeName&&e.dom.remove(n)}),n())}),n.onKeyDown.addToTop(function(n,i){if(e.mainEditor.plugins.wstableoverlay.selectedTableCell&&!i.ctrlKey&&!i.altKey){if("9"==i.keyCode){var o,r=t(e.mainEditor.plugins.wstableoverlay.selectedTableCell);i.shiftKey?(o=r.prev("td,th"),0==o.length&&r.parents("tr").eq(0).prev("tr").length>0&&(o=r.parents("tr").eq(0).prev("tr").find("td,th").eq(r.parents("tr").eq(0).prev("tr").find("td,th").length-1)),o.length||(e.mainEditor.plugins.wstableoverlay.addNewRow(!1,!0),o=r.parents("tr").eq(0).prev("tr").find("td,th").eq(r.parents("tr").eq(0).prev("tr").find("td,th").length-1))):(o=r.next("td,th"),0==o.length&&r.parents("tr").eq(0).next("tr").length>0&&(o=r.parents("tr").eq(0).next("tr").find("td,th").eq(0)),o.length||(e.mainEditor.plugins.wstableoverlay.addNewRow(!1,!1),o=r.parents("tr").eq(0).next("tr").find("td,th").eq(0))),o.length&&(o=o.get(0),n.selection.select(o,!0),n.selection.collapse(!0),e.mainEditor.plugins.wstableoverlay.selectTableCell(o),e.activeEditor.undoManager.add(),i.preventDefault(),i.stopPropagation())}if(e.isWebKit&&(8==i.keyCode||46==i.keyCode)){var a=t(n.selection.getNode()).closest("li:first-child");if(a.size()>0&&""==a.text()){n.undoManager.begin();var s=a.parent();a.remove(),0==s.children().size()&&s.remove(),span=t("<span>",n.getDoc()).prependTo(e.mainEditor.plugins.wstableoverlay.selectedTableCell),n.plugins.wscommon.cursorToAndRemoveElement(span),n.undoManager.end()}}}}),n.plugins.wscommon.disableUntilLibsLoad(n,"wstable")},getInfo:function(){return{longname:"Wikispaces table",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},addTable:function(n,i){ws.common.track("Editor","Add Table",n+"x"+i),(isNaN(n)||1>n)&&(n=1),(isNaN(i)||1>i)&&(i=1);for(var o='<table class="wiki_table" id="__newTable__">\n',r=0;n>r;r++){o+="<tr>\n";for(var a=0;i>a;a++)o+="<td>"+this.emptyCellContents+"</td>\n";o+="</tr>\n"}o+="</table>\n";var s=this.editor;s.wsselection.setContent(o);var l=s.dom.select("#__newTable__")[0];s.dom.split(t(l).closest("p,div,h1,h2,h3,h4,h5,h6")[0],l),l=s.dom.select("#__newTable__")[0],s.dom.setAttrib(l,"id",null),t("td",s.contentDocument).css({minWidth:5,minHeight:20});var c=s.dom.select("td",l)[0];s.selection.select(c.firstChild),s.selection.collapse(!0),s.controlManager.setDisabled("table",!0),s.controlManager.setActive("table",!0),e.mainEditor.plugins.wstableoverlay.selectTableCell(c),e.mainEditor.controlManager.setActive("wstable",!0)}}),e.PluginManager.add("wstable",wikispaces.plugins.TablePlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.TableOverlay",{selectedTableCell:null,init:function(n){var i=this;n.onModeSwitch.add(function(e){"plain"==e&&i.hide()}),t(window).resize(function(){i.selectedTableCell&&t(i.selectedTableCell).is(":visible")&&i.show(n,i.selectedTableCell)}),this.emptyCellContents=e.isIE?"&nbsp;":"<br/>"},show:function(e,n){this.editor=e,this.selectedTableCell=n,this.menuHandleLoaded||(t("#pageEditor").append(ws.editor.content.loadContent("tableMenu")),this.setupMenu(),this.menuHandleLoaded=!0),t("#tablePropertiesMenuHandle").css({position:"absolute",left:"-10000px",top:"-10000px"}).addClass("overlayLayer").show(),t("#tableProperties").hide(),this.reposition(),this.updateMenu(n)},showProperties:function(){t("#tableProperties").css({position:"absolute",left:"-10000px",top:"-10000px"}).addClass("overlayLayer").show(),t("#tablePropertiesMenuHandle").hide(),this.reposition()},hide:function(){this.selectedTableCell&&(this.removeHighlight(),this.selectedTableCell=null),t("#tablePropertiesMenuHandle").hide(),t("#tableProperties").hide()},updateMenu:function(e){e=t(e);var n=t("#tablePropertiesList"),i=e.is("th");i?n.find(".headerToggleLabel").text("Remove Header"):n.find(".headerToggleLabel").text("Make Header"),n.find(".alignmentMenu:not(.tableAlignmentMenu)").toggleClass("disabledMenu",i),n.find(".mergeSplit").toggleClass("disabledMenu",!(e.attr("colspan")>1)),n.find(".mergeLeft").toggleClass("disabledMenu",!e.prev("td,th").length),n.find(".mergeRight").toggleClass("disabledMenu",!e.next("td,th").length)},tablePropertiesShow:function(e,n){var i=t.when();e.is("ul:visible")&&(i=e.slideUp("fast").promise()),e.is("ul:not(:visible)")&&(i=t.when(i,t(n).slideUp("fast").promise(),e.slideDown("fast").promise()));var o=this;i.done(function(){o.reposition()})},reposition:function(){var e=null,n=t("#tableProperties:visible");n.length&&(e=this.editor.plugins.wscommon.getPositionWith(n,this.selectedTableCell,2),n.css(e));var i=t("#tablePropertiesMenuHandle:visible");i.length&&(e=this.editor.plugins.wscommon.getPositionWith(i,this.selectedTableCell,2),i.css(e))},getScope:function(e){return e=t(e),e.closest("#cellItem").length?"Cell":e.closest("#rowItem").length?"Row":e.closest("#colItem").length?"Col":e.closest("#tableItem").length?"Table":null},setupMenu:function(){var e=this;t("#tablePropertiesMenuHandle").click(function(n){return n.stopPropagation(),t("#tablePropertiesList ul").hide(),e.showProperties(),!1}),t("#tablePropertiesList ul").hide(),t("#tablePropertiesList .topmenu").click(function(n){return n.stopPropagation(),e.tablePropertiesShow(t(this).next(),"#tablePropertiesList li ul:visible"),!1}),t("#tablePropertiesList .submenu").click(function(n){return n.stopPropagation(),e.tablePropertiesShow(t(this).next(),"#tablePropertiesList li ul li ul:visible"),!1}),t("#cellItem, #rowItem, #colItem, #tableItem").mouseover(function(){var t="highlight"+e.getScope(this);return e[t]("highlightTableCell"),!0}).mouseout(function(){return e.removeHighlight(),!0}),t("#tableProperties .mergeMenu li").mouseover(function(){var n,i;switch(t(this).attr("class")){case"mergeLeft":i=!0,n="highlight"+e.getScope(this)+"ForMerge";break;case"mergeRight":i=!1,n="highlight"+e.getScope(this)+"ForMerge";break;case"mergeUp":i=!0,n="highlight"+e.getScope(this)+"ForRowMerge";break;case"mergeDown":i=!1,n="highlight"+e.getScope(this)+"ForRowMerge"}return n&&e[n](i),!0}).mouseout(function(){return e.removeHighlight("highlightTableCellForMerge"),!0}).click(function(){var n,i;switch(t(this).attr("class")){case"mergeLeft":i=!0,n="merge"+e.getScope(this);break;case"mergeRight":i=!1,n="merge"+e.getScope(this);break;case"mergeUp":i=!0,n="mergeRow"+e.getScope(this);break;case"mergeDown":i=!1,n="mergeRow"+e.getScope(this);break;case"mergeSplit":i=e.selectTableCell,n="splitCell"}return e[n](i),!1}),t("#tableProperties .headerMenu").click(function(){var t="convert"+e.getScope(this)+"Type";return e[t](),!1}),t("#tableProperties .addMenu li").mouseover(function(){var n,i;switch(t(this).attr("class")){case"addPre":ws.common.log("pre"),i=!0,n="addNew"+e.getScope(this);break;case"addPost":ws.common.log("post"),i=!1,n="addNew"+e.getScope(this)}return e[n](!0,i),!0}).mouseout(function(){return e.removePreviews(),!0}).click(function(){var n,i;switch(t(this).attr("class")){case"addPre":i=!0,n="addNew"+e.getScope(this);break;case"addPost":i=!1,n="addNew"+e.getScope(this)}return e[n](!1,i),!1}),t("#tableProperties .alignmentMenu li").click(function(){var n="align"+e.getScope(this),i=t(this).attr("class");return e[n](i),!1}),t("#tableProperties .removeMenu").mouseover(function(){var t="highlight"+e.getScope(this)+"ForRemoval";return e[t](),!0}).mouseout(function(){return e.removeHighlight("highlightTableCellForRemoval"),!0}).click(function(){var t="remove"+e.getScope(this);return e[t](),!1})},$table:function(){return t(this.selectedTableCell).closest("table.wiki_table")},selectTableCell:function(t){ws.common.log("selectTableCell",t),this.show(e.activeEditor,t)},unselectTableCell:function(){this.hide()},highlightCell:function(e){this.selectedTableCell&&t(this.selectedTableCell).addClass(e)},highlightCellForMerge:function(e){this.selectedTableCell&&(e?t(this.selectedTableCell).prev("td,th").addClass("highlightTableCellForMerge"):t(this.selectedTableCell).next("td,th").addClass("highlightTableCellForMerge"))},highlightCellForRowMerge:function(e){if(this.selectedTableCell){var n=this.getColumnNumber(this.selectedTableCell);e?this.getColumnInPosition(t(this.selectedTableCell).parent().prev("tr").children("td,th"),n).addClass("highlightTableCellForMerge"):this.getColumnInPosition(t(this.selectedTableCell).parent().next("tr").children("td,th"),n).addClass("highlightTableCellForMerge")}},convertCells:function(e,n){var i=this.editor.getDoc();this.removeHighlight(),this.editor.undoManager.begin(),t(e).each(function(){var e=parseInt(t(this).attr("colspan")),o=i.createElement(n);t(o).attr("colspan",e),t(o).html(t(this).html()),t(this).replaceWith(o),this==this.selectedTableCell&&this.selectTableCell(o)}),this.editor.undoManager.end(),this.unselectTableCell()},convertCellType:function(){var e=t(this.selectedTableCell).is("td")?"th":"td";this.convertCells(this.selectedTableCell,e)},convertColType:function(){var e=this.getColCells(this.getColumnNumber(this.selectedTableCell),!1),n=t(this.selectedTableCell).is("td")?"th":"td";this.convertCells(e,n)},convertRowType:function(){var e=t(this.selectedTableCell).parent("tr").find("td,th"),n=t(this.selectedTableCell).is("td")?"th":"td";this.convertCells(e,n)},mergeCell:function(e){if(this.selectedTableCell){var n=this.editor.getDoc();this.removeHighlight(),this.removePreviews(),this.editor.undoManager.begin(),this.selectedTableCell.innerHTML;var i=parseInt(t(this.selectedTableCell).attr("colspan")>1?t(this.selectedTableCell).attr("colspan"):1);e?t(this.selectedTableCell).prev("td,th").remove():t(this.selectedTableCell).next("td,th").remove();var o="td";t(this.selectedTableCell).is("th")&&(o="th");var r=n.createElement(o);t(r).html(t(this.selectedTableCell).html()),t(r).attr("colspan",i+1),t(this.selectedTableCell).replaceWith(r),this.editor.undoManager.end();var a=t(r).parent("tr").eq(0),s=n.createElement("tr");t(s).html(t(a).html()),t(a).after(s),t(a).remove(),this.unselectTableCell()}},splitCell:function(){if(this.selectedTableCell&&t(this.selectedTableCell).attr("colspan")>1){var e="td";t(this.selectedTableCell).is("th")&&(e="th");for(var n="<"+e+">"+t(this.selectedTableCell).html()+"</"+e+">",i=parseInt(t(this.selectedTableCell).attr("colspan"))-1,o=0;i>o;o++)n+="<td>"+this.emptyCellContents+"</td>";this.removeHighlight(),this.removePreviews(),this.editor.undoManager.begin(),t(this.selectedTableCell).replaceWith(n),this.editor.undoManager.end(),this.unselectTableCell()}},highlightTable:function(e){this.selectedTableCell&&this.$table().find("td,th").each(function(){t(this).addClass(e)})},highlightSelectedTable:function(){this.highlightTable("highlightTableCell")},highlightTableForRemoval:function(){this.highlightTable("highlightTableCellForRemoval")},highlightSelectedRow:function(){this.highlightRow("highlightTableCell")},highlightRowForRemoval:function(){this.highlightRow("highlightTableCellForRemoval")},highlightRow:function(e){this.selectedTableCell&&t(this.selectedTableCell).parent("tr").eq(0).find("td,th").each(function(){t(this).addClass(e)})},getColumnNumber:function(e){for(var n=0,i=t(e).prevAll("td,th"),o=0;i.length>o;o++)n+=parseInt(t(i[o]).attr("colspan")>1?t(i[o]).attr("colspan"):1);return n},getColumnInPosition:function(e,t){for(var n=0;e.length>n;n++)if(this.getColumnNumber(e[n])>=t)return e[n]},highlightSelectedCol:function(){this.highlightCol("highlightTableCell")},highlightColForRemoval:function(){this.highlightCol("highlightTableCellForRemoval")},highlightCol:function(e){if(this.selectedTableCell){var n=this.getColCells(this.getColumnNumber(this.selectedTableCell),!1);t(n).each(function(){t(this).addClass(e)})}},removeHighlight:function(e){e?this.$table().find("."+e).each(function(){t(this).removeClass(e)}):this.$table().find(".highlightTableCell,.highlightTableCellForRemoval,.highlightTableCellForMerge").each(function(){t(this).removeClass("highlightTableCell").removeClass("highlightTableCellForRemoval").removeClass("highlightTableCellForMerge")})},addNewRow:function(e,n){if(this.selectedTableCell){for(var i=0,o=t(this.selectedTableCell).parent("tr").eq(0).find("td,th"),r=0;o.length>r;r++)i+=parseInt(t(o[r]).attr("colspan")>1?t(o[r]).attr("colspan"):1);if(e)var a='<tr class="tablePreview"><td colspan="'+i+'">'+this.emptyCellContents+"</td></tr>";else{for(var a="<tr>",r=0;i>r;r++)a+="<td>"+this.emptyCellContents+"</td>";a+="</tr>",this.removeHighlight(),this.removePreviews(),this.editor.undoManager.begin()}n?t(this.selectedTableCell).parent("tr").eq(0).before(a):t(this.selectedTableCell).parent("tr").eq(0).after(a),e||(this.editor.undoManager.end(),this.unselectTableCell())}},addNewCol:function(e,n){if(this.selectedTableCell){if(e)var i='<td class="tablePreview">&nbsp;&nbsp;&nbsp;&nbsp;</td>',o='<th class="tablePreview">&nbsp;&nbsp;&nbsp;&nbsp;</th>';else{var i="<td>"+this.emptyCellContents+"</td>",o="<th>"+this.emptyCellContents+"</th>";this.removeHighlight(),this.removePreviews(),this.editor.undoManager.begin()}var r=this.getColumnNumber(this.selectedTableCell);if(!n){var a=parseInt(t(this.selectedTableCell).attr("colspan")>1?t(this.selectedTableCell).attr("colspan"):1);r=r+a-1}var s=this.getColCells(r,!0),l=this;t(s).each(function(e){var r=l.isHeaderRow(e)?o:i;n?t(this).before(r):t(this).after(r)}),e||(this.editor.undoManager.end(),this.unselectTableCell())}},removeTable:function(){this.selectedTableCell&&(this.removeHighlight(),this.editor.undoManager.begin(),this.$table().remove(),this.editor.undoManager.end(),this.unselectTableCell())},removeCol:function(){if(this.selectedTableCell){var e=this.getColCells(this.getColumnNumber(this.selectedTableCell),!1);this.removeHighlight(),this.editor.undoManager.begin(),t(e).each(function(){t(this).remove()}),this.editor.undoManager.end(),this.unselectTableCell()}},removeRow:function(){this.selectedTableCell&&(this.removeHighlight(),this.editor.undoManager.begin(),t(this.selectedTableCell).parent("tr").eq(0).remove(),this.editor.undoManager.end(),this.unselectTableCell())},alignCell:function(e){t(this.selectedTableCell).is("td")&&(this.removeHighlight(),this.editor.undoManager.begin(),t(this.selectedTableCell).css("text-align",e),this.editor.undoManager.end(),this.unselectTableCell())},alignRow:function(e){var n=t(this.selectedTableCell).parent("tr").eq(0).find("td,th");this.removeHighlight(),this.editor.undoManager.begin(),t(n).each(function(){t(this).is("td")&&t(this).css("text-align",e)}),this.editor.undoManager.end(),this.unselectTableCell()},alignCol:function(e){var n=this.getColCells(this.getColumnNumber(this.selectedTableCell),!1);this.removeHighlight(),this.editor.undoManager.begin(),t(n).each(function(){t(this).is("td")&&t(this).css("text-align",e)}),this.editor.undoManager.end(),this.unselectTableCell()},alignTable:function(e){var n=this.$table().find("td,th");this.removeHighlight(),this.editor.undoManager.begin(),t(n).each(function(){t(this).is("td")&&t(this).css("text-align",e)}),this.editor.undoManager.end(),this.unselectTableCell()},getColCells:function(e,n){if(this.selectedTableCell){for(var i=this.$table().find("tr"),o=[],r=0;i.length>r;r++)for(var a=t(i[r]).children(),s=0,l=0;a.length>l;l++){if(s+=parseInt(t(a[l]).attr("colspan")>1?t(a[l]).attr("colspan"):1),s>e){o[o.length]=a[l];break}if(s>e&&n){o[o.length]=a[l-1];break}}return o}},removePreviews:function(){this.$table().find(".tablePreview").each(function(){t(this).remove()})},isHeaderRow:function(e){return _(this.$table().find("tr").eq(e).children()).all(function(e){return t(e).is("th")})}}),e.PluginManager.add("wstableoverlay",wikispaces.plugins.TableOverlay)}(tinymce,jQuery),function(e,t){e.create("wikispaces.popups.Table",{plugin:null,init:function(e){var t=this;e.plugins.wspopup.register({wsname:"tablePopupContents",title:"Insert Table",width:280,height:100,wsselection:0,onShow:function(e){t.onShow(e)},uiSetup:function(e){t.uiSetup(e)}})},setPlugin:function(e){this.plugin=e},onShow:function(e){this.setPlugin(e.plugin)},uiSetup:function(e){var n=this;t("#addTableButton").click(function(){n.plugin.addTable(document.insertTableForm.rows.value,document.insertTableForm.cols.value),e.close()}),t("#tableCancelLink").click(function(){return e.close(),!1}),t("#tableCloseButton").click(function(){return e.close(),!1})}}),e.PluginManager.add("wstablepopup",wikispaces.popups.Table)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.ToolbarScrollPlugin",{init:function(e){var n=this;e.onInit.add(function(){t(".mceExternalToolbar").before('<div id="mceToolbarAnchor">'),t(window).scroll(n.moveScroller),n.moveScroller()})},moveScroller:function(){var e=t(".mceExternalToolbar"),n=e.height(),i=_(t(".navbar-fixed-top")).reduce(function(e,n){return e+t(n).outerHeight()},0);if(t(window).scrollTop()>t("#mceToolbarAnchor").offset().top-n-i?e.css({position:"fixed",top:i}):e.css({position:"absolute",top:"-"+(n+4)+"px"}),t("#menu_wsMainEditor_wsMainEditor_wssave_menu").is(":visible")){var o=t("#wsMainEditor_wssave_action");t("#menu_wsMainEditor_wsMainEditor_wssave_menu").css({left:Math.min(o.offset().left,t(window).scrollLeft()+t(window).width()-t("#menu_wsMainEditor_wsMainEditor_wssave_menu").width()-3)+"px",top:o.offset().top+o.outerHeight()+"px"})}if(t("#menu_wsMainEditor_wsMainEditor_formatlistbox_menu").is(":visible")){var o=t("#wsMainEditor_formatlistbox");t("#menu_wsMainEditor_wsMainEditor_formatlistbox_menu").css({left:o.offset().left+"px",top:o.offset().top+o.outerHeight()+"px"})}},getInfo:function(){return{longname:"Wikispaces toolbar scroll",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}}}),e.PluginManager.add("wstoolbarscroll",wikispaces.plugins.ToolbarScrollPlugin)}(tinymce,jQuery),function(e){var t=e.util.Dispatcher;e.UndoManager=function(n){function i(){return e.trim(n.getContent({format:"raw",no_events:1}).replace(/<span[^>]+data-mce-bogus[^>]+>[\u200B\uFEFF]+<\/span>/g,"")).replace(/(?:&nbsp;)+$/g,"")
}var o;return o={typing:!1,onAdd:new t(o),onUndo:new t(o),onRedo:new t(o),undoData:[],currentLevel:null,redoData:[],nestLevel:0,getLevels:function(){var e=[],t=[];return jQuery.each(this.undoData,function(){e.push(this.content)}),jQuery.each(this.redoData,function(){t.push(this.content)}),[e,this.currentLevel.content,t]},begin:function(){this.add(),++this.nestLevel},end:function(){--this.nestLevel,this.add()},add:function(t){return e.mainEditor.plugins.wsundomain.add(n,t)},remove:function(){return e.mainEditor.plugins.wsundomain.remove(n)},undo:function(){return e.mainEditor.plugins.wsundomain.undo()},redo:function(){return e.mainEditor.plugins.wsundomain.redo()},clear:function(){return e.mainEditor.plugins.wsundomain.clear()},hasUndo:function(){return e.mainEditor.plugins.wsundomain.hasUndo()},hasRedo:function(){return e.mainEditor.plugins.wsundomain.hasRedo()},updateButtonState:function(){return e.mainEditor.plugins.wsundomain.updateButtonState()},subAdd:function(e){if(this.nestLevel>0)return null;o.typing=!1;var t=n.settings;return e=e||{},e.content=i(),o.currentLevel&&o.currentLevel.content==e.content?null:(t.custom_undo_redo_levels&&o.redoData.length+o.undoData.length>t.custom_undo_redo_levels+1&&o.dropOldestUndo(),e.bookmark=n.selection.getBookmark(2,!0),o.clearRedo(),o.undoData.push(o.currentLevel),o.currentLevel=e,o.onAdd.dispatch(o,e),n.isNotDirty=0,e)},subRemove:function(){return this.nestLevel>0?null:o.undoData.pop()},beforeChange:function(){o.currentLevel&&(o.currentLevel.beforeBookmark=n.selection.getBookmark(2,!0))},clearRedo:function(){o.redoData=[]},dropOldestUndo:function(){return o.undoData.shift()},subUndo:function(){return o.typing&&o.add(),o.subHasUndo()?(o.redoData.push(o.currentLevel),o.currentLevel=o.undoData.pop(),n.setContent(o.currentLevel.content,{format:"raw",no_events:!0}),n.selection.moveToBookmark(o.currentLevel.beforeBookmark),o.onUndo.dispatch(o,o.currentLevel),o.currentLevel):null},subRedo:function(){return o.subHasRedo()?(o.undoData.push(o.currentLevel),o.currentLevel=o.redoData.pop(),n.setContent(o.currentLevel.content,{format:"raw",no_events:!0}),n.selection.moveToBookmark(o.currentLevel.bookmark),o.onRedo.dispatch(o,o.currentLevel),o.currentLevel):null},subClear:function(){o.undoData=[],o.currentLevel={content:i(),bookmark:n.selection.getBookmark(2,!0)},o.redoData=[],o.typing=!1},subHasUndo:function(){return o.undoData.length>0||o.typing},subHasRedo:function(){return o.redoData.length>0}},o.onAdd.add(function(e,t){return n.onChange.dispatch(n,t,e)}),o.onUndo.add(function(e,t){return n.onUndo.dispatch(n,t,e),n.onChange.dispatch(n,t,e)}),o.onRedo.add(function(e,t){return n.onRedo.dispatch(n,t,e),n.onChange.dispatch(n,t,e)}),n.onBeforeExecCommand.add(function(e,t,n,i,r){"Undo"==t||"Redo"==t||"mceRepaint"==t||r&&r.skip_undo||o.beforeChange()}),n.onExecCommand.add(function(e,t,n,i,r){"Undo"==t||"Redo"==t||"mceRepaint"==t||r&&r.skip_undo||o.add()}),n.onSaveContent.add(function(){o.add()}),n.dom.bind(n.dom.getRoot(),"dragend",function(){o.add()}),n.dom.bind(n.getDoc(),e.isGecko?"blur":"focusout",function(){!n.removed&&o.typing&&o.add()}),n.onKeyUp.add(function(e,t){var n=t.keyCode;(n>=33&&36>=n||n>=37&&40>=n||45==n||13==n||t.ctrlKey)&&o.add()}),n.onKeyDown.add(function(e,t){var n=t.keyCode;return n>=33&&36>=n||n>=37&&40>=n||45==n?(o.typing&&o.add(),void 0):((16>n||n>20)&&224!=n&&91!=n&&!o.typing&&(o.beforeChange(),o.add(),o.typing=!0),void 0)}),n.onMouseDown.add(function(){o.typing&&o.add()}),n.addShortcut("ctrl+z","undo_desc","Undo"),n.addShortcut("ctrl+y","redo_desc","Redo"),o},e.create("wikispaces.plugins.UndoPlugin",{init:function(t){t.onNodeChange.add(function(e){e.undoManager.updateButtonState()}),t.onDeactivate.add(function(e){e.initialized&&e.undoManager.typing&&e.undoManager.add()}),t.onInit.add(function(t){t.undoManager.subClear(),e.mainEditor.plugins.wsundomain.removeEditor(t)}),t.onKeyDown.add(function(e,t){16!=t.keyCode&&17!=t.keyCode&&18!=t.keyCode&&e.undoManager.updateButtonState()})}}),e.PluginManager.add("wsundo",wikispaces.plugins.UndoPlugin)}(tinymce),function(e){e.create("wikispaces.plugins.UndoMainPlugin",{undoData:[],redoData:[],init:function(e){this.editor=e},add:function(e,t){if(t=e.undoManager.subAdd(t),!t)return null;this.clearRedo();var n=this.editor.settings;return n.custom_undo_redo_levels&&this.undoData.length>n.custom_undo_redo_levels&&this.undoData.shift().undoManager.dropOldestUndo(),this.undoData.push(e),this.updateButtonState(),t},remove:function(e){if(0==this.undoData.length)return null;var t=this.undoData.pop();if(t!=e)return this.undoData.push(t),null;var n=t.undoManager.subRemove();return n||this.undoData.push(t),n},undo:function(){if(e.activeEditor.undoManager.typing&&(this.add(e.activeEditor),e.activeEditor.undoManager.typing=0),!(0>=this.undoData.length)){var t=this.undoData.pop();if(t.destroyed)return this.undo();this.redoData.push(t),t.focus();var n=t.undoManager.subUndo();return this.updateButtonState(),n}},redo:function(){if(this.hasRedo()){var e=this.redoData.pop();this.undoData.push(e),e.focus();var t=e.undoManager.subRedo();return this.updateButtonState(),t}},clear:function(){this.undoData=[],this.redoData=[],jQuery.each(e.editors,function(){this.initialized&&this.undoManager.subClear()}),this.updateButtonState()},clearRedo:function(){this.redoData=[],jQuery.each(e.editors,function(){this.initialized&&this.undoManager.clearRedo()}),this.updateButtonState()},hasUndo:function(){return this.undoData.length>0||e.activeEditor.initialized&&e.activeEditor.undoManager.typing},hasRedo:function(){return this.redoData.length>0},updateButtonState:function(){var e=this.editor.controlManager;e.setDisabled("undo",!this.hasUndo()),e.setDisabled("redo",!this.hasRedo())},removeEditor:function(e){var t;jQuery.each([this.undoData,this.redoData],function(){t=0;for(var n=0;this.length>n;++n)this[n]==e?++t:this[n-t]=this[n];this.length-=t}),this.updateButtonState()}}),e.PluginManager.add("wsundomain",wikispaces.plugins.UndoMainPlugin)}(tinymce),function(e,t){e.create("wikispaces.plugins.WidgetPlugin",{init:function(n){var i=this;i.editor=n,n.addCommand("wsWidget",function(){i.openWidget()}),n.addButton("wswidget",{title:"Embed Widget",label:"Widget",onclick:function(){e.activeEditor.wsExecCommand("wsWidget")}}),n.onNodeChange.add(function(t,n,o){if("visual"!=t.plugins.wscommon.getOption("mode"))return t.theme.controlManager().setActive("wswidget",!1),void 0;t.theme.controlManager().setDisabled("wswidget",t.plugins.wscommon.isCommentEditor());var r=i.findWidgetPlaceholder(o);t.theme.controlManager().setActive("wswidget",!!r),r?e.mainEditor.plugins.wswidgetoverlay.show(t,r):e.mainEditor.plugins.wswidgetoverlay.hide()}),n.onDblClick.add(function(e,t){var n=null;(n=i.findWidgetPlaceholder(t.target))&&i.openWidget(n)}),n.onKeyPress.addToTop(function(n,i){if(13==i.keyCode){var o=n.selection.getNode(),r=t(o).closest("pre,code");if(r.length){var a=!1;return e.isWebKit?("\n"!=r.text().substr(-1)&&(a=!0),n.selection.setContent('\n<span id="wsHold"></span>')):n.selection.setContent('<br/><span id="wsHold">﻿</span>'),n.plugins.wscommon.cursorToAndRemoveElement(t("#wsHold",n.getDoc()).get(0)),a&&"\n"==r.text().substr(-1)&&(n.selection.setContent('\n<span id="wsHold"></span>'),n.plugins.wscommon.cursorToAndRemoveElement(t("#wsHold",n.getDoc()).get(0))),i.preventDefault(),i.stopPropagation(),!1}}}),n.plugins.wscommon.disableUntilLibsLoad(n,"wswidget")},getInfo:function(){return{longname:"Wikispaces widgets",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},openWidget:function(n){if(n||(n=this.findWidgetPlaceholder(this.editor.selection.getNode())),!t(n).is(".WikiMediaToc, .WikiMediaTocFlat")){var i="";i=t(n).is(".WikiAnchor")?"#"+t(n).attr("id").match(/@@([^@]+)$/)[1]:t(n).attr("id"),this.selectedPlaceholder=n,ws.common.track("Editor","Open Media Tool"),e.mainEditor.plugins.wspopup.show("mediaTool",{plugin:this,mediaString:i})}},insertWidget:function(n,i){if(ws.common.track("Editor","Add Media",i),this.selectedPlaceholder){var o=t(n).attr({style:t(this.selectedPlaceholder).attr("style"),align:t(this.selectedPlaceholder).attr("align")});t(this.selectedPlaceholder).replaceWith(o),e.mainEditor.plugins.wswidgetoverlay.hide()}else this.editor.wsselection.setContent(n)},findWidgetPlaceholder:function(e){return t(e).is("img.WikiMedia")&&!t(e).hasClass("WikiMediaFile")||t(e).hasClass("WikiAnchor")?e:null},insertCharacter:function(t){ws.common.track("Editor","Add Character",t),e.activeEditor.wsselection.setContent(t)},insertToc:function(t){ws.common.track("Editor","Insert Toc",t),t?e.activeEditor.wsselection.setContent('<img id="wikitext@@toc@@flat" class="NewWikiMedia WikiMedia WikiMediaTocFlat" title="Table of Contents" src="'+window.location.protocol+"//www."+wikispaces_domain+'/site/embedthumbnail/toc/flat?w=100&h=16"/>',"h1,h2,h3,h4,h5,h6"):e.activeEditor.wsselection.setContent('<img id="wikitext@@toc@@normal" class="NewWikiMedia WikiMedia WikiMediaToc" title="Table of Contents" src="'+window.location.protocol+"//www."+wikispaces_domain+'/site/embedthumbnail/toc/normal?w=225&h=100"/>',"h1,h2,h3,h4,h5,h6")},insertReference:function(){var n=e.mainEditor.plugins.wsreference.insertReferenceAtSelection();e.mainEditor.focus(),setTimeout(function(){t.scrollTo(n.getContentAreaContainer(),{axis:"y",duration:500}),n.focus(),n.wsselection.selectAll()},100)},insertReferences:function(){ws.common.track("Editor","Insert References"),e.mainEditor.wsselection.setContent("\n&lt;references/&gt;")},insertCode:function(){var n=e.activeEditor,i=n.dom.encode(document.codeMediaForm.code.value);i=i.replace(/\r\n|\n|\r/g,"<br/>");var o=n.dom.encode(document.codeMediaForm.format.value);o||(o="text"),ws.common.track("Editor","Add Code",o),n.wsselection.setContent('<pre id="wsTempPre" class="'+o+'">'+i+"</pre><br/>");var r=t("#wsTempPre",n.getDoc()),a=r.closest("p,div,h1,h2,h3,h4,h5,h6");a.length&&n.dom.split(a.get(0),r.get(0)),r=t("#wsTempPre",n.getDoc()),r.nextAll("p,div,h1,h2,h3,h4,h5,h6").length&&(n.selection.select(r.nextAll("p,div,h1,h2,h3,h4,h5,h6").get(0),!0),n.selection.collapse(!0)),r.removeAttr("id"),document.codeMediaForm.reset(),n.onNeedsResize.dispatch()},insertAnchor:function(n){var i=t("<div>").text(n).html();return i=i.replace(/"/g,"&quot;"),e.activeEditor.wsselection.setContent('<img src="/i/anchor.gif" class="WikiAnchor"  alt="Anchor"  id="wikitext@@anchor@@'+i+'" title="Anchor: '+i+'"/>'),ws.common.track("Editor","Add Anchor",n),!0}}),e.PluginManager.add("wswidget",wikispaces.plugins.WidgetPlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.popups.Widget",{previousSection:"wikispaces",currentMenu:"wikispaces",currentSection:"wikispaces",editor:null,plugin:null,COMMAND_URL_PARAM:"wikispacesCommandUrl",customPlugins:[],init:function(e){var n=this;n.editor=e,e.plugins.wspopup.register({wsname:"mediaTool",title:"Widgets",width:680,height:420,wsselection:0,onShow:function(e){n.onShow(e)},uiSetup:function(e){n.uiSetup(e)}}),e.plugins.wspopup.register({wsname:"mediaPreview",title:"Widget Preview",width:340,height:340,uiSetup:function(e){t("#closePreviewButton").click(function(){e.close()})}}),this.registerPlugin({options:{id:"glogster",name:"Glogster",type:"media",category:"poster",logo:"/i/icon_16_glogster.png",url:"/web/20130613001053/http://edu.glogster.com/?page=wiki_spaces&wikiaction=login",homepage_url:"/web/20130613001053/http://edu.glogster.com",terms_url:"/web/20130613001053/http://edu.glogster.com/terms-of-use"}}),this.registerPlugin({options:{id:"dogobooks",name:"Dogo Books",type:"media",category:"education",logo:"/i/icon_16_dogobooks.png",url:"/web/20130613001053/http://wikispaces.dogobooks.com",homepage_url:"/web/20130613001053/http://www.dogobooks.com",terms_url:"/web/20130613001053/http://www.dogobooks.com/pages/terms-and-conditions-dogobooks"}}),this.registerPlugin({options:{id:"dogonews",name:"Dogo News",type:"media",category:"education",logo:"/i/icon_16_dogonews.png",url:"/web/20130613001053/http://wikispaces.dogonews.com",homepage_url:"/web/20130613001053/http://www.dogonews.com",terms_url:"/web/20130613001053/http://www.dogonews.com/pages/terms-and-conditions"}})},setPlugin:function(e){this.plugin=e},onShow:function(e){this.setPlugin(e.plugin),this.resetMediaForms(),e.plugin&&(e.plugin.editor.plugins.wsreference?t("#referenceMediaMenuEntry").show():t("#referenceMediaMenuEntry").hide(),wikispaces_isMain&&"www"==wikispaces_spaceName&&t("#includeTagCloudMediaMenuEntry, #includeEditorsMediaMenuEntry, #includeNavbarMediaMenuEntry, #includePageListMediaMenuEntry, #includeWikiListMediaMenuEntry").hide()),t("#mediaDiv form").attr("action",ws.common.pathFor("page","embedmedia",wikispaces_page)+"?mode="+encodeURIComponent(this.editor.plugins.wscommon.getOption("mode"))+"&editorVersion=3");var n;e.mediaString&&(n=e.mediaString.match(/^#(.+)/))?(t("#anchorName").val(n[1]),t("#anchorMediaMenuEntry").click()):e.mediaString?this.loadMedia(e.mediaString):this.setMediaMenu("wikispaces")},loadMedia:function(e){document.genericMediaForm.media.value=e,document.genericMediaForm.submit()},addWidget:function(e,n){this.plugin.insertWidget(e,n),t("#mediaDiv .cancelMediaLink").eq(0).click()},setMediaError:function(e){t("#mediaError").show().text(e)},resetMediaForms:function(){t("#mediaDiv .mediaForm").each(function(){this.reset()}),t("#mediaDiv .s2_autocompletePage").not("#includePageMediaMenu input").val(wikispaces_page).select2("data",{id:"page:"+wikispaces_page,text:wikispaces_page}),t(".s2_autocompleteLink").select2("data",{id:"",text:""}),wikispaces_isMain&&"www"==wikispaces_spaceName&&t("#mediaDiv .s2_autocompletePage").not("#includePageMediaMenu input").attr("readonly","readonly").select2("disable"),t("#mediaDiv .s2_autocompleteWiki").select2("data",{id:wikispaces_wikiName,text:wikispaces_wikiText}),t("#mediaError").hide().html("")},setMediaPreview:function(e){this.editor.plugins.wspopup.show("mediaPreview"),t("#mediaPreviewArea").html(e)},startMediaSpinner:function(){this.previousSection=this.currentSection,this.setMediaMenu("spinner"),t("#mediaError").hide().html("")},stopMediaSpinner:function(){this.setMediaMenu(this.previousSection)},valuesChanged:function(){t("input").change()},setMediaMenu:function(e){ws.common.log("setMediaMenu",e);var n=!1;1==t("#"+e+"MediaMenuEntry").parents("#mediaMenu").length&&(t("#"+this.currentMenu+"MediaMenuEntry").removeClass("selected"),t("#"+e+"MediaMenuEntry").addClass("selected"),this.currentMenu=e,n=!0),"showcustom"==e&&(e="custom"),document.getElementById(e+"MediaMenu")||(e="wikispaces"),ws.autocomplete.getAutocompleters(t("#"+e+"MediaMenu")).each(function(){var e=this.autocompleter;setTimeout(function(){e.findValue()},1)}),t("#"+this.currentSection+"MediaMenu").hide();var i=t("#"+e+"MediaMenu").show();this.currentSection=e;var o=i.find("iframe.pluginIframe");o.length&&o.data("src")&&"/s/blank.html"==o.attr("src")&&(o.attr("src",o.data("src")),o.data("src","")),n&&"custom"!=e||"wikispaces"==e||"spinner"==e||"flickr"==e||"gabbly"==e||"yackpack"==e||"bittybrowser"==e||"toc"==e||"reference"==e||"facebooklike"==e||"googleplusone"==e||"digg"==e||"reddit"==e||"anchor"==e||"include"==e.substring(0,7)||t("#"+e+"MediaMenu").is(".hideTextMediaInstructions")?t(document.otherMediaForm).hide():t(document.otherMediaForm).show(),"spinner"!=e&&(document.otherMediaForm.mediaType.value=e),t("#"+e+"MediaMenu").find('input[type="text"],textarea').eq(0).focus(),this.editor.plugins.wspopup.resize("mediaTool")},submitYackpack:function(){var e=document.yackpackMediaForm.channel.value,t="/web/20130613001053/http://www.yackpack.com/walkietalkie/?"+encodeURIComponent(e);document.otherMediaForm.embedText.value=t,document.otherMediaForm.save.click()},submitBittyBrowser:function(){var e=document.bittybrowserMediaForm.url.value;document.otherMediaForm.embedText.value='bitty browser\nwebsite: "'+e+'"',document.otherMediaForm.save.click()},embedGabbly:function(){var e=location.protocol+"//"+location.host+"/"+wikispaces_page;document.otherMediaForm.embedText.value="<iframe src='/web/20130613001053/http://cw.gabbly.com/gabbly/cw.jsp?e=1&t="+encodeURIComponent(e)+"' scrolling='no' style='width:300px; height:250px;' frameborder='0'></iframe>",document.otherMediaForm.save.click()},embedFacebookLike:function(){var e=location.protocol+"//"+location.host+"/"+wikispaces_page;document.otherMediaForm.embedText.value='<iframe src="//www.facebook.com/plugins/like.php?href='+encodeURIComponent(e)+'&amp;send=false&amp;layout=standard&amp;width=450&amp;show_faces=true&amp;action=like&amp;colorscheme=light&amp;font&amp;height=80&amp;appId=XXX" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:450px; height:80px;" allowTransparency="true"></iframe>',document.otherMediaForm.save.click()},embedGooglePlusOne:function(){document.otherMediaForm.embedText.value='<g:plusone annotation="inline"></g:plusone>',document.otherMediaForm.save.click()},embedDigg:function(){var e=location.protocol+"//"+location.host+"/"+wikispaces_page;document.otherMediaForm.embedText.value='<a class="DiggThisButton DiggMedium" src="/web/20130613001053/http://digg.com/submit?url='+encodeURIComponent(e)+'"></a>',document.otherMediaForm.save.click()},embedReddit:function(){document.otherMediaForm.embedText.value='<script type="text/javascript" src="/web/20130613001053/http://www.reddit.com/static/button/button1.js"></script>',document.otherMediaForm.save.click()},uiSetup:function(n){var i=this,o=function(){return e.activeEditor,n.close(),!1};t("#widgetCloseButton").click(o),t("#mediaDiv").on("click","ul li",function(){var e=this.id,t=e.substring(0,e.indexOf("MediaMenuEntry"));return"spinner"!=i.currentMenu&&(i.setMediaMenu(t),n.resize()),!1}),t("#tocMediaForm #tocSubmitButton").click(function(){return i.plugin.insertToc(),o()}),t("#tocMediaForm #flatSubmitButton").click(function(){return i.plugin.insertToc(!0),o()}),t("#referenceMediaForm").submit(function(e){return i.plugin.insertReference(),e.preventDefault(),e.stopPropagation(),o()}),t("#referencesMediaForm").submit(function(e){return i.plugin.insertReferences(),e.preventDefault(),e.stopPropagation(),o()}),t("#anchorMediaForm").submit(function(e){var n=t("#anchorName").val();return n.match(/^[^\]\|]+$/)?(i.plugin.insertAnchor(n),e.preventDefault(),e.stopPropagation(),o()):(n?alert('Anchors may not contain the characters "|" or "]".'):alert("Please enter a name for the anchor."),e.preventDefault(),e.stopPropagation(),!1)}),t("#mediaDiv .mediaForm").submit(function(){i.startMediaSpinner()}),t("#bittybrowserMediaForm").submit(function(){i.submitBittyBrowser()}),t("#gabblyMediaForm").submit(function(e){return i.embedGabbly(),e.preventDefault(),e.stopPropagation(),!1}),t("#yackpackMediaForm").submit(function(e){return i.submitYackpack(),e.preventDefault(),e.stopPropagation(),!1}),t("#codeMediaForm").submit(function(n){return t(e.activeEditor.selection.getNode()).closest("pre").length?(alert("You cannot insert a code block inside another code block"),i.stopMediaSpinner()):(i.plugin.insertCode(document.codeMediaForm.code.value,document.codeMediaForm.format.value),o()),n.preventDefault(),n.stopPropagation(),!1}),t("#facebooklikeMediaForm").submit(function(e){return i.embedFacebookLike(),e.preventDefault(),e.stopPropagation(),!1}),t("#googleplusoneMediaForm").submit(function(e){return i.embedGooglePlusOne(),e.preventDefault(),e.stopPropagation(),!1}),t("#diggMediaForm").submit(function(e){return i.embedDigg(),e.preventDefault(),e.stopPropagation(),!1}),t("#redditMediaForm").submit(function(e){return i.embedReddit(),e.preventDefault(),e.stopPropagation(),!1}),t("#includeCharMediaMenu td").hover(function(){t(this).hasClass("empty")||t(this).addClass("hl")},function(){t(this).hasClass("empty")||t(this).removeClass("hl")}),t("#includeCharMediaMenu td").click(function(){t(this).hasClass("empty")||(i.plugin.insertCharacter(t(this).html(),t(this).text()),o())}),t("#mediaDiv .cancelMediaLink").click(o),ws.autocomplete.registerAutocompleters(t("#mediaDiv")),t("#rssDescInput").change(function(){this.checked?(t("#rssDescRow input").prop("disabled",!1),t("#rssDescRow th").removeClass("disabled")):(t("#rssDescRow input").prop("disabled",!0),t("#rssDescRow th").addClass("disabled"))}),ws.select2.wikiAndObject(t(".s2_autocompleteWiki"),t(".s2_autocompleteLink"),"P"),ws.select2.object(t(".s2_autocompletePage")),t.each(this.customPlugins,function(){var e=this;if("media"==e.options.type){var n=t("<a>").attr("href","#widget-"+e.options.id).text(e.options.name).css("background-image","url("+e.options.logo+")"),o=t("<li>").attr("id",e.options.id+"MediaMenuEntry").append(n);t("#"+e.options.category+"MediaMenu ul li:last").before(o);var r=document.location.protocol+"//"+document.location.host+ws.common.pathFor("site","editorplugin",e.options.id),a=ws.common.addUriParams(e.options.url,[[i.COMMAND_URL_PARAM,r]]),s=t("<div>").attr("id",e.options.id+"MediaMenu").addClass("hideTextMediaInstructions").addClass("mediaInstructions").hide().html('<div><iframe class="pluginIframe" frameborder="0" src="/s/blank.html"data-src="'+a+'" '+'id="'+e.options.id+'-pluginIframe" '+'name="'+e.options.id+'-pluginIframe"></iframe>'+'<p class="mediaInstructionsTerms">'+"The content above is provided by "+'<a href="'+e.options.homepage_url+'" target="_blank">'+e.options.homepage_url+"</a> and is governed by their "+'<a href="'+e.options.terms_url+'" target="_blank">terms of service</a>.'+"</p></div>");t("#mediaDiv").find(".mediaInstructions:last").after(s)}})},runCustomPluginCommand:function(e,n,i){switch(e){case"cancel":t("#mediaDiv .cancelMediaLink").click();break;case"preview":this.setMediaPreview(i.content);break;case"submit":document.otherMediaForm.embedText.value=i.content,document.otherMediaForm.mediaType.value=n,document.otherMediaForm.save.click();break;default:alert("The "+n+" plugin requested an invalid operation.")}},registerPlugin:function(e){this.customPlugins[this.customPlugins.length]=e}}),e.PluginManager.add("wswidgetpopup",wikispaces.popups.Widget)}(tinymce,jQuery),function(e){var t=e.DOM;e.create("wikispaces.themes.WikispacesTheme",{init:function(t){var n=this;n.editor=t;var i=["Bold","Italic","Underline","InsertUnorderedList","InsertOrderedList"];t.settings,t.onInit.add(function(){for(var o=49;57>=o;o++)delete t.shortcuts["ctrl,,,"+o];t.plugins.wscommon.resizeToolbar(),jQuery(window).resize(function(){t.plugins.wscommon.resizeToolbar()}),_.delay(function(){jQuery(window).scrollLeft(0)},1e3),t.onNodeChange.add(function(t,o,r){if("visual"==t.plugins.wscommon.getOption("mode")){e.each(i,function(e){n.controlManager().get(e.toLowerCase()).setDisabled(t.wsselection&&t.wsselection.withinCode()),n.controlManager().get(e.toLowerCase()).setActive(t.queryCommandState(e))});var a=n.getHeaderParent(r);n.controlManager().get("formatlistbox").select(a?a.nodeName.toLowerCase():"p")}if(n.controlManager().get("insertunorderedlist").isActive()&&n.controlManager().get("insertorderedlist").isActive()){var s=jQuery(r).closest("ul,ol");s.is("ul")?n.controlManager().get("insertorderedlist").setActive(!1):n.controlManager().get("insertunorderedlist").setActive(!1)}}),"plain"==t.plugins.wscommon.getOption("mode")&&t.plugins.wstext?(t.plugins.wstext.flipToText(jQuery("#wsMainEditor").val()),ws.common.track("Editor","Start","Text")):ws.common.track("Editor","Start","Visual"),"wsMainEditor"==t.id&&jQuery("#wsMainEditor_container .mceIframeContainer").click(function(){var n=jQuery("<span>",t.getDoc()).appendTo(e.mainEditor.getBody());e.mainEditor.plugins.wscommon.cursorToAndRemoveElement(n),jQuery(".WikiOverlay").hide()}),e.isIE&&t.dom.bind(t.getDoc(),"controlselect",function(e){jQuery(e.srcElement).is("img,pre")&&t.onClick.dispatch(t,e)})});var o=!1;t.onKeyDown.add(function(e,t){t.ctrlKey||t.altKey||("9"==t.keyCode&&(t.preventDefault(),t.stopPropagation()),(8==t.keyCode||46==t.keyCode)&&(o=!e.selection.isCollapsed()))}),t.onKeyUp.add(function(e,t){8!=t.keyCode&&46!=t.keyCode||!o||e.undoManager.add()}),e.isWebKit&&t.onKeyUp.add(function(e,t){if((8==t.keyCode||46==t.keyCode)&&o&&""==jQuery.trim(jQuery(e.getBody()).text())&&e.dom.isBlock(jQuery(e.getBody()).children().get(0))){e.undoManager.begin(),jQuery(e.getDoc().body).children().remove();var n=jQuery("<span>",e.getDoc()).appendTo(e.getDoc().body).after("<br/>");e.plugins.wscommon.cursorToAndRemoveElement(n),e.undoManager.end(),e.undoManager.remove()}}),t.onActivate.add(function(e){n.controlManager().editor=e,jQuery(e.getContentAreaContainer()).addClass("active_editor")}),t.onDeactivate.add(function(e){e.initialized&&(jQuery(e.getContainer()).is(":visible")&&e.selection.collapse(),jQuery(e.getContentAreaContainer()).removeClass("active_editor"))}),t.onModeSwitch=new e.util.Dispatcher(t),t.onModeSwitch.add(function(t){e.each(i,function(e){n.controlManager().get(e.toLowerCase()).setActive(!1)}),"plain"==t?jQuery("#switchEditorModes span.mceText").text("Visual Editor").attr("title","Visual Editor"):jQuery("#switchEditorModes span.mceText").text("WikiText Editor").attr("title","WikiText Editor"),n.showToolSet()}),t.setClean=function(){this.startContent=e.trim(this.getContent({format:"raw",no_events:1}))},t.addCommand("wsInsertHorizontalRule",function(){e.isWebKit?t.execCommand("InsertHtml",!1,"<hr>"):t.execCommand("InsertHorizontalRule")}),t.wsExecCommand=function(e,n,i,o){switch(e){case"Bold":case"Italic":case"Underline":case"wsFormatBlock":case"wsInsertHorizontalRule":case"wsInsertOrderedList":case"wsInsertUnorderedList":case"wslink":case"wsimage":case"wsTable":case"wsWidget":case"wsStyle":case"preview":case"endPreview":if("plain"==t.plugins.wscommon.getOption("mode")){this.execCommand(e+"Text",n,i,o);break}default:this.execCommand(e,n,i,o)}}},controlManager:function(){return e.mainEditor.controlManager},getHeaderParent:function(e){var t=this.editor.dom.getParents(e);for(i=0;t.length>i;i++)if(t[i].nodeName.toLowerCase().match(/h\d/))return t[i]},showToolSet:function(e){var t=jQuery("#wsMainEditor_tools1 td > *:first-child");switch(e){case"preview":t.css("visibility","hidden"),jQuery("#wsMainEditor_wssave_action").css("visibility","visible"),jQuery("#wsMainEditor_wssave_open").css("visibility","visible"),jQuery("#wsMainEditor_wsendpreview").css("visibility","visible"),jQuery("#wsMainEditor_wsendpreview").css(jQuery.browser.msie&&jQuery.browser.version>=8?{left:-100,top:5}:{right:170,top:28}),jQuery.browser.webkit&&jQuery("#wsMainEditor_wsendpreview").parent().css("position","");break;default:t.css("visibility","visible"),jQuery("#wsMainEditor_wsendpreview").css("visibility","hidden"),"plain"==this.editor.plugins.wscommon.getOption("mode")&&(jQuery("#wsMainEditor_wscomment").css("visibility","hidden"),jQuery("#wsMainEditor_undo").css("visibility","hidden"),jQuery("#wsMainEditor_redo").css("visibility","hidden"))}},renderUI:function(n){function i(){jQuery("#menu_wsMainEditor_wsMainEditor_wssave_menu").is(":visible")||h.showMenu()}function o(){r.preventMenuCloseHoverButton||r.preventMenuCloseHoverMenu||r.preventMenuCloseClick||h.hideMenu()}var r=this,a=r.editor,s=a.controlManager,l=t.insertAfter(t.create("div",{id:a.id+"_container","class":"mceEditor "+a.settings.skin+"Skin"}),n.targetNode),c=t.add(l,"div",{id:a.id+"_external","class":"mceExternalToolbar toolbarLayer"}),u=t.create("div",{id:a.id+"_overlay","class":"wsPopupModalBlocker blockerLayer",style:"display: block !important; "});jQuery(".commentContainer").before(u),r.toolbar=s.createToolbar("tools1"),r.toolbar.add(s.createButton("bold",{title:"Bold",onclick:function(){e.activeEditor.wsExecCommand("Bold"),ws.common.track("Editor","Bold")}})),r.toolbar.add(s.createButton("italic",{title:"Italic",onclick:function(){e.activeEditor.wsExecCommand("Italic"),ws.common.track("Editor","Italic")}})),r.toolbar.add(s.createButton("underline",{title:"Underline",onclick:function(){e.activeEditor.wsExecCommand("Underline"),ws.common.track("Editor","Underline")}})),r.toolbar.add(s.createControl("wsstyle")),r.toolbar.add(s.createSeparator());var d=s.createListBox("formatlistbox",{title:"Format",onselect:function(t){e.activeEditor.wsExecCommand("wsFormatBlock",!1,t),ws.common.track("Editor","Select Font",t),jQuery("#wsMainEditor_formatlistbox").removeClass("mceListBoxSelected")}});d.onRenderMenu.add(function(t,n){n.onShowMenu.add(function(){function t(e){return document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,""):e.currentStyle?e.currentStyle:void 0}function i(e,t,n){if(document.defaultView&&document.defaultView.getComputedStyle)for(var i=0;t.length>i;i++){var o=t[i],r=t.getPropertyValue(o),a=e.getPropertyValue(o);r&&r!=a&&jQuery(n).css(o,r)}else for(var o in t){o=o.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()});var r=t[o],a=e[o];r&&r!=a&&jQuery(n).css(o,r)}}e.activeEditor.wsselection.save(2),n.alreadyRendered||(n.alreadyRendered=!0,jQuery(document.body).append('<div class="wiki" style="display: none;" id="styleHolder"><h1>h1</h1><h2>h2</h2><h3>h3</h3><h4>h4</h4><h5>h5</h5><h6>h6</h6><span>span</span></div>'),jQuery("#styleHolder").children().each(function(){var e;e="span"==this.nodeName.toLowerCase()?jQuery("#menu_wsMainEditor_wsMainEditor_formatlistbox_menu .toolbar_formatmenu_normal .mceText"):jQuery("#menu_wsMainEditor_wsMainEditor_formatlistbox_menu .toolbar_formatmenu_"+this.nodeName.toLowerCase()+" .mceText");var n=t(jQuery("#styleHolder").get(0)),o=t(this);i(n,o,e.get(0)),e.css("white-space","nowrap")}))}),n.onHideMenu.add(function(){e.activeEditor.wsselection.restore(),setTimeout(function(){e.activeEditor.focus()},100)}),n.settings.max_height=185}),d.add("1. Heading","h1",{"class":"toolbar_formatmenu_h1"}),d.add("2. Heading","h2",{"class":"toolbar_formatmenu_h2"}),d.add("3. Heading","h3",{"class":"toolbar_formatmenu_h3"}),d.add("4. Heading","h4",{"class":"toolbar_formatmenu_h4"}),d.add("5. Heading","h5",{"class":"toolbar_formatmenu_h5"}),d.add("6. Heading","h6",{"class":"toolbar_formatmenu_h6"}),d.add("Normal","p",{"class":"toolbar_formatmenu_normal"}),r.toolbar.add(d),d.originalShow=d.showMenu,d.showMenu=function(){var t=jQuery(window).scrollTop();d.originalShow(),jQuery(window).scrollTop(t),jQuery("#menu_wsMainEditor_wsMainEditor_formatlistbox_menu tr.mceFirst td").css("height",0),jQuery("#menu_wsMainEditor_wsMainEditor_formatlistbox_menu tr.mceFirst td a").html("").css({position:"relative",height:0,padding:0}),jQuery("#menu_wsMainEditor_wsMainEditor_formatlistbox_menu_co").css("height","auto").css("width","auto"),jQuery("#menu_wsMainEditor_wsMainEditor_formatlistbox_menu").css({borderBottom:"1px solid #d4d0c9",borderRight:"1px solid #d4d0c9"}).appendTo(document.body),a.plugins.wstoolbarscroll.moveScroller();var n=e.DOM.select("a","menu_"+d.menu.id)[1];jQuery(n).is(":visible")&&n.focus(),d.menu._focusIdx=1},r.toolbar.add(s.createSeparator()),r.toolbar.add(s.createButton("insertorderedlist",{title:"Numbered List",onclick:function(){e.activeEditor.wsExecCommand("wsInsertOrderedList"),ws.common.track("Editor","Add Ordered List")}})),r.toolbar.add(s.createButton("insertunorderedlist",{title:"Bulleted List",onclick:function(){e.activeEditor.wsExecCommand("wsInsertUnorderedList"),ws.common.track("Editor","Add Unordered List")}})),r.toolbar.add(s.createButton("hr",{title:"Insert Horizontal Rule",onclick:function(){e.activeEditor.wsExecCommand("wsInsertHorizontalRule"),ws.common.track("Editor","Add Horizontal Rule")}})),r.toolbar.add(s.createSeparator()),r.toolbar.add(s.createControl("wslink")),r.toolbar.add(s.createControl("wsimage")),r.toolbar.add(s.createControl("wswidget")),r.toolbar.add(s.createControl("wstable")),r.toolbar.add(s.createControl("wscomment")),r.toolbar.add(s.createSeparator()),r.toolbar.add(s.createButton("undo",{title:"Undo",onclick:function(){e.activeEditor.wsExecCommand("Undo"),ws.common.track("Editor","Undo")}})),r.toolbar.add(s.createButton("redo",{title:"Redo",onclick:function(){e.activeEditor.wsExecCommand("Redo"),ws.common.track("Editor","Redo")}})),r.toolbar.add(s.createSeparator()),r.toolbar.add(s.createButton("wspreview",{title:"Preview",label:"Preview","class":"mceButtonNotReallyLabeled mceButtonGroup mceButtonGroupLeft",onclick:function(){e.mainEditor.wsExecCommand("preview",!1,!1,{skip_undo:!0}),ws.common.track("Editor","Preview")
}})),r.toolbar.add(s.createButton("wsendpreview",{title:"Continue Editing",label:"Continue Editing","class":"continueBtn mceButtonNotReallyLabeled","class":"continueBtn",onclick:function(){e.mainEditor.wsExecCommand("endPreview",!1,!1,{skip_undo:!0})}})),r.toolbar.add(s.createControl("wscancel"));var h=s.createControl("wssave");r.toolbar.add(h),r.toolbar.renderTo(c),jQuery("#pageEditor").addClass("defaultSkin"),jQuery("#wsMainEditor_external").prependTo("#pageEditor"),jQuery("#wsMainEditor_wssave_action").addClass("mceButton mceButtonNotReallyLabeled mceButtonGroup mceButtonGroupRight mceButtonPrimary"),jQuery("#wsMainEditor_formatlistbox_open").click(function(){return!1}).bind("mousedown",function(){return d.showMenu(),!1}),r.preventMenuCloseHoverButton=!1,r.preventMenuCloseHoverMenu=!1,r.preventMenuCloseClick=!1,jQuery(document).on("mouseover","#menu_wsMainEditor_wsMainEditor_wssave_menu",function(){r.preventMenuCloseHoverMenu=!0,jQuery("#menu_wsMainEditor_wsMainEditor_wssave_menu").die("mouseover"),jQuery(this).hover(function(){return r.preventMenuCloseHoverMenu=!0,!0},function(){return r.preventMenuCloseHoverMenu=!1,setTimeout(o,500),!0})}),jQuery(c).find("#wsMainEditor_wssave_open, #wsMainEditor_wssave").removeAttr("title"),jQuery(c).find("#wsMainEditor_wssave_open .mceOpen").click(function(e){return r.preventMenuCloseClick=!r.preventMenuCloseClick,i(),e.preventDefault(),!1}).hoverIntent({sensitivity:3,interval:200,over:function(){r.preventMenuCloseHoverButton=!0,i()},timeout:500,out:function(){r.preventMenuCloseHoverButton=!1,o()}}),jQuery(c).prepend('<table style="width: 100%; border-collapse: collapse; background: transparent;" ><tr style="height: 21px;"><td style="width:10px; background: url(/i/window-bar-nl.png) no-repeat left bottom; padding: 0;"><img src="/i/c.gif" width="10" height="21" alt="" /></td><td style="width:75%; background: url(/i/window-bar-n.png) repeat-x left bottom; padding: 0;"></td><td style="width:23px; background: url(/i/window-bar-yl.png) no-repeat left bottom; padding: 0;"><img src="/i/c.gif" width="23" height="21" alt="" /></td><td style="width:25%; background: url(/i/window-bar-m.png) repeat-x left bottom; padding: 0; text-align: right;"><span id="autosaveStatus"></span></td><td style="width:10px; background: url(/i/window-bar-mr.png) no-repeat left bottom; padding: 0;"><img src="/i/c.gif" width="10" height="21" alt="" /></td></tr></table>'),jQuery("#wsMainEditor_external").css({MozUserSelect:"none",KhtmlUserSelect:"None",cursor:"default"}).bind("selectstart",function(){return!1});var p=t.add(l,"div",{"class":"mceIframeContainer editorLayer active_editor",style:"position: relative;"}),f=t.add(l,"div",{style:"display: none;"});return{iframeContainer:p,editorContainer:a.id+"_container",sizeContainer:f,deltaHeight:0}},getInfo:function(){return{longname:"Wikispaces theme",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}}}),e.ThemeManager.add("wikispaces",wikispaces.themes.WikispacesTheme)}(tinymce),function(e){var t=e.DOM;e.create("wikispaces.themes.SubEditorTheme:wikispaces.themes.WikispacesTheme",{renderUI:function(e){var n=this,i=n.editor,o=t.insertAfter(t.create("div",{id:i.id+"_container","class":"mceEditor "+i.settings.skin+"Skin editorLayer",style:"position: relative; "}),e.targetNode),r=t.add(o,"div",{"class":"mceIframeContainer editorLayer",style:"position: relative;"}),a=t.add(o,"div",{style:"display: none;"});return{iframeContainer:r,editorContainer:i.id+"_container",sizeContainer:a,deltaHeight:0}},getInfo:function(){return{longname:"Wikispaces subeditor theme",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}}}),e.ThemeManager.add("subeditor",wikispaces.themes.SubEditorTheme)}(tinymce),function(e){var t=e.DOM;e.create("wikispaces.themes.ReferenceTheme:wikispaces.themes.WikispacesTheme",{renderUI:function(n){var i=this,o=i.editor,r=o.controlManager,a=o.getParam("reference_reference_id"),s=t.insertAfter(t.create("div",{id:o.id+"_container","class":"mceEditor "+o.settings.skin+"Skin editorLayer referenceEditor",style:"position: relative; margin-top: 5px; "}),n.targetNode),l=t.add(s,"div",{"class":"mceIframeContainer editorLayer",style:"position: relative;"}),c=t.add(s,"div",{id:o.id+"_external","class":"toolbarLayer"});i.toolbar=r.createToolbar("tools1"),i.toolbar.add(r.createButton("wsremovereference",{title:"Remove Reference",label:"Remove Reference","class":"wsbtn",onclick:function(){e.mainEditor.plugins.wsreference.toggleReference(a)}})),i.toolbar.add(r.createButton("wsgotoreference",{title:"Show Citation",label:"Show Citation","class":"wsbtn",onclick:function(){var t=jQuery(e.mainEditor.getDoc()).find("#citation-"+a),n=o.plugins.wscommon.absoluteOffset(t.get(0)).top,i=0,r=function(){i++>2||t.animate({opacity:"0.1"},500,"swing",function(){t.animate({opacity:"1.0"},500,"swing",r)})};jQuery(window).scrollTo(n-55,{axis:"y",duration:500,onAfter:r})}})),i.toolbar.renderTo(c),jQuery(c).find("td:first-child").attr("width",5),jQuery(c).find("td:nth-child(2)").attr("width",140),jQuery(c).find("td:nth-child(3)").attr("width",120);var u=t.add(s,"div",{style:"display: none;"});return{iframeContainer:l,editorContainer:o.id+"_container",sizeContainer:u,deltaHeight:0}},getInfo:function(){return{longname:"Wikispaces reference theme",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}}}),e.ThemeManager.add("reference",wikispaces.themes.ReferenceTheme)}(tinymce),function(e){e.create("wikispaces.plugins.ImageTextPlugin:wikispaces.plugins.ImagePlugin",{init:function(t){var n=this;this.editor=t,t.addCommand("wsimageText",function(){e.mainEditor.plugins.wspopup.show("imageTool",{plugin:n})})},getInfo:function(){return{longname:"Wikispaces image text",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},insertImageInEditorCallback:function(e,t,n,i,o,r,a){document.forms.imageToolForm;var s=r;if(r&&this.isLocalContext(r)&&(s=""),"audio"==n||"video"==n)this.editor.wsselection.setContent('[[media type="'+e+'" key="'+s+t+'"]]');else{var l="";if("image"==n&&a.width>800){var c=Math.floor(800/a.width*a.height);l=' width="800" height="'+c+'"'}"image"==n&&(e="image"),this.editor.wsselection.setContent("[["+e+":"+(i?i:s+t)+l+"]]")}}}),e.PluginManager.add("wsimagetext",wikispaces.plugins.ImageTextPlugin)}(tinymce),function(e,t){e.create("wikispaces.plugins.LinkTextPlugin:wikispaces.plugins.LinkPlugin",{init:function(t){var n=this;this.editor=t,t.addCommand("wslinkText",function(){e.mainEditor.plugins.wspopup.show("linkTool",{plugin:n})})},getInfo:function(){return{longname:"Wikispaces link (text)",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},setupForms:function(){this.editor.wsselection.restore(!0),this.editor.plugins.wstext.expandSelectionToTag("[[","","]]");var e=t.trim(this.editor.plugins.wstext.getSelectedText());e&&this.editor.plugins.wslinkpopup.prefill(this.parseLink(e))},parseLink:function(e){var t="",n="",i=null;if(i=e.match(/^\[\[(@)?((?:[a-zA-Z0-9.+-]+:\/\/|mailto:).*?)(?:\|(.*))?\]\]$/i)){var o="",r="";if(i[1]&&(t=i[1]),i[3]&&(n=i[3]),i[2]){o=i[2];var a=null;(a=o.match(/^mailto:(.+)/i))&&(r=a[1]),n||(n=o)}return{linkText:n,extLink:o,mailTo:r,targetNew:t}}if(i=e.match(/\[\[(@)?(?:([a-z0-9-]+):)?(?:([a-z0-9-]+)[:\/])?([^|\[\]\{\}\$#@\\]+)(?:\#([A-Za-z][-A-Za-z0-9_ ]*))?(?:\|([^\[\]\xff]+))?\]\]/)){var s="",l="",c="",u="page";return i[1]&&(t=i[1]),i[2]&&i[3]?(u=i[2],s=i[3]):i[2]&&("doc"==i[2]||"file"==i[2]?u=i[2]:s=i[2]),i[4]&&(l=i[4]),(match=l.match(/^[\/:](.*)/))&&(s=wikispaces_wikiName,l=match[1]),i[5]&&(c=i[5]),i[6]&&(n=i[6]),n||(n=s&&s!=wikispaces_wikiName?s+" / "+l:l),{linkText:n,objectClass:u,pageName:l,wikiName:s,anchor:c,targetNew:t}}return{linkText:e}},insertLinkFromComponents:function(e){var t="";if(e.targetNew&&(t="@"),e.pageName){var n="page"==e.objectClass?"":e.objectClass+":",i=n+(e.wikiName==wikispaces_wikiName?"":e.wikiName+":")+e.pageName;this.editor.wsselection.setContent("[["+t+i+(e.anchor?e.anchor:"")+(e.linkText==i?"":"|"+e.linkText)+"]] "),ws.common.track("Editor","Add Link",e.wikiName+":"+i)}else if(e.mailTo){var o="mailto:"+encodeURI(e.mailTo).replace(/%25/g,"%");this.editor.wsselection.setContent("[["+t+o+(o==e.linkText?"":"|"+e.linkText)+"]] "),ws.common.track("Editor","Add Link",o)}else{var o=encodeURI(e.url).replace(/%25/g,"%");this.editor.wsselection.setContent("[["+t+o+(o==e.linkText?"":"|"+e.linkText)+"]] "),ws.common.track("Editor","Add Link",o)}return!0},removeLink:function(){if(ws.common.track("Editor","Remove Link"),this.editor.plugins.wstext.expandSelectionToTag("[[","","]]")){var e=this.editor.plugins.wstext.getSelectedText();if(!("[[code]]"==e||e.match(/^\[\[media /)||e.match(/^\[\[file /)||e.match(/^\[\[image /)||e.match(/^\[\[include /))){var t=e.match(/(\s*)\[\[([^\]]*)\]\](\s*)/);return e=t[1]+t[2]+t[3],this.editor.plugins.wstext.insertInEditor(e),void 0}}alert("Please put your cursor inside of the link wikitext to remove it.")}}),e.PluginManager.add("wslinktext",wikispaces.plugins.LinkTextPlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.PreviewTextPlugin:wikispaces.plugins.PreviewPlugin",{init:function(e){this.editor=e;var t=this;e.addCommand("previewText",function(){t.showPreview()}),e.addCommand("endPreviewText",function(){t.hidePreview()})},getInfo:function(){return{longname:"Wikispaces preview text",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},hideEditor:function(){t("#plainTextEditor").hide()},showEditor:function(){t("#plainTextEditor").show()}}),e.PluginManager.add("wspreviewtext",wikispaces.plugins.PreviewTextPlugin)}(tinymce,jQuery),function(e,t){e.create("wikispaces.plugins.StyleTextPlugin:wikispaces.plugins.StylePlugin",{init:function(t){var n=this;this.editor=t,t.addCommand("wsStyleText",function(){var t=n.editor.plugins.wstext.getSelectedText();e.mainEditor.plugins.wspopup.show("stylePopupContents",{plugin:n,text:t})})},getInfo:function(){return{longname:"Wikispaces style text",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},setSpanText:function(e){if(e.text){var n=e.text.match(/^<span\s+.*?style="([\s\S]*?)"[\s\S]*<\/span>$/i);if(n&&2==n.length)for(var i=n[1],o=i.split(";"),r=0;o.length>r;r++){var a=o[r].split(":"),s=t.trim(a[0]),l=t.trim(a[1]);s&&l&&(this.setSpanTextValue(s,l),document.styleForm.removeStyleButton.disabled=!1)}}},applyStyle:function(){ws.common.track("Editor","Apply Style");var e=t.trim(document.styleForm.styleText.value);if(e.length>0){var n=this.editor.plugins.wstext.getSelectedText(),i=n.match(/^<span [\s\S]*?>([\s\S]*)<\/span>$/i);i&&2==i.length&&(n=i[1]);var o=document.getElementById("textEditor");o.focus(),this.editor.plugins.wstext.insertInEditor('<span style="'+e+'">'+n+"</span>")}else this.removeStyle();return!1},removeStyle:function(){ws.common.track("Editor","Remove Style");var e=this.editor.plugins.wstext.getSelectedText(),t=e.match(/^<span [\s\S]*?>([\s\S]*)<\/span>$/i);t&&2==t.length&&this.editor.plugins.wstext.insertInEditor(t[1])},getUsedColors:function(){var e=[],t=this.editor.plugins.wstext.getContent(),n=t.match(/style=\"[^\"]*?color:\s*.*?[;\"]/gi);if(n)for(var i=0;n.length>i;i++){var o=n[i].match(/color:\s*(.*?)[;\"]/i);e[e.length]=new RGBColor(o[1]).toHex().toUpperCase()}return e}}),e.PluginManager.add("wsstyletext",wikispaces.plugins.StyleTextPlugin)}(tinymce,jQuery),function(e){e.create("wikispaces.plugins.TableTextPlugin:wikispaces.plugins.TablePlugin",{init:function(t){var n=this;this.editor=t,t.addCommand("wsTableText",function(){e.mainEditor.plugins.wspopup.show("tablePopupContents",{plugin:n})})},getInfo:function(){return{longname:"Wikispaces table text",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},addTable:function(e,t){ws.common.track("Editor","Add Table",e+"x"+t);for(var n="",i=0;e>i;i++)for(n+="\n||",cols=0;t>cols;cols++)n+=" ||";n+="\n",this.editor.wsselection.setContent(n)}}),e.PluginManager.add("wstabletext",wikispaces.plugins.TableTextPlugin)}(tinymce),function(e,t){e.create("wikispaces.plugins.TextPlugin",{init:function(e){var n=this;n.editor=e,e.addCommand("wstext",function(){"visual"==e.plugins.wscommon.getOption("mode")?n.switchToTextEditor():(t("#previewBox").length&&e.execCommand("endPreviewText"),n.switchToVisualEditor())}),e.addCommand("BoldText",function(){n.wrapTextEditorSelection("**")}),e.addCommand("ItalicText",function(){n.wrapTextEditorSelection("//")}),e.addCommand("UnderlineText",function(){n.wrapTextEditorSelection("__")}),e.addCommand("wsFormatBlockText",function(e,t){var i="";if("h1"==t?i="=":"h2"==t?i="==":"h3"==t?i="===":"h4"==t?i="====":"h5"==t?i="=====":"h6"==t&&(i="======"),i)if(n.getSelectedText())n.insertInEditor("\n"+i+n.getSelectedText()+i+"\n");else{var o=document.getElementById("textEditor");n.prepareSelection(o);var r=o.sel_start+i.length+1;n.insertInEditor("\n"+i+i+"\n"),n.setSelectionRange(o,r,r)}document.getElementById("textEditor").focus()}),e.addCommand("wsInsertOrderedListText",function(){n.addListInTextEditor("#")}),e.addCommand("wsInsertUnorderedListText",function(){n.addListInTextEditor("*")}),e.addCommand("wsInsertHorizontalRuleText",function(){n.insertInEditor("\n----\n")})},getInfo:function(){return{longname:"Wikispaces text",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},flipToText:function(n){function i(){t("#textEditor").css("width",t("#textEditor").parent().width()-10)}this.editor.undoManager.clear(),t("#plainTextEditor").show(),t("#textEditor").show().val(n),t("html, body").animate({scrollTop:0},"fast"),t("#wsMainEditor_container").css("position","static"),this.editor.plugins.wscommon.setOption("mode","plain"),this.editor.onModeSwitch.dispatch("plain"),t(this.editor.getContentAreaContainer()).hide(),setTimeout(function(){t("#textEditor").focus()},500),e.isIE&&(i(),t(window).resize(i)),this.setClean()},switchToTextEditor:function(){var e=this,t=this.editor.plugins.wscommon.fullContent(!0);this.convertContent(t,"plain",function(t){e.flipToText(t)},function(){e.switchToTextEditor()}),ws.common.track("Editor","Switch Mode To","Text")},switchToVisualEditor:function(){var e=this;this.convertContent(this.editor.plugins.wstext.getContent(),"visual",function(n){t("#plainTextEditor").hide(),t(e.editor.getContentAreaContainer()).show(),t("html, body").animate({scrollTop:0},"fast"),e.editor.plugins.wscommon.setOption("mode","visual"),e.editor.onModeSwitch.dispatch("visual"),e.editor.setContent(n,{load:!0}),e.editor.undoManager.clear(),e.editor.onNeedsResize.dispatch(),setTimeout(function(){e.editor.onNeedsResize.dispatch()},1e3),e.editor.wsselection.ensureCursor(),e.editor.focus(),t("#wsMainEditor_container").css("position","relative")},function(){e.switchToVisualEditor()}),ws.common.track("Editor","Switch Mode To","Visual")},convertContent:function(e,n,i,o){var r=this,a=t("<div></div>").attr("id","textSpinner").addClass("wikispaces_content").addClass("mceToolbar spinner").css({textAlign:"center"}).html('Loading <img src="/i/spinner.gif" alt="" width="18" height="18" style="padding-top: 9px; vertical-align: -4px;"/>');t(".mceToolbar").hide(),t(r.editor.plugins.wscommon.editorToolbar()).append(a);var s=function(){ws.session.reloadSession(o,3e3,function(){r.editor.plugins.wscommon.sessionReloadFailed(),t(".mceToolbar.spinner").remove(),t(".mceToolbar").show()})};t.ajax({url:ws.common.pathFor("page","convert",wikispaces_page),type:"POST",async:!1,cache:!1,data:{content:e,mode:n},dataType:"xml",global:!1,error:s,success:function(e){ws.session.reloadSessionSuccess();var n=t(e).find("convert");n.length&&i(n.text()),t(".mceToolbar.spinner").remove(),t(".mceToolbar").show()}})},editorTextArea:function(){return t("#textEditor").get(0)},getContent:function(){return t("#textEditor").val()},isDirty:function(){return this.getContent()!=this.cleanContent},setClean:function(){this.cleanContent=this.getContent()},insertInEditor:function(e){var n=document.getElementById("textEditor");if(n.focus(),document.selection)sel=document.selection.createRange(),sel.text=e,sel.select();else if(n.selectionStart||"0"==n.selectionStart){var i=n.selectionStart,o=n.selectionEnd,r=n.scrollTop;t(n).val(n.value.substring(0,i)+e+n.value.substring(o,n.value.length)),n.scrollTop=r,i==o?this.setSelectionRange(n,i+e.length,i+e.length):this.setSelectionRange(n,i,i+e.length),this.editor.wsselection.saveOver()}else n.value+=e},setSelectionRange:function(e,t,n){if(e.setSelectionRange)return e.setSelectionRange(t,n);var i=e.createTextRange();i.collapse(!0),i.moveEnd("character",n),i.moveStart("character",t),i.select()},wrapTextEditorSelection:function(e){var t=this.getSelectedText(),n=t.length;t=t.replace(/^\s+/,"");var i=n-t.length;t=t.replace(/\s+$/,"");var o=n-i-t.length,r="";r=t.substring(0,e.length)==e&&t.substring(t.length-e.length,t.length)==e?t.substring(e.length,t.length-e.length):e+t+e;for(var a=0;i>a;a++)r=" "+r;for(var a=0;o>a;a++)r+=" ";var s=document.getElementById("textEditor");this.prepareSelection(s);var l=s.sel_start,c=s.sel_end,u=r.length;this.insertInEditor(r),l==c?this.setSelectionRange(s,l+u/2,l+u/2):this.setSelectionRange(s,l,u+l),this.editor.wsselection.saveOver(),s.focus()},getSelectedText:function(){var e=document.getElementById("textEditor");return e?(this.prepareSelection(e),e.sel_text?e.sel_text:""):""},prepareSelection:function(e){if(e.sel_text="",e.sel_text_pre="",e.sel_text_post="",e.sel_start=0,e.sel_end=0,e.focus(),"number"==typeof e.selectionStart)e.sel_start=e.selectionStart,e.sel_end=e.selectionEnd;else if(document.selection){var n=document.selection.createRange();if(n.parentElement()!=e)return;var i=n.duplicate();i.moveToElementText(e),i.setEndPoint("EndToEnd",n);for(var o=i.text.length,r=o-n.text.length,a=e.value,s=o-1;s>=r;--s)"\n"==a.charAt(s)&&--o;for(var s=r-1;s>=0;--s)"\n"==a.charAt(s)&&(--o,--r);e.sel_start=r,e.sel_end=o}var l=t(e).val();e.sel_text=l.substring(e.sel_start,e.sel_end),e.sel_text_pre=l.substring(0,e.sel_start),e.sel_text_post=l.substring(e.sel_end)},expandSelectionToLine:function(){var e=document.getElementById("textEditor");this.prepareSelection(e);for(var n,i=t(e).val(),o=e.sel_start-1;o>=0;o--)if("\n"==i.charAt(o)){n=o+1;break}for(o=e.sel_end;i.length>o&&"\n"!=i.charAt(o);o++);return this.setSelectionRange(e,n,o),!0},expandSelectionToTag:function(e,n,i){var o=this.getSelectedText().replace(/^\s+/,"").replace(/\s+$/,"");if(o)return o.substring(0,n.length+e.length)==e+n&&o.substring(o.length-i.length,o.length)==i?!0:!1;var r=document.getElementById("textEditor");this.prepareSelection(r);var a=0,s=0,l=r.sel_start-1;0>l&&(l=0);for(var c=null,u=t(r).val(),d=l;d>=0;d--)if(u.substr(d,e.length+n.length)==e+n){if(0==s){c=d;break}s--}else{if(u.substr(d,e.length)==e)return!1;u.substr(d,i.length)==i&&r.sel_start-d>=i.length&&s++}if(null==c)return!1;l=r.sel_end-(i.length-1),0>l&&(l=0),c+e.length+n.length>l&&(l=c+e.length+n.length);for(var d=l;u.length-1>d;d++)if(u.substr(d,i.length)==i){if(0==a)return this.setSelectionRange(r,c,d+i.length),this.editor.wsselection.saveOver(),!0;a--}else u.substr(d,e.length)==e&&a++;return!1},addListInTextEditor:function(e){this.getSelectedText()||this.expandSelectionToLine();var t=document.getElementById("textEditor");this.prepareSelection(t);for(var n=t.sel_text,i="",o=!0,r=n.split("\n"),a=0;r.length>a;a++){var s;(s=r[a].match(/^(\#|\*|\>)+\s(.*)$/i))?(s[1].charAt(0)!=e&&(o=!1),i+="\n"+e+" "+s[2]):(o=!1,i+="\n"+e+" "+r[a])}if((0==t.sel_text_pre.length||"\n"==t.sel_text_pre.charAt(t.sel_text_pre.length-1))&&(i=i.substring(1,i.length)),o){var n=t.sel_text;i="";for(var r=n.split("\n"),a=0;r.length>a;a++)(s=r[a].match(/^(\#|\*|\>)+\s(.*)$/i))&&(i+=s[2]+"\n");"\n"!=t.sel_text.charAt(t.sel_text.length-1)&&(i=i.substring(0,i.length-1))}this.insertInEditor(i)}}),e.PluginManager.add("wstext",wikispaces.plugins.TextPlugin)}(tinymce,jQuery),function(e){e.create("wikispaces.plugins.WidgetTextPlugin:wikispaces.plugins.WidgetPlugin",{init:function(t){var n=this;this.editor=t,t.addCommand("wsWidgetText",function(){ws.common.track("Editor","Open Media Tool");var i="";t.plugins.wstext.expandSelectionToTag("[[","media","]]")?i="wikitext@@media@@"+t.plugins.wstext.getSelectedText().match(/\[\[media (.*)\]\]/)[1]:t.plugins.wstext.expandSelectionToTag("[[","rss","]]")?i="wikitext@@rss@@"+t.plugins.wstext.getSelectedText().match(/\[\[rss (.*)\]\]/)[1]:t.plugins.wstext.expandSelectionToTag("[[","","]]")&&(i=t.plugins.wstext.getSelectedText().match(/^\[\[(#.+)\]\]/)[1]),e.mainEditor.plugins.wspopup.show("mediaTool",{plugin:n,mediaString:i})})},getInfo:function(){return{longname:"Wikispaces widgets text",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},insertWidget:function(e,t){ws.common.track("Editor","Add Media",t),this.editor.wsselection.setContent(e)},insertCharacter:function(e,t){ws.common.track("Editor","Add Character",e),this.editor.wsselection.setContent(t)},insertReference:function(){ws.common.track("Editor","Insert Reference"),this.editor.wsselection.setContent("<ref></ref>")},insertReferences:function(){ws.common.track("Editor","Insert References"),this.editor.wsselection.setContent("\n<references/>")},insertToc:function(e){ws.common.track("Editor","Insert Toc",e),e?this.editor.wsselection.setContent("\n[[toc|flat]]"):this.editor.wsselection.setContent("\n[[toc]]")},insertCode:function(e,t){t||(t="text"),ws.common.track("Editor","Add Code",t),this.editor.wsselection.setContent('\n[[code format="'+t+'"]]\n'+e+"\n[[code]]\n")},insertAnchor:function(e){return ws.common.track("Editor","Add Anchor",e),this.editor.wsselection.setContent("[[#"+e+"]]"),!0}}),e.PluginManager.add("wswidgettext",wikispaces.plugins.WidgetTextPlugin)}(tinymce),function(e,t){e.create("wikispaces.plugins.WidgetOverlay:wikispaces.plugins.ImageOverlay",{getInfo:function(){return{longname:"Wikispaces widget overlay",author:"Tangient LLC",authorurl:"/web/20130613001053/http://wikispaces.com",infourl:"/web/20130613001053/http://wikispaces.com",version:"0.1"}},init:function(e,t){var n=this;e.onInit.add(function(e){var t=function(e){e.onClick.add(function(e,t){var i=e.plugins.wswidget.findWidgetPlaceholder(t.target);i?n.show(e,i):n.hide()})};e.onInitSubEditor.add(t),t(e)}),this.overlayInit(e,t)},show:function(e,n){if(this.parent(e,n),t(n).hasClass("WikiAnchor")){var i=t(n).attr("id").match(/@@([^@]+)$/)[1];t("#mediaAnchorName").text(ws.common.truncify(i,40)),t("#mediaEdit").show(),t("#mediaAppearance").hide(),t("#mediaAnchorNameSection").show()}else t(n).is(".WikiMediaToc, .WikiMediaTocFlat")?(t("#mediaEdit").hide(),t("#mediaAppearance").hide(),t("#mediaAnchorNameSection").hide()):t(n).is(".WikiMediaRss, .WikiMediaInclude")?(t("#mediaEdit").show(),t("#mediaAppearance").hide(),t("#mediaAnchorNameSection").hide()):(t("#mediaEdit").show(),t("#mediaAppearance").show(),t("#mediaAnchorNameSection").hide());this.repositionAndShow()},overlayContent:function(){return ws.editor.content.loadContent("mediaProperties")},refreshAlignment:function(){switch(t("#mediaAlign a").removeClass("buttonSelected"),this.currentAlignment()){case"left":t("#mediaAlignLeft").addClass("buttonSelected");break;case"center":t("#mediaAlignCenter").addClass("buttonSelected");break;case"right":t("#mediaAlignRight").addClass("buttonSelected")}},setup:function(){var e=this;t("#mediaAlignLeft").click(function(){return e.setImageAlignment("left"),!1}),t("#mediaAlignCenter").click(function(){return e.setImageAlignment("center"),!1}),t("#mediaAlignRight").click(function(){return e.setImageAlignment("right"),!1}),t("#mediaAlignNone").click(function(){return e.setImageAlignment(""),!1}),t("#mediaSizeDown").click(function(){return e.adjustImageSize(-.1),!1}),t("#mediaSizeUp").click(function(){return e.adjustImageSize(.1),!1}),t("#mediaSizeOriginal").click(function(){return e.adjustImageSize(0,!0),!1}),t("#mediaSizeFit").click(function(){return e.adjustImageSize(0,!1,!0),!1}),t("#mediaEditLink").click(function(){return e.editor.plugins.wswidget.openWidget(e.img),e.hide(),!1}),t("#mediaRemoveLink").click(function(){return e.editor.undoManager.add(),e.editor.dom.remove(e.img),e.hide(),!1})},toggleFitImage:function(){t(this.img).width()>800?t("#mediaSizeFit").show():t("#mediaSizeFit").hide()}}),e.PluginManager.add("wswidgetoverlay",wikispaces.plugins.WidgetOverlay)}(tinymce,jQuery),function(){tinymce.create("tinymce.plugins.Autoresize",{init:function(e){e.onNeedsResize=new tinymce.util.Dispatcher(e),e.onNeedsResize.add(this.fitEditor),e.onSetContent.add(this.fitEditor),e.onChange.add(this.fitEditor),e.onKeyDown.add(this.fitEditor),e.onInit.add(this.fitEditor),e.onPaste.add(function(){_.delay(function(){e.onNeedsResize.dispatch()},200)}),e.onNeedsResize.dispatch()},fitEditor:function(){editorID=this.id;var e,t,n,i,o;if(t=document.getElementById(editorID+"_ifr"),null!=t){if(t.contentDocument?n=t.contentDocument:t.contentWindow?n=t.contentWindow.document:t.document&&(n=t.document),null==n)return;n.body.style.overflow="hidden",e=t.parentNode.parentNode.parentNode.parentNode,e.style.height="auto",o=parseInt(t.style.height),i=tinymce.isWebKit||jQuery.browser.mozilla?jQuery(n.body).height():parseInt(n.body.scrollHeight);var r=tinymce.isWebKit?0:50;i+r>o?t.style.height=i+r+"px":o>i+r&&(t.style.height=Math.max(i+r,100)+"px"),jQuery(t).parent().css("width","100%"),jQuery(t).scrollTo(0)}}}),tinymce.PluginManager.add("autoresize",tinymce.plugins.Autoresize)}(),function(){tinymce.create("tinymce.plugins.Rgbcolor",{init:function(){}}),tinymce.PluginManager.add("rgbcolor",tinymce.plugins.Rgbcolor)}();